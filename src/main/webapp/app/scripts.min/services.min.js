var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,k,e){if(e.get||e.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[k]=e.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var k=0;return $jscomp.iteratorPrototype(function(){return k<a.length?{done:!1,value:a[k++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,k){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var e=0,l={next:function(){if(e<a.length){var u=e++;return{value:k(u,a[u]),done:!1}}l.next=function(){return{done:!0,value:void 0}};return l.next()}};l[Symbol.iterator]=function(){return l};return l};
$jscomp.polyfill=function(a,k,e,l){if(k){e=$jscomp.global;a=a.split(".");for(l=0;l<a.length-1;l++){var u=a[l];u in e||(e[u]={});e=e[u]}a=a[a.length-1];l=e[a];k=k(l);k!=l&&null!=k&&$jscomp.defineProperty(e,a,{configurable:!0,writable:!0,value:k})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");var app=angular.module("portalNMC");
app.service("indicatorSvc",["mainSvc",function(a){var k=null,e=null,l=null,u=null,g="24h",A="",w="24h",h=null,x=null,t=moment().subtract(6,"days").startOf("day").format("YYYY-MM-DD"),b=moment().endOf("day").format("YYYY-MM-DD"),m=[{header:"\u0413\u041a\u0430\u043b \u043d\u0430 \u0432\u0445\u043e\u0434\u0435","class":"col-xs-1 col-md-1",fieldName:"h_in",imgpath:"",imgclass:"",title:""},{header:"\u0413\u041a\u0430\u043b \u043d\u0430 \u0432\u044b\u0445\u043e\u0434\u0435","class":"col-xs-1 col-md-1",
fieldName:"h_out",imgpath:"",imgclass:"",title:""},{header:"\u041f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435 \u0442\u0435\u043f\u043b\u043e\u0432\u043e\u0439 \u044d\u043d\u0435\u0440\u0433\u0438\u0438, \u0413\u041a\u0430\u043b","class":"col-xs-1 col-md-1 nmc-distinguish",fieldName:"h_delta",imgpath:"",imgclass:"",title:""},{header:"\u041c\u0430\u0441\u0441\u0430 \u043f\u043e\u0434\u0430\u0447\u0438, \u0442","class":"col-xs-1 col-md-1",fieldName:"m_in",imgpath:"",imgclass:"",title:""},
{header:"\u041c\u0430\u0441\u0441\u0430 \u043e\u0431\u0440\u0430\u0442\u043a\u0438, \u0442","class":"col-xs-1 col-md-1",fieldName:"m_out",imgpath:"",imgclass:"",title:""},{header:"\u0420\u0430\u0437\u043d\u0438\u0446\u0430 \u043c\u0430\u0441\u0441 \u0432\u043e\u0434\u044b, \u0442","class":"col-xs-1 col-md-1 nmc-distinguish",fieldName:"m_delta",imgpath:"",imgclass:"",title:""},{header:"\u041e\u0431\u044a\u0435\u043c \u043f\u043e\u0434\u0430\u0447\u0438, \u043c3","class":"col-xs-1 col-md-1",fieldName:"v_in",
imgpath:"",imgclass:"",title:""},{header:"\u041e\u0431\u044a\u0435\u043c \u043e\u0431\u0440\u0430\u0442\u043a\u0438, \u043c3","class":"col-xs-1 col-md-1",fieldName:"v_out",imgpath:"",imgclass:"",title:""},{header:"\u0420\u0430\u0437\u043d\u0438\u0446\u0430 \u043e\u0431\u044a\u0435\u043c\u043e\u0432, \u043c3","class":"col-xs-1 col-md-1 nmc-distinguish",fieldName:"v_delta",imgpath:"",imgclass:"",title:""},{header:"\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0430 \u043f\u043e\u0434\u0430\u0447\u0435, \u041c\u043f\u0430",
"class":"col-xs-1 col-md-1",fieldName:"p_in",imgpath:"",imgclass:"",title:""},{header:"\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0430 \u043e\u0431\u0440\u0430\u0442\u043a\u0435, \u041c\u043f\u0430","class":"col-xs-1 col-md-1",fieldName:"p_out",imgpath:"",imgclass:"",title:""},{header:"\u0420\u0430\u0437\u043d\u043e\u0441\u0442\u044c \u0434\u0430\u0432\u043b\u0435\u043d\u0438\u0439, \u041c\u043f\u0430","class":"col-xs-1 col-md-1",fieldName:"p_delta",imgpath:"",imgclass:"",title:""},
{header:"\u0422\u0435\u043c\u043f. \u043f\u043e\u0434\u0430\u0447\u0438","class":"col-xs-1 col-md-1",fieldName:"t_in",imgpath:"",imgclass:"",title:"",dataType:"temperature"},{header:"\u0422\u0435\u043c\u043f. \u043e\u0431\u0440\u0430\u0442\u043a\u0438","class":"col-xs-1 col-md-1",fieldName:"t_out",imgpath:"",imgclass:"",title:"",dataType:"temperature"},{header:"\u0422\u0435\u043c\u043f. \u0425\u0412\u0421","class":"col-xs-1 col-md-1",fieldName:"t_cold",imgpath:"",imgclass:"",title:"",dataType:"temperature"},
{header:"\u0422\u0435\u043c\u043f. \u043e\u043a\u0440. \u0441\u0440\u0435\u0434\u044b","class":"col-xs-1 col-md-1",fieldName:"t_outdoor",imgpath:"",imgclass:"",title:"",dataType:"temperature"}],v=[{header:"\u0414\u0430\u0442\u0430",headerClass:"col-xs-2 col-md-2",dataClass:"col-xs-2 col-md-2",fieldName:"dataDate","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:!1,isvisible:"isvisible"},{header:"\u0412\u0440\u0435\u043c\u044f \u043d\u0430\u0440\u0430\u0431\u043e\u0442\u043a\u0438, \u0447\u0430\u0441",
headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"workTime","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:!1,isvisible:"isvisible"},{header:"\u0413\u041a\u0430\u043b \u043d\u0430 \u0432\u0445\u043e\u0434\u0435",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"h_in","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0413\u041a\u0430\u043b \u043d\u0430 \u0432\u044b\u0445\u043e\u0434\u0435",
headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"h_out","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u041f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435 \u0442\u0435\u043f\u043b\u043e\u0432\u043e\u0439 \u044d\u043d\u0435\u0440\u0433\u0438\u0438, \u0413\u041a\u0430\u043b",headerClass:"col-xs-1 col-md-1 nmc-distinguish",dataClass:"col-xs-1 col-md-1 nmc-distinguish",fieldName:"h_delta","1h":"1h","24h":"24h","1h_abs":"1h_abs",
"24h_abs":"24h_abs",istunable:"istunable"},{header:"\u041c\u0430\u0441\u0441\u0430 \u043f\u043e\u0434\u0430\u0447\u0438, \u0442",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"m_in","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u041c\u0430\u0441\u0441\u0430 \u043e\u0431\u0440\u0430\u0442\u043a\u0438, \u0442",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"m_out","1h":"1h","24h":"24h","1h_abs":"1h_abs",
"24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0420\u0430\u0437\u043d\u043e\u0441\u0442\u044c \u043c\u0430\u0441\u0441, \u0442",headerClass:"col-xs-1 col-md-1 nmc-distinguish",dataClass:"col-xs-1 col-md-1 nmc-distinguish",fieldName:"m_delta","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u041e\u0431\u044a\u0435\u043c \u043f\u043e\u0434\u0430\u0447\u0438, \u043c3",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"v_in","1h":"1h",
"24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u041e\u0431\u044a\u0435\u043c \u043e\u0431\u0440\u0430\u0442\u043a\u0438, \u043c3",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"v_out","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0420\u0430\u0437\u043d\u043e\u0441\u0442\u044c \u043e\u0431\u044a\u0435\u043c\u043e\u0432, \u043c3",headerClass:"col-xs-1 col-md-1 nmc-distinguish",dataClass:"col-xs-1 col-md-1 nmc-distinguish",
fieldName:"v_delta","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0430 \u043f\u043e\u0434\u0430\u0447\u0435, \u041c\u043f\u0430",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"p_in","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0430 \u043e\u0431\u0440\u0430\u0442\u043a\u0435, \u041c\u043f\u0430",
headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"p_out","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0420\u0430\u0437\u043d\u043e\u0441\u0442\u044c \u0434\u0430\u0432\u043b\u0435\u043d\u0438\u0439, \u041c\u043f\u0430",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"p_delta","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0422\u0435\u043c\u043f. \u043f\u043e\u0434\u0430\u0447\u0438",
headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"t_in",dataType:"temperature","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0422\u0435\u043c\u043f. \u043e\u0431\u0440\u0430\u0442\u043a\u0438",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"t_out",dataType:"temperature","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0422\u0435\u043c\u043f. \u0425\u0412\u0421",
headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"t_cold",dataType:"temperature","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0422\u0435\u043c\u043f. \u043e\u043a\u0440. \u0441\u0440\u0435\u0434\u044b",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"t_outdoor",dataType:"temperature","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"}],p=[],q=[{header:"\u0414\u0430\u0442\u0430",
headerClass:"col-xs-2 nmc-text-align-center",dataClass:"col-xs-2",fieldName:"dataDate","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:!1,isvisible:"isvisible"},{header:"\u041f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f",headerClass:"col-xs-1 nmc-text-align-center",dataClass:"col-xs-1",fieldName:"dataValue","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable",isvisible:"isvisible"}];(function(){var a=[{name:"p_A",caption:"A"},{name:"q_R",caption:"R"}],
b=[{name:"p",caption:"+"},{name:"n",caption:"-"}],g=[1,2,3,4,5],m=[{header:"\u0414\u0430\u0442\u0430",headerClass:"col-xs-2 col-md-2 nmc-text-align-center",dataClass:"col-xs-2 col-md-2",fieldName:"dataDateString",type:"string",date:!0,istunable:!1,isvisible:"isvisible"}],h,z,e,f;for(h=0;h<a.length;h+=1){for(z=0;z<g.length;z+=1)for(e=0;e<b.length;e+=1)f={},f.header=a[h].caption+b[e].caption+" (T"+g[z]+")",f.headerClass="nmc-view-digital-data nmc-text-align-center",f.dataClass="nmc-view-digital-data",
f.fieldName=a[h].name+b[e].name+g[z],f.elKind=b[e].name,f.elType=a[h].name,f.istunable="istunable",m.push(f);for(e=0;e<b.length;e+=1)f={},f.header="\u03a3"+a[h].caption+b[e].caption,f.headerClass="nmc-view-digital-data nmc-text-align-center",f.dataClass="nmc-el-totals-indicator-highlight nmc-view-digital-data",f.fieldName=a[h].name+b[e].name,f.isSummary=!0,f.elKind=b[e].name,f.elType=a[h].name,f.istunable="istunable",m.push(f)}return p=m})();return{getContObjectId:function(){return k},getContObjectName:function(){return l},
getDetailType:function(){return A},getDeviceModel:function(){return h},getDeviceSN:function(){return x},getElectricityColumns:function(){return p},getFromDate:function(){return t},getIntotalColumns:function(){return m},getImpulseColumns:function(){return q},getWaterColumns:function(){return v},getTimeDetailType:function(){return g},getTimeType:function(){return w},getToDate:function(){return b},getZpointId:function(){return e},getZpointName:function(){return u},setColorHighlightsForManualAndCrc:function(d){if(a.checkUndefinedNull(d)||
!angular.isArray(d))return console.log("Can't set color highlights"),!1;d.forEach(function(a){switch(a.dataMstatus){case 3:a.dataClass="nmc-tr-indicator-manual"}!1===a.crc32Valid&&(a.dataClass="nmc-tr-indicator-crc-error")})},setContObjectId:function(a){k=a},setContObjectName:function(a){l=a},setDetailType:function(a){A=a},setDeviceModel:function(a){h=a},setDeviceSN:function(a){x=a},setFromDate:function(a){t=a},setTimeDetailType:function(a){g=a},setTimeType:function(a){w=a},setToDate:function(a){b=
a},setZpointId:function(a){e=a},setZpointName:function(a){u=a}}}]);app=angular.module("portalNMC");
app.service("logSvc",["$rootScope","$http","$interval","mainSvc","$q",function(a,k,e,l,u){function g(a){return l.checkUndefinedNull(a)||!angular.isArray(a)||0==a.length?null:a.map(function(a){var b={};b.id=a.id;l.checkUndefinedNull(a.dataSourceInfo)||(b.dataSource=a.dataSourceInfo.caption||a.dataSourceInfo.dataSourceName);l.checkUndefinedNull(a.deviceObjectInfo)||(b.deviceModel=a.deviceObjectInfo.deviceModelName,b.deviceNumber=a.deviceObjectInfo.number);b.startDate=a.sessionDateStr;b.endDate=a.sessionEndDateStr;
l.checkUndefinedNull(a.authorInfo)||(b.author=a.authorInfo.authorName);b.currentStatus=a.sessionStatus;b.statusMessage=a.statusMessage;b.sessionMessage=a.sessionMessage;b.sessionUuid=a.sessionUuid;b.masterSessionUuid=a.masterSessionUuid;t.some(function(d){if(d.keyname==a.sessionStatus)return b.currentStatusColor=d.color,!0});return b})}function A(){if(!l.checkUndefinedNull(b)&&angular.isArray(b)&&0!=b.length){var a=[],g=[];angular.copy(b).forEach(function(b){l.checkUndefinedNull(b.masterSessionUuid)?
a.push(b):(l.checkUndefinedNull(g[b.masterSessionUuid])&&(g[b.masterSessionUuid]=[]),g[b.masterSessionUuid].push(angular.copy(b)))});for(var e in g)a.some(function(a){if(e==a.sessionUuid)return a.childs=g[e],!0});return a}}function w(d){if(l.checkUndefinedNull(d.data)||!angular.isArray(d.data)||0==d.data.length)b=[];else if(b=g(angular.copy(d.data)),l.checkUndefinedNull(m.contObjectIds)||0>=m.contObjectIds.length)b=A();a.$broadcast("logSvc:sessionsLoaded")}function h(a){console.log(a)}function x(){k({method:"GET",
url:"../api/rma/logSessions",params:m}).then(w,h)}var t=[{keyname:"LOADING",color:"YELLOW"},{keyname:"PARSING",color:"YELLOW"},{keyname:"DB INSERTING",color:"YELLOW"},{keyname:"COMPLETE",color:"GREEN"},{keyname:"COMPLETE WITH ERROR",color:"RED"},{keyname:"FAILURE",color:"RED"}],b=null,m={},v={startDate:moment().startOf("day"),endDate:moment().endOf("day")};m.fromDate=v.startDate.format("YYYY-MM-DD");m.toDate=v.endDate.format("YYYY-MM-DD");var p=null,q=null;a.$on("logSvc:requestSessionsLoading",function(a,
b){null!=p&&(e.cancel(p),p=null);m=b.params;v={startDate:m.fromDate,endDate:m.toDate};x();p=e(x,6E4)});a.$on("logSvc:cancelInterval",function(){null!=p&&(e.cancel(p),p=null)});q=u.defer();m.timeout=q.promise;return{getRequestCanceler:function(){return q},getSessions:function(){return b},getSessionsLogDaterange:function(){return v},serverDataParser:g,setSessionsLogDaterange:function(a){v=a}}}]);app=angular.module("portalNMC");
app.service("mainSvc",["$cookies","$http","$rootScope","$log","objectSvc","monitorSvc","$q","$timeout",function(a,k,e,l,u,g,A,w){function h(a){var c=!1;if(angular.isUndefined(a)||null==a)c=!0;return c}function x(a){return 0===Object.keys(a).length&&a.constructor===Object}function t(a){console.log(a)}function b(a,c){var b="";0<a&&(10>a&&(b+="0"),b+=a+c);return b}function m(a,c,b){k.get(n+"?subscrPrefKeyname="+a,C).then(function(a){d.mapSettings[c]=a.data.value;h(b)||e.$broadcast(b)},t)}function v(a){return!isNaN(parseFloat(a))&&
isFinite(a)}function p(a,c){if(!angular.isArray(a))return"Input value is no array.";if(h(c))return"Field for sort is undefined or null.";a.sort(function(a,b){return h(a[c])&&h(b[c])?0:h(a[c])?-1:h(b[c])||a[c].toUpperCase()>b[c].toUpperCase()?1:a[c].toUpperCase()<b[c].toUpperCase()?-1:0})}function q(a){var c=I;if(H(a))return c;L.some(function(b){if(b.resultCode==a)return c=b,!0});return c}var d={subscrUrl:"../api/subscr"};d.servicePermissionUrl=d.subscrUrl+"/manage/service/permissions";d.loadingServicePermissionFlag=
!1;d.serverTimeZone=3;d.mapSettings={};var n=d.subscrUrl+"/subscrPrefValue",y=[],B=null,C=null,z={zoom:null,lat:null,lng:null},D={zoom:null,lat:null,lng:null},f={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",fromLabel:"\u0441",toLabel:"\u043f\u043e",cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),
firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},ranges:{"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0434\u0435\u043d\u044c":[moment().startOf("day"),
moment().endOf("day")],"\u041f\u043e\u0441\u043b 7 \u0434\u043d\u0435\u0439":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 30 \u0434\u043d\u0435\u0439":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},startDate:moment(a.fromDate)||moment().subtract(6,"days").startOf("day"),endDate:moment(a.toDate)||moment().endOf("day"),format:"DD.MM.YYYY",separator:" \u043f\u043e "};f.startDate=moment().subtract(6,"days").startOf("day");f.endDate=
moment().endOf("day");f.maxDate=moment().endOf("day");k.get("../api/systemInfo/fullUserInfo",C).success(function(a,c,b,r){a=angular.copy(a);a.userNameCaption=10<a.userName.length?a.userName.substring(0,10)+"...":a.userName;a.userSubscrCaption=15<a.subscriber.subscriberName.length?a.subscriber.subscriberName.substring(0,15)+"...":a.subscriber.subscriberName;e.userInfo=a}).error(function(a){console.log(a)});e.$on("mainSvc:loadMapCenterLat",function(){m("SUBSCR_LAT_MAP_PREF","mapCenterLat","mainSvc:loadMapCenterLng")});
e.$on("mainSvc:loadMapCenterLng",function(){m("SUBSCR_LNG_MAP_PREF","mapCenterLng","mainSvc:loadMapZoom")});e.$on("mainSvc:loadMapZoom",function(){m("SUBSCR_ZOOM_MAP_PREF","mapZoom","mainSvc:setMapSettingsInServices")});e.$on("mainSvc:setMapSettingsInServices",function(){x(d.mapSettings)||(u.setObjectSettings(d.mapSettings),g.setMonitorSettings(d.mapSettings))});var F=function(a,c){var b=!1;angular.isDefined(a)&&(b=a[c]);return b},E=function(){return F(e.userInfo,"isCabinet")},G=[{keyname:"WEB_ALLOW_SETTING_MAIN_MENU_ITEM",
permissionTagId:"setting_main_menu_item",priority:100},{keyname:"WEB_ALLOW_REPORT_MAIN_MENU_ITEM",permissionTagId:"report_main_menu_item",priority:100}],H=function(a){var c=!1;if(angular.isUndefined(a)||null==a||""===a)c=!0;return c},c=function(a){return""===a||null==a?!0:v(a)?!0:!1},r=function(a){var b;b=c(a);return b?b=0<=parseInt(a,10)?!0:!1:b},I={resultCode:"ERR_DEFAULT",caption:"\u041d\u0435\u043f\u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043d\u043d\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f",
description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},L=[{resultCode:"ERR_UNCKNOWN",caption:"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430",description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},
{resultCode:"ERR_ACCESS_DENIED",caption:"\u041e\u0442\u043a\u0430\u0437\u0430\u043d\u043e \u0432 \u0434\u043e\u0441\u0442\u0443\u043f\u0435",description:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u043f\u0440\u0430\u0432 \u0434\u043e\u0441\u0442\u0443\u043f\u0430. \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},{resultCode:"ERR_UNPROCESSABLE_TRANSACTION",
caption:"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044e",description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},{resultCode:"ERR_DATABASE_ERROR",caption:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445",
description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},{resultCode:"ERR_BRM_VALIDATION",caption:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438 \u0431\u0438\u0437\u043d\u0435\u0441-\u043f\u0440\u0430\u0432\u0438\u043b",description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},
{resultCode:"ERR_VALIDATION",caption:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438",description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},{resultCode:"ERR_INTERNAL",caption:"\u0412\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u044f\u044f \u043e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430",
description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},{resultCode:"ERR_INVALID_STATE",caption:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f",description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},
{resultCode:"ERR_USER_ALREADY_EXISTS",caption:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442",description:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441 \u0442\u0430\u043a\u0438\u043c \u043b\u043e\u0433\u0438\u043d\u043e\u043c \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043d\u0430\u0431\u043e\u0440\u0430."},
{resultCode:"ERR_CONNECTION",caption:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f",description:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043e\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c."}],
J=function(a,c){var b=null;if(!angular.isArray(c.childObjectList))return b;c.childObjectList.some(function(c){if(a.id==c.id&&a.objectName==c.objectName)return b=c,!0;b=J(a,c);return null!=b});return b},K=function(a,c){!h(a.childObjectList)&&angular.isArray(a.childObjectList)&&(p(a.childObjectList,c),a.childObjectList.forEach(function(a){K(a,c)}))},B=A.defer(),C={timeout:B.promise};(function(){k.get(n+"?subscrPrefKeyname=SUBSCR_MAP_PREF",C).then(function(a){!0===a.data.isActive&&e.$broadcast("mainSvc:loadMapCenterLat")},
t)})();return{checkContext:function(a){var c=!1;y.some(function(b){if(0===b.permissionTagId.localeCompare(a))return c=!0});return c},checkEmptyObject:x,checkHHmm:function(a){return/(0[0-9]|1[0-9]|2[0-3]){1,2}:([0-5][0-9]){1}/.test(a)?!0:!1},checkNumericValue:c,checkPositiveNumberValue:r,checkStrForDate:function(a){return/(0[1-9]|[12][0-9]|3[01])[\- \/.](0[1-9]|1[012])[\- \/.](19|20)\d\d/.test(a)?!0:!1},checkUndefinedEmptyNullValue:H,checkUndefinedNull:h,dateFormating:function(a,c){var b=new Date(a+
Math.round(36E5*d.serverTimeZone));return null===b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes()]).format(c)},errorCallbackHandler:function(a){console.log(a);var c="-1";if(h(a)||h(a.data))c="ERR_CONNECTION";h(a)||h(a.resultCode)&&(h(a.data)||h(a.data.resultCode))||(c=a.resultCode||a.data.resultCode);return q(c)},findItemBy:function(a,c,b){var r=null;if(!angular.isArray(a))return console.log("Input value is no array."),r;if(h(b))return console.log("value for search is undefined or null."),
r;h(c)?a.some(function(a){if(a==b)return r=a,!0}):a.some(function(a){if(a[c]==b)return r=a,!0});return r},findNodeInTree:J,getConfirmCode:function(a){var c=10*Math.random(),b=100*Math.random();h(a)||!0!==a||(c=1E3*Math.random()+100,b=1E3*Math.random()+100);a=Math.round(c);b=Math.round(b);return{label:a+" + "+b+" = ",result:a+b}},getContextIds:function(){return y},getHtmlLoading:function(){return'<head><meta charset="utf-8"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"/></head><body><div  ng-show="loading" class="nmc-loading"><i class="fa fa-spinner fa-spin"></i> \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 ... </div></body>'},
getLoadingServicePermissionFlag:function(){return d.loadingServicePermissionFlag},getLoadedServicePermission:function(){return d.loadedServicePermission},getMonitorMapSettings:function(){return D},getObjectMapSettings:function(){return z},getDateRangeOptions:function(c,b){var r=null;switch(c){case "ru":r=f;break;case "monitor-ru":r=f;break;case "indicator-ru":r=angular.copy(f),r.startDate=angular.isDefined(a.fromDate)&&null!=a.fromDate?moment(a.fromDate).startOf("day"):moment(e.reportStart).startOf("day"),
r.endDate=angular.isDefined(a.toDate)&&null!=a.toDate?moment(a.toDate).startOf("day"):moment(e.reportEnd).startOf("day"),h(b)||h(b.minDate)||(r.minDate=b.minDate)}return r},getRequestCanceler:function(){return B},getServerTimeZone:function(){return d.serverTimeZone},getServerErrorByResultCode:q,getUseColorHighlightIndicatorData:function(){return!0},getUserServicesPermissions:function(){d.loadingServicePermissionFlag=!0;d.loadedServicePermission=k.get(d.servicePermissionUrl,C).then(function(a){y=a.data;
E()||y.push(G[0],G[1]);d.loadingServicePermissionFlag=!1;e.$broadcast("servicePermissions:loaded")},function(a){console.log(a);d.loadingServicePermissionFlag=!1})},getUseTest:function(){return!0},getViewSystemInfo:function(){return!0},isAdmin:function(){var a=!1,c=e.userInfo;angular.isDefined(c)&&(a=c.isAdmin);return a},isCabinet:E,isNumeric:v,isPositiveNumberValue:function(a){return h(a)?!1:r(a)},isRma:function(){var a=!1,c=e.userInfo;angular.isDefined(c)&&(a=c.isRma);return a},isReadonly:function(){var a=
!1,c=e.userInfo;angular.isDefined(c)&&(a=c.isReadonly);return a},isSystemuser:function(){var a=!1,c=e.userInfo;angular.isDefined(c)&&(a=c._system);return a},isTestMode:function(){var a=!0;h(e.userInfo)||(a="TEST_CERTIFICATE"===F(e.userInfo,"subscrType"));return a},prepareTimeOffset:function(a){var c=null;h(a)||(c=1===a.timeDeltaSign?"+":"-",c+=b(a.years,"\u0433 "),c+=b(a.mons,"\u041c "),c+=b(a.days,"\u0434 "),c+=b(a.hh,"\u0447 "),c+=b(a.mm,"\u043c "),c+=b(a.ss,"\u0441 "));return c},setMonitorMapSettings:function(a){D=
a},setObjectMapSettings:function(a){z=a},setToolTip:function(a,c,b,r,d,g,f,I,E){var e=1;h(d)||(e=d);var z=1E3;h(g)||(z=g);var m="top right";h(f)||(m=f);var k="bottom right";h(I)||(k=I);var l="qtip-nmc-indicator-tooltip";h(E)||(l=E);w(function(){$(b).qtip({suppress:!1,content:{text:c,title:a,button:!0},show:{event:"click"},style:{classes:l,width:z},hide:{event:"unfocus"},position:{my:m,at:k,target:$(r)}})},e)},sortItemsBy:p,sortNumericItemsBy:function(a,c){if(!angular.isArray(a))return"Input value is no array.";
if(h(c))return"Field for sort is undefined or null.";a.sort(function(a,b){return h(a[c])&&h(b[c])?0:h(a[c])?-1:h(b[c])||a[c]>b[c]?1:a[c]<b[c]?-1:0})},sortOrganizationsByName:function(a){if(!angular.isArray(a))return"Param is no array.";p(a,"organizationName")},sortTreeNodesBy:K,strDateToUTC:function(a,c){var b=new Date(moment(a,c).format("YYYY-MM-DD"));return isNaN(b.getTime())?null:Date.UTC(b.getFullYear(),b.getMonth(),b.getDate())}}}]);angular.module("portalNMC").service("meterPeriodsSvc",["$http","$cookies","$interval","$rootScope","$q",function(a,k,e,l,u){return{loadMeterPeriods:function(){return a.get("../api/subscr/meter-period-settings")},saveMeterPeriod:function(g,e){return a({method:g,url:"../api/subscr/meter-period-settings",data:e})},deleteMeterPeriod:function(g){a["delete"]("../api/subscr/meter-period-settings/"+g)}}}]);app=angular.module("portalNMC");
app.service("monitorSvc",["$rootScope","$http","$interval","$cookies","$location","objectSvc","$q",function(a,k,e,l,u,g,A){function w(){return B(n)||B(y)}function h(a){console.log(a)}function x(a){if(angular.isUndefined(a)||null==a||!angular.isArray(a))return!1;var b=[];a.forEach(function(a){a.contEventNotificationStatuses.forEach(function(a){b.push(a)})});return b}function t(a){var b="";a.forEach(function(a){var c=new Date(a.contEventTime),r="";"RED"===a.contEventLevelColorKeyname&&(r="color: red;");
a="<p style='"+r+"'>"+c.toLocaleString()+", "+a.contEventType.name+"</p>";b+=a});return b}function b(){}function m(){angular.isDefined(D)&&(e.cancel(D),D=void 0)}var v=null,p=[],q=[],d={refreshPeriod:"300",loadingFlag:!0,noGreenObjectsFlag:!1};d.fromDate=moment().subtract(6,"days").startOf("day").format("YYYY-MM-DD");d.toDate=moment().endOf("day").format("YYYY-MM-DD");var n=null,y=null,B=function(a){var b=!1;if(angular.isUndefined(a)||null==a)b=!0;return b},C=function(b){console.log(b);q=[];p=[];
d.loadingFlag=!1;a.$broadcast("monitorObjects:updated")},z=function(b,d){if(B(b))return 400;d.loadingFlag=!0;var f=b+"/?fromDate="+d.fromDate+"&toDate="+d.toDate+"&noGreenColor="+d.noGreenObjectsFlag;B(d.contGroupId)||(f+="&contGroupId="+d.contGroupId);if(!0===w())return null;k.get(f,y).success(function(c){q=c;p=x(c);g.sortObjectsByConObjectFullName(p);d.loadingFlag=!1;a.$broadcast("monitorObjects:updated")}).error(C)},D;a.$on("monitor:periodChanged",function(){m();D=e(b,1E3*Number(d.refreshPeriod))},
!1);D=e(b,1E3*Number(d.refreshPeriod));var f=function(){return!0===w()?null:k.get("../api/subscr/subscrPrefValue?subscrPrefKeyname=SUBSCR_OBJECT_TREE_CONT_OBJECTS",y)},F=function(){f().then(function(b){d.isTreeView=b.data.isActive;!0===d.isTreeView&&!0!==d.isFullObjectView?(d.defaultTreeId=Number(b.data.value),B(d.curTreeId)&&(d.curTreeId=d.defaultTreeId),B(d.curTreeNodeId)?(q=[],p=[],d.loadingFlag=!1,a.$broadcast("monitorObjects:updated")):(v="../api/subscr/subscrObjectTree/contObjectTreeType1/"+
d.curTreeId+"/node/"+d.curTreeNodeId+"/contObjects/cityStatusCollapseV2",z(v,d))):(v=angular.copy("../api/subscr/contEvent/notifications/contObject/cityStatusCollapseV2"),z(v,d))},C)};a.$on("monitor:updateObjectsRequest",function(){F()});a.$on("$destroy",function(){alert("MonitorSvc destroy");m()});n=A.defer();y={timeout:n.promise};return{checkUndefinedNull:B,getAllMonitorObjects:function(){return p},getAllMonitorCities:function(){return q},getLoadingStatus:function(){return d.loadingFlag},getMonitorEventsByObject:function(b){var d=
"../api/subscr/contEvent/notifications/contObject/"+b.contObject.id+"/monitorEvents";if(!0===w())return null;k.get(d,y).success(function(d){if(d.hasOwnProperty("length")&&0!=d.length){var c="";d.forEach(function(a){var b=new Date(a.contEventTime),r="";"RED"===a.contEventLevelColorKey&&(r="color: red;");a="<p style='"+r+"'>"+b.toLocaleString()+", "+a.contEventType.name+"</p>";c+=a});if("YELLOW"===b.statusColor)b.monitorEvents="\u041d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043d\u0435\u0442 \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439";
else if("RED"===b.statusColor||"ORANGE"===b.statusColor)b.monitorEvents=c,b.monitorEventsForMap=d;a.$broadcast("monitorObjects:getObjectEvents",{obj:b})}else"YELLOW"===b.statusColor&&(b.monitorEvents="\u041d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043d\u0435\u0442 \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439",a.$broadcast("monitorObjects:getObjectEvents",{obj:b}))}).error(h)},getMonitorEventsByObjectForMap:function(a){var b="../api/subscr/contEvent/notifications/contObject/"+
a.contObject.id+"/monitorEventsV2";if(!0===w())return null;k.get(b,y).success(function(b){!b.hasOwnProperty("length")||0===b.length||"RED"!==a.contEventLevelColorKey&&"YELLOW"!==a.contEventLevelColorKey||(a.monitorEventsForMap=b)}).error(h)},getMonitorEventsForObject:function(b){var d="../api/subscr/contEvent/notifications/contObject/"+b.id+"/monitorEventsV2";if(!0===w())return null;k.get(d,y).success(function(d){if(d.hasOwnProperty("length")&&0!==d.length){if("RED"===b.contObjectStats.contEventLevelColor||
"YELLOW"===b.contObjectStats.contEventLevelColor)b.monitorEvents=t(d),b.monitorEventsForMap=d;a.$broadcast("monitorObjects:getObjectEvents",{obj:b})}}).error(h)},getMonitorSettings:function(){return d},getRequestCanceler:function(){return n},loadDefaultMonitorTreeSetting:f,loadMonitorEventsForObject:function(a){a="../api/subscr/contEvent/notifications/contObject/"+a+"/monitorEventsV2";return!0===w()?null:k.get(a,y)},prepareEventMessage:t,setMonitorSettings:function(a){for(var b in a)d[b]=a[b]}}}]);angular.module("portalNMC").factory("notificationFactory",function(){return{success:function(){toastr.success("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043e.")},successInfo:function(a){toastr.success(a)},info:function(a){toastr.success(a)},error:function(a){toastr.error(a,"\u041e\u0448\u0438\u0431\u043a\u0430!")},errorInfo:function(a,k){toastr.error(k,a)},warning:function(a){toastr.warning(a)}}});app=angular.module("portalNMC");
app.service("objectSvc",["$http","$cookies","$interval","$rootScope","$q",function(a,k,e,l,u){function g(){return n(q)||n(d)}function A(a){F(a,"fullName")}var w={BUILDING_TYPES_LOADED:"objectSvc:buildingTypesLoaded",BUILDING_CATEGORIES_LOADED:"objectSvc:buildingCategoriesLoaded"},h=[],x={},t={},b=null,m={},v=[],p=[],q=null,d=null,n=function(a){var c=!1;if(angular.isUndefined(a)||null===a)c=!0;return c},y=function(){return!0===g()?null:a.get("../api/rma/contObjects/rsoOrganizations",d)},B=function(){return!0===
g()?null:a.get("../api/rma/contObjects/cmOrganizations",d)},C=function(c,b,f){c=c+"?measureUnit="+f.all[b].keyname;if(!0===g())return null;a.get(c,d).then(function(a){f[f.all[b].keyname]=a.data},function(a){console.log(a)})},z=function(){return!0===g()?null:a.get("../api/subscr/deviceObjects/metaVzlet/system",d)},D=[],f=function(c){var b="../api/rma/contObjects";n(c)||(b+="?contGroupId="+c);return!0===g()?null:a.get(b,d)},F=function(a,b){if(!angular.isArray(a))return"Input value is no array.";if(n(b))return"Field for sort is undefined or null.";
a.sort(function(a,c){return n(a[b])&&n(c[b])?0:n(a[b])?-1:n(c[b])||a[b].toUpperCase()>c[b].toUpperCase()?1:a[b].toUpperCase()<c[b].toUpperCase()?-1:0})},E=null,G=null,H=function(c,b){console.time("Object loading");var r="../api/subscr/contObjects";n(c)||(r+="?contGroupId="+c);E=!0===g()?null:a.get(r,d);if(n(b)||!0!==b)G=f(c)};l.$on("objectSvc:requestReloadData",function(a,b){var c=null,d=!1;n(b)||n(b.contGroupId)||(c=b.contGroupId);n(b)||n(b.onlySubscrList)||(d=!!b.onlySubscrList);H(c,d)});k=function(c){a.get(c).then(function(a){h=
angular.copy(a.data)},function(a){console.log(a)})};q=u.defer();d={timeout:q.promise};(function(){z().then(function(a){D=a.data},function(a){console.log(a)})})();(function(){if(!0===g())return null;a.get("../api/rma/contObjects/deviceObjects/metadata/measureUnits",d).then(function(a){x.all=a.data;x.all.forEach(function(a,c){C("../api/rma/contObjects/deviceObjects/metadata/measureUnits",c,x)});l.$broadcast("objectSvc:deviceMetadataMeasuresLoaded")},function(a){console.log(a)})})();(function(){a.get("../api/subscr/service/buildingType/list").then(function(a){l.$broadcast(w.BUILDING_TYPES_LOADED);
if(n(a)||n(a.data)||!angular.isArray(a.data))return console.log("Building type list is empty!"),!1;v=angular.copy(a.data)},function(a){console.log(a)})})();(function(){a.get("../api/subscr/service/buildingType/category/list").then(function(a){l.$broadcast(w.BUILDING_CATEGORIES_LOADED);if(n(a)||n(a.data)||!angular.isArray(a.data))return console.log("Building category list is empty!"),!1;p=angular.copy(a.data)},function(a){console.log(a)})})();k("../api/subscr/subscrObjectTreeTemplates");H();return{BROADCASTS:w,
OBJECT_PER_SCROLL:42,createTree:function(b){return a.post("../api/subscr/subscrObjectTree/contObjectTreeType1",b)},deleteTree:function(b){return a["delete"]("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b)},deleteTreeNode:function(b,d){return a["delete"]("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+d)},getAllDevices:function(){return!0===g()?null:a.get("../api/rma/contObjects/deviceObjects",d)},getBuildingCategories:function(){return p},getBuildingTypes:function(){return v},
getCityConsumingData:function(b,f){var c="../api/subscr/service/hwater/contObjects/serviceTypeInfo/city/?dateFrom="+f.dateFrom+"&dateTo="+f.dateTo+"&cityFias="+b;return!0===g()?null:a.get(c,d)},getCitiesConsumingData:function(b){b="../api/subscr/service/hwater/contObjects/serviceTypeInfo/?dateFrom="+b.dateFrom+"&dateTo="+b.dateTo;return!0===g()?null:a.get(b,d)},getCmOrganizations:B,getCmOrganizationsWithId:function(b){if(n(b))return B();b="../api/rma/contObjects/cmOrganizations?organizationId="+b;
return!0===g()?null:a.get(b,d)},getCurrentObject:function(){return b},getDatasourcesUrl:function(){return"../api/rma/dataSources"},getDeviceModels:function(){return!0===g()?null:a.get("../api/rma/deviceObjects/deviceModels",d)},getDeviceSchedulerSettings:function(b,f){var c="../api/subscr/contObjects/"+b+"/deviceObjects/"+f+"/subscrDataSource/loadingSettings";return!0===g()?null:a.get(c,d)},getImpulseCounterTypes:function(){return!0===g()?null:a.get("../api/rma/deviceObjects/impulseCounterTypes",
d)},getMeterPeriodByObject:function(b){return a.get("../api/subscr/contObjects/"+b+"/meterPeriodSettings")},getObject:function(b){return angular.isUndefined(b)||null===b?"Object id is null or undefined":!0===g()?null:a.get("../api/subscr/contObjects/"+b,d)},getObjectConsumingData:function(b,f){var c="../api/subscr/service/hwater/contObjects/serviceTypeInfo/"+f+"/?dateFrom="+b.dateFrom+"&dateTo="+b.dateTo;return!0===g()?null:a.get(c,d)},getObjectSettings:function(){return m},getDevicesByObject:function(b){b=
"../api/subscr/contObjects/"+b.id+"/deviceObjects";return!0===g()?null:a.get(b,d)},getRequestCanceler:function(){return q},getRmaDeviceMetadata:function(b,f){var c="../api/rma/contObjects/"+b+"/deviceObjects/"+f+"/metadata";return!0===g()?null:a.get(c,d)},getDeviceDatasources:function(b,f){var c="../api/rma/contObjects/"+b+"/deviceObjects/"+f+"/subscrDataSource";return!0===g()?null:a.get(c,d)},getDeviceMetadataMeasures:function(){return x},getDeviceMetaDataVzlet:function(b,f){var c="../api/subscr/contObjects/"+
b.id+"/deviceObjects/"+f.id+"/metaVzlet";return!0===g()?null:a.get(c,d)},getDeviceMetaDataVzletSystemList:z,getLoadingStatus:function(){return!0},getObjectsUrl:function(){return"../api/subscr/contObjects"},getPromise:function(){return E},getRmaDeviceMetaDataVzlet:function(b,f){var c="../api/rma/contObjects/"+b+"/deviceObjects/"+f.id+"/metaVzlet";return!0===g()?null:a.get(c,d)},getRmaMetadataMeasureUnit:C,getRmaObject:function(b){return angular.isUndefined(b)||null===b?"Object id is null or undefined":
!0===g()?null:a.get("../api/rma/contObjects/"+b,d)},getRmaObjectsData:f,getRmaObjectSubscribers:function(b){b="../api/rma/contObjects/"+b+"/subscribers";return!0===g()?null:a.get(b,d)},getRmaObjectsUrl:function(){return"../api/rma/contObjects"},getRmaPromise:function(){return G},getRefRangeByObjectAndZpoint:function(b,f){var c="../api/subscr/contObjects/"+b.id+"/zpoints/"+f.id+"/referencePeriod";return!0===g()?null:a.get(c,d)},getRsoOrganizations:y,getRsoOrganizationsWithId:function(b){if(n(b))return y();
b="../api/rma/contObjects/rsoOrganizations?organizationId="+b;return!0===g()?null:a.get(b,d)},getServiceTypes:function(){return!0===g()?null:a.get("../api/rma/contObjects/contServiceTypes",d)},getSubscrUrl:function(){return"../api/subscr"},getTimezones:function(){var b;b=!0===g()?null:a.get("../api/timezoneDef/all",d);return b},getRmaTreeTemplates:function(){return h},getVzletSystemList:function(){return D},getZpointMetaDestProp:function(b,f){var c;c="../api/subscr/contObjects"+("/"+b+"/zpoints/"+
f+"/metadata/destDb");return!0===g()?null:a.get(c,d)},getZpointMetadataMeasures:function(){return t},getZpointMetaMeasureUnits:function(b,f){var c="../api/subscr/contObjects",c=c+("/"+b+"/zpoints/"+f+"/metadata/measureUnits");return!0===g()?null:a.get(c,d).then(function(a){t={};t.all=a.data;t.all.forEach(function(a,b){C(c,b,t)});l.$broadcast("objectSvc:zpointMetadataMeasuresLoaded")},function(a){console.log(a)})},getZpointMetaSrcProp:function(b,f){var c;c="../api/subscr/contObjects"+("/"+b+"/zpoints/"+
f+"/metadata/srcProp");return!0===g()?null:a.get(c,d)},getZpointMetadata:function(b,f){var c;c="../api/subscr/contObjects"+("/"+b+"/zpoints/"+f+"/metadata");return!0===g()?null:a.get(c,d)},getZpointsDataByObject:function(b,f){b.zpoints=[];var c="../api/subscr/contObjects/"+b.id+"/contZPoints"+f;return!0===g()?null:a.get(c,d)},findObjectById:function(a,b){var c=null;if(!angular.isArray(b)||!angular.isNumber(a))return c;b.some(function(b){if(b.id===a)return c=b,!0});return c},isDirectDevice:function(a){var b=
!1;angular.isDefined(a.activeDataSource)&&null!=a.activeDataSource&&angular.isDefined(a.activeDataSource.subscrDataSource)&&null!=a.activeDataSource.subscrDataSource&&"DEVICE"==a.activeDataSource.subscrDataSource.dataSourceTypeKey&&(b=!0);return b},loadDefaultTreeSetting:function(){return a.get("../api/subscr/subscrPrefValue?subscrPrefKeyname=SUBSCR_OBJECT_TREE_CONT_OBJECTS")},loadFreeObjectsByTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/contObjects/free")},
loadObjectsByTreeNode:function(b,f){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+f+"/contObjects")},loading:!0,loadObjectMeterPeriods:function(){return a.get("../api/subscr/contObjects/meterPeriodSettings")},loadTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b)},loadTrees:function(){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1")},loadTreeTemplateItems:function(b){return a.get("../api/subscr/subscrObjectTreeTemplates/"+
b+"/items")},loadTreeTemplates:k,loadSubscrFreeObjectsByTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/contObjects/free")},loadSubscrObjectsByTreeNode:function(b,f){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+f+"/contObjects")},loadSubscrTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b)},loadSubscrTrees:function(){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1")},promise:E,
putDeviceMetaDataVzlet:function(b){return a.put("../api/subscr/contObjects/"+b.contObject.id+"/deviceObjects/"+b.id+"/metaVzlet",b.metaData)},putDeviceSchedulerSettings:function(b,f,d){return a.put("../api/rma/contObjects/"+b+"/deviceObjects/"+f+"/subscrDataSource/loadingSettings",d)},putObjectsToTreeNode:function(b,f,d){return a.put("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+f+"/contObjects/add",d)},releaseObjectsFromTreeNode:function(b,f,d){return a.put("../api/subscr/subscrObjectTree/contObjectTreeType1/"+
b+"/node/"+f+"/contObjects/remove",d)},rmaPromise:G,saveZpointMetadata:function(b,f,d){return a.put("../api/rma/contObjects/"+b+"/zpoints/"+f+"/metadata",d)},sendDeviceToServer:function(b){var c={};angular.isDefined(b.subscrDataSourceAddr)&&null!==b.subscrDataSourceAddr&&(c.subscrDataSourceAddr=b.subscrDataSourceAddr);angular.isDefined(b.dataSourceTable)&&null!==b.dataSourceTable&&(c.dataSourceTable=b.dataSourceTable);angular.isDefined(b.dataSourceTable1h)&&null!==b.dataSourceTable1h&&(c.dataSourceTable1h=
b.dataSourceTable1h);angular.isDefined(b.dataSourceTable24h)&&null!==b.dataSourceTable24h&&(c.dataSourceTable24h=b.dataSourceTable24h);var f="../api/rma/contObjects/"+b.contObjectId+"/deviceObjects";angular.isDefined(b.id)&&null!==b.id&&(f=f+"/"+b.id);c.subscrDataSourceId=b.subscrDataSourceId;b.editDataSourceInfo=c;return angular.isDefined(b.id)&&null!==b.id?a.put(f,b):a.post(f,b)},setCurrentObject:function(a){b=a},setMeterPeriodForObject:function(b){return a.put("../api/subscr/contObjects/"+b.contObjectId+
"/meterPeriodSettings",b)},setMeterPeriods:function(b){return a.put("../api/subscr/contObjects/meterPeriodSettings",b)},setObjectSettings:function(a){for(var b in a)m[b]=a[b]},sortObjectsByFullName:A,sortObjectsByFullNameEx:function(a){if(angular.isUndefined(a)||null===a||!angular.isArray(a))return!1;var b=[],c=[];a.forEach(function(a){n(a.fullName)?c.push(a):b.push(a)});if(0===b.length)return"No objects with fullName";A(b);Array.prototype.push.apply(c,b);return c},sortObjectsByConObjectFullName:function(a){if(angular.isUndefined(a)||
null===a||!angular.isArray(a))return!1;a.sort(function(a,b){return(n(a.contObject)||n(a.contObject.fullName))&&(n(b.contObject)||n(b.contObject.fullName))?0:n(a.contObject)||n(a.contObject.fullName)?-1:n(b.contObject)||n(b.contObject.fullName)||a.contObject.fullName.toUpperCase()>b.contObject.fullName.toUpperCase()?1:a.contObject.fullName.toUpperCase()<b.contObject.fullName.toUpperCase()?-1:0})},updateTree:function(b){return a.put("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b.id,b)}}}]);app=angular.module("portalNMC");
app.service("reportSvc",["$http","$cookies","$interval","$rootScope","crudGridDataFactoryWithCanceler","mainSvc","$q",function(a,k,e,l,u,g,A){function w(a){a.forEach(function(a){var b=!1;p.some(function(f){if(f.keyname===a.keyname)return b=!0});!1===b&&p.push(angular.copy(a))})}function h(a){if(angular.isArray(a)&&0!==a.length){g.sortNumericItemsBy(a,"serviceOrder");var b=a.map(function(a){return a.keyname}).join(","),f=a.map(function(a){return a.captionShort}).join(", ");a.push({keyname:b,captionShort:f,
isGroup:!0})}}var x={keyname:"WITHOUT",caption:"\u0411\u0435\u0437 \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0438 \u043a \u0442\u0438\u043f\u0443 \u0440\u0435\u0441\u0443\u0440\u0441\u0430",captionShort:"\u0411\u0435\u0437 \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0438 \u043a \u0442\u0438\u043f\u0443 \u0440\u0435\u0441\u0443\u0440\u0441\u0430","class":"active"},t=!1,b=!1,m=[{name:"METROLOGICAL",caption:"\u041c\u0435\u0442\u0440\u043e\u043b\u043e\u0433\u0438\u044f",prefix:"\u041c","class":"active",
reportTypes:[]},{name:"QUALITY_MONITOR",caption:"\u041c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430",prefix:"\u041a",reportTypes:[]},{name:"FAULT_DIAGNOSIS",caption:"\u0414\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a\u0430 \u043d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u043e\u0441\u0442\u0435\u0439",prefix:"\u0414",reportTypes:[]},{name:"ANALYTICS",caption:"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430",prefix:"C",
reportTypes:[]},{name:"SERVICE",caption:"\u0421\u043b\u0443\u0436\u0435\u0431\u043d\u044b\u0435",prefix:"C",reportTypes:[]},{name:"OPERATE",caption:"\u041e\u043f\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u044b\u0435",prefix:"\u042d",reportTypes:[]},{name:"ANALITIC",caption:"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435",prefix:"\u0410",reportTypes:[]}],v=[{name:"ALL",caption:"\u041f\u043e \u0432\u0441\u0435\u043c \u044d\u043d\u0435\u0440\u0433\u043e\u0440\u0435\u0441\u0443\u0440\u0441\u0430\u043c",
isDefault:!0,isAll:!0},{name:"ELECTRICITY",caption:"\u042d\u043b\u0435\u043a\u0442\u0440\u0438\u0447\u0435\u0441\u0442\u0432\u043e"},{name:"WATER",caption:"\u041e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u0435, \u0413\u0412\u0421, \u0425\u0412\u0421"}],p=[],q=null,d=null,n=[],y=[],B=function(a,b){if(null===q)return null;u(a,q).query(function(a){g.sortItemsBy(a,"name");b.paramsets=a;b.paramsetsCount=a.length})},C=function(a,b){if(!a.hasOwnProperty("reportPeriodKey")||!a.hasOwnProperty("reportTemplate"))return!1;
var f=!0,d=!1;g.checkUndefinedNull(a.currentReportPeriod)||g.checkUndefinedNull(a.currentReportPeriod.isSettlementMonth)||!0!==a.currentReportPeriod.isSettlementMonth&&!0!==a.currentReportPeriod.isSettlementDay||(d=!0);null===b&&!d&&(f=g.strDateToUTC(a.psStartDateFormatted,"DD.MM.YYYY"),f=new Date(f),d=g.strDateToUTC(a.psEndDateFormatted,"DD.MM.YYYY"),d=new Date(d),f=!isNaN(f.getTime())&&!isNaN(d.getTime()))&&(d=a.psStartDateFormatted,f=a.psEndDateFormatted,g.checkStrForDate(d)&&g.checkStrForDate(f)?
null==d||null==f||""==d||""==f?(console.log("1"),f=!1):(d=g.strDateToUTC(d,"DD.MM.YYYY"),d=null!=d?new Date(d):null,f=g.strDateToUTC(f,"DD.MM.YYYY"),f=null!=f?new Date(f):null,f=null==d||null==f?!1:f>=d):f=!1);return!(null===a.reportPeriodKey||null===a.reportTemplate.id)&&f},q=A.defer(),d={timeout:q.promise};(function(){b=!1;if(null===q)return null;u("../api/reportSettings/reportPeriod",q).query(function(a){y=a;b=!0;l.$broadcast("reportSvc:reportPeriodsIsLoaded")})})();(function(){t=!1;if(null===
q)return null;u("../api/reportSettings/reportType",q).query(function(a){g.sortItemsBy(a,"caption");n=a;m.forEach(function(a){a.reportTypes=[]});var b=[],d={},e,k;for(e=0;e<a.length;e+=1)if(a[e]._enabled&&(g.isSystemuser()||!a[e].isDevMode)){d={};d.reportType=a[e].keyname;d.reportTypeName=a[e].caption;d.reportCategory=a[e].reportCategory;d.resourceCategory=a[e].resourceCategory;d.contServiceTypes=a[e].contServiceTypes;d.previewUrl=a[e].previewUrl;h(d.contServiceTypes);w(d.contServiceTypes);d.suffix=
a[e].suffix;d.reportMetaParamSpecialList=a[e].reportMetaParamSpecialList;d.reportMetaParamCommon=a[e].reportMetaParamCommon;d.reportMetaParamSpecialList_flag=0<a[e].reportMetaParamSpecialList.length?!0:!1;for(k=0;k<m.length;k+=1)0===d.reportCategory.localeCompare(m[k].name)&&m[k].reportTypes.push(d);b.push(d)}n=b;g.sortItemsBy(p,"captionShort");p.push(x);l.$broadcast("reportSvc:reportTypesIsLoaded");t=!0})})();return{checkPSRequiredFieldsOnSave:function(a,b,d,e){var f;if(g.checkUndefinedNull(a))return console.log("Report type = "+
a),f="\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0442\u0438\u043f \u043e\u0442\u0447\u0435\u0442\u0430.\n",!1;if(!a.hasOwnProperty("reportMetaParamCommon"))return!0;var m=!0;f="\u041d\u0435 \u0432\u0441\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430 \u043e\u0442\u0447\u0435\u0442\u0430 \u0437\u0430\u0434\u0430\u043d\u044b:\n";g.checkUndefinedEmptyNullValue(b.outputFileType)&&
(f+="\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430: \n",f+="\u2022 \u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0442\u0438\u043f \u0444\u0430\u0439\u043b\u0430\n",m=!1);var h=!1;g.checkUndefinedNull(b.currentReportPeriod)||g.checkUndefinedNull(b.currentReportPeriod.isSettlementMonth)||!0!==b.currentReportPeriod.isSettlementMonth&&!0!==b.currentReportPeriod.isSettlementDay||(h=!0);if(null==d&&!h){var h=g.strDateToUTC(b.psStartDateFormatted,"DD.MM.YYYY"),
c=new Date(h),k=g.strDateToUTC(b.psEndDateFormatted,"DD.MM.YYYY"),l=new Date(k);!a.reportMetaParamCommon.startDateRequired||!isNaN(c.getTime())&&g.checkStrForDate(b.psStartDateFormatted)||(m&&(f+="\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430: \n"),f+="\u2022 \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0447\u0430\u043b\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430\n",m=
!1);!a.reportMetaParamCommon.startDateRequired||!isNaN(l.getTime())&&g.checkStrForDate(b.psEndDateFormatted)||(m&&(f+="\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430: \n"),f+="\u2022 \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043a\u043e\u043d\u0435\u0446 \u043f\u0435\u0440\u0438\u043e\u0434\u0430\n",m=!1);a.reportMetaParamCommon.startDateRequired&&!isNaN(l.getTime())&&!isNaN(c.getTime())&&h>
k&&(m&&(f+="\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430: \n"),f+="\u2022 \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u044b \u0433\u0440\u0430\u043d\u0438\u0446\u044b \u043f\u0435\u0440\u0438\u043e\u0434\u0430\n",m=!1)}a.reportMetaParamCommon.oneContObjectRequired&&0===b.selectedObjects.length&&a.reportMetaParamCommon.manyContObjectsRequired&&(f+="\u2022 \u0414\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u0438\u043d \u043e\u0431\u044a\u0435\u043a\u0442\n",
m=!1);a.reportMetaParamCommon.oneContObjectRequired&&0===b.selectedObjects.length&&!a.reportMetaParamCommon.manyContObjectsRequired&&(f+="\u2022 \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u043e\u0434\u0438\u043d \u043e\u0431\u044a\u0435\u043a\u0442\n",m=!1);!0===a.reportMetaParamCommon.manyContObjectsRequired&&1>=b.selectedObjects.length&&(f+="\u2022 \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432\n",
m=!1);!a.reportMetaParamCommon.manyContObjectsRequired&&1<b.selectedObjects.length&&a.reportMetaParamCommon.oneContObjectRequired&&(f+="\u2022 \u041d\u0435\u043b\u044c\u0437\u044f \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0431\u043e\u043b\u0435\u0435 \u043e\u0434\u043d\u043e\u0433\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0430\n",m=!1);a.reportMetaParamCommon.manyContObjectsZipOnly&&(1<b.selectedObjects.length||0===b.selectedObjects.length)&&(b.outputFileZipped=!0);var v=!0;g.checkUndefinedNull(b.currentParamSpecialList)||
b.currentParamSpecialList.forEach(function(a,b,c){!a.paramSpecialRequired||a.textValue||a.numericValue||a.oneDateValue||a.oneDateValueFormatted||a.startDateValue||a.endDateValue||a.directoryValue||(v&&(f+="\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430: \n"),f+='\u2022 \u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 "'+a.paramSpecialCaption+'" \n',v=m=!1)});"\u041d\u0435 \u0432\u0441\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430 \u043e\u0442\u0447\u0435\u0442\u0430 \u0437\u0430\u0434\u0430\u043d\u044b:\n"!=
f&&(0===e.toUpperCase().localeCompare("CREATE")&&(f+="\n \u042d\u0442\u043e\u0442 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u043e\u0442\u0447\u0435\u0442\u0430 \u043d\u0435\u043b\u044c\u0437\u044f \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0431\u0435\u0437 \u0443\u0442\u043e\u0447\u043d\u0435\u043d\u0438\u044f \u0438\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0432 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0435, \u043d\u0435 \u0437\u0430\u0434\u0430\u0432 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432. \u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c?"),
m=!1);m=m&&C(b,d);m||(b.showParamsBeforeRunReport=!0);return{flag:m,message:f}},getContServiceTypes:function(){return p},getDefaultResourceCategory:function(){var a=null;v.some(function(b){if(!0===b.isDefault)return a=b,!0});return a},getParamsetsForTypes:function(a,b){var d;if(0!==a.length)for(d=0;d<a.length;d+=1)"undefined"!==typeof a[d].suffix&&B("../api/reportParamset"+b+a[d].suffix,a[d])},getReportCategories:function(){return m},getReportPeriods:function(){return y},getReportPeriodsIsLoaded:function(){return b},
getReportTypes:function(){return n},getReportTypesIsLoaded:function(){return t},getRequestCanceler:function(){return q},getResourceCategories:function(){return v},loadReportsContextLaunch:function(){return!0===(g.checkUndefinedNull(q)||g.checkUndefinedNull(d))?null:a.get("../api/reportParamset/menu/contextLaunch",d)}}}]);app.filter("resourceCategoryFilter",function(){return function(a,k){if(!0===k.isAll)return a;var e=[];a.forEach(function(a){a.resourceCategory===k.name&&e.push(a)});return e}});
app.filter("serviceTypesFilter",function(){return function(a,k){if("ALL"===k.keyname)return a;var e=[];a.forEach(function(a){angular.isArray(a.contServiceTypes)&&(!angular.isUndefined(a.contServiceTypes)&&0!==a.contServiceTypes.length||"WITHOUT"!==k.keyname||e.push(a),a.contServiceTypes.some(function(l){if(angular.isUndefined(l)||angular.isUndefined(k)||!0!==l.isGroup)return!1;if(l.keyname===k.keyname)return e.push(a),!0}))});return e}});
app.filter("reportTypesCountInCategoryByServiceType",["$filter",function(a){return function(k,e){return a("serviceTypesFilter")(e.reportTypes,k).length||0}}]);app.filter("notEmptyContServiceTypesByReportTypes",["$filter",function(a){return function(k,e){var l=[];angular.isArray(k)?k.forEach(function(k){var g=[];angular.isDefined(e)&&(g=a("serviceTypesFilter")(e.reportTypes,k));0!==g.length&&l.push(k)}):l=k;return l}}]);
app.filter("withReportTypes",[function(){return function(a){var k=[];angular.isArray(a)?a.forEach(function(a){0!==a.reportTypes.length&&k.push(a)}):k=a;return k}}]);app.filter("notEmptyCategories",[function(){return function(a,k){var e=[];angular.isArray(a)?a.forEach(function(a){var k=!1;a.reportTypes.some(function(a){if(a.paramsetsCount&&a.paramsetsCount===a.checkedParamsetsCount)return k=!0});!0===k&&e.push(a)}):e=a;return e}}]);app=angular.module("portalNMC");app.service("securityCheck",["$http",function(a){return{isAuthenficated:function(){return a({url:"../api/securityCheck/isAuthenticated",method:"GET",timeout:5E3}).then(function(a){return a.data.success},function(a){return!1})["catch"](function(a){return!1})}}}]);angular.module("portalNMC").service("subscrCabinetsSvc",["$http","$cookies","$interval","$rootScope",function(a,k,e,l){function u(a){x(a,"fullName")}var g=[],A=null,w={},h=function(a){var b=!1;if(angular.isUndefined(a)||null==a)b=!0;return b},x=function(a,e){if(!angular.isArray(a))return"Input value is no array.";if(h(e))return"Field for sort is undefined or null.";a.sort(function(a,b){return h(a[e])&&h(b[e])?0:h(a[e])?-1:h(b[e])||a[e].toUpperCase()>b[e].toUpperCase()?1:a[e].toUpperCase()<b[e].toUpperCase()?
-1:0})},t=null;l.$on("subscrCabinets:requestReloadCabinetData",function(){t=a.get("../api/subscr/subscrCabinet/contObjectCabinetInfo")});k=function(b){a.get(b).then(function(a){g=angular.copy(a.data)},function(a){console.log(a)})};k("../api/subscr/subscrObjectTreeTemplates");t=a.get("../api/subscr/subscrCabinet/contObjectCabinetInfo");return{createTree:function(b){return a.post("../api/rma/subscrObjectTree/contObjectTreeType1",b)},createCabinets:function(b){return h(b)||!angular.isArray(b)?null:a.put("../api/subscr/subscrCabinet/create",
b)},deleteCabinets:function(b){return h(b)||!angular.isArray(b)?null:a.put("../api/subscr/subscrCabinet/delete",b)},deleteTree:function(b){return a["delete"]("../api/rma/subscrObjectTree/contObjectTreeType1/"+b)},deleteTreeNode:function(b,e){return a["delete"]("../api/rma/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+e)},getCurrentCabinet:function(){return A},getCabinet:function(b){return angular.isUndefined(b)||null==b?"Cabinet id is null or undefined":a.get("../api/subscr/subscrCabinet/contObjectCabinetInfo/"+
b)},getCabinetSettings:function(){return w},getLoadingStatus:function(){return!0},getCabinetsUrl:function(){return"../api/subscr/subscrCabinet"},getPromise:function(){return t},getRmaCabinet:function(b){return angular.isUndefined(b)||null==b?"Cabinet id is null or undefined":a.get("../api/rma/contObjects/"+b)},getRmaCabinetsData:function(){return a.get("../api/rma/contObjects")},getRmaCabinetsUrl:function(){return"../api/rma/contObjects"},getRmaPromise:function(){return null},getSubscrUrl:function(){return"../api/subscr"},
getRmaTreeTemplates:function(){return g},findCabinetById:function(a,e){var b=null;if(!angular.isArray(e))return b;e.some(function(e){if(e.id===a)return b=e,!0});return b},loadFreeCabinetsByTree:function(b){return a.get("../api/rma/subscrObjectTree/contObjectTreeType1/"+b+"/contCabinets/free")},loadCabinetsByTreeNode:function(b,e){return a.get("../api/rma/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+e+"/contCabinets")},loading:!0,loadTree:function(b){return a.get("../api/rma/subscrObjectTree/contObjectTreeType1/"+
b)},loadTrees:function(){return a.get("../api/rma/subscrObjectTree/contObjectTreeType1")},loadTreeTemplateItems:function(b){return a.get("../api/subscr/subscrObjectTreeTemplates/"+b+"/items")},loadTreeTemplates:k,loadSubscrFreeCabinetsByTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/contCabinets/free")},loadSubscrCabinetsByTreeNode:function(b,e){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+e+"/contCabinets")},loadSubscrTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+
b)},loadSubscrTrees:function(){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1")},promise:t,putCabinetsToTreeNode:function(b,e,g){return a.put("../api/rma/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+e+"/contCabinets/add",g)},releaseCabinetsFromTreeNode:function(b,e,g){return a.put("../api/rma/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+e+"/contCabinets/remove",g)},resetPassword:function(b){return h(b)||!angular.isArray(b)?null:a.put("../api/subscr/subscrCabinet/subscrUser/resetPassword",
b)},rmaPromise:null,sendLDByEmail:function(b){return h(b)||!angular.isArray(b)?null:a.put("../api/subscr/subscrCabinet/subscrUser/sendPassword",b)},setCabinetSettings:function(a){for(var b in a)w[b]=a[b]},setCurrentCabinet:function(a){A=a},sortCabinetsByFullName:u,sortCabinetsByFullNameEx:function(a){if(angular.isUndefined(a)||null==a||!angular.isArray(a))return!1;var b=[],e=[];a.forEach(function(a){h(a.fullName)?e.push(a):b.push(a)});if(0==b.length)return"No Cabinets with fullName";u(b);Array.prototype.push.apply(e,
b);return e},sortCabinetsByContObjectFullName:function(a){if(angular.isUndefined(a)||null==a||!angular.isArray(a))return!1;a.sort(function(a,b){return(h(a.contObjectInfo)||h(a.contObjectInfo.fullName))&&(h(b.contObjectInfo)||h(b.contObjectInfo.fullName))?0:h(a.contObjectInfo)||h(a.contObjectInfo.fullName)?-1:h(b.contObjectInfo)||h(b.contObjectInfo.fullName)||a.contObjectInfo.fullName.toUpperCase()>b.contObjectInfo.fullName.toUpperCase()?1:a.contObjectInfo.fullName.toUpperCase()<b.contObjectInfo.fullName.toUpperCase()?
-1:0})},updateCabinet:function(b){return h(b)||h(b.cabinet)?null:a.put("../api/subscr/subscrCabinet/subscrUser/"+b.cabinet.subscrUser.id,b.cabinet.subscrUser)},updateTree:function(b){return a.put("../api/rma/subscrObjectTree/contObjectTreeType1/"+b.id,b)}}}]);
