var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,h={next:function(){if(d<a.length){var g=d++;return{value:b(g,a[g]),done:!1}}h.next=function(){return{done:!0,value:void 0}};return h.next()}};h[Symbol.iterator]=function(){return h};return h};
$jscomp.polyfill=function(a,b,d,h){if(b){d=$jscomp.global;a=a.split(".");for(h=0;h<a.length-1;h++){var g=a[h];g in d||(d[g]={});d=d[g]}a=a[a.length-1];h=d[a];b=b(h);b!=h&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");
angular.module("portalNMC").controller("AboutProgramCtrl",["mainSvc","$scope","$http",function(a,b,d){b.data={};b.data.columns=[{fieldName:"moduleName",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",headerClass:"col-xs-5 col-md-5 bg-info",dataClass:"col-xs-5 col-md-5"},{fieldName:"moduleVersion",header:"\u0412\u0435\u0440\u0441\u0438\u044f",headerClass:"col-xs-2 col-md-2 bg-info",dataClass:"col-xs-2 col-md-2"},{fieldName:"moduleReleaseDate",header:"\u0414\u0430\u0442\u0430 \u0432\u044b\u0445\u043e\u0434\u0430",
headerClass:"col-xs-2 col-md-2 bg-info",dataClass:"col-xs-2 col-md-2"}];b.data.modules=[];b.isTestMode=function(){return a.isTestMode()};(function(){d.get("../api/appStatus/appModulesVersions").then(function(a){b.data.modules=a.data},function(a){console.log(a)})})()}]);angular.module("portalNMC").controller("LineCtrl",function(a){a.labels="\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c".split(" ");a.series=["\u0421\u0435\u0440\u0438\u044f A","\u0421\u0435\u0440\u0438\u044f B"];a.data=[[65,59,80,81,56,55,40],[28,48,40,19,86,27,90]];a.onClick=function(a,d){console.log(a,d)};a.datasetOverride=[{yAxisID:"y-axis-1"},
{yAxisID:"y-axis-2"}];a.options={scales:{yAxes:[{id:"y-axis-1",type:"linear",display:!0,position:"left"},{id:"y-axis-2",type:"linear",display:!0,position:"right"}]}}}).controller("googleChartCtrl",function(a){var b={type:"PieChart",data:[["Component","cost"],["Software",5E4],["Hardware",8E4]]};b.data.push(["Services",2E4]);b.options={displayExactValues:!0,width:360,height:200,is3D:!0,chartArea:{left:10,top:10,bottom:0,height:"100%"}};b.formatters={number:[{columnNum:1,pattern:"$ #,##0.00"}]};a.chart=
b});var app=angular.module("portalNMC");
app.controller("ContactsCtrl",["$rootScope","$scope","$http","mainSvc","notificationFactory",function(a,b,d,h,g){a.ctxId="contacts_page";b.contacts=[];b.lists=[];b.currentItem={};b.cnt_lst=[];b.small_lists=[];b.small_contacts=[];b.url_users="../api/subscr/subscrAction/users";b.url_groups="../api/subscr/subscrAction/groups";var k=function(a){a=h.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};b.getContacts=function(){$.ajax({type:"GET",url:b.url_users,dataType:"json",async:!1,success:function(a){b.contacts=
a}})};b.getLists=function(){$.ajax({type:"GET",url:b.url_groups,dataType:"json",async:!1,success:function(a){b.lists=a}})};b.addContact=function(){if(!b.currentItem.userName||""==b.currentItem.userName)return g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0438\u043c\u044f \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u0430. \u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u043f\u043e\u043b\u0435 '\u0418\u043c\u044f'."),"Add / edit contact: no name";
var a,h=document.getElementById("table_lists_in_window");b.cnt_lst=[];for(a=0;a<h.rows.length;a+=1)h.rows[a].cells[0].childNodes[1].checked&&b.cnt_lst.push(h.rows[a].cells[0].childNodes[1].id);"undefined"!==typeof b.currentItem.id?(a=b.url_users+"/"+b.currentItem.id+"?subscrGroupIds="+b.cnt_lst,d.put(a,b.currentItem).success(function(){b.getContacts();$("#edit_contact").modal("hide")}).error(k)):(a=b.url_users+"?subscrGroupIds="+b.cnt_lst,d.post(a,b.currentItem).success(function(){b.getContacts();
$("#edit_contact").modal("hide")}).error(k))};b.addList=function(){var a,g=document.getElementById("table_contacts_in_window");b.cnt_lst=[];for(a=0;a<g.rows.length;a+=1)g.rows[a].cells[0].childNodes[1].checked&&b.cnt_lst.push(g.rows[a].cells[0].childNodes[1].id);"undefined"!==typeof b.currentItem.id?(a=b.url_groups+"/"+b.currentItem.id+"?subscrUserIds="+b.cnt_lst,d.put(a,b.currentItem).success(function(){b.getLists();$("#edit_list").modal("hide")}).error(k)):(a=b.url_groups+"?subscrUserIds="+b.cnt_lst,
d.post(a,b.currentItem).success(function(){b.getLists();$("#edit_list").modal("hide")}).error(k))};b.delContact=function(a){d["delete"](b.url_users+"/"+a.id).success(function(){$("#div_delete_contact").modal("hide");b.getContacts()}).error(k)};b.delList=function(a){d["delete"](b.url_groups+"/"+a.id).success(function(){$("#div_delete_contact_list").modal("hide");b.getLists()}).error(k)};b.getCntLst=function(a,g){var f,m,e;b.cnt_lst=[];if("new"!=g)e="contact"==a?b.url_users+"/"+g.id+"/groups":b.url_groups+
"/"+g.id+"/users",d.get(e).success(function(c){for(f=0;f<c.length;f+=1)b.cnt_lst.push(c[f].id);if("list"==a)for(b.small_contacts=b.contacts,f=0;f<b.contacts.length;f+=1)for(m=0;m<b.cnt_lst.length;m+=1)b.small_contacts[f].id==b.cnt_lst[m]&&(b.small_contacts[f].checked=!0);else for(b.small_lists=b.lists,f=0;f<b.lists.length;f+=1)for(b.small_lists[f].checked=!1,m=0;m<b.cnt_lst.length;m+=1)b.small_lists[f].id==b.cnt_lst[m]&&(b.small_lists[f].checked=!0)}).error(k);else if("contact"==a)for(b.small_lists=
b.lists,e=0;e<b.small_lists.length;e+=1)b.small_lists[e].checked=!1;else for(b.small_contacts=b.contacts,e=0;e<b.small_contacts.length;e+=1)b.small_contacts[e].checked=!1};b.addItem=function(a,d){b.editItem(a,d);"contact"==d?$("#edit_contact").modal():"list"==d&&$("#edit_list").modal()};b.editItem=function(a,d){b.currentItem="new"==a?{}:a;b.getCntLst(d,a)};b.getContacts();b.getLists();b.isAdmin=function(){return h.isAdmin()};b.isReadonly=function(){return h.isReadonly()};b.isROfield=function(){return b.isReadonly()};
b.isSystemViewInfo=function(){return h.getViewSystemInfo()}}]);app=angular.module("portalNMC");
app.controller("DataRangeSettings",["$scope","$interval","$rootScope","$location","$cookies",function(a,b,d,h,g){b=h.search();angular.isDefined(b.fromDate)&&"/notices/list"===h.path()?a.navPlayerDates={startDate:b.fromDate,endDate:b.toDate}:a.navPlayerDates={startDate:d.reportStart||moment().subtract(6,"days").startOf("day"),endDate:d.reportEnd||moment().endOf("day")};a.queryDateOptsRu={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",fromLabel:"\u0441",
toLabel:"\u043f\u043e",cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
ranges:{"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0434\u0435\u043d\u044c":[moment().startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 7 \u0434\u043d\u0435\u0439":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 30 \u0434\u043d\u0435\u0439":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},startDate:moment(a.navPlayerDates.startDate).startOf("day"),endDate:moment(a.navPlayerDates.endDate).endOf("day"),format:"DD.MM.YYYY",
separator:" \u043f\u043e "};a.queryDateOptsRuNoRanges={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",fromLabel:"\u0441",toLabel:"\u043f\u043e",cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
startDate:moment().startOf("day"),endDate:moment().endOf("day"),format:"DD.MM.YYYY",separator:" \u043f\u043e "};a.queryDateOptsEn={locale:{applyClass:"btn-green"},ranges:{Today:[moment().startOf("day"),moment().endOf("day")],"Last 7 days":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"Last 30 days":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},startDate:moment().startOf("day"),endDate:moment().endOf("day"),format:"DD.MM.YYYY"};a.$watch("navPlayerDates",
function(a,b){a!==b&&"/objects/indicators"!==h.path()&&(d.reportStart=moment(a.startDate).format("YYYY-MM-DD"),d.reportEnd=moment(a.endDate).format("YYYY-MM-DD"),"/notices/monitor"!=h.path()&&"/objects/indicators"!=h.path()&&(h.search("fromDate",d.reportStart),h.search("toDate",d.reportEnd)),d.$broadcast("navPlayerDatesChanged"))},!1);a.queryDateOptsIndicatorRu={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",fromLabel:"\u0441",toLabel:"\u043f\u043e",
cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
ranges:{"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0434\u0435\u043d\u044c":[moment().startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 7 \u0434\u043d\u0435\u0439":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 30 \u0434\u043d\u0435\u0439":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},format:"DD.MM.YYYY",separator:" \u043f\u043e "};a.$watch("indicatorDates",function(a){h.path()},!1);a.deleteIndicatorDates={startDate:moment().subtract(6,
"days").startOf("day"),endDate:moment().endOf("day")};a.$watch("deleteIndicatorDates",function(a){"/objects/indicators"===h.path()&&(d.startDateToDel=moment(a.startDate).format("YYYY-MM-DD"),d.endDateToDel=moment(a.endDate).format("YYYY-MM-DD"))},!1);angular.isDefined(g.fromDate)?a.monitorDates={startDate:g.fromDate,endDate:g.toDate}:a.monitorDates={startDate:moment().subtract(6,"days").startOf("day"),endDate:moment().endOf("day")};a.queryDateOptsMonitorRu={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",
fromLabel:"\u0441",toLabel:"\u043f\u043e",cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
ranges:{"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0434\u0435\u043d\u044c":[moment().startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 7 \u0434\u043d\u0435\u0439":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 30 \u0434\u043d\u0435\u0439":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},startDate:moment(g.fromDate)||moment().subtract(6,"days").startOf("day"),endDate:moment(g.toDate)||moment().endOf("day"),maxDate:moment().endOf("day"),
format:"DD.MM.YYYY",separator:" \u043f\u043e "};a.$watch("monitor123Dates",function(a){"/notices/monitor"===h.path()&&(d.monitorStart=moment(a.startDate).format("YYYY-MM-DD"),d.monitorEnd=moment(a.endDate).format("YYYY-MM-DD"))},!1)}]);app=angular.module("portalNMC");
app.controller("DlvrCtrl",["$rootScope","$scope","$http","notificationFactory","mainSvc",function(a,b,d,h,g){a.ctxId="delivery_page";b.rep_shdls=[];b.cur_rep_shdl={};b.rep_types=[];b.rep_act_types=[];b.rep_shdl_types=[];b.paramsets=[];b.dlvr_lists=[];b.url_rep_shdls="../api/reportShedule";b.url_rep_types="../api/reportSettings/reportType";b.url_rep_act_types="../api/reportSettings/reportActionType";b.url_rep_shdl_types="../api/reportSettings/reportSheduleType";b.url_paramsets="../api/reportParamset";
b.url_dlvr_lists="../api/subscr/subscrAction/groups";var k=function(a){a=g.errorCallbackHandler(a);h.errorInfo(a.caption,a.description)};b.getReportShedules=function(){d.get(b.url_rep_shdls).success(function(a){b.rep_shdls=a}).error(k)};b.addReportShedule=function(){var a,g;for(a=0;a<b.paramsets.length;a+=1)b.paramsets[a].id==b.cur_rep_shdl.reportParamset.id&&(g=b.paramsets[a].reportTemplate.id);"new"==b.cur_rep_shdl.id?(a=b.url_rep_shdls+"?reportTemplateId="+g+"&reportParamsetId="+b.cur_rep_shdl.reportParamset.id,
b.cur_rep_shdl.id=null,d.post(a,b.cur_rep_shdl).success(function(){h.success();b.getReportShedules()}).error(k)):(a=b.url_rep_shdls+"/"+b.cur_rep_shdl.id+"?reportTemplateId="+g+"&reportParamsetId="+b.cur_rep_shdl.reportParamset.id,d.put(a,b.cur_rep_shdl).success(function(){h.success();b.getReportShedules()}).error(k))};b.delReportShedule=function(a){d["delete"](b.url_rep_shdls+"/"+a.id).success(function(){$("#div_delete_delivery").modal("hide");h.success();b.getReportShedules()}).error(k)};b.getReportParameters=
function(){d.get(b.url_rep_types).success(function(a){b.rep_types=a}).error(k);d.get(b.url_rep_act_types).success(function(a){b.rep_act_types=a}).error(k);d.get(b.url_rep_shdl_types).success(function(a){b.rep_shdl_types=a}).error(k)};b.getParamsets=function(a){var g="",f;for(f=0;f<b.rep_types.length;f+=1)b.rep_types[f].keyname==b.cur_rep_shdl.reportTemplate.reportTypeKeyname&&(g=b.url_paramsets+b.rep_types[f].suffix);d.get(g).success(function(d){b.paramsets=d;a||(angular.isArray(b.paramsets)&&0<b.paramsets.length?
b.cur_rep_shdl.reportParamset=b.paramsets[0]:b.cur_rep_shdl.reportParamset=null)}).error(k)};b.getDeliveryLists=function(){d.get(b.url_dlvr_lists).success(function(a){b.dlvr_lists=a;for(a=0;a<b.dlvr_lists.length;a+=1)b.dlvr_lists[a].id=b.dlvr_lists[a].id.toString()}).error(k)};b.addNewReportShedule=function(a){b.editReportShedule(a);$("#div_edit_delivery").modal()};b.editReportShedule=function(a){"new"==a?(b.cur_rep_shdl={},b.cur_rep_shdl.id="new",b.time=[],b.start_date=new Date,b.end_date=null,document.getElementById("div_rcpt_slct").style.display=
"none",document.getElementById("div_rcpt_email").style.display="block",document.getElementById("div_day_of_month").style.display="block",document.getElementById("div_day_of_week").style.display="none",document.getElementById("div_day_date").style.display="none",document.getElementById("div_daily").style.display="none",document.getElementById("inp_day").disabled=!0,document.getElementById("inp_hour").disabled=!0,document.getElementById("inp_minute").disabled=!0,document.getElementById("inp_rcpt_email").disabled=
!0,document.getElementById("slct_rep_tmpl_var").disabled=!0,b.cur_rep_shdl.sheduleTimeTemplate="15 0 1 * 1"):(b.cur_rep_shdl=angular.copy(a),b.changeReportType(!0),b.changeSheduleAction(),b.activateStartEndDates(),b.activatePeriod())};b.changeReportType=function(a){document.getElementById("slct_rep_tmpl_var").disabled=!1;b.getParamsets(a)};b.changeSheduleAction=function(){switch(b.cur_rep_shdl.sheduleAction1Key){case "EMAIL_LIST_DELIVERY":b.getDeliveryLists();document.getElementById("div_rcpt_slct").style.display=
"block";document.getElementById("div_rcpt_email").style.display="none";document.getElementById("slct_rcpt").disabled=!1;break;case "EMAIL_RAW_DELIVERY":document.getElementById("div_rcpt_slct").style.display="none";document.getElementById("div_rcpt_email").style.display="block";document.getElementById("inp_rcpt_email").disabled=!1;break;default:h.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u044b\u0431\u043e\u0440\u0430 \u0441\u043f\u043e\u0441\u043e\u0431\u0430 \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438",
"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043f\u043e\u0441\u043e\u0431 \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438")}};b.activateStartEndDates=function(){null!=b.cur_rep_shdl.sheduleStartDate&&(b.start_date=new Date(b.cur_rep_shdl.sheduleStartDate));null!=b.cur_rep_shdl.sheduleEndDate&&(b.end_date=new Date(b.cur_rep_shdl.sheduleEndDate))};b.activatePeriod=function(){document.getElementById("inp_hour").disabled=!1;document.getElementById("inp_minute").disabled=
!1;b.time=b.cur_rep_shdl.sheduleTimeTemplate.split(" ");if("*"==b.time[3])b.time[3]=new Date;else{var a=new Date;--b.time[3];b.time[3]=new Date(a.getFullYear(),b.time[3],b.time[2])}switch(b.cur_rep_shdl.reportSheduleTypeKey){case "SINGLE":document.getElementById("div_day_of_month").style.display="none";document.getElementById("div_day_of_week").style.display="none";document.getElementById("div_day_date").style.display="block";document.getElementById("div_daily").style.display="none";document.getElementById("inp_day_date").disabled=
!1;break;case "DAILY":document.getElementById("div_day_of_month").style.display="none";document.getElementById("div_day_of_week").style.display="none";document.getElementById("div_day_date").style.display="none";document.getElementById("div_daily").style.display="block";break;case "WEEKLY":document.getElementById("div_day_of_month").style.display="none";document.getElementById("div_day_of_week").style.display="block";document.getElementById("div_day_date").style.display="none";document.getElementById("div_daily").style.display=
"none";document.getElementById("slct_day_of_week").disabled=!1;break;case "MONTHLY":document.getElementById("div_day_of_month").style.display="block";document.getElementById("div_day_of_week").style.display="none";document.getElementById("div_day_date").style.display="none";document.getElementById("div_daily").style.display="none";document.getElementById("inp_day").disabled=!1;break;default:h.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u044b\u0431\u043e\u0440\u0430 \u043f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u043d\u043e\u0441\u0442\u0438 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438",
"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u043d\u043e\u0441\u0442\u044c \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438")}};b.dlvrSave=function(){var a=!1;b.cur_rep_shdl.sheduleStartDate=b.start_date.getTime();if(null!=b.end_date){var d=b.end_date.getTime();d<b.cur_rep_shdl.sheduleStartDate?(h.errorInfo("\u0412\u0432\u0435\u0434\u0435\u043d\u043e \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f",
"\u0423\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438 \u043c\u0435\u043d\u044c\u0448\u0435, \u0447\u0435\u043c \u0432\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u0430"),a=!0):b.cur_rep_shdl.sheduleEndDate=d}else b.cur_rep_shdl.sheduleEndDate=null;null==b.cur_rep_shdl.name&&(h.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438",
"\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438"),a=!0);if("undefined"==typeof b.cur_rep_shdl.reportTemplate)h.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0442\u0438\u043f \u043e\u0442\u0447\u0451\u0442\u0430","\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0442\u0438\u043f \u043e\u0442\u0447\u0451\u0442\u0430"),
a=!0;else if("undefined"==typeof b.cur_rep_shdl.reportParamset||null==b.cur_rep_shdl.reportParamset)h.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u0448\u0430\u0431\u043b\u043e\u043d\u0430","\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u0448\u0430\u0431\u043b\u043e\u043d\u0430"),a=!0;null==b.cur_rep_shdl.sheduleAction1Key?(h.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0441\u043f\u043e\u0441\u043e\u0431 \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438",
"\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0441\u043f\u043e\u0441\u043e\u0431 \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438"),a=!0):null==b.cur_rep_shdl.sheduleAction1Param&&(h.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u0438","\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u0435\u0439"),
a=!0);0<=b.time[0]&&60>b.time[0]?b.cur_rep_shdl.sheduleTimeTemplate=b.time[0]+" ":(h.errorInfo("\u0412\u0440\u0435\u043c\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u043d\u0435\u0432\u0435\u0440\u043d\u043e","\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043c\u0438\u043d\u0443\u0442\u044b \u043e\u0442 0 \u0434\u043e 60"),a=!0);0<=b.time[1]&&24>b.time[1]?b.cur_rep_shdl.sheduleTimeTemplate=b.cur_rep_shdl.sheduleTimeTemplate+b.time[1]+
" ":(h.errorInfo("\u0412\u0440\u0435\u043c\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u043d\u0435\u0432\u0435\u0440\u043d\u043e","\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0447\u0430\u0441\u044b \u043e\u0442 0 \u0434\u043e 24"),a=!0);switch(b.cur_rep_shdl.reportSheduleTypeKey){case "SINGLE":b.cur_rep_shdl.sheduleTimeTemplate=b.cur_rep_shdl.sheduleTimeTemplate+b.time[3].getDate()+" "+(b.time[3].getMonth()+1)+" *";break;case "DAILY":b.cur_rep_shdl.sheduleTimeTemplate+=
"* * *";break;case "WEEKLY":1>b.time[4]||7<b.time[4]?(h.errorInfo("\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d \u0434\u0435\u043d\u044c \u043d\u0435\u0434\u0435\u043b\u0438","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0434\u0435\u043d\u044c \u043d\u0435\u0434\u0435\u043b\u0438"),a=!0):b.cur_rep_shdl.sheduleTimeTemplate=b.cur_rep_shdl.sheduleTimeTemplate+"* * "+b.time[4];break;case "MONTHLY":0<b.time[2]&&31>=b.time[2]&&(b.cur_rep_shdl.sheduleTimeTemplate=
b.cur_rep_shdl.sheduleTimeTemplate+b.time[2]+" * *");break;default:h.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0430 \u043f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u043d\u043e\u0441\u0442\u044c \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u043d\u043e\u0441\u0442\u044c \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438"),
a=!0}a||(b.addReportShedule(),$("#div_edit_delivery").modal("hide"))};b.getReportShedules();b.getReportParameters();b.isAdmin=function(){return g.isAdmin()};b.isReadonly=function(){return g.isReadonly()};b.isROfield=function(){return b.isReadonly()};b.isTestMode=function(){return g.isTestMode()};b.isSystemViewInfo=function(){return g.getViewSystemInfo()}}]);app=angular.module("portalNMC");app.controller("DirectoryCtrl",["$scope","$resource",function(a,b){a.clk=function(){alert("Hi")}}]);app=angular.module("portalNMC");app.controller("IdleCtrl",["$scope",function(a){a.$on("IdleEnd",function(){$("#warnDialogModal").modal("hide")});a.$on("IdleStart",function(){$("#warnDialogModal").modal()});a.$on("IdleTimeout",function(){window.location.assign("../logout")});a.progressbar=function(a){return Math.round(a)}}]);angular.module("portalNMC").controller("ImpulseIndicatorsCtrl",["$scope","$rootScope","$cookies","$window","$http","$location","crudGridDataFactory","FileUploader","notificationFactory","indicatorSvc","mainSvc","$timeout",function(a,b,d,h,g,k,f,n,l,m,e,c){b.ctxId="indicators_page";a.date={};angular.isDefined(k.search().fromDate)&&null!=k.search().fromDate?a.impulseIndicatorDates={startDate:k.search().fromDate,endDate:k.search().toDate}:angular.isDefined(d.fromDate)&&null!=d.toDate?a.impulseIndicatorDates=
{startDate:d.fromDate,endDate:d.toDate}:a.impulseIndicatorDates={startDate:m.getFromDate(),endDate:m.getToDate()};a.date.deleteIndicatorDates={startDate:angular.copy(a.impulseIndicatorDates.startDate),endDate:angular.copy(a.impulseIndicatorDates.endDate)};a.$watch("date.deleteIndicatorDates",function(a,c,p){"/objects/impulse-indicators"===k.path()&&a!==c&&(b.startDateToDel=moment(a.startDate).format("YYYY-MM-DD"),b.endDateToDel=moment(a.endDate).format("YYYY-MM-DD"))},!1);a.ctrlSettings={};a.ctrlSettings.ctxId=
"zpoint_indicator_page";a.ctrlSettings.loadedWaterColumnsPref=[];a.ctrlSettings.orderBy={};if(angular.isDefined(d.indicatorsortorder)&&null!=d.indicatorsortorder)switch(d.indicatorsortorder){case "asc":a.ctrlSettings.orderBy={field:"dataDate",asc:!0,desc:!1,order:"asc"};break;case "desc":a.ctrlSettings.orderBy={field:"dataDate",asc:!1,desc:!0,order:"desc"}}else a.ctrlSettings.orderBy={field:"dataDate",asc:!1,desc:!0,order:"desc"};a.intotalColumns=m.getIntotalColumns();a.indicatorColumns=m.getImpulseColumns();
a.tableDef={tableClass:"crud-grid table table-lighter table-bordered table-condensed table-hover",hideHeader:!1,headerClassTR:"nmc-main-table-header",columns:a.indicatorColumns};a.summary={};a.totalIndicators=0;a.indicatorsPerPage=100;a.timeDetailType="24h";a.data=[];a.pagination={current:1};a.indicatorModes=[];a.showLinkToFileFlag=!1;a.isManualLoading="true"===d.isManualLoading?!0:!1;var q=function(b){a.ctrlSettings.loading=!1;console.log(b);var c="-1";if(e.checkUndefinedNull(b)||e.checkUndefinedNull(b.data))c=
"ERR_CONNECTION";e.checkUndefinedNull(b)||e.checkUndefinedNull(b.resultCode)&&(e.checkUndefinedNull(b.data)||e.checkUndefinedNull(b.data.resultCode))||(c=b.resultCode||b.data.resultCode);b=e.getServerErrorByResultCode(c);l.errorInfo(b.caption,b.description)};(function(){a.uploader=new n({url:"../api/subscr/contObjects/"+d.contObject+"/contZPoints/"+d.contZPoint+"/service/24h/csv"});a.uploader.onErrorItem=function(a,b,c,e){console.info("onErrorItem",c,b);q(b)};a.uploader.onSuccessItem=function(a,b,
c,e){}})();a.isSystemuser=function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};a.columns=[];a.getData=function(t){a.ctrlSettings.loading=!0;a.pagination.current=t;a.zpointTable="../api/subscr/"+a.contObject+"/serviceImpulse/"+(a.timeDetailType||d.timeDetailType)+"/"+a.contZPoint+"/paged?beginDate="+b.reportStart+"&endDate="+b.reportEnd+"&page="+(t-1)+"&size="+a.indicatorsPerPage+"&dataDateSort="+a.ctrlSettings.orderBy.order;g.get(a.zpointTable).success(function(b){a.totalIndicators=
b.totalElements;a.columns=a.tableDef.columns;!0===e.getUseColorHighlightIndicatorData()&&m.setColorHighlightsForManualAndCrc(b.objects);b.objects.map(function(b,c){for(var p in a.columns)"dataDate"===a.columns[p].fieldName?b.dataDate=b.dataDateString:null!=b[a.columns[p].fieldName]&&"dataDateString"!==a.columns[p].fieldName&&(b[a.columns[p].fieldName]=b[a.columns[p].fieldName].toFixed(3))});a.data=b.objects;a.ctrlSettings.loading=!1;c(function(){a.setScoreStyles()},100)}).error(q)};a.setScoreStyles=
function(){var b=document.getElementById("indicatorTableHeader"),c=document.getElementById("divCFIndicatorTable");if(!e.checkUndefinedNull(c)&&!e.checkUndefinedNull(b)){if(0==b.offsetWidth)return"Indicators. tableHeader.offsetWidth == 0";c.style.width=c.offsetWidth>c.clientWidth?b.offsetWidth+17+"px":b.offsetWidth+"px"}a.tableDef.columns.some(function(b){var c=document.getElementById("indicators_th_"+b.fieldName),p=document.getElementById("indicators_head_"+b.fieldName),d=null;e.checkUndefinedNull(a.deviceMu)||
(d=document.getElementById("indicators_head1_"+b.fieldName));angular.isDefined(c)&&null!=c&&angular.isDefined(p)&&null!=p&&(b=Math.max(c.offsetWidth,c.clientWidth),p.style.width=b+"px",e.checkUndefinedNull(a.deviceMu)||(d.style.width=b+"px"))})};a.onTableLoad=function(){a.setScoreStyles()};(function(){var c=k.search();angular.isUndefined(null);angular.isDefined(c.zpointId)&&"null"!==c.zpointId&&m.setZpointId(c.zpointId);angular.isUndefined(null);angular.isDefined(c.objectId)&&"null"!==c.objectId&&
m.setContObjectId(c.objectId);angular.isUndefined(null);angular.isDefined(c.zpointName)&&"null"!==c.zpointName&&m.setZpointName(c.zpointName);angular.isUndefined(null);angular.isDefined(c.objectName)&&"null"!==c.objectName&&m.setContObjectName(c.objectName);angular.isUndefined(null);angular.isDefined(c.deviceModel)&&"null"!==c.deviceModel&&m.setDeviceModel(c.deviceModel);angular.isUndefined(null);angular.isDefined(c.deviceSN)&&"null"!==c.deviceSN&&m.setDeviceSN(c.deviceSN);angular.isDefined(c.mu)&&
(a.deviceMu=c.mu);angular.isUndefined(null);angular.isDefined(c.timeDetailType)&&"null"!==c.timeDetailType?a.timeDetailType=c.timeDetailType:angular.isDefined(d.timeDetailType)&&"undefined"!=d.timeDetailType&&"null"!=d.timeDetailType?a.timeDetailType=d.timeDetailType:a.timeDetailType=m.getTimeDetailType();var t=a.timeDetailType.split("_");1<t.length?(a.timeType=t[0],a.detailType="_"+t[1]):1==t.length?(a.timeType=t[0],a.detailType=""):(a.timeType=m.getTimeType(),a.detailType=m.getDetailType());a.contZPoint=
m.getZpointId();a.contZPointName="undefined"!=m.getZpointName()?m.getZpointName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";a.contObject=m.getContObjectId();a.contObjectName="undefined"!=m.getContObjectName()?m.getContObjectName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";a.deviceModel=m.getDeviceModel();a.deviceSN=m.getDeviceSN();angular.isDefined(c.fromDate)&&"null"!==c.fromDate?b.reportStart=c.fromDate:angular.isDefined(d.fromDate)&&"null"!==
d.fromDate?b.reportStart=d.fromDate:b.reportStart=m.getFromDate();angular.isDefined(c.toDate)&&"null"!==c.toDate?b.reportEnd=c.toDate:angular.isDefined(d.toDate)&&"null"!==d.toDate?b.reportEnd=d.toDate:b.reportEnd=m.getToDate();a.dateRangeOptsRu=e.getDateRangeOptions("indicator-ru");a.date.forDeleteDateRangeOptsRu=e.getDateRangeOptions("indicator-ru");a.getData(1)})();a.$on("indicators:loadedModePrefs",function(){a.getData(1)});a.pageChanged=function(b){a.getData(b)};a.changeTimeDetailType=function(){a.timeDetailType=
a.timeType+a.detailType;d.timeDetailType=a.timeDetailType;a.getData(1)};a.$watch("impulseIndicatorDates",function(c,e,p){"/objects/impulse-indicators"===k.path()&&c!==e&&(d.fromDate=moment(c.startDate).format("YYYY-MM-DD"),d.toDate=moment(c.endDate).format("YYYY-MM-DD"),m.setFromDate(moment(c.startDate).format("YYYY-MM-DD")),m.setToDate(moment(c.endDate).format("YYYY-MM-DD")),b.reportStart=moment(c.startDate).format("YYYY-MM-DD"),b.reportEnd=moment(c.endDate).format("YYYY-MM-DD"),a.getData(1),a.date.deleteIndicatorDates=
{startDate:moment(c.startDate),endDate:moment(c.endDate)},b.startDateToDel=moment(c.startDate).format("YYYY-MM-DD"),b.endDateToDel=moment(c.endDate).format("YYYY-MM-DD"))},!1);var t=angular.element(h),u=function(){angular.isDefined(a.setScoreStyles)&&a.setScoreStyles();a.$apply()};t.bind("resize",u);a.$on("$destroy",function(){t.unbind("resize",u)});a.saveIndicatorsToFile=function(c){window.open("../api/subscr/"+(a.contObject||d.contObject)+"/service/"+(a.timeDetailType||d.timeDetailType)+"/"+(a.contZPoint||
d.contZPoint)+"/csv"+c+"?beginDate="+b.reportStart+"&endDate="+b.reportEnd)};a.uploadFile=function(){a.uploader.queue[a.uploader.queue.length-1].upload()};a.deleteData=function(){g["delete"]("../api/subscr/contObjects/"+(a.contObject||d.contObject)+"/contZPoints/"+(a.contZPoint||d.contZpoint)+"/service/24h/csv?beginDate="+b.startDateToDel+"&endDate="+b.endDateToDel).success(function(b){l.success();a.linkToFileWithDeleteData="../api/subscr/service/out/csv/"+b.filename;a.fileWithDeleteData=b.filename;
a.showLinkToFileFlag=!0;a.getData(1)}).error(q)};a.setOrderBy=function(b){var c=a.ctrlSettings.orderBy.field===b?!a.ctrlSettings.orderBy.asc:!0;d.indicatorsortorder=1==c?"asc":"desc";a.ctrlSettings.orderBy={field:b,asc:c,order:d.indicatorsortorder};a.getData(1)};a.isHaveData=function(){return angular.isUndefined(a.data)||0==a.data.length?!1:!0};a.isTDTabs=function(a){return"1h_abs"==a};a.changeIndicatorMode=function(){a.ctrlSettings.loadedWaterColumnsPref=a.currentIndicatorMode.vv.waterColumns;a.timeDetailType=
a.currentIndicatorMode.vv.indicatorHwKind;a.indicatorsPerPage=a.currentIndicatorMode.vv.indicatorHwPerPage;a.$broadcast("indicators:loadedModePrefs")};var v=function(a){e.getContextIds().forEach(function(b){b.permissionTagId.localeCompare(a);var c=document.getElementById(b.permissionTagId);angular.isUndefined(c)||null==c||$("#"+b.permissionTagId).removeClass("nmc-hide")})};v(a.ctrlSettings.ctxId);b.$on("servicePermissions:loaded",function(){v(a.ctrlSettings.ctxId)});window.setTimeout(function(){v(a.ctrlSettings.ctxId)},
500)}]);app=angular.module("portalNMC");
app.controller("ElectricityConsumptionCtrl",["$scope","$http","indicatorSvc","mainSvc","$location","$cookies","$rootScope","$window","$timeout","notificationFactory",function(a,b,d,h,g,k,f,n,l,m){function e(b){a.$broadcast("indicators:loadedModePrefs");a.ctrlSettings.loading=!1;b=h.errorCallbackHandler(b);m.errorInfo(b.caption,b.description)}function c(c){if(h.checkUndefinedNull("../api/subscr/vcookie")||h.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||h.checkUndefinedNull(c))return console.log("Request required params is null!"),!1;
b.get("../api/subscr/vcookie?vcMode=OBJECT_INDICATOR_PREFERENCES&vcKey="+c).then(function(b){if(h.checkUndefinedNull(b)||h.checkUndefinedNull(b.data)||!angular.isArray(b.data)||0===b.data.length)return a.$broadcast("indicators:loadedModePrefs"),console.log("Indicators: incorrect mode preferences!"),!1;b=JSON.parse(b.data[0].vcValue);a.ctrlSettings.loadedElectricityColumnsPref=b.electricityColumns;a.ctrlSettings.viewMode=b.indicatorElMode;a.timeDetailType=b.indicatorElKind;a.$broadcast("indicators:loadedModePrefs")},
e)}function q(p){if(h.checkUndefinedNull("../api/subscr/vcookie/user")||h.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||h.checkUndefinedNull(p))return console.log("Request required params is null!"),a.$broadcast("indicators:loadedModePrefs"),!1;b.get("../api/subscr/vcookie/user?vcMode=OBJECT_INDICATOR_PREFERENCES&vcKey=OIP_"+p).then(function(b){if(h.checkUndefinedNull(b)||h.checkUndefinedNull(b.data)||0===b.data.length)return a.$broadcast("indicators:loadedModePrefs"),!1;b=JSON.parse(b.data[0].vcValue);
c(b)},e)}function t(b){var c;if(h.checkUndefinedNull(b)||0===b.length)for(a.ctrlSettings.activeEnergyColCount=F,a.ctrlSettings.reactiveEnergyColCount=F,c=1;c<a.columns.length;c+=1)a.columns[c].isvisible="isvisible";else{var p={p_A:0,q_R:0};for(c=1;c<a.columns.length;c+=1)b.forEach(function(b){b.fieldName===a.columns[c].fieldName&&!0===b.isVisible&&(a.columns[c].isvisible="isvisible",p[a.columns[c].elType]+=1)});a.ctrlSettings.activeEnergyColCount=p.p_A;a.ctrlSettings.reactiveEnergyColCount=p.q_R}}
function u(a){var b,c;a.forEach(function(a){for(b=0;b<p.length;b+=1)for(c=0;c<y.length;c+=1)a[""+p[b].name+y[c].name+"_sum"]=-a[""+p[b].name+y[c].name]});return a}function v(b){var c;b.forEach(function(b){for(c in a.columns)null!=b[a.columns[c].fieldName]&&"string"!==a.columns[c].type&&(b[a.columns[c].fieldName]=b[a.columns[c].fieldName].toFixed(a.ctrlSettings.precision),b[""+a.columns[c].elType+a.columns[c].elKind+"_sum"]+=Number(b[a.columns[c].fieldName]))});return b}function x(b){var c,e;b.forEach(function(b){for(c=
0;c<p.length;c+=1)for(e=0;e<y.length;e+=1)b[""+p[c].name+y[e].name+"_sum"]=b[""+p[c].name+y[e].name+"_sum"].toFixed(a.ctrlSettings.precision)})}function w(b){var c,e;b.forEach(function(b,d){for(c=0;c<p.length;c+=1)for(e=0;e<y.length;e+=1){b[""+p[c].name+y[e].name+"_style"]={};b[""+p[c].name+y[e].name+"_style"].bgcolor="aquamarine";b[""+p[c].name+y[e].name+"_style"].cursor="default";if(h.checkUndefinedNull(b[""+p[c].name+y[e].name+"_sum"])||h.checkUndefinedNull(b[""+p[c].name+y[e].name]))return"Sum is undefined or null.";
var t=Math.abs(b[""+p[c].name+y[e].name+"_sum"]-b[""+p[c].name+y[e].name]).toFixed(a.ctrlSettings.precision),K=Number("0.00000000000000000000".substring(0,a.ctrlSettings.precision+1)+"1");t>K&&1>=t?(b[""+p[c].name+y[e].name+"_style"].bgcolor="#FFFFA4",b[""+p[c].name+y[e].name+"_style"].cursor="pointer"):1<t&&(b[""+p[c].name+y[e].name+"_style"].bgcolor="#FF7171",b[""+p[c].name+y[e].name+"_style"].cursor="pointer");t="#indicators_td_"+b.id+p[c].name+y[e].name;K="";K+="\u0421\u0443\u043c\u043c\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u0430\u044f \u043e\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: "+
b[""+p[c].name+y[e].name];K+="<br><br>";K+="\u0420\u0430\u0441\u0441\u0447\u0438\u0442\u0430\u043d\u043d\u0430\u044f \u0441\u0443\u043c\u043c\u0430: "+b[""+p[c].name+y[e].name+"_sum"];C("\u0414\u0435\u0442\u0430\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f",K,t,t)}})}a.data=[];a.totals=[];a.indicatorsPerPage=a.data.length;a.totalIndicators=a.data.length;a.pagination={current:1};angular.isDefined(g.search().fromDate)&&null!=g.search().fromDate?a.indicatorDates=
{startDate:g.search().fromDate,endDate:g.search().toDate}:angular.isDefined(k.fromDate)&&null!=k.toDate?a.indicatorDates={startDate:k.fromDate,endDate:k.toDate}:a.indicatorDates={startDate:d.getFromDate(),endDate:d.getToDate()};a.ctrlSettings={};a.ctrlSettings.dataUrl="";a.ctrlSettings.userFormat="DD.MM.YYYY";a.ctrlSettings.requestFormat="YYYY-MM-DD";a.ctrlSettings.viewMode="";a.ctrlSettings.dataDate=moment().endOf("day").format(a.ctrlSettings.userFormat);a.ctrlSettings.loading=!0;a.ctrlSettings.precision=
3;a.ctrlSettings.ctxId="electricity_consumption_page";a.ctrlSettings.loadedElectricityColumnsPref=[];a.tableDef={tableClass:"crud-grid table table-lighter table-bordered table-condensed table-hover",hideHeader:!1,headerClassTR:"nmc-main-table-header",columns:[]};var p=[{name:"p_A",caption:"A"},{name:"q_R",caption:"R"}],y=[{name:"p",caption:"+"},{name:"n",caption:"-"}];a.tableDef.columns=d.getElectricityColumns();a.columns=a.tableDef.columns;var F=Math.floor(a.columns.length/2);a.ctrlSettings.activeEnergyColCount=
F;a.ctrlSettings.reactiveEnergyColCount=F;a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:a.ctrlSettings.dateFormat};var G=function(c,p){b.get(c+p).then(function(b){b=angular.copy(b.data);if(h.checkUndefinedNull(b))return"Electricity indicators undefined or null.";l(function(){a.setScoreStyles()});!0===h.getUseColorHighlightIndicatorData()&&d.setColorHighlightsForManualAndCrc(b);u(b);v(b);x(b);w(b);a.data=b;a.indicatorsPerPage=a.data.length;a.ctrlSettings.loading=!1;""==a.ctrlSettings.viewMode&&0<a.data.length&&H(c+"/summary"+p)},function(b){a.ctrlSettings.loading=
!1;console.log(b)})},C=function(a,b,c,p){l(function(){$(c).qtip({suppress:!1,content:{text:b,title:a,button:!0},show:{event:"click"},style:{classes:"qtip-nmc-indicator-tooltip",width:1E3},hide:{event:"unfocus"},position:{my:"top right",at:"bottom right",target:$(p)}})},1)},H=function(c){a.totals=[];var p={},e,d;b.get(c).then(function(b){l(function(){a.setScoreStyles()});p=angular.copy(b.data);b=[{name:"totals",caption:"\u0418\u0442\u043e\u0433\u043e:",type:"Cons"},{name:"diffsAbs",caption:"\u0418\u0442\u043e\u0433\u043e \u043f\u043e \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u0430\u043c:",
type:"Abs"}];for(e in b){var c=angular.copy(p[b[e].name]);if(!h.checkUndefinedNull(c)){for(d in a.columns)null!=c[a.columns[d].fieldName]&&"string"!==a.columns[d].type&&(c[a.columns[d].fieldName]=c[a.columns[d].fieldName].toFixed(a.ctrlSettings.precision));c.onlyCons=!0;c.type=b[e].type;c.dataDateString=b[e].caption;c["class"]="nmc-el-totals-indicator-highlight nmc-view-digital-data";a.totals.push(angular.copy(c));a.indicatorsPerPage+=1}}p.hasOwnProperty("diffsAbs")&&p.hasOwnProperty("totals")&&a.tableDef.columns.forEach(function(a,
b,c){a.diffBgColor="aquamarine";a.title="";b=a.fieldName;if(!angular.isUndefined(p.firstDataAbs)&&!angular.isUndefined(p.lastDataAbs)&&null!==p.firstDataAbs&&null!==p.lastDataAbs&&p.firstDataAbs.hasOwnProperty(b)&&p.lastDataAbs.hasOwnProperty(b)){c="\u041d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 = "+p.firstDataAbs[b]+" ";var e="";10==p.firstDataAbs.dataDateString.length&&(e=" 00:00");c+="(\u0414\u0430\u0442\u0430 = "+p.firstDataAbs.dataDateString+
e+");<br><br>";c+="\u041a\u043e\u043d\u0435\u0447\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 = "+p.lastDataAbs[b]+" ";e="";10==p.lastDataAbs.dataDateString.length&&(e=" 00:00");c+="(\u0414\u0430\u0442\u0430 = "+p.lastDataAbs.dataDateString+e+");";C("\u0414\u0435\u0442\u0430\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f",c,"#diffElBtn"+b,"#totalAbs"+b);p.diffsAbs.hasOwnProperty(b)&&!isNaN(p.diffsAbs[b])&&null!=p.diffsAbs[b]&&(p.diffsAbs[b]=
Number(p.diffsAbs[b]).toFixed(3));p.totals.hasOwnProperty(b)&&!isNaN(p.totals[b])&&null!=p.totals[b]&&(p.totals[b]=Number(p.totals[b]).toFixed(3));p.diffsAbs.hasOwnProperty(b)&&p.totals.hasOwnProperty(b)&&(c=p.diffsAbs[b],e=p.totals[b],null!=c&&null!=e&&"-"!=c&&"-"!=e&&(c.toString().split("."),e.toString().split("."),c=Number("0.001"),b=Math.abs(p.diffsAbs[b]-p.totals[b]).toFixed(3),b>c&&1>=b?(a.diffBgColor="#FFFFA4",a.title="\u0418\u0442\u043e\u0433\u043e \u0438 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0440\u0430\u0441\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u041d\u0415 \u0431\u043e\u043b\u0435\u0435 \u0447\u0435\u043c \u043d\u0430 1"):
1<b&&(a.diffBgColor="#FF7171",a.title="\u0418\u0442\u043e\u0433\u043e \u0438 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0440\u0430\u0441\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0411\u041e\u041b\u0415\u0415 \u0447\u0435\u043c \u043d\u0430 1")))}})},function(a){console.log(a)})};a.getData=function(){a.ctrlSettings.loading=!0;0<=a.ctrlSettings.viewMode.indexOf("_abs")?a.ctrlSettings.precision=2:a.ctrlSettings.precision=
3;a.data=[];var b;b=a.timeDetailType||k.timeDetailType;0<=b.indexOf("_abs")&&(b="24h",a.timeDetailType="24h");b+=a.ctrlSettings.viewMode;a.zpointTable="../api/subscr/"+a.contObject+"/serviceElCons/"+b+"/"+a.contZPoint;if("1h"==a.timeDetailType){b=moment(a.ctrlSettings.dataDate,a.ctrlSettings.userFormat).format(a.ctrlSettings.requestFormat);if(0==b.localeCompare("Invalid date")||"2000-01-01">b)return"requestDate is Invalid date.";b="/?beginDate="+b+"&endDate="+b}else b="/?beginDate="+f.reportStart+
"&endDate="+f.reportEnd;G(a.zpointTable,b)};a.$on("indicators:loadedModePrefs",function(){t(a.ctrlSettings.loadedElectricityColumnsPref);a.getData()});a.changeViewMode=function(){a.getData()};a.changeTimeDetailType=function(){a.getData()};a.refreshData=function(){a.getData()};a.$watch("indicatorDates",function(b,c){"/objects/indicator-electricity"===g.path()&&b!==c&&(k.fromDate=moment(b.startDate).format(a.ctrlSettings.requestFormat),k.toDate=moment(b.endDate).format(a.ctrlSettings.requestFormat),
d.setFromDate(moment(b.startDate).format(a.ctrlSettings.requestFormat)),d.setToDate(moment(b.endDate).format(a.ctrlSettings.requestFormat)),f.reportStart=moment(b.startDate).format(a.ctrlSettings.requestFormat),f.reportEnd=moment(b.endDate).format(a.ctrlSettings.requestFormat),a.getData())},!1);var r=angular.element(n),I=function(){angular.isDefined(a.setScoreStyles)&&a.setScoreStyles();a.$apply()};r.bind("resize",I);a.$on("$destroy",function(){r.unbind("resize",I)});a.setScoreStyles=function(){var a=
document.getElementById("indicatorConsTableHeader"),b=document.getElementById("divIndicatorConsTable");h.checkUndefinedNull(b)||(b.style.width=b.offsetWidth>b.clientWidth?a.offsetWidth+17+"px":a.offsetWidth+"px")};$(document).ready(function(){$("#inputElConsDate").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display",
"table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});h.checkUndefinedNull(a.contObject)||q(a.contObject)}]);app=angular.module("portalNMC");
app.controller("ElectricityEnergyCtrl",["$scope","$http","indicatorSvc","mainSvc","$location","$cookies","$rootScope","notificationFactory",function(a,b,d,h,g,k,f,n){a.electroKind="Energy";a.dataUrl="../api/subscr/"+a.contObject+"/serviceElProfile/30min/"+a.contZPoint;a.columns=[{header:"\u0414\u0430\u0442\u0430",headerClass:"col-xs-2 col-md-2 nmc-text-align-center",dataClass:"col-xs-2 col-md-2 nmc-text-align-right",fieldName:"dataDateString",type:"string",date:!0},{header:"\u0418\u043d\u0442\u0435\u0440\u0432\u0430\u043b, \u043c\u0438\u043d",
headerClass:"col-xs-1 col-md-1 nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-text-align-right",fieldName:"profileInterval",type:"string"},{header:"A+, \u043a\u0412\u0442/\u0447",headerClass:"col-xs-1 col-md-1 nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-text-align-right",fieldName:"p_Ap",graph:!0},{header:"A-, \u043a\u0412\u0442/\u0447",headerClass:"col-xs-1 col-md-1 nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-text-align-right",fieldName:"p_An",graph:!0},{header:"R+, \u043a\u0412\u0410\u0440/\u0447",
headerClass:"col-xs-1 col-md-1 nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-text-align-right",fieldName:"q_Rp",graph:!0},{header:"R-, \u043a\u0412\u0410\u0440/\u0447",headerClass:"col-xs-1 col-md-1 nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-text-align-right",fieldName:"q_Rn",graph:!0}]}]);app=angular.module("portalNMC");
app.controller("ElectricityPkeCtrl",["$scope","$http","indicatorSvc","mainSvc","$location","$cookies","$rootScope","$filter","notificationFactory","$window","$timeout","objectSvc",function(a,b,d,h,g,k,f,n,l,m,e,c){a.electroKind="Pke";a.pkeTypes=[];a.pkeData=[];a.states={};a.states.isSelectedAllPkeTypes=!0;a.states.isSelectedAllPkeTypesInWindow=!0;a.defaultFilterCaption="\u0412\u0441\u0435";a.selectedPkeTypes_list={caption:a.defaultFilterCaption};a.ctrlSettings={};a.ctrlSettings.loading=!0;a.ctrlSettings.systemDateFormat=
"YYYY-MM-DD";a.columns=[{header:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",headerClass:"col-xs-3 col-md-3 nmc-text-align-center",dataClass:"col-xs-3 col-md-3 nmc-text-align-right",fieldName:"warnStartDateStr",type:"string",date:!0},{header:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",headerClass:"col-xs-3 col-md-3 nmc-text-align-center",dataClass:"col-xs-3 col-md-3 nmc-text-align-right",fieldName:"warnEndDateStr",type:"string",date:!0},{header:"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0440\u0435\u0434\u0435\u043b\u0430",
headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"warnValue"},{header:"\u0415\u0434. \u0438\u0437\u043c.",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-left",fieldName:"pkeMeasureUnit"},{header:"\u0422\u0438\u043f",headerClass:"col-xs-4 col-md-4 nmc-text-align-center",dataClass:"col-xs-4 col-md-4 nmc-text-align-right",
fieldName:"pkeTypeCaption"}];a.ctrlSettings.orderBy={field:a.columns[0].fieldName,asc:!0};a.setOrderBy=function(b){a.ctrlSettings.orderBy={field:b,asc:a.ctrlSettings.orderBy.field===b?!a.ctrlSettings.orderBy.asc:!0}};a.indicatorPkeDates={startDate:moment().subtract(6,"days").startOf("day"),endDate:moment().endOf("day")};a.dateRangeOptsPkeRu=h.getDateRangeOptions("indicator-ru",{});a.dateRangeOptsPkeRu.startDate=moment().subtract(6,"days").startOf("day");a.dateRangeOptsPkeRu.endDate=moment().endOf("day");
a.dateRangeOptsPkeRu.dateLimit={months:1};var q="../api/subscr/deviceObjects/pke/byContZPoint/"+a.contZPoint+"/warn",t=function(a){a=h.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)},u=function(c){a.ctrlSettings.loading=!0;var p=q,d={},p=p+("/?beginDate="+moment(a.indicatorPkeDates.startDate).format(a.ctrlSettings.systemDateFormat)+"&endDate="+moment(a.indicatorPkeDates.endDate).format(a.ctrlSettings.systemDateFormat));!h.checkUndefinedNull(c)&&angular.isArray(c)&&(d={pkeTypeKeynames:c.map(function(a){return a.keyname})});
b({method:"GET",url:p,params:d}).then(function(b){a.pkeData=angular.copy(b.data);a.pkeData.forEach(function(b){a.pkeTypes.some(function(c){if(b.deviceObjectPkeTypeKeyname==c.keyname)return b.pkeTypeCaption=c.caption,a.measureUnits.all.some(function(a){if(a.keyname===c.pkeMeasureUnit)return b.pkeMeasureUnit=a.caption,!0}),!0})});a.ctrlSettings.loading=!1;e(function(){a.setScoreStyles()},10)},t)};(function(){b.get("../api/subscr/deviceObjects/pke/types").then(function(b){a.pkeTypes=angular.copy(b.data);
a.pkeTypesInWindow=angular.copy(b.data);u()},t)})();var v=function(){var b=document.getElementsByClassName("btn-group open");h.checkUndefinedNull(b)||0==b.length||b[0].classList.remove("open");a.states.isSelectElement=!1};a.getDataWithSelectedTypes=function(){v();angular.isArray(a.pkeTypesInWindow)||u();a.pkeTypes=angular.copy(a.pkeTypesInWindow);a.states.isSelectedAllPkeTypes=angular.copy(a.states.isSelectedAllPkeTypesInWindow);var b=[];a.pkeTypes.forEach(function(a){1==a.selected&&b.push(a)});a.selectedPkeTypes_list.caption=
0==b.length?a.defaultFilterCaption:b.length;u(b)};a.selectPkeTypesClick=function(){a.states.isSelectElement=!1;a.pkeTypesInWindow=angular.copy(a.pkeTypes);a.states.isSelectedAllPkeTypesInWindow=angular.copy(a.states.isSelectedAllPkeTypes)};a.selectAllTypes=function(){n("filter")(a.pkeTypes,a.pkeTypesFilter).forEach(function(b){b.selected=a.isSelectedAllTypes});a.getDataWithSelectedTypes()};a.selectAllElements=function(b){a.states.isSelectElement=!0;b.forEach(function(a){a.selected=!1})};a.selectElement=
function(b){a.states.isSelectElement=!0;return a.states[b]=!1};a.isFilterApplyDisabled=function(a,b){return!angular.isArray(a)||h.checkUndefinedNull(b)||1==b?!1:!a.some(function(a){if(1==a.selected)return!0})};a.clearPkeTypeFilter=function(){a.pkeTypesFilter="";a.isSelectedAllTypes=!1;a.pkeTypesInWindow.forEach(function(a){a.selected=!1});a.states.isSelectedAllPkeTypesInWindow=!0;a.getDataWithSelectedTypes()};a.$watch("indicatorPkeDates",function(b,c){a.getDataWithSelectedTypes()});a.setScoreStyles=
function(){var a=document.getElementById("pkeTableHeader"),b=document.getElementById("divPkeTable");if(!h.checkUndefinedNull(b)&&!h.checkUndefinedNull(a)){if(0==a.offsetWidth)return"Pke. tableHeader.offsetWidth == 0";b.style.width=b.offsetWidth>b.clientWidth?a.offsetWidth+17+"px":a.offsetWidth+"px"}};var x=angular.element(m),w=function(){angular.isDefined(a.setScoreStyles)&&a.setScoreStyles();a.$apply()};x.bind("resize",w);a.$on("$destroy",function(){x.unbind("resize",w)});a.onTableLoad=function(){a.setScoreStyles()};
e(function(){a.setScoreStyles()},500);a.initCtrl=function(){a.pkeTypesInWindow=angular.copy(a.pkeTypes);a.measureUnits=c.getDeviceMetadataMeasures()};a.initCtrl()}]);app=angular.module("portalNMC");
app.controller("ElectricitySpecCtrl",["$scope","$http","indicatorSvc","mainSvc","$location","$cookies","$rootScope",function(a,b,d,h,g,k,f){a.electroKind="Spec";a.dataUrl="../api/subscr/"+a.contObject+"/serviceElTech/abs/"+a.contZPoint;a.columns=[{header:"\u0414\u0430\u0442\u0430",headerClass:"col-xs-2 col-md-2 nmc-text-align-center",dataClass:"col-xs-2 col-md-2 nmc-text-align-right",fieldName:"dataDateString",type:"string",date:!0},{header:"Ua, V",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",
fieldName:"u1"},{header:"Ub, V",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"u2"},{header:"Uc, V",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"u3"},{header:"Ia, A",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",
fieldName:"i1"},{header:"Ib, A",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"i2"},{header:"Ic, A",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"i3"},{header:"cos \u03c6a",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",
fieldName:"k1"},{header:"cos \u03c6b",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"k2"},{header:"cos \u03c6c",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"k3"},{header:"f, Hz",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",
fieldName:"frequency"},{header:"T, \u2103",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"deviceTemp"}]}]);app=angular.module("portalNMC");
app.controller("ElectricityCtrl",["$scope","mainSvc","indicatorSvc","$location","$cookies","$rootScope","$timeout",function(a,b,d,h,g,k,f){k.ctxId="indicators_page";a.oldMinWidth=null;a.curMinWidth="1920px";a.isSystemuser=function(){return b.isSystemuser()};(function(){var f=h.search();angular.isUndefined(null);angular.isDefined(f.zpointId)&&"null"!==f.zpointId&&d.setZpointId(f.zpointId);angular.isUndefined(null);angular.isDefined(f.objectId)&&"null"!==f.objectId&&d.setContObjectId(f.objectId);angular.isUndefined(null);
angular.isDefined(f.zpointName)&&"null"!==f.zpointName&&d.setZpointName(f.zpointName);angular.isUndefined(null);angular.isDefined(f.objectName)&&"null"!==f.objectName&&d.setContObjectName(f.objectName);angular.isUndefined(null);angular.isDefined(f.deviceModel)&&"null"!==f.deviceModel&&d.setDeviceModel(f.deviceModel);angular.isUndefined(null);angular.isDefined(f.deviceSN)&&"null"!==f.deviceSN&&d.setDeviceSN(f.deviceSN);angular.isUndefined(null);angular.isDefined(f.timeDetailType)&&"null"!==f.timeDetailType?
a.timeDetailType=f.timeDetailType:angular.isDefined(g.timeDetailType)&&"undefined"!=g.timeDetailType&&"null"!=g.timeDetailType?a.timeDetailType=g.timeDetailType:a.timeDetailType=d.getTimeDetailType();a.contZPoint=d.getZpointId();a.contZPointName="undefined"!=d.getZpointName()?d.getZpointName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";a.contObject=d.getContObjectId();a.contObjectName="undefined"!=d.getContObjectName()?d.getContObjectName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";
a.deviceModel=d.getDeviceModel();a.deviceSN=d.getDeviceSN();angular.isDefined(f.fromDate)&&"null"!==f.fromDate?k.reportStart=f.fromDate:angular.isDefined(g.fromDate)&&"null"!==g.fromDate?k.reportStart=g.fromDate:k.reportStart=d.getFromDate();angular.isDefined(f.toDate)&&"null"!==f.toDate?k.reportEnd=f.toDate:angular.isDefined(g.toDate)&&"null"!==g.toDate?k.reportEnd=g.toDate:k.reportEnd=d.getToDate();a.dateRangeOptsRu=b.getDateRangeOptions("indicator-ru")})();$(document).ready(function(){a.oldMinWidth=
$(".wrap > .container-fluid >.row").css("min-width");$(".wrap > .container-fluid >.row").css("min-width",a.curMinWidth)});a.$on("$destroy",function(){$(".wrap > .container-fluid >.row").css("min-width",a.oldMinWidth)});a.initCons=function(){$(".wrap > .container-fluid >.row").css("min-width",a.curMinWidth)};a.initProfile=function(){$(".wrap > .container-fluid >.row").css("min-width",a.oldMinWidth)};a.initTech=function(){$(".wrap > .container-fluid >.row").css("min-width",a.oldMinWidth)};$("#consumptionTab").on("shown.bs.tab",
function(){var a=document.getElementById("indicatorConsTableHeader"),d=document.getElementById("divIndicatorConsTable");b.checkUndefinedNull(d)||(d.style.width=d.offsetWidth>d.clientWidth?a.offsetWidth+17+"px":a.offsetWidth+"px")})}]);angular.module("portalNMC").controller("IndicatorsCtrl",["$scope","$rootScope","$cookies","$window","$http","$location","crudGridDataFactory","FileUploader","notificationFactory","indicatorSvc","mainSvc",function(a,b,d,h,g,k,f,n,l,m,e){function c(b){if(e.checkUndefinedNull("../api/subscr/vcookie")||e.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES"))return console.log("Request required params is null!"),a.$broadcast("indicators:loadedModePrefs"),!1;g.get("../api/subscr/vcookie?vcMode=OBJECT_INDICATOR_PREFERENCES").then(function(c){var p;
if(e.checkUndefinedNull(c)||e.checkUndefinedNull(c.data)||!angular.isArray(c.data)||0===c.data.length)return console.log("Indicators: incorrect mode preferences!"),a.$broadcast("indicators:loadedModePrefs"),!1;angular.copy(c.data).forEach(function(b){if(null===b.vcValue)return!1;p=JSON.parse(b.vcValue);b.caption=p.caption;b.vv=p;a.indicatorModes.push(b)});a.currentIndicatorMode=null;e.checkUndefinedNull(b)||a.indicatorModes.some(function(c){if(c.vcKey===b)return a.currentIndicatorMode=c,!0});if(e.checkUndefinedNull(a.currentIndicatorMode))return console.log("Current indicator mode is undefined or null!"),
a.$broadcast("indicators:loadedModePrefs"),!1;a.ctrlSettings.loadedWaterColumnsPref=a.currentIndicatorMode.vv.waterColumns;a.timeDetailType=a.currentIndicatorMode.vv.indicatorHwKind;a.indicatorsPerPage=a.currentIndicatorMode.vv.indicatorHwPerPage;a.$broadcast("indicators:loadedModePrefs")},u)}function q(b){if(e.checkUndefinedNull("../api/subscr/vcookie/user")||e.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||e.checkUndefinedNull(b))return console.log("Request required params is null!"),a.$broadcast("indicators:loadedModePrefs"),
!1;g.get("../api/subscr/vcookie/user?vcMode=OBJECT_INDICATOR_PREFERENCES&vcKey=OIP_"+b).then(function(a){var b;e.checkUndefinedNull(a)||e.checkUndefinedNull(a.data)||0===a.data.length||(b=JSON.parse(a.data[0].vcValue));c(b)},u)}function t(b){var c;for(c=2;c<a.indicatorColumns.length;c+=1)a.indicatorColumns[c].isvisible="false";a.intotalColumns.forEach(function(a){a.isvisible="false"});for(c=2;c<a.indicatorColumns.length;c+=1)b.forEach(function(b){b.fieldName===a.indicatorColumns[c].fieldName&&!0===
b.isVisible&&(a.indicatorColumns[c].isvisible="isvisible")});for(c=0;c<a.intotalColumns.length;c+=1)b.forEach(function(b){b.fieldName===a.intotalColumns[c].fieldName&&!0===b.isVisible&&(a.intotalColumns[c].isvisible="isvisible")});if(e.checkUndefinedNull(b)||0===b.length){for(c=2;c<a.indicatorColumns.length;c+=1)a.indicatorColumns[c].isvisible="isvisible";for(c=0;c<a.intotalColumns.length;c+=1)a.intotalColumns[c].isvisible="isvisible"}else{for(c=2;c<a.indicatorColumns.length;c+=1)b.forEach(function(b){b.fieldName===
a.indicatorColumns[c].fieldName&&!0===b.isVisible&&(a.indicatorColumns[c].isvisible="isvisible")});for(c=0;c<a.intotalColumns.length;c+=1)b.forEach(function(b){b.fieldName===a.intotalColumns[c].fieldName&&!0===b.isVisible&&(a.intotalColumns[c].isvisible="isvisible")})}}b.ctxId="indicators_page";a.date={};angular.isDefined(k.search().fromDate)&&null!=k.search().fromDate?a.indicatorDates={startDate:k.search().fromDate,endDate:k.search().toDate}:angular.isDefined(d.fromDate)&&null!=d.toDate?a.indicatorDates=
{startDate:d.fromDate,endDate:d.toDate}:a.indicatorDates={startDate:m.getFromDate(),endDate:m.getToDate()};a.date.deleteIndicatorDates={startDate:angular.copy(a.indicatorDates.startDate),endDate:angular.copy(a.indicatorDates.endDate)};b.startDateToDel=moment(a.date.deleteIndicatorDates.startDate).format("YYYY-MM-DD");b.endDateToDel=moment(a.date.deleteIndicatorDates.endDate).format("YYYY-MM-DD");a.$watch("date.deleteIndicatorDates",function(a,c,e){"/objects/indicators"===k.path()&&a!==c&&(b.startDateToDel=
moment(a.startDate).format("YYYY-MM-DD"),b.endDateToDel=moment(a.endDate).format("YYYY-MM-DD"))},!1);a.ctrlSettings={};a.ctrlSettings.ctxId="zpoint_indicator_page";a.ctrlSettings.loadedWaterColumnsPref=[];a.ctrlSettings.orderBy={};if(angular.isDefined(d.indicatorsortorder)&&null!=d.indicatorsortorder)switch(d.indicatorsortorder){case "asc":a.ctrlSettings.orderBy={field:"dataDate",asc:!0,desc:!1,order:"asc"};break;case "desc":a.ctrlSettings.orderBy={field:"dataDate",asc:!1,desc:!0,order:"desc"}}else a.ctrlSettings.orderBy=
{field:"dataDate",asc:!1,desc:!0,order:"desc"};a.intotalColumns=m.getIntotalColumns();a.indicatorColumns=m.getWaterColumns();a.tableDef={tableClass:"crud-grid table table-lighter table-bordered table-condensed table-hover",hideHeader:!1,headerClassTR:"nmc-main-table-header-indicator",columns:a.indicatorColumns};a.summary={};a.totalIndicators=0;a.indicatorsPerPage=100;a.indicatorsPerPageList=[15,25,50,75,100];a.timeDetailType="24h";a.data=[];a.pagination={current:1};a.indicatorModes=[];a.showLinkToFileFlag=
!1;a.isManualLoading="true"===d.isManualLoading?!0:!1;var u=function(b){a.ctrlSettings.loading=!1;console.log(b);var c="-1";if(e.checkUndefinedNull(b)||e.checkUndefinedNull(b.data))c="ERR_CONNECTION";e.checkUndefinedNull(b)||e.checkUndefinedNull(b.resultCode)&&(e.checkUndefinedNull(b.data)||e.checkUndefinedNull(b.data.resultCode))||(c=b.resultCode||b.data.resultCode);b=e.getServerErrorByResultCode(c);l.errorInfo(b.caption,b.description)};a.initFileUploader=function(){a.uploader=new n({url:"../api/subscr/contObjects/"+
(a.contObject||d.contObject)+"/contZPoints/"+(a.contZPoint||d.contZPoint)+"/service/"+(a.timeDetailType||d.timeDetailType)+"/csv"});a.uploader.onErrorItem=function(b,c,e,d){console.info("onErrorItem",e,c);u(c);a.successOnUpload=!1;a.errorOnUpload=!0;a.uploadFlag=!1};a.uploader.onSuccessItem=function(a,b,c,e){};a.uploader.onCompleteAll=function(){a.getData(1);a.successOnUpload=!0;a.errorOnUpload=!1};window.setTimeout(function(){$("#upLoadFileModal").on("shown.bs.modal",function(){});$("#upLoadFileModal").on("hidden.bs.modal",
function(){a.uploader=null;a.uploadFlag=!1;a.successOnUpload=!1;a.errorOnUpload=!1;a.$apply()})},10)};a.isSystemuser=function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};(function(){var c=k.search();angular.isUndefined(null);angular.isDefined(c.zpointId)&&"null"!==c.zpointId&&m.setZpointId(c.zpointId);angular.isUndefined(null);angular.isDefined(c.objectId)&&"null"!==c.objectId&&m.setContObjectId(c.objectId);angular.isUndefined(null);angular.isDefined(c.zpointName)&&
"null"!==c.zpointName&&m.setZpointName(c.zpointName);angular.isUndefined(null);angular.isDefined(c.objectName)&&"null"!==c.objectName&&m.setContObjectName(c.objectName);angular.isUndefined(null);angular.isDefined(c.deviceModel)&&"null"!==c.deviceModel&&m.setDeviceModel(c.deviceModel);angular.isUndefined(null);angular.isDefined(c.deviceSN)&&"null"!==c.deviceSN&&m.setDeviceSN(c.deviceSN);angular.isUndefined(null);angular.isDefined(c.timeDetailType)&&"null"!==c.timeDetailType?a.timeDetailType=c.timeDetailType:
angular.isDefined(d.timeDetailType)&&"undefined"!=d.timeDetailType&&"null"!=d.timeDetailType?a.timeDetailType=d.timeDetailType:a.timeDetailType=m.getTimeDetailType();a.contZPoint=m.getZpointId();a.contZPointName="undefined"!=m.getZpointName()?m.getZpointName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";a.contObject=m.getContObjectId();a.contObjectName="undefined"!=m.getContObjectName()?m.getContObjectName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";
a.deviceModel=m.getDeviceModel();a.deviceSN=m.getDeviceSN();angular.isDefined(c.isManualLoading)&&"null"!==c.isManualLoading&&(a.isManualLoading="true"===c.isManualLoading?!0:!1);angular.isDefined(c.fromDate)&&"null"!==c.fromDate?b.reportStart=c.fromDate:angular.isDefined(d.fromDate)&&"null"!==d.fromDate?b.reportStart=d.fromDate:b.reportStart=m.getFromDate();angular.isDefined(c.toDate)&&"null"!==c.toDate?b.reportEnd=c.toDate:angular.isDefined(d.toDate)&&"null"!==d.toDate?b.reportEnd=d.toDate:b.reportEnd=
m.getToDate();a.dateRangeOptsRu=e.getDateRangeOptions("indicator-ru");a.date.forDeleteDateRangeOptsRu=e.getDateRangeOptions("indicator-ru");e.checkUndefinedNull(a.contObject)||q(a.contObject)})();a.columns=[];a.getData=function(c){a.ctrlSettings.loading=!0;a.pagination.current=c;a.zpointTable="../api/subscr/"+a.contObject+"/service/"+(a.timeDetailType||d.timeDetailType)+"/"+a.contZPoint+"/paged?beginDate="+b.reportStart+"&endDate="+b.reportEnd+"&page="+(c-1)+"&size="+a.indicatorsPerPage+"&dataDateSort="+
a.ctrlSettings.orderBy.order;c=a.zpointTable;g.get(c).success(function(b){a.totalIndicators=b.totalElements;a.columns=a.tableDef.columns;!0===e.getUseColorHighlightIndicatorData()&&m.setColorHighlightsForManualAndCrc(b.objects);b.objects.map(function(b,c){for(var e in a.columns)"dataDate"===a.columns[e].fieldName?b.dataDate=b.dataDateString:(null!=b[a.columns[e].fieldName]&&"dataDateString"!==a.columns[e].fieldName&&(b[a.columns[e].fieldName]=b[a.columns[e].fieldName].toFixed(3)),null===b[a.columns[e].fieldName]&&
"m_delta"===a.columns[e].fieldName&&null!==b.m_out&&null!==b.m_in&&(b[a.columns[e].fieldName]=(b.m_in-b.m_out).toFixed(3)),null===b[a.columns[e].fieldName]&&"v_delta"===a.columns[e].fieldName&&null!==b.v_out&&null!==b.v_in&&(b[a.columns[e].fieldName]=(b.v_in-b.v_out).toFixed(3)),null===b[a.columns[e].fieldName]&&"p_delta"===a.columns[e].fieldName&&null!==b.p_out&&null!==b.p_in&&(b[a.columns[e].fieldName]=(b.p_in-b.p_out).toFixed(3)))});a.data=b.objects;a.ctrlSettings.loading=!1}).error(u);a.setScoreStyles=
function(){var b=document.getElementById("indicatorTableHeader"),c=document.getElementById("divIndicatorTable");if(!e.checkUndefinedNull(c)&&!e.checkUndefinedNull(b)){if(0==b.offsetWidth)return"Indicators. tableHeader.offsetWidth == 0";c.style.width=c.offsetWidth>c.clientWidth?b.offsetWidth+17+"px":b.offsetWidth+"px"}a.tableDef.columns.some(function(a){var b=document.getElementById("indicators_th_"+a.fieldName),c=document.getElementById("indicators_head_"+a.fieldName);a=document.getElementById("indicators_tdh_"+
a.fieldName);angular.isDefined(b)&&null!=b&&angular.isDefined(c)&&null!=c&&(b=Math.max(b.offsetWidth,b.clientWidth),c.style.width=b+"px",a.style.width=b+"px")});b=document.getElementById("indicators_th_dataDate");c=document.getElementById("indicators_th_workTime");document.getElementById("totals_th_head");angular.isDefined(b)&&null!=b&&angular.isDefined(c)&&null!=c&&(a.totals_th_head_style=b.offsetWidth+c.offsetWidth+4);a.intotalColumns.some(function(a){var b=document.getElementById("indicators_th_"+
a.fieldName);document.getElementById("indicators_head_"+a.fieldName);angular.isDefined(b)&&null!=b&&(a.ngstyle=b.offsetWidth)})};a.onTableLoad=function(){a.setScoreStyles()};var p=function(b){a.intotalColumns.forEach(function(a){a=a.fieldName;b.hasOwnProperty(a)&&!isNaN(b[a])&&null!=b[a]?b[a]=b[a].toFixed(3):b[a]="m_delta"==a&&"-"!=b.m_out&&"-"!=b.m_in?(b.m_in-b.m_out).toFixed(3):"v_delta"==a&&"-"!=b.v_out&&"-"!=b.v_in?(b.v_in-b.v_out).toFixed(3):"p_delta"==a&&"-"!=b.p_out&&"-"!=b.p_in?(b.p_in-b.p_out).toFixed(3):
"-"})};c=c.replace("paged","summary");f(c).get(function(b){a.setScoreStyles();a.intotalColumns.forEach(function(a,b,c){a.imgpath="images/plug.png";a.imgclass="";a.title=""});a.summary=angular.copy(b);a.summary.hasOwnProperty("diffs")&&p(a.summary.diffs);a.summary.hasOwnProperty("totals")&&p(a.summary.totals);a.summary.hasOwnProperty("average")&&p(a.summary.average);a.summary.hasOwnProperty("diffs")&&a.summary.hasOwnProperty("totals")&&a.intotalColumns.forEach(function(b,c,e){c=b.fieldName;if(!angular.isUndefined(a.summary.firstData)&&
!angular.isUndefined(a.summary.lastData)&&null!==a.summary.firstData&&null!==a.summary.lastData&&a.summary.firstData.hasOwnProperty(c)&&a.summary.lastData.hasOwnProperty(c)){e="\u041d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 = "+a.summary.firstData[c]+" ";var p="";10==a.summary.firstData.dataDateString.length&&(p=" 00:00");e+="(\u0414\u0430\u0442\u0430 = "+a.summary.firstData.dataDateString+p+");<br><br>";e+="\u041a\u043e\u043d\u0435\u0447\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 = "+
a.summary.lastData[c]+" ";p="";10==a.summary.lastData.dataDateString.length&&(p=" 00:00");e+="(\u0414\u0430\u0442\u0430 = "+a.summary.lastData.dataDateString+p+");";p="#total"+c;$("#diffBtn"+c).qtip({suppress:!1,content:{text:e,title:"\u0414\u0435\u0442\u0430\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f",button:!0},show:{event:"click"},style:{classes:"qtip-nmc-indicator-tooltip",width:1E3},hide:{event:"unfocus"},position:{my:"top right",at:"bottom right",
target:$(p)}});a.summary.diffs.hasOwnProperty(c)&&!isNaN(a.summary.diffs[c])&&null!=a.summary.diffs[c]&&(a.summary.diffs[c]=Number(a.summary.diffs[c]).toFixed(3));a.summary.totals.hasOwnProperty(c)&&!isNaN(a.summary.totals[c])&&null!=a.summary.totals[c]&&(a.summary.totals[c]=Number(a.summary.totals[c]).toFixed(3));a.summary.diffs.hasOwnProperty(c)&&a.summary.totals.hasOwnProperty(c)&&(e=a.summary.diffs[c],p=a.summary.totals[c],null!=e&&null!=p&&"-"!=e&&"-"!=p&&(e.toString().split("."),p.toString().split("."),
e=Number("0.001"),c=Math.abs(a.summary.diffs[c]-a.summary.totals[c]).toFixed(3),c>e&&1>=c?(b.imgpath="images/divergenceIndicatorAlert.png",b.imgclass="nmc-img-divergence-indicator",b.title="\u0418\u0442\u043e\u0433\u043e \u0438 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0440\u0430\u0441\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u041d\u0415 \u0431\u043e\u043b\u0435\u0435 \u0447\u0435\u043c \u043d\u0430 1"):1<c?
(b.imgpath="images/divergenceIndicatorCrit.png",b.imgclass="nmc-img-divergence-indicator",b.title="\u0418\u0442\u043e\u0433\u043e \u0438 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0440\u0430\u0441\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0411\u041e\u041b\u0415\u0415 \u0447\u0435\u043c \u043d\u0430 1"):(b.imgpath="images/plug.png",b.imgclass="",b.title="")))}})})};a.$on("indicators:loadedModePrefs",function(){t(a.ctrlSettings.loadedWaterColumnsPref);
a.getData(1)});a.pageChanged=function(b){a.getData(b)};a.changeTimeDetailType=function(){d.timeDetailType=a.timeDetailType;a.getData(1)};a.$watch("indicatorDates",function(c,e,t){"/objects/indicators"===k.path()&&c!==e&&(d.fromDate=moment(c.startDate).format("YYYY-MM-DD"),d.toDate=moment(c.endDate).format("YYYY-MM-DD"),m.setFromDate(moment(c.startDate).format("YYYY-MM-DD")),m.setToDate(moment(c.endDate).format("YYYY-MM-DD")),b.reportStart=moment(c.startDate).format("YYYY-MM-DD"),b.reportEnd=moment(c.endDate).format("YYYY-MM-DD"),
a.getData(1),a.date.deleteIndicatorDates={startDate:moment(c.startDate),endDate:moment(c.endDate)},b.startDateToDel=moment(c.startDate).format("YYYY-MM-DD"),b.endDateToDel=moment(c.endDate).format("YYYY-MM-DD"))},!1);var v=angular.element(h),x=function(){angular.isDefined(a.setScoreStyles)&&a.setScoreStyles();a.$apply()};v.bind("resize",x);a.$on("$destroy",function(){v.unbind("resize",x)});a.saveIndicatorsToFile=function(c){window.open("../api/subscr/"+(a.contObject||d.contObject)+"/service/"+(a.timeDetailType||
d.timeDetailType)+"/"+(a.contZPoint||d.contZPoint)+"/csv"+c+"?beginDate="+b.reportStart+"&endDate="+b.reportEnd)};a.uploadFile=function(){a.uploadFlag=!0;a.uploader.queue[a.uploader.queue.length-1].upload()};a.deleteData=function(){g["delete"]("../api/subscr/contObjects/"+(a.contObject||d.contObject)+"/contZPoints/"+(a.contZPoint||d.contZpoint)+"/service/"+(a.timeDetailType||d.timeDetailType)+"/csv?beginDate="+b.startDateToDel+"&endDate="+b.endDateToDel).success(function(b){l.success();a.linkToFileWithDeleteData=
"../api/subscr/service/out/csv/"+b.filename;a.fileWithDeleteData=b.filename;a.showLinkToFileFlag=!0;a.getData(1)}).error(u)};a.setOrderBy=function(b){var c=a.ctrlSettings.orderBy.field===b?!a.ctrlSettings.orderBy.asc:!0;d.indicatorsortorder=1==c?"asc":"desc";a.ctrlSettings.orderBy={field:b,asc:c,order:d.indicatorsortorder};a.getData(1)};a.isHaveData=function(){return angular.isUndefined(a.data)||0==a.data.length?!1:!0};a.isTDTabs=function(a){return"1h_abs"==a};a.changeIndicatorMode=function(){a.ctrlSettings.loadedWaterColumnsPref=
a.currentIndicatorMode.vv.waterColumns;a.timeDetailType=a.currentIndicatorMode.vv.indicatorHwKind;a.indicatorsPerPage=a.currentIndicatorMode.vv.indicatorHwPerPage;a.$broadcast("indicators:loadedModePrefs")};var w=function(a){e.getContextIds().forEach(function(b){b.permissionTagId.localeCompare(a);var c=document.getElementById(b.permissionTagId);angular.isUndefined(c)||null==c||$("#"+b.permissionTagId).removeClass("nmc-hide")})};w(a.ctrlSettings.ctxId);b.$on("servicePermissions:loaded",function(){w(a.ctrlSettings.ctxId)});
window.setTimeout(function(){w(a.ctrlSettings.ctxId)},500)}]);app=angular.module("portalNMC");
app.controller("LogSmsCtrl",["$scope","$cookies","$timeout","mainSvc","objectSvc","$http","notificationFactory",function(a,b,d,h,g,k,f){function n(b){a.ctrlSettings.loading=!1;b=h.errorCallbackHandler(b);f.errorInfo(b.caption,b.description)}function l(b){var c;b.forEach(function(b){b.smsDateStr=moment(b.smsDate).format(a.ctrlSettings.userDateFormat);for(c=0;c<a.ctrlSettings.logColumns.length;c+=1)b[a.ctrlSettings.logColumns[c].name+"view"]=20<=b[a.ctrlSettings.logColumns[c].name].toString().length?b[a.ctrlSettings.logColumns[c].name].toString().substr(0,
20)+"...":b[a.ctrlSettings.logColumns[c].name].toString()})}function m(){a.ctrlSettings.loading=!0;var b=a.ctrlSettings.smsLogUrl,c;h.checkUndefinedNull(a.ctrlSettings.smsLogDaterange.startDate)||(c=moment(a.ctrlSettings.smsLogDaterange.startDate).format(a.ctrlSettings.systemDateFormat),b+="?fromDate="+c);h.checkUndefinedNull(a.ctrlSettings.smsLogDaterange.endDate)||(c=moment(a.ctrlSettings.smsLogDaterange.endDate).format(a.ctrlSettings.systemDateFormat),b+="&toDate="+c);k.get(b).then(function(b){b=
angular.copy(b.data);l(b);a.data.log=b;a.ctrlSettings.loading=!1},n)}a.messages={};a.ctrlSettings={};a.ctrlSettings.smsLogUrl="../api/subscr/smsLog";a.ctrlSettings.groupUrl="../api/subscr/contGroup";a.ctrlSettings.showObjectsFlag=!0;a.ctrlSettings.smsLogDaterange={startDate:moment().startOf("day"),endDate:moment().endOf("day")};a.ctrlSettings.systemDateFormat="YYYY-MM-DD";a.ctrlSettings.userDateFormat="DD-MM-YYYY HH:mm:ss";a.ctrlSettings.daterangeOpts=h.getDateRangeOptions("ru");a.ctrlSettings.daterangeOpts.startDate=
moment().startOf("day");a.ctrlSettings.daterangeOpts.endDate=moment().endOf("day");a.ctrlSettings.daterangeOpts.dateLimit={months:1};a.ctrlSettings.logColumns=[{name:"smsDateStr",caption:"\u0414\u0430\u0442\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding",type:"datetime"},{name:"smsRecieverName",caption:"\u041a\u043e\u043c\u0443",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding"},
{name:"smsRecieverTel",caption:"\u041d\u043e\u043c\u0435\u0440",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding"},{name:"smsMessage",caption:"\u0422\u0435\u043a\u0441\u0442",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding",type:"textarea"},{name:"smsProviderUrl",caption:"\u041f\u043e\u043b\u043d\u044b\u0439 url \u0430\u0434\u0440\u0435\u0441 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438",headerClass:"col-xs-1 col-md-1 paddingLeftRight5I",dataClass:"col-xs-1 col-md-1 noPadding",
isTableView:!1,type:"textarea"},{name:"smsProviderResponseCode",caption:"\u041a\u043e\u0434 \u043e\u0442\u0432\u0435\u0442\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 text-center noPadding"},{name:"smsProviderResponseBody",caption:"\u0422\u0435\u043a\u0441\u0442 \u043e\u0442\u0432\u0435\u0442\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding",type:"textarea",viewInNewWindow:!0},
{name:"smsStatus",caption:"\u0421\u0442\u0430\u0442\u0443\u0441",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding"}];b=[];for(d=0;d<a.ctrlSettings.logColumns.length;d+=1)if(g=angular.copy(a.ctrlSettings.logColumns[d]),h.checkUndefinedNull(g.isTableView)||0!=g.isTableView)g.name+="view",b.push(g);a.ctrlSettings.logColumnsForTable=b;a.data={};a.data.log=[];a.data.logDaterange={startDate:moment().subtract(6,"days").startOf("day"),endDate:moment().endOf("day")};a.states={};a.states.isSelectedAllObjects=
!0;a.states.isSelectedAllObjectsInWindow=!0;a.messages.defaultFilterCaption="\u0412\u0441\u0435";a.selectedObjects_list={};a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.loadSmsLogData=function(){m()};a.viewDetail=function(b,c){if(!h.checkUndefinedNull(c.viewInNewWindow)&&1==c.viewInNewWindow){var e=window.open("about:blank","Server respond"),d=c.name.substr(0,c.name.indexOf("view"));e.document.write(b[d]);return!0}a.data.currentLog=angular.copy(b);$("#showLogModal").modal()};a.$watch("ctrlSettings.smsLogDaterange",
function(a,b){a.startDate==b.startDate&&a.endDate==b.endDate||m()});m()}]);app=angular.module("portalNMC");
app.controller("LogViewCtrl",["$scope","$cookies","$timeout","mainSvc","objectSvc","$http","notificationFactory","logSvc","$rootScope",function(a,b,d,h,g,k,f,n,l){var m;function e(){a.ctrlSettings.sessionsLoading=!0;a.data.sessionLog=[];a.data.currentSession={};var b={};h.checkUndefinedNull(a.ctrlSettings.sessionsLogDaterange.startDate)||(b.fromDate=moment(a.ctrlSettings.sessionsLogDaterange.startDate).format(x.systemDateFormat));h.checkUndefinedNull(a.ctrlSettings.sessionsLogDaterange.endDate)||(b.toDate=
moment(a.ctrlSettings.sessionsLogDaterange.endDate).format(x.systemDateFormat));!h.checkUndefinedNull(a.selectedObjects)&&angular.isArray(a.selectedObjects)&&0<a.selectedObjects.length&&(b.contObjectIds=a.selectedObjects);l.$broadcast("logSvc:requestSessionsLoading",{params:b})}function c(b){k.get(a.ctrlSettings.groupUrl+"/"+b.id+"/contObject").then(function(a){b.objects=a.data})}function q(){a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.selectedObjects=[];a.objects=angular.copy(a.objectsInWindow);
a.objects.map(function(b){b.selected&&a.selectedObjects.push(b.id)});0==a.selectedObjects.length?(a.selectedObjects_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllObjects=!0):(a.selectedObjects_list.caption=a.selectedObjects.length,a.states.isSelectedAllObjects=!1)}function t(){a.selectedObjects_list.caption="";a.selectedGroups=[];a.selectedObjects=[];a.groups=angular.copy(a.objectsInWindow);var b=a.joinObjectsFromSelectedGroups(a.groups);g.sortObjectsByFullName(b);a.deleteDoublesObjects(b);
a.addUniqueObjectsFromGroupsToSelectedObjects(b,a.selectedObjects);b=a.selectedObjects.map(function(a){return a.id});a.selectedObjects=b;a.groups.map(function(b){b.selected&&a.selectedGroups.push(b.id)});0==a.selectedGroups.length?(a.selectedObjects_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllObjects=!0):(a.selectedObjects_list.caption=a.selectedGroups.length,a.states.isSelectedAllObjects=!1)}function u(b){a.ctrlSettings.sessionsLoading=!1;a.ctrlSettings.logLoading=!1;console.log(b);
var c="-1";if(h.checkUndefinedNull(b)||h.checkUndefinedNull(b.data))c="ERR_CONNECTION";h.checkUndefinedNull(b)||h.checkUndefinedNull(b.resultCode)&&(h.checkUndefinedNull(b.data)||h.checkUndefinedNull(b.data.resultCode))||(c=b.resultCode||b.data.resultCode);b=h.getServerErrorByResultCode(c);f.errorInfo(b.caption,b.description)}function v(){var b;m=n.getSessions();a.ctrlSettings.sessionsLoading=!1;if(h.checkUndefinedNull(m)||0==m.length)return a.data.totalSessions=0,a.data.sessionsOnView=[],d(e,3E5),
"Session array is empty";a.data.totalSessions=m.length;h.checkUndefinedNull(a.ctrlSettings.pagination.current)&&(a.ctrlSettings.pagination.current=1);var c=null;h.checkUndefinedNull(a.data.currentSession)||(c=angular.copy(a.data.currentSession));var t=null;if(h.checkUndefinedNull(a.data.sessionsOnView)||0<a.data.sessionsOnView.length)t=angular.copy(a.data.sessionsOnView);a.data.sessionsOnView=m.slice((a.ctrlSettings.pagination.current-1)*a.ctrlSettings.itemPerPage,a.ctrlSettings.pagination.current*
a.ctrlSettings.itemPerPage);!h.checkUndefinedNull(t)&&0<t.length&&t.forEach(function(c){for(b=0;b<a.data.sessionsOnView.length;b+=1)c.id==a.data.sessionsOnView[b].id&&(a.data.sessionsOnView[b].isChildView=c.isChildView)});h.checkUndefinedNull(c)||a.data.sessionsOnView.some(function(b){if(b.id==c.id)return a.loadLogData(b),!0;if(h.checkUndefinedNull(b.childs)||0==b.childs.length)return!1;var e=!1;b.childs.some(function(b){if(b.id==c.id)return a.loadLogData(b),e=!0});return e})}a.messages={};a.ctrlSettings=
{};a.ctrlSettings.itemPerPage=20;a.ctrlSettings.pagination={current:1};a.ctrlSettings.sessionsUrl="../api/rma/logSessions";a.ctrlSettings.groupUrl="../api/subscr/contGroup";a.ctrlSettings.showObjectsFlag=!0;a.ctrlSettings.daterangeOpts=h.getDateRangeOptions("ru");a.ctrlSettings.daterangeOpts.startDate=moment().startOf("day");a.ctrlSettings.daterangeOpts.endDate=moment().endOf("day");a.ctrlSettings.daterangeOpts.dateLimit={months:1};a.ctrlSettings.sessionsLogDaterange=n.getSessionsLogDaterange();var x=
{systemDateFormat:"YYYY-MM-DD"};a.ctrlSettings.sessionColumns=[{name:"currentStatusColor",caption:"",type:"color",headerClass:"col-xs-1 nmc-td-for-button noPadding"},{name:"dataSource",caption:"\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a",headerClass:"col-xs-2 noPadding",type:"id"},{name:"deviceModel",caption:"\u041c\u043e\u0434\u0435\u043b\u044c",headerClass:"col-xs-1"},{name:"deviceNumber",caption:"\u041d\u043e\u043c\u0435\u0440 \u043f\u0440\u0438\u0431\u043e\u0440\u0430",headerClass:"col-xs-1"},
{name:"startDate",caption:"\u0412\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u0430",headerClass:"col-xs-1 noPadding"},{name:"author",caption:"\u0418\u043d\u0438\u0446\u0438\u0430\u0442\u043e\u0440",headerClass:"col-xs-1"},{name:"currentStatus",caption:"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441",headerClass:"col-xs-1"},{name:"statusMessage",caption:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",headerClass:"col-xs-4"}];a.ctrlSettings.logColumns=
[{name:"stepDateStr",caption:"\u0414\u0430\u0442\u0430-\u0432\u0440\u0435\u043c\u044f",headerClass:"col-xs-2",type:"id"},{name:"stepType",caption:"\u0422\u0438\u043f",headerClass:"col-xs-1"},{name:"stepMessage",caption:"\u0422\u0435\u043a\u0441\u0442",headerClass:"col-xs-7"},{name:"isIncremental",caption:"\u0421\u0447\u0435\u0442\u0447\u0438\u043a",headerClass:"col-xs-1",type:"checkbox"},{name:"sumRows",caption:"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435",headerClass:"col-xs-1"}];a.selectedObjects=
[];a.data={};m=void 0;m=[];a.data.sessionLog=[];a.data.currentSession={};a.states={};a.states.isSelectedAllObjects=!0;a.states.isSelectedAllObjectsInWindow=!0;a.messages.defaultFilterCaption="\u0412\u0441\u0435";a.selectedObjects_list={};a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.toggleChildSessionsView=function(a){a.isChildView=!a.isChildView};a.isSystemuser=function(){return h.isSystemuser()};a.clearObjectFilter=function(){a.objects.forEach(function(a){a.selected=!1});a.groups.forEach(function(a){a.selected=
!1});a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.selectedObjects=[];a.selectedGroups=[];a.states.isSelectedAllObjects=!0;e()};a.selectObjectsClick=function(){a.states.isSelectElement=!1;a.states.isSelectedAllObjectsInWindow=angular.copy(a.states.isSelectedAllObjects);a.objectsInWindow=1==a.ctrlSettings.showObjectsFlag?angular.copy(a.objects):angular.copy(a.groups)};var w=function(b){a.objects=b.data;g.sortObjectsByFullName(a.objects)};a.getObjects=function(){h.isRma()?g.rmaPromise.then(w):
g.promise.then(w)};a.getObjects();a.getGroups=function(){k.get(a.ctrlSettings.groupUrl).then(function(b){b=b.data;b.forEach(function(a){c(a)});h.sortItemsBy(b,"contGroupName");a.groups=b},function(a){console.log(a)})};a.getGroups();a.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};a.deleteDoublesObjects=function(a){for(var b=a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&a.splice(b,1)};a.addUniqueObjectsFromGroupsToSelectedObjects=
function(a,b){var c,e;for(c=0;c<a.length;c+=1){var d=!0;for(e=0;e<b.length;e+=1)if(a[c].fullName===b[e].fullName){d=!1;break}d&&b.push(a[c])}};a.selectObjects=function(){var b=document.getElementsByClassName("btn-group open");h.checkUndefinedNull(b)||0==b.length||b[0].classList.remove("open");a.states.isSelectElement=!1;1==a.ctrlSettings.showObjectsFlag?q():t();e()};a.pageChanged=function(b){a.ctrlSettings.pagination.current=b;a.data.sessionsOnView=m.slice((a.ctrlSettings.pagination.current-1)*a.ctrlSettings.itemPerPage,
a.ctrlSettings.pagination.current*a.ctrlSettings.itemPerPage)};a.isDisabledFilters=function(){return a.ctrlSettings.sessionsLoading||a.ctrlSettings.logLoading};a.$on("$destroy",function(){b.heightLogUpperPart=$("#log-upper-part > .rui-resizable-content").height();b.heightLogFooterPart=$("#log-footer-part > .rui-resizable-content").height();l.$broadcast("logSvc:cancelInterval")});$(document).ready(function(){$("#log-upper-part > .rui-resizable-handle").on("click",function(){document.cookie="heightLogUpperPart="+
$("#log-upper-part > .rui-resizable-content").height()});$("#log-footer-part > .rui-resizable-handle").on("click",function(){document.cookie="heightLogFooterPart="+$("#log-footer-part > .rui-resizable-content").height()});$("#object-toggle-view").bootstrapToggle();$("#object-toggle-view").change(function(){a.ctrlSettings.showObjectsFlag=!!$(this).prop("checked");a.$apply();a.selectObjectsClick();if(a.selectedObjects_list.caption==a.messages.defaultFilterCaption)return"Object / group filter. No changes";
a.clearObjectFilter()})});a.selectAllElements=function(b){a.states.isSelectElement=!0;b.forEach(function(a){a.selected=!1})};a.selectElement=function(b){a.states.isSelectElement=!0;return a.states[b]=!1};a.isFilterApplyDisabled=function(a,b){return h.checkUndefinedNull(a)||!angular.isArray(a)||1==b?!1:!a.some(function(a){if(1==a.selected)return!0})};a.loadSessionsData=function(){e()};a.$on("logSvc:sessionsLoaded",function(){v()});a.loadLogData=function(b){a.data.currentSession.selected=!1;b.selected=
!0;a.ctrlSettings.logLoading=!0;a.data.currentSession=b;k.get(a.ctrlSettings.sessionsUrl+"/"+b.id+"/steps").then(function(b){a.data.sessionLog=b.data;a.ctrlSettings.logLoading=!1},u)};a.$watch("ctrlSettings.sessionsLogDaterange",function(a,b){b!=a&&e()});a.$watch("ctrlSettings.itemPerPage",function(b,c){b!=c&&a.pageChanged(1)});a.checkEmptyObject=function(a){return h.checkEmptyObject(a)};(function(){e();d(function(){$("#log-upper-part > .rui-resizable-content").height(Number(b.heightLogUpperPart));
$("#log-footer-part > .rui-resizable-content").height(Number(b.heightLogFooterPart))})})()}]);app=angular.module("portalNMC");
app.controller("MainCtrl",["$scope","$rootScope","$cookies","$location","mainSvc","notificationFactory","$http","objectSvc","reportSvc","monitorSvc","logSvc",function(a,b,d,h,g,k,f,n,l,m,e){function c(a){console.log(a);k.errorInfo("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c!","\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u0430\u0440\u043e\u043b\u044f.")}function q(b){if(g.checkUndefinedNull(b))return!1;
var c=!0;a.emptyString(b.oldPassword)&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u0435 "\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),c=!1);a.emptyString(b.newPassword)&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c!"),
c=!1);b.newPassword!==b.newPasswordConfirm&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u044f "\u041f\u0430\u0440\u043e\u043b\u044c" \u0438 "\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f" \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442!'),c=!1);return c}a.mainCtrlSettings={};a.mainCtrlSettings.showFullMenuFlag=!0;a.mainCtrlSettings.loadingServicePermissionFlag=g.getLoadingServicePermissionFlag();
a.mainCtrlSettings.ctxId="nmc_main";a.data={};a.showPrivateOfficeMenu=!1;b.showIndicatorsParam=!1;a.setMenuVisibles=function(c,e){a.showPrivateOfficeMenu=c;b.showIndicatorsParam=e};b.timeDetailType="1h";a.menuMassive={};a.clickMenu=function(b){Object.keys(a.menuMassive).forEach(function(b){a.menuMassive[b]=!1});a.menuMassive[b]=!0};a.setDefaultMenuState=function(){Object.keys(a.menuMassive).forEach(function(b){a.menuMassive[b]=!1});a.menuMassive.object_menu_item=!0};$(window).bind("beforeunload",
function(){a.setDefaultMenuState()});a.logOut=function(){n.getRequestCanceler().resolve();g.getRequestCanceler().resolve();l.getRequestCanceler().resolve();m.getRequestCanceler().resolve();e.getRequestCanceler().resolve();a.setDefaultMenuState()};(function(){var b=h.path(),c=!1,e=null;a.menuMassive.object_menu_item=-1!==b.indexOf("/objects/list")?!0:!1;a.menuMassive.report_menu_item="/reports"===b?!0:!1;a.menuMassive.object_menu_item=-1!==b.indexOf("/notices/")?!0:!1;a.menuMassive.setting_menu_item=
-1!==b.indexOf("/settings/")?!0:!1;a.menuMassive.admin_menu_item=-1!==b.indexOf("/management/")?!0:!1;a.menuMassive.log_menu_item=-1!==b.indexOf("/log")?!0:!1;a.menuMassive.test_menu_item=-1!==b.indexOf("/test")?!0:!1;e=Object.keys(a.menuMassive);e.some(function(b){return!1===a.menuMassive[b]?!1:c=!0});c||a.setDefaultMenuState();""===h.path()&&(a.menuMassive.object_menu_item&&window.location.assign("#/"),a.menuMassive.report_menu_item&&window.location.assign("#/reports/"),a.menuMassive.setting_menu_item&&
window.location.assign("#/settings/tariffs/"),a.menuMassive.admin_menu_item&&window.location.assign("#/management/objects/"),a.menuMassive.log_menu_item&&window.location.assign("#/log/"),a.menuMassive.test_menu_item&&window.location.assign("#/test/"))})();var t=function(a){g.getContextIds().forEach(function(a){var b=document.getElementById(a.permissionTagId);angular.isUndefined(b)||null===b||$("#"+a.permissionTagId).removeClass("nmc-hide")})};t(a.mainCtrlSettings.ctxId);b.$on("servicePermissions:loaded",
function(){t(a.mainCtrlSettings.ctxId)});a.isRma=function(){return g.isRma()};a.isCabinet=function(){return g.isCabinet()};a.getCtx=function(){return b.ctxId};a.emptyString=function(a){return g.checkUndefinedEmptyNullValue(a)};a.isTestMode=function(){return g.isTestMode()};a.changePasswordInit=function(){a.data.userInfo=angular.copy(b.userInfo)};a.checkPasswordFields=function(b){if(g.checkUndefinedNull(b))return!1;var c=!0;a.emptyString(b.oldPassword)&&(c=!1);a.emptyString(b.newPassword)&&(c=!1);
b.newPassword!==b.newPasswordConfirm&&(c=!1);return c};a.changeUserPassword=function(a){if(!1===q(a))return"Password is incorrect!";f({method:"PUT",url:"../api/systemInfo/passwordChange",params:{oldPassword:a.oldPassword,newPassword:a.newPassword}}).then(function(){k.success();$("#changePasswordModal").modal("hide")},c)}}]);app=angular.module("portalNMC");
app.controller("MngmtClientsCtrl",["$rootScope","$scope","$http","objectSvc","notificationFactory","crudGridDataFactory","mainSvc",function(a,b,d,h,g,k,f){a.ctxId="management_rma_clients_page";b.extraProps={idColumnName:"id",defaultOrderBy:"subscriberName",nameColumnName:"subscriberName"};b.orderBy={field:b.extraProps.defaultOrderBy,asc:!0};b.ctrlSettings={};b.ctrlSettings.rmaUrl="../api/rma";b.ctrlSettings.clientsUrl="../api/rma/subscribers";b.ctrlSettings.orgUrl=b.ctrlSettings.clientsUrl+"/organizations";
b.ctrlSettings.availableObjectsSuffix="/availableContObjects";b.ctrlSettings.subscrObjectsSuffix="/subscrContObjects";b.ctrlSettings.groupUrl="../api/subscr/contGroup";b.headers={};b.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b";b.ctrlSettings.clientColumns=[{name:"subscriberName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-md-3"},{name:"info",caption:"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f",
"class":"col-md-3"},{name:"comment",caption:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439","class":"col-md-2"},{name:"organizationName",caption:"\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f","class":"col-md-2"}];b.data={};b.data.organizations=[];b.data.clients=[];b.data.currentClient={};var n=function(){d.get(b.ctrlSettings.clientsUrl).then(function(a){if(f.checkUndefinedNull(a)||f.checkUndefinedNull(a.data)||!angular.isArray(a.data))return!1;a.data.forEach(function(a){if(f.checkUndefinedNull(a.organization))return!1;
a.organizationName=a.organization.organizationFullName||a.organization.organizationName});b.data.clients=a.data},function(a){console.log(a)})},l=function(){d.get(b.ctrlSettings.orgUrl).then(function(a){b.data.organizations=a.data;f.sortOrganizationsByName(b.data.organizations);n()},function(a){console.log(a)})};b.selectClient=function(a){b.data.currentClient=a};b.selectedItem=function(a){a=angular.copy(a);b.data.currentClient=a};b.editObjectList=function(a){b.selectedItem(a);b.getAvailableObjects(b.data.currentClient.id);
b.getSelectedObjects(b.data.currentClient.id);b.showAvailableObjects_flag=!1};b.addClient=function(){b.data.currentClient={};$("#showClientOptionModal").modal()};b.setOrderBy=function(a){b.orderBy={field:a,asc:b.orderBy.field===a?!b.orderBy.asc:!0}};(function(){h.getTimezones().then(function(a){b.data.timezones=a.data;l()})})();var m=function(a,b){g.success();$("#deleteClientModal").modal("hide");$("#showClientOptionModal").modal("hide");$("#showObjectListModal").modal("hide");n()},e=function(b){g.success();
$("#showObjectListModal").modal("hide");a.$broadcast("objectSvc:requestReloadData")},c=function(a){a=f.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};b.sendClientToServer=function(a){var c=!0;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.subscriberName)||null==a.subscriberName||""==a.subscriberName)g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u0430!"),
c=!1;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.organizationId)||null==a.organizationId)g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u0430!"),c=!1;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.timezoneDefKeyname)||null==a.timezoneDefKeyname)g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0447\u0430\u0441\u043e\u0432\u043e\u0439 \u043f\u043e\u044f\u0441 \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u0430!"),
c=!1;0!=c&&(c=b.ctrlSettings.clientsUrl,angular.isDefined(a.id)&&null!=a.id?b.updateObject(c,a):b.saveNewClient(c,a))};b.saveNewClient=function(a,b){k(a).save(b,m,c)};b.deleteObject=function(a){k(b.ctrlSettings.clientsUrl)["delete"]({id:a[b.extraProps.idColumnName]},m,c)};b.updateObject=function(a,e){var d={id:e[b.extraProps.idColumnName]};k(a).update(d,e,m,c)};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=f.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.availableObjects=
[];b.availableObjectGroups=[];b.selectedObjects=[];b.getAvailableObjects=function(a){k(b.ctrlSettings.rmaUrl+"/"+a+b.ctrlSettings.availableObjectsSuffix).query(function(a){b.availableObjects=a;h.sortObjectsByFullName(b.availableObjects)})};b.getSelectedObjects=function(){k(b.ctrlSettings.rmaUrl+"/"+b.data.currentClient.id+b.ctrlSettings.subscrObjectsSuffix).query(function(a){b.selectedObjects=a;h.sortObjectsByFullName(b.selectedObjects)})};b.getGroupObjects=function(a){k(b.ctrlSettings.groupUrl+"/"+
a.id+"/contObject").query(function(b){a.objects=b})};b.getAvailableObjectGroups=function(){k(b.ctrlSettings.groupUrl).query(function(a){a.forEach(function(a){b.getGroupObjects(a)});b.availableObjectGroups=a})};b.getAvailableObjectGroups();b.viewAvailableObjects=function(a){b.showAvailableObjects_flag=!b.showAvailableObjects_flag;(b.showAvailableObjectGroups_flag=a)?(b.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",
b.availableEntities=b.availableObjectGroups):(b.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b",b.availableEntities=b.availableObjects)};var q=function(a,c){var e={},d=[],t=[],p=[],q;b.addObject_flag?(d=b.availableObjects,p=t=b.selectedObjects):(t=b.availableObjects,p=d=b.selectedObjects);for(q=0;q<d.length;q+=1)if(d[q].id==b.currentObjectId){e=angular.copy(d[q]);e.selected=!1;d.splice(q,1);break}t.push(e);return p.map(function(a){return a.id})};
b.addObject=function(a){b.addObject_flag=!0;b.currentObjectId=a.id;q(!0,a.id)};b.removeObject=function(a){b.addObject_flag=!1;b.currentObjectId=a.id;q(!1,a.id)};b.removeSelectedObject=function(a){b.availableObjects.push(a);b.selectedObjects.splice(b.selectedObjects.indexOf(a),1);h.sortObjectsByFullName(b.availableObjects)};b.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};b.deleteDoublesObjects=function(a){for(var b=
a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&a.splice(b,1)};b.addUniqueObjectsFromGroupsToSelectedObjects=function(a,b){var c,e;for(c=0;c<a.length;c+=1){var d=!0;for(e=0;e<b.length;e+=1)if(a[c].fullName===b[e].fullName){d=!1;break}d&&b.push(a[c])}};b.removeGroupObjectsFromAvailableObjects=function(a,b){var c,e;for(c=0;c<a.length;c+=1){var d=-1;for(e=0;e<b.length;e+=1)if(a[c].fullName===b[e].fullName){d=e;break}0<=d&&b.splice(d,1)}};b.selectAllAvailableEntities=function(){var a;for(a=0;a<b.availableEntities.length;a+=
1)b.availableEntities[a].selected=b.ctrlSettings.selectedAll;b.ctrlSettings.selectedAll=!1};b.addSelectedEntities=function(){if(b.showAvailableObjectGroups_flag){var a=b.joinObjectsFromSelectedGroups(b.availableEntities);h.sortObjectsByFullName(a);b.deleteDoublesObjects(a);b.addUniqueObjectsFromGroupsToSelectedObjects(a,b.selectedObjects);b.removeGroupObjectsFromAvailableObjects(a,b.availableObjects)}var a=angular.copy(b.availableObjects),c;for(c=0;c<b.availableObjects.length;c+=1){var e=b.availableObjects[c];
if(e.selected){var d=angular.copy(e);d.selected=null;var q=-1;a.some(function(a,b,c){if(a.fullName===e.fullName)return q=b,!0});a.splice(q,1);b.selectedObjects.push(d);e.selected=null}}b.availableObjects=a;h.sortObjectsByFullName(b.selectedObjects);b.availableEntities=b.showAvailableObjectGroups_flag?b.availableObjectGroups:b.availableObjects};b.showAddObjectButton=function(){return!b.showAvailableObjects_flag};b.saveObject=function(){var a=b.selectedObjects.map(function(a){return a.id});null!=b.data.currentClient.id&&
"undefined"!=typeof b.data.currentClient.id&&d.put(b.ctrlSettings.rmaUrl+"/"+b.data.currentClient.id+b.ctrlSettings.subscrObjectsSuffix,a).then(e,c)};b.isSystemuser=function(){return f.isSystemuser()};b.isTestMode=function(){return f.isTestMode()}}]);app=angular.module("portalNMC");
app.controller("MngmtDatasourcesCtrl",["$rootScope","$scope","$http","mainSvc","notificationFactory",function(a,b,d,h,g){function k(a){if(0==b.data.rawModemModels.length)return null;var e=null;b.data.rawModemModels.some(function(b){if(b.id==a)return e=b,!0});return e}a.ctxId="management_rma_data_sources_page";b.ctrlSettings={};b.ctrlSettings.subscrUrl="../api/rma";b.ctrlSettings.datasourcesUrl=b.ctrlSettings.subscrUrl+"/dataSources";b.ctrlSettings.datasourceTypesUrl=b.ctrlSettings.subscrUrl+"/dataSourceTypes";
b.ctrlSettings.rawModemModelsUrl=b.ctrlSettings.subscrUrl+"/dataSources/rawModemModels";b.ctrlSettings.DEVICE_MODES=[{caption:"\u0421\u0435\u0440\u0432\u0435\u0440",keyname:"SERVER"},{caption:"\u041a\u043b\u0438\u0435\u043d\u0442",keyname:"CLIENT"}];b.data={};b.data.dataSources=[];b.data.dataSourcesTypes=[];b.data.rawModemModels=[];b.data.currentObject={};(function(a){d.get(a).then(function(a){b.data.dataSourcesTypes=a.data},function(a){console.log(a)})})(b.ctrlSettings.datasourceTypesUrl);var f=
function(a){d.get(a).then(function(a){b.data.dataSources=a.data;h.sortItemsBy(b.data.dataSources,"dataSourceName")},function(a){console.log(a)})};f(b.ctrlSettings.datasourcesUrl);b.changeModemModel=function(){var a=k(b.data.currentObject.rawModemModelId);b.data.currentObject.rawModemIdentity=a.rawModemModelIdentity;b.data.currentObject.rawModemDialupAvailable=a.isDialup};b.selectedItem=function(a){b.data.currentObject=angular.copy(a);h.checkUndefinedNull(b.data.currentObject.rawTimeout)&&(b.data.currentObject.rawTimeout=
25);h.checkUndefinedNull(b.data.currentObject.rawSleepTime)&&(b.data.currentObject.rawSleepTime=250);h.checkUndefinedNull(b.data.currentObject.rawResendAttempts)&&(b.data.currentObject.rawResendAttempts=3);h.checkUndefinedNull(b.data.currentObject.rawReconnectAttempts)&&(b.data.currentObject.rawReconnectAttempts=1);h.checkUndefinedNull(b.data.currentObject.rawReconnectTimeout)&&(b.data.currentObject.rawReconnectTimeout=60);h.checkUndefinedNull(b.data.currentObject.rawModemIdentity)&&!h.checkUndefinedNull(b.data.currentObject.rawModemModelId)&&
(a=k(b.data.currentObject.rawModemModelId),b.data.currentObject.rawModemIdentity=a.rawModemModelIdentity,b.data.currentObject.rawModemDialupAvailable=a.isDialup)};var n=function(a){a=h.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};(function(){d.get(b.ctrlSettings.rawModemModelsUrl).then(function(a){b.data.rawModemModels=a.data},n)})();b.addDatasource=function(){b.data.currentObject={};b.data.currentObject.dataSourceTypeKey="DEVICE";b.data.currentObject.rawConnectionType="SERVER";b.data.currentObject.rawTimeout=
25;b.data.currentObject.rawSleepTime=250;b.data.currentObject.rawResendAttempts=3;b.data.currentObject.rawReconnectAttempts=1;b.data.currentObject.rawReconnectTimeout=60;$("#showDatasourceModal").modal()};b.editDatasource=function(a){b.selectedItem(a);$("#showDatasourceModal").modal()};var l=function(a){g.success();f(b.ctrlSettings.datasourcesUrl);$("#showDatasourceModal").modal("hide");$("#deleteObjectModal").modal("hide");b.data.currentObject={};b.data.currentObject.dataSourceTypeKey="DEVICE";b.data.currentObject.rawConnectionType=
"SERVER"};b.saveDatasource=function(a){var e=!0;if(angular.isUndefined(a.dataSourceName)||null===a.dataSourceName||""===a.dataSourceName)g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0438\u043c\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445."),e=!1;"MANUAL"!==a.dataSourceTypeKey&&("CLIENT"==a.rawConnectionType||b.checkPositiveNumberValue(a.dataSourcePort)||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043f\u043e\u0440\u0442 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445."),e=!1),"CLIENT"==a.rawConnectionType||!angular.isUndefined(a.dataSourceIp)&&null!==a.dataSourceIp&&""!==a.dataSourceIp||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d ip \\ hostname \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445."),
e=!1),"DEVICE"==a.dataSourceTypeKey&&(""==a.rawTimeout?(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430."),e=!1):(a.rawTimeout=Number(a.rawTimeout),b.checkPositiveNumberValue(a.rawTimeout)||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430."),
e=!1)),""==a.rawSleepTime?(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430."),e=!1):(a.rawSleepTime=Number(a.rawSleepTime),b.checkPositiveNumberValue(a.rawSleepTime)||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430."),e=!1)),""==a.rawResendAttempts?(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u043f\u044b\u0442\u043e\u043a \u043f\u0435\u0440\u0435\u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u0430\u043a\u0435\u0442\u0430."),
e=!1):(a.rawResendAttempts=Number(a.rawResendAttempts),b.checkPositiveNumberValue(a.rawResendAttempts)||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u043f\u044b\u0442\u043e\u043a \u043f\u0435\u0440\u0435\u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u0430\u043a\u0435\u0442\u0430."),e=!1)),""==a.rawReconnectAttempts?
(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u043e\u0448\u0438\u0431\u043a\u0438."),e=!1):(a.rawReconnectAttempts=Number(a.rawReconnectAttempts),b.checkPositiveNumberValue(a.rawReconnectAttempts)||
(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u043e\u0448\u0438\u0431\u043a\u0438."),e=!1)),""==a.rawReconnectTimeout?(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u0430\u0443\u0437\u0430 \u043c\u0435\u0436\u0434\u0443 \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f\u043c\u0438."),
e=!1):(a.rawReconnectTimeout=Number(a.rawReconnectTimeout),b.checkPositiveNumberValue(a.rawReconnectTimeout)||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u0430\u0443\u0437\u0430 \u043c\u0435\u0436\u0434\u0443 \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f\u043c\u0438."),e=!1))),"DEVICE"==a.dataSourceTypeKey&&"CLIENT"==a.rawConnectionType&&
h.checkUndefinedNull(a.rawModemModelId)&&(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043c\u043e\u0434\u0435\u043b\u044c \u043c\u043e\u0434\u0435\u043c\u0430"),e=!1),"DEVICE"==a.dataSourceTypeKey&&"CLIENT"==a.rawConnectionType&&1==a.rawModemDialEnable&&(h.checkUndefinedNull(a.rawModemDialTel)||10>a.rawModemDialTel.length)&&(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u043c\u043e\u0434\u0435\u043c\u0430"),
e=!1),"DEVICE"!=a.dataSourceTypeKey||"CLIENT"!=a.rawConnectionType||"SERIAL_NR"!=a.rawModemIdentity||!h.checkUndefinedNull(a.rawModemSerial)&&0!=a.rawModemSerial.length||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u0441\u0435\u0440\u0438\u0439\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u043c\u043e\u0434\u0435\u043c\u0430"),e=!1),"DEVICE"!=a.dataSourceTypeKey||"CLIENT"!=a.rawConnectionType||
"MAC_ADDR"!=a.rawModemIdentity||!h.checkUndefinedNull(a.rawModemMacAddr)&&0!=a.rawModemMacAddr.length||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d MAC-\u0430\u0434\u0440\u0435\u0441 \u043c\u043e\u0434\u0435\u043c\u0430"),e=!1),"DEVICE"!=a.dataSourceTypeKey||"CLIENT"!=a.rawConnectionType||"IMEI"!=a.rawModemIdentity||!h.checkUndefinedNull(a.rawModemImei)&&0!=a.rawModemImei.length||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d IMEI \u043c\u043e\u0434\u0435\u043c\u0430"),e=!1));!1!==e&&(e=b.ctrlSettings.datasourcesUrl,angular.isDefined(a.id)&&null!=a.id?(e=e+"/"+a.id,d.put(e,a).then(l,n)):d.post(e,a).then(l,n))};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=h.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.deleteObject=function(a){d["delete"](b.ctrlSettings.datasourcesUrl+"/"+a.id).then(l,
n)};b.isSystemuser=function(){return h.isSystemuser()};b.isTestMode=function(){return h.isTestMode()};b.checkNumericValue=function(a){return h.checkNumericValue(a)};b.checkPositiveNumberValue=function(a){return h.checkPositiveNumberValue(a)};$("#showDatasourceModal").on("shown.bs.modal",function(){$("#inputDataSourceMode").focus();$("#inputDSTimeout").inputmask();$("#inputDSCheckInterval").inputmask();$("#inputDSRepeatCount").inputmask();$("#inputDSReconnectionCount").inputmask();$("#inputDSReconnectionInterval").inputmask()});
$("#showDatasourceModal").on("hidden.bs.modal",function(){var a;a=document.getElementById("con_properties_tab");h.checkUndefinedNull(a)||a.classList.remove("active");a=document.getElementById("con_properties");h.checkUndefinedNull(a)||a.classList.remove("active");a=document.getElementById("ex_properties_tab");h.checkUndefinedNull(a)||a.classList.remove("active");a=document.getElementById("ex_properties");h.checkUndefinedNull(a)||a.classList.remove("active");a=document.getElementById("main_properties_tab");
h.checkUndefinedNull(a)||a.classList.add("active");a=document.getElementById("main_properties");h.checkUndefinedNull(a)||(a.classList.add("in"),a.classList.add("active"))})}]);app=angular.module("portalNMC");
app.controller("MngmtDeviceModelsCtrl",["$rootScope","$scope","$http","objectSvc","notificationFactory","crudGridDataFactory","mainSvc",function(a,b,d,h,g,k,f){a.ctxId="management_rma_device_models_page";b.extraProps={idColumnName:"id",defaultOrderBy:"modelName",nameColumnName:"modelName"};b.orderBy={field:b.extraProps.defaultOrderBy,asc:!0};b.ctrlSettings={};b.ctrlSettings.rmaUrl="../api/rma";b.ctrlSettings.modelsUrl=b.ctrlSettings.rmaUrl+"/deviceObjects/deviceModels";b.headers={};b.ctrlSettings.modelColumns=
[{name:"modelName",caption:"modelName","class":"col-xs-3",type:"name"},{name:"caption",caption:"Caption","class":"col-xs-3"},{name:"keyname",caption:"Keyname","class":"col-xs-1"},{name:"exCode",caption:"exCode","class":"col-xs-1"},{name:"exLabel",caption:"exLabel","class":"col-xs-1"},{name:"exSystem",caption:"exSystem","class":"col-xs-1"},{name:"isImpulse",caption:"isImpulse","class":"col-xs-1",type:"checkbox"}];b.data={};b.data.models=[];b.data.currentModel={};b.data.modemTypes=[{keyname:"GPRS-MODEM",
caption:"GPRS-\u043c\u043e\u0434\u0435\u043c"},{keyname:"ETHERNET-CONVERTER",caption:"Ethernet-\u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0435\u0440"}];var n=function(){d.get(b.ctrlSettings.modelsUrl).then(function(a){!f.checkUndefinedNull(a.data)&&angular.isArray(a.data)&&0<a.data.length&&(b.data.models=a.data)},function(a){console.log(a)})};b.selectModel=function(a){b.data.currentModel=a};b.selectedItem=function(a){a=angular.copy(a);b.data.currentModel=a};b.addModel=function(){b.data.currentModel=
{};$("#showModelOptionModal").modal()};b.setOrderBy=function(a){b.orderBy={field:a,asc:b.orderBy.field===a?!b.orderBy.asc:!0}};var l=function(a,b){g.success();$("#deleteModelModal").modal("hide");$("#showModelOptionModal").modal("hide");n()},m=function(a){a=f.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};b.sendModelToServer=function(a){var c=!0;if(angular.isUndefined(a)||null===a||angular.isUndefined(a.modelName)||null===a.modelName||""===a.modelName)g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043c\u043e\u0434\u0435\u043b\u0438!"),c=!1;!1!==c&&(c=b.ctrlSettings.modelsUrl,angular.isDefined(a.id)&&null!=a.id?b.updateObject(c,a):b.saveNewModel(c,a))};b.saveNewModel=function(a,b){k(a).save(b,l,m)};b.deleteObject=function(a){k(b.ctrlSettings.modelsUrl)["delete"]({id:a[b.extraProps.idColumnName]},l,m)};b.updateObject=function(a,c){var e={id:c[b.extraProps.idColumnName]};k(a).update(e,c,l,m)};
b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=f.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.isSystemuser=function(){return f.isSystemuser()};b.data.measures=h.getDeviceMetadataMeasures();b.$on("objectSvc:deviceMetadataMeasuresLoaded",function(){b.data.measures=h.getDeviceMetadataMeasures()});b.initCtrl=function(){n()};b.initCtrl()}]);app=angular.module("portalNMC");
app.controller("MngmtDevicesCtrl",["$rootScope","$scope","$http","$timeout","objectSvc","notificationFactory","mainSvc","$interval","logSvc","$cookies",function(a,b,d,h,g,k,f,n,l,m){function e(a){b.data.deviceModalWindowTabs.forEach(function(b){var c,e;c=document.getElementById(b.name)||null;e=document.getElementById(b.tabpanel)||null;0!==b.name.localeCompare(a)?(c.classList.remove("active"),e.classList.remove("active")):(c.classList.add("active"),e.classList.add("in"),e.classList.add("active"))})}
function c(a){if(angular.isUndefined(a)||null===a||!angular.isArray(a))return!1;a.sort(function(a,b){return a.contObjectInfo.fullName.toUpperCase()>b.contObjectInfo.fullName.toUpperCase()?1:a.contObjectInfo.fullName.toUpperCase()<b.contObjectInfo.fullName.toUpperCase()?-1:0})}function q(a){var c=null;if(f.checkUndefinedNull(b.data.deviceModels)||!angular.isArray(b.data.deviceModels))return c;b.data.deviceModels.some(function(b){if(b.id===a)return c=b,!0});return c}function t(a,b){return f.checkUndefinedNull(a)||
!0!==a.isImpulse||!0===b.dataSourceType.isRaw?!0:(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u0412\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0439 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 \u0438\u043c\u043f\u0443\u043b\u044c\u0441\u043d\u044b\u043c\u0438 \u043f\u0440\u0438\u0431\u043e\u0440\u0430\u043c\u0438"),!1)}
function u(){var a=!0;if(f.checkUndefinedNull(b.data.currentObject)||f.checkUndefinedNull(b.data.currentObject.id))a=!1,k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043f\u0440\u0438\u0431\u043e\u0440.");f.checkUndefinedNull(b.ctrlSettings.dataLoadDaterange.startDate)&&(a=!1,k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0447\u0430\u043b\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430."));
f.checkUndefinedNull(b.ctrlSettings.dataLoadDaterange.endDate)&&(a=!1,k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043a\u043e\u043d\u0435\u0446 \u043f\u0435\u0440\u0438\u043e\u0434\u0430."));b.ctrlSettings.dataLoadDaterange.endDate<b.ctrlSettings.dataLoadDaterange.startDate&&(a=!1,k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u044b \u0433\u0440\u0430\u043d\u0438\u0446\u044b \u043f\u0435\u0440\u0438\u043e\u0434\u0430."));
var c=!1;b.data.detailTypes.some(function(a){if(!0===a.selected)return c=!0});!1===c&&(a=!1,k.warning("\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445. \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u0430."));return a}function v(a){b.ctrlSettings.dataIsLoaded=
!1;if(f.checkUndefinedNull(a)||0===a.length)return!1;var c=0;a.forEach(function(a){-1!==C.indexOf(a.currentStatus)&&(c+=1)});c===a.length&&(b.ctrlSettings.dataIsLoaded=!0)}function x(){b.ctrlSettings.sessionsLoading=!0;d.get("../api/rma/subscrSessionTask/"+b.data.currentSessionTask.id+"/logSessions").then(function(a){b.ctrlSettings.sessionsLoading=!1;if(f.checkUndefinedNull(a.data)||0===a.data.length)return"Session array is empty";var c=null;f.checkUndefinedNull(b.data.currentSession)||f.checkEmptyObject(b.data.currentSession)||
(c=angular.copy(b.data.currentSession));b.data.sessionsOnView=l.serverDataParser(angular.copy(a.data));v(b.data.sessionsOnView);if(f.checkUndefinedNull(c)||f.checkEmptyObject(c))b.data.currentSession=b.data.sessionsOnView[0],c=angular.copy(b.data.currentSession);f.checkUndefinedNull(c)||f.checkEmptyObject(c)||b.data.sessionsOnView.some(function(a){a.id===c.id&&b.loadLogData(a)})},B)}function w(){d.get("../api/rma/subscrSessionTask/"+b.data.currentSessionTask.id).then(function(a){b.data.currentSessionTask=
a.data},r)}function p(){w();x()}function y(a){d.get("../api/rma/subscrSessionTask/contZPointSessionDetailType/byDeviceObject/"+a.id).then(function(a){if(f.checkUndefinedNull(a)||f.checkUndefinedNull(a.data))return console.log("Session detail type is empty."),"Session detail type is empty.";b.data.sessionDetailType=a.data},r)}function F(a){d.get("../api/rma/subscrSessionTask/sessionDetailTypes/byDeviceObject/"+a.id).then(function(a){if(f.checkUndefinedNull(a)||f.checkUndefinedNull(a.data))return console.log("Session detail type is empty."),
"Session detail type is empty.";b.data.detailTypes=angular.copy(a.data)},r)}a.ctxId="management_rma_devices_page";var G=null;b.ctrlSettings={};b.ctrlSettings.datasourcesUrl=g.getDatasourcesUrl();b.ctrlSettings.loading=!0;b.ctrlSettings.userDateFormat="DD.MM.YYYY";b.ctrlSettings.sessionsUrl="../api/rma/logSessions";b.ctrlSettings.sessionColumns=[{name:"currentStatusColor",caption:"",type:"color",headerClass:"col-xs-1 col-md-1 nmc-td-for-button noPadding"},{name:"startDate",caption:"\u0412\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u0430",
headerClass:"col-xs-2 col-md-2 noPadding"},{name:"endDate",caption:"\u0412\u0440\u0435\u043c\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f",headerClass:"col-xs-2 col-md-2 noPadding"},{name:"currentStatus",caption:"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441",headerClass:"col-xs-1 col-md-1"},{name:"statusMessage",caption:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",headerClass:"col-xs-5 col-md-5"}];var C=["COMPLETE","COMPLETE WITH ERROR",
"FAILURE"];b.ctrlSettings.logColumns=[{name:"stepDateStr",caption:"\u0414\u0430\u0442\u0430-\u0432\u0440\u0435\u043c\u044f",headerClass:"col-xs-2 col-md-2",type:"id"},{name:"stepType",caption:"\u0422\u0438\u043f",headerClass:"col-xs-1 col-md-1"},{name:"stepMessage",caption:"\u0422\u0435\u043a\u0441\u0442",headerClass:"col-xs-7 col-md-7"},{name:"isIncremental",caption:"\u0421\u0447\u0435\u0442\u0447\u0438\u043a",headerClass:"col-xs-1 col-md-1",type:"checkbox"},{name:"sumRows",caption:"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435",
headerClass:"col-xs-1 col-md-1"}];b.ctrlSettings.deviceColumns=[{name:"deviceContObjectCaption",caption:"\u041e\u0431\u044a\u0435\u043a\u0442",headerClass:"col-xs-4 col-md-4"},{name:"deviceModelCaption",caption:"\u041c\u043e\u0434\u0435\u043b\u044c",headerClass:"col-xs-1 col-md-1"},{name:"number",caption:"s/n",headerClass:"col-xs-2 col-md-2"},{name:"deviceDatasourceCaption",caption:"\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445",headerClass:"col-xs-3 col-md-3"},
{name:"deviceTimeOffsetString",caption:"\u0420\u0430\u0441\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u0438",headerClass:"col-xs-2 col-md-2"}];b.ctrlSettings.daterangeOpts=f.getDateRangeOptions("ru");b.ctrlSettings.daterangeOpts.startDate=moment().startOf("day");b.ctrlSettings.daterangeOpts.endDate=moment().endOf("day");b.ctrlSettings.dataLoadDaterange={startDate:moment().startOf("day"),endDate:moment().endOf("day")};b.data={};b.data.dataSources=[];b.data.objects=
[];b.data.devices=[];b.data.deviceModels=[];b.data.deviceModelTypes=[];b.data.impulseCounterTypes=[];b.data.currentObject={};b.data.currentScheduler={};b.data.currentSession={};b.data.metadataSchema=[{header:"\u041f\u043e\u043b\u0435 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a",headClass:"col-xs-2 col-md-2",name:"srcProp",type:"input/text"},{header:"\u041f\u043e\u043b\u0435 \u043f\u0440\u0438\u0435\u043c\u043d\u0438\u043a",headClass:"col-xs-2 col-md-2",name:"destProp",type:"input/text"},{header:"\u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f",
headClass:"col-xs-1 col-md-1",name:"srcMeasureUnit",type:"select",disabled:!1}];b.data.deviceModalWindowTabs=[{name:"main_properties_tab",tabpanel:"main_properties"},{name:"con_properties_tab",tabpanel:"con_properties"},{name:"time_properties_tab",tabpanel:"time_properties"}];var H=function(){e("main_properties_tab")},r=function(a){a=f.errorCallbackHandler(a);k.errorInfo(a.caption,a.description)},I=function(a){k.success();b.getDevices();$("#showDeviceModal").modal("hide");$("#deleteObjectModal").modal("hide");
$("#scheduleEditorModal").modal("hide");b.data.currentObject={};b.data.currentScheduler={}},B=function(a){r(a);b.data.currentObject.isSaving=!1;b.data.currentScheduler.isSaving=!1;b.ctrlSettings.sessionsLoading=!1};b.getDevices=function(){g.getAllDevices().then(function(a){a=a.data;a.forEach(function(a){angular.isDefined(a.contObjectInfo)&&null!==a.contObjectInfo&&(a.contObjectId=a.contObjectInfo.contObjectId);angular.isDefined(a.activeDataSource)&&null!==a.activeDataSource&&(a.subscrDataSourceId=
Number(a.activeDataSource.subscrDataSource.id),a.curDatasource=a.activeDataSource.subscrDataSource,a.subscrDataSourceAddr=a.activeDataSource.subscrDataSourceAddr,a.dataSourceTable1h=a.activeDataSource.dataSourceTable1h,a.dataSourceTable24h=a.activeDataSource.dataSourceTable24h);f.checkUndefinedNull(a.verificationDate)||(a.verificationDateString=f.dateFormating(a.verificationDate,b.ctrlSettings.userDateFormat));a.deviceContObjectCaption=a.contObjectInfo.fullName;a.deviceModelCaption=a.deviceModel.caption||
a.deviceModel.modelName;if(!0===b.isDeviceDisabled(a))switch(a.exSystemKeyname){case "LERS":a.deviceDatasourceCaption="\u041b\u042d\u0420\u0421";break;case "VZLET":a.deviceDatasourceCaption="\u0412\u0417\u041b\u0415\u0422"}else f.checkUndefinedNull(a.activeDataSource)||(a.deviceDatasourceCaption=a.activeDataSource.subscrDataSource.dataSourceName);a.deviceTimeOffsetString=f.prepareTimeOffset(a.deviceObjectTimeOffset);f.checkUndefinedNull(a.deviceTimeOffsetString)||(0===a.deviceTimeOffsetString.indexOf("+")&&
(a.deviceTimeOffsetStringTitle="\u0427\u0430\u0441\u044b \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0441\u043f\u0435\u0448\u0430\u0442"),0===a.deviceTimeOffsetString.indexOf("-")&&(a.deviceTimeOffsetStringTitle="\u0427\u0430\u0441\u044b \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u043e\u0442\u0441\u0442\u0430\u044e\u0442"))});c(a);b.data.devices=a;b.ctrlSettings.loading=!1},r)};(function(){g.getImpulseCounterTypes().then(function(a){b.data.impulseCounterTypes=a.data;b.getDevices()},r)})();b.getDeviceSchedulerSettings=
function(a,c){g.getDeviceSchedulerSettings(a,c.id).then(function(a){b.data.currentScheduler=a.data;b.selectedItem(c);$("#scheduleEditorModal").modal()},r)};b.saveScheduler=function(a,b,c){if(f.checkUndefinedNull(a))return"ObjId of scheduler is undefined or null.";if(f.checkUndefinedNull(b)||f.checkUndefinedNull(b.id))return"Device of scheduler is empty.";if(f.checkUndefinedNull(c))return"Scheduler is empty.";c.isSaving=!0;g.putDeviceSchedulerSettings(a,b.id,c).then(I,B)};b.checkDatasource=function(){var a=
!0;null===b.data.currentObject.id&&f.checkUndefinedNull(b.data.currentObject.subscrDataSourceId)&&b.data.currentObject.isManual&&(a=!1);if(f.checkUndefinedNull(b.data.currentObject.deviceModelId))return a;var c=q(b.data.currentObject.deviceModelId);f.checkUndefinedNull(b.data.currentObject)||f.checkUndefinedNull(b.data.currentObject.curDatasource)||!0!==c.isImpulse||!0===b.data.currentObject.curDatasource.dataSourceType.isRaw||(a=!1);return a};b.checkModel=function(){var a=!0;null===b.data.currentObject.id&&
f.checkUndefinedNull(b.data.currentObject.deviceModelId)&&b.data.currentObject.isManual&&(a=!1);if(f.checkUndefinedNull(b.data.currentObject.deviceModelId))return a;var c=q(b.data.currentObject.deviceModelId);f.checkUndefinedNull(b.data.currentObject)||f.checkUndefinedNull(b.data.currentObject.curDatasource)||!0!==c.isImpulse||!0===b.data.currentObject.curDatasource.dataSourceType.isRaw||(a=!1);return a};b.deviceModelChange=function(){if(!f.checkUndefinedNull(b.data.currentObject.deviceModelId)){var a=
q(b.data.currentObject.deviceModelId);f.checkUndefinedNull(b.data.currentObject)||f.checkUndefinedNull(b.data.currentObject.curDatasource)||t(a,b.data.currentObject.curDatasource);m.recentDeviceModelId=b.data.currentObject.deviceModelId;b.data.currentModel=a;b.data.currentObject.curModel=a;if(!0===b.data.currentModel.isImpulse){var a=b.data.currentObject,c=b.data.currentModel.defaultImpulseK,e=b.data.currentModel.defaultImpulseMu,d=b.data.impulseCounterTypes[0].keyname||null;a.isImpulse=b.data.currentModel.isImpulse;
a.impulseK=c;a.impulseMu=e;a.impulseCounterType=d||null}else a=b.data.currentObject,a.isImpulse=!1,a.impulseK=null,a.impulseMu=null,a.impulseCounterType=null}};b.getDeviceModels=function(){g.getDeviceModels().then(function(a){var c=null,e=-1;a.data.some(function(a,b){if("NOT_ASSIGNED"===a.modelName)return c=a,e=b,!0});-1!==e&&(a.data.splice(e,1),a.data.splice(0,0,c));b.data.deviceModels=a.data},r)};b.getDeviceModels();var z=function(a){d.get(a).then(function(a){b.data.dataSources=a.data;f.sortItemsBy(b.data.dataSources,
"dataSourceName")},function(a){console.log(a)})};z(b.ctrlSettings.datasourcesUrl);b.getObjects=function(){g.getRmaPromise().then(function(a){g.sortObjectsByFullName(a.data);b.data.objects=a.data})};b.getObjects();b.selectedItem=function(a){b.data.currentObject=angular.copy(a);b.data.currentObject.beginDeviceModelId=b.data.currentObject.deviceModelId};b.addDevice=function(){b.data.currentObject={};b.data.currentObject.id=null;b.data.currentObject.isManual=!0;b.data.currentObject.deviceLoginInfo={};
if(!f.checkUndefinedNull(m.recentDeviceModelId)&&(b.data.currentObject.deviceModelId=Number(m.recentDeviceModelId),b.data.currentModel=q(b.data.currentObject.deviceModelId),b.data.currentObject.curModel=q(b.data.currentObject.deviceModelId),!0===b.data.currentModel.isImpulse)){var a=b.data.currentObject,c=b.data.currentModel.defaultImpulseK,e=b.data.currentModel.defaultImpulseMu,d=b.data.impulseCounterTypes[0].keyname||null;a.isImpulse=b.data.currentModel.isImpulse;a.impulseK=c;a.impulseMu=e;a.impulseCounterType=
d||null}f.checkUndefinedNull(m.recentDataSourceId)||(b.data.currentObject.subscrDataSourceId=Number(m.recentDataSourceId),b.deviceDatasourceChange());z(b.ctrlSettings.datasourcesUrl);$("#showDeviceModal").modal()};b.editDevice=function(a){b.selectedItem(a);f.checkUndefinedNull(a.deviceModelId)||(b.data.currentModel=q(a.deviceModelId),b.data.currentObject.curModel=q(a.deviceModelId));g.getDeviceDatasources(a.contObjectId,a.id).then(function(a){b.data.dataSources=angular.copy(a.data);b.getDeviceMetaDataVzlet(b.data.currentObject);
$("#showDeviceModal").modal()},B)};b.deviceDatasourceChange=function(){var a=null;b.data.dataSources.some(function(c){if(c.id===b.data.currentObject.subscrDataSourceId)return a=c,!0});t(b.data.currentModel,a);b.data.currentObject.dataSourceTable1h=null;b.data.currentObject.dataSourceTable24h=null;b.data.currentObject.subscrDataSourceAddr=null;b.data.currentObject.curDatasource=a;f.checkUndefinedNull(b.data.currentObject.subscrDataSourceId)||(m.recentDataSourceId=b.data.currentObject.subscrDataSourceId)};
b.saveDevice=function(a){var c;a:{c=a.isSaving=!0;f.checkUndefinedNull(a.contObjectId)&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043e\u0431\u044a\u0435\u043a\u0442 \u0443\u0447\u0435\u0442\u0430"),c=!1);null===a.id&&f.checkUndefinedNull(a.subscrDataSourceId)&&a.isManual&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445"),
c=!1);null===a.id&&f.checkUndefinedNull(a.deviceModelId)&&a.isManual&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043c\u043e\u0434\u0435\u043b\u044c \u043f\u0440\u0438\u0431\u043e\u0440\u0430"),c=!1);!1===t(a.curModel,a.curDatasource)&&(c=!1);if(!f.checkUndefinedNull(a.curModel)&&!0===a.curModel.isImpulse&&!0===a.curDatasource.dataSourceType.isRaw){var d=c,r=!0;if(f.checkUndefinedNull(a.impulseK)||0==a.impulseK)k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0447\u0438\u0441\u043b\u043e \u0438\u043c\u043f\u0443\u043b\u044c\u0441\u043e\u0432 \u0432 \u0435\u0434\u0438\u043d\u0438\u0446\u0435 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f"),r=!1;if(f.checkUndefinedNull(a.impulseMu)||""===a.impulseMu)k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u0435\u0434\u0438\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f"),
r=!1;if(f.checkUndefinedNull(a.impulseCounterAddr)||""===a.impulseCounterAddr)k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0430\u0434\u0440\u0435\u0441 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0430 \u0438\u043c\u043f\u0443\u043b\u044c\u0441\u043e\u0432"),r=!1;if(f.checkUndefinedNull(a.impulseCounterSlotAddr)||""===a.impulseCounterSlotAddr)k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0430\u0434\u0440\u0435\u0441 \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0432 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0435 \u0438\u043c\u043f\u0443\u043b\u044c\u0441\u043e\u0432"),
r=!1;!1===r&&(c=!1);!0===d&&!1===c&&(e("con_properties_tab"),$("#divInputNetDevAddr").hasClass("has-error")?$("#inputNetDevAddr").focus():$("#divInputNetAddrImpDev").hasClass("has-error")?$("#inputNetAddrImpDev").focus():$("#divInputTikCost").hasClass("has-error")?$("#inputTikCost").focus():$("#divInputDevMeasure").hasClass("has-error")&&$("#inputDevMeasure").focus());!1===d&&H()}if(!1===c)c=a.isSaving=!1;else{f.checkUndefinedNull(a.verificationDateString)&&""===a.verificationDateString||(a.verificationDate=
f.strDateToUTC(a.verificationDateString,b.ctrlSettings.userDateFormat));if(!f.checkUndefinedNull(a.id)&&b.isDirectDevice(a)&&a.beginDeviceModelId!==a.deviceModelId&&(c=confirm("\u041c\u043e\u0434\u0435\u043b\u044c \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0431\u044b\u043b\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0430. \u041c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0431\u0443\u0434\u0443\u0442 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u043d\u044b \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u043c\u043e\u0434\u0435\u043b\u0438. \u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c?"),
!c)){c=a.isSaving=!1;break a}c=!0}}if(!1===c)return!1;g.sendDeviceToServer(a).then(I,B)};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=f.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.deleteObject=function(a){var b=g.getRmaObjectsUrl(),b=b+"/"+a.contObjectInfo.contObjectId+"/deviceObjects/"+a.id;d["delete"](b).then(I,B)};b.data.deviceMetadataMeasures=g.getDeviceMetadataMeasures();b.$on("objectSvc:deviceMetadataMeasuresLoaded",function(){b.data.deviceMetadataMeasures=
g.getDeviceMetadataMeasures()});b.updateDeviceMetaData=function(a){a.isSaving=!0;var c=g.getRmaObjectsUrl()+"/"+a.contObjectId+"/deviceObjects/"+a.id+"/metadata";d({url:c,method:"PUT",data:a.metadata}).then(function(a){b.currentObject={};$("#metaDataEditorModal").modal("hide");k.success()},B)};b.vzletDevice=function(a){var b=!1;angular.isDefined(a.activeDataSource)&&null!==a.activeDataSource&&angular.isDefined(a.activeDataSource.subscrDataSource)&&null!==a.activeDataSource.subscrDataSource&&"VZLET"===
a.activeDataSource.subscrDataSource.dataSourceTypeKey&&(b=!0);return b};b.isDirectDevice=function(a){return g.isDirectDevice(a)};b.getDeviceMetaDataVzlet=function(a){if(f.checkUndefinedNull(a))return console.log("getDeviceMetaDataVzlet: Device undefined or null."),"getDeviceMetaDataVzlet: Device undefined or null.";g.getRmaDeviceMetaDataVzlet(a.contObjectInfo.contObjectId,a).then(function(b){a.metaData=b.data},B)};b.getVzletSystemList=function(){var a=g.getVzletSystemList();0===a.length?g.getDeviceMetaDataVzletSystemList().then(function(a){b.data.vzletSystemList=
a.data},B):b.data.vzletSystemList=a};b.getVzletSystemList();b.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0};b.startLoadData=function(){b.data.sessionsOnView=[];b.data.sessionLog=[];if(!1!==u()){var a={};a.deviceObjectId=b.data.currentObject.id;a.periodBeginDate=b.ctrlSettings.dataLoadDaterange.startDate;a.periodEndDate=b.ctrlSettings.dataLoadDaterange.endDate;a.sessionDetailTypes=[];angular.isArray(b.data.detailTypes)&&0<b.data.detailTypes.length&&b.data.detailTypes.forEach(function(b){!0===b.selected&&a.sessionDetailTypes.push(b.keyname)});d.post("../api/rma/subscrSessionTask",a).then(function(a){f.checkUndefinedNull(a)||
f.checkUndefinedNull(a.data)||(b.data.currentSessionTask=a.data,G=n(p,1E4))},B)}};b.initManualLoading=function(a){b.ctrlSettings.dataIsLoaded=!1;b.data.sessionsOnView=[];b.data.currentSession={};b.data.currentSessionTask={};b.data.sessionLog=[];b.data.currentContZpoint=null;b.data.sessionDetailType=[];b.data.detailTypes=[];b.selectedItem(a);y(a);F(a)};b.changeSessionDetailType=function(){b.data.detailTypes=angular.copy(b.data.currentContZpoint.sessionDetailTypes)};b.loadLogData=function(a){b.data.currentSession.selected=
!1;a.selected=!0;b.ctrlSettings.logLoading=!0;b.data.currentSession=a;d.get(b.ctrlSettings.sessionsUrl+"/"+a.id+"/steps").then(function(a){b.data.sessionLog=a.data;b.ctrlSettings.logLoading=!1},B)};$("#deviceSessionModal").on("hidden.bs.modal",function(){f.checkUndefinedNull(G)||n.cancel(G)});b.isDisabledStartButton=function(){return!f.checkUndefinedNull(b.data.currentSessionTask)&&!f.checkUndefinedNull(b.data.currentSessionTask.id)};b.$on("$destroy",function(){window.onkeydown=void 0});window.onkeydown=
function(a){"ArrowUp"===a.code?(a=document.getElementById("divWithDeviceTable"),a.scrollTop-=20):"ArrowDown"===a.code?(a=document.getElementById("divWithDeviceTable"),a.scrollTop+=20):"PageDown"===a.code?(a=document.getElementById("divWithDeviceTable"),a.scrollTop+=340):"PageUp"===a.code?(a=document.getElementById("divWithDeviceTable"),a.scrollTop-=340):a.ctrlKey&&"Home"===a.code?(a=document.getElementById("divWithDeviceTable"),a.scrollTop=0):a.ctrlKey&&"End"===a.code&&(a=document.getElementById("divWithDeviceTable"),
a.scrollTop=a.scrollHeight)};b.isSystemuser=function(){return f.isSystemuser()};b.isTestMode=function(){return f.isTestMode()};b.isDeviceDisabled=function(a){return"VZLET"===a.exSystemKeyname||"LERS"===a.exSystemKeyname||!0===a.isSaving};b.isDeviceProtoLoaded=function(a){return"VZLET"===a.exSystemKeyname||"LERS"===a.exSystemKeyname};b.checkHHmm=function(a){return f.checkHHmm(a)};b.checkPositiveNumberValue=function(a){return f.checkPositiveNumberValue(a)};b.checkScheduler=function(a){return b.checkHHmm(a.loadingInterval)&&
b.checkHHmm(a.loadingRetryInterval)&&b.checkPositiveNumberValue(a.loadingAttempts)};b.isAvailableConPropertiesTab=function(){return f.checkUndefinedNull(b.data.currentObject.curDatasource)?!1:!0===b.data.currentObject.curDatasource.dataSourceType.isRaw||!0===b.data.currentObject.curDatasource.dataSourceType.isDbTablePair||"VZLET"===b.data.currentObject.exSystemKeyname};b.checkAutoLoadingDisabled=function(){return f.checkUndefinedNull(b.data.currentObject)||f.checkUndefinedNull(b.data.currentObject.activeDataSource)||
f.checkUndefinedNull(b.data.currentObject.activeDataSource.subscrDataSource)?!1:"CLIENT"===b.data.currentObject.activeDataSource.subscrDataSource.rawConnectionType&&!0!==b.data.currentObject.activeDataSource.subscrDataSource.rawModemDialEnable};b.checkNodataIdleTimeEnabled=function(){return f.checkUndefinedNull(b.data.currentObject)||f.checkUndefinedNull(b.data.currentObject.activeDataSource)||f.checkUndefinedNull(b.data.currentObject.activeDataSource.subscrDataSource)?!1:"CLIENT"===b.data.currentObject.activeDataSource.subscrDataSource.rawConnectionType&&
!0===b.data.currentObject.activeDataSource.subscrDataSource.rawModemDialEnable};$(document).ready(function(){$("#inputVerificationInterval").inputmask();$("#inputVerificationDate").datepicker({dateFormat:"dd.mm.yy",firstDay:b.dateOptsParamsetRu.locale.firstDay,dayNamesMin:b.dateOptsParamsetRu.locale.daysOfWeek,monthNames:b.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display",
"table")},1)}});$("#inputAttemptsNumberShd").inputmask()});b.setInputTikCostMask=function(){$("#inputTikCost").inputmask()};$("#showDeviceModal").on("shown.bs.modal",function(){$("#inputDeviceModel").focus()});$("#showDeviceModal").on("hidden.bs.modal",function(){H()})}]);app=angular.module("portalNMC");
app.controller("MngmtModemsCtrl",["$rootScope","$scope","$http","objectSvc","notificationFactory","crudGridDataFactory","mainSvc",function(a,b,d,h,g,k,f){function n(){d.get(b.ctrlSettings.modemsIdentityUrl).then(function(a){b.data.modemIdentities=a.data},function(a){console.log(a)})}a.ctxId="management_rma_modems_page";b.extraProps={idColumnName:"id",defaultOrderBy:"rawModemModelName",nameColumnName:"rawModemModelName"};b.orderBy={field:b.extraProps.defaultOrderBy,asc:!0};b.ctrlSettings={};b.ctrlSettings.rmaUrl=
"../api/rma";b.ctrlSettings.modemsUrl=b.ctrlSettings.rmaUrl+"/dataSources/rawModemModels";b.ctrlSettings.modemsIdentityUrl=b.ctrlSettings.modemsUrl+"/rawModemModelIdentity";b.headers={};b.ctrlSettings.modemColumns=[{name:"rawModemModelName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-xs-3 col-md-3",type:"name"},{name:"rawModemTypeCaption",caption:"\u0422\u0438\u043f","class":"col-xs-3 col-md-3"},{name:"rawModemModelDescription",caption:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",
"class":"col-xs-2 col-md-2"},{name:"isDialup",caption:"\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430 \u0430\u0432\u0442\u043e\u0434\u043e\u0437\u0432\u043e\u043d\u0430","class":"col-xs-1 col-md-1",type:"checkbox"}];b.data={};b.data.modems=[];b.data.currentModem={};b.data.modemTypes=[{keyname:"GPRS-MODEM",caption:"GPRS-\u043c\u043e\u0434\u0435\u043c"},{keyname:"ETHERNET-CONVERTER",caption:"Ethernet-\u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0435\u0440"}];b.data.modemIdentities=[];var l=function(){d.get(b.ctrlSettings.modemsUrl).then(function(a){!f.checkUndefinedNull(a.data)&&
angular.isArray(a.data)&&0<a.data.length&&(a.data.forEach(function(a){f.checkUndefinedNull(a.rawModemType)||b.data.modemTypes.some(function(b){if(b.keyname==a.rawModemType)return a.rawModemTypeCaption=b.caption,!0})}),b.data.modems=a.data)},function(a){console.log(a)})};b.selectModem=function(a){b.data.currentModem=a};b.selectedItem=function(a){a=angular.copy(a);b.data.currentModem=a};b.addModem=function(){b.data.currentModem={};b.data.currentModem.rawModemType=b.data.modemTypes[0].keyname;b.data.currentModem.rawModemModelIdentity=
b.data.modemIdentities[0].keyname;$("#showModemOptionModal").modal()};b.setOrderBy=function(a){b.orderBy={field:a,asc:b.orderBy.field===a?!b.orderBy.asc:!0}};var m=function(a,b){g.success();$("#deleteModemModal").modal("hide");$("#showModemOptionModal").modal("hide");l()},e=function(a){a=f.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};b.sendModemToServer=function(a){var c=!0;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.rawModemModelName)||null==a.rawModemModelName||""==
a.rawModemModelName)g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043c\u043e\u0434\u0435\u043b\u0438 \u043c\u043e\u0434\u0435\u043c\u0430!"),c=!1;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.rawModemModelIdentity)||null==a.rawModemModelIdentity||""==a.rawModemModelIdentity)g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0432\u0438\u0434 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438!"),
c=!1;0!=c&&(c=b.ctrlSettings.modemsUrl,angular.isDefined(a.id)&&null!=a.id?b.updateObject(c,a):b.saveNewModem(c,a))};b.saveNewModem=function(a,b){k(a).save(b,m,e)};b.deleteObject=function(a){k(b.ctrlSettings.modemsUrl)["delete"]({id:a[b.extraProps.idColumnName]},m,e)};b.updateObject=function(a,d){var c={id:d[b.extraProps.idColumnName]};k(a).update(c,d,m,e)};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=f.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.isSystemuser=
function(){return f.isSystemuser()};b.initCtrl=function(){n();l()};b.initCtrl()}]);app=angular.module("portalNMC");
app.controller("MngmtObjectsCtrl",["$scope","$rootScope","$routeParams","$resource","$cookies","$compile","$parse","crudGridDataFactory","notificationFactory","$http","objectSvc","mainSvc","$timeout","$window",function(a,b,d,h,g,k,f,n,l,m,e,c,q,t){function u(){I()}function v(){var b=a.currentObject.contManagementId,d=!1;a.data.cmOrganizations.some(function(a){if(a.id==b)return d=!0});0==d&&e.getCmOrganizationsWithId(b).then(function(b){a.data.cmOrganizations=b.data;c.sortOrganizationsByName(a.data.cmOrganizations)},
function(a){console.log(a)})}function x(b){var e=document.getElementById("obj"+b.id);if(!angular.isUndefined(e)&&null!==e){var e=e.getElementsByClassName("nmc-tr-zpoint")[0],d="",d=d+('<td class="nmc-td-for-button-object-control" ng-hide="!objectCtrlSettings.extendedInterfaceFlag"></td><td></td><td style="padding-top: 2px !important;"><table id="zpointTable'+b.id+'" class="crud-grid table table-lighter table-bordered table-condensed table-hover nmc-child-object-table">'),d=d+'<thead><tr class="nmc-child-table-header">',
d=d+'<th ng-show="bObject || bList" class="nmc-td-for-button"></th>';a.oldColumns.forEach(function(a){d+='<th class="'+a["class"]+'">';d+=a.header||a.name;d+="</th>"});d+="<th></th>";d+="</tr></thead>";b.zpoints.forEach(function(e){d+='<tr id="trZpoint'+e.id+'" >';d+='<td class="nmc-td-for-button"><div class="btn-group"><i title="\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043d\u0430\u0434 \u0442\u043e\u0447\u043a\u043e\u0439 \u0443\u0447\u0435\u0442\u0430" type="button" class="btn btn-xs glyphicon glyphicon-menu-hamburger nmc-button-in-table dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-size: .9em;"></i><ul class="dropdown-menu"><li><a ng-click="getZpointSettingsEx('+
b.id+","+e.id+')"data-target="#showZpointOptionModal"data-toggle="modal"data-placement="bottom"title="\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0451\u0442\u0430">\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430</a></li><li><a ng-click="getZpointSettingsExpl('+b.id+","+e.id+')"data-target="#showZpointExplParameters"data-toggle="modal"data-placement="bottom"title="\u042d\u043a\u0441\u043f\u043b\u0443\u0430\u0442\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0451\u0442\u0430">\u042d\u043a\u0441\u043f\u043b\u0443\u0430\u0442\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b</a></li><li><a ng-click="openZpointMetadata('+
b.id+","+e.id+')"title="\u041c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430">\u041c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430</a></li></ul></div></td>';a.oldColumns.forEach(function(a){switch(a.name){case "zpointName":var b;switch(e.zpointType){case "cw":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-22-snowflake.png";break;case "hw":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-93-tint.png";
break;case "heat":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-85-heat.png";break;case "gas":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-23-fire.png";break;case "env":b="images/es.png";break;case "el":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-242-flash.png";break;default:b=a.zpointType}d+="<td>";d+="<img class='marginLeft5' height=12 width=12 src=\""+b+"\"> <span class='paddingLeft5'></span>";d+=(e[a.name]||"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e")+
'<span ng-show="isSystemuser()">(id = '+e.id+")</span></td>";break;case "zpointLastDataDate":d+="<td>{{"+e[a.name]+" | date: 'dd.MM.yyyy HH:mm'}}</td>";break;case "zpointRefRange":d+='<td id="zpointRefRange'+e.id+'"></td>';break;default:d+="<td>"+(c.checkUndefinedNull(e[a.name])?"":e[a.name])+"</td>"}});d+="<td>";d+='<div class="btn-toolbar"><div class="btn-group pull-right"><i title="\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443 \u0443\u0447\u0435\u0442\u0430" class="btn btn-xs glyphicon glyphicon-trash nmc-button-in-table" ng-click="deleteZpointInit('+
b.id+","+e.id+')" data-target="#deleteZpointModal" data-toggle="modal"></i></div></div>';d+="</td>";d+="</tr>"});d+="</table></td>";e.innerHTML=d;k(e)(a)}}function w(){var b=a.zpointSettings.contManagementId,d=!1;a.data.rsoOrganizations.some(function(a){if(a.id==b)return d=!0});0==d&&e.getRsoOrganizationsWithId(b).then(function(b){a.data.rsoOrganizations=b.data;c.sortOrganizationsByName(a.data.rsoOrganizations)},function(a){console.log(a)})}function p(b){a.objectCtrlSettings.objectModalWindowTabs.forEach(function(a){var c,
e;c=document.getElementById(a.name)||null;e=document.getElementById(a.tabpanel)||null;0!==a.name.localeCompare(b)?(c.classList.remove("active"),e.classList.remove("active")):(c.classList.add("active"),e.classList.add("in"),e.classList.add("active"))})}function y(b){var c=[],e=[],d=null;a.data.buildingCategories.forEach(function(a){a.buildingType===b&&c.push(angular.copy(a))});c.forEach(function(b){a.data.buildingCategories.forEach(function(a){a.parentCategory===b.keyname&&(d=angular.copy(a),d.parentCategoryCaption=
b.caption,e.push(d))})});a.data.preparedBuildingCategoryList=e}function F(){var b=null;a.data.preparedBuildingCategoryList.some(function(c){if(c.keyname===a.currentObject.buildingTypeCategory)return b=c,!0});null!==b&&50<=b.caption.length?($("#inputBuildingCategory").removeClass("nmc-select-form"),$("#inputBuildingCategory").addClass("nmc-select-form-high")):($("#inputBuildingCategory").removeClass("nmc-select-form-high"),$("#inputBuildingCategory").addClass("nmc-select-form"));if(c.checkUndefinedNull(a.currentObject.buildingTypeCategory))return!1}
function G(){a.currentZpoint.metaData.metaData.forEach(function(b){var e=null,d="";a.currentZpoint.metaData.srcProp.some(function(a){if(b.srcProp===a.columnName)return e=a,!0});if(c.checkUndefinedNull(e)||c.checkUndefinedNull(e.deviceMapping)||c.checkUndefinedNull(e.deviceMappingInfo))return!1;b.haveToolTip=!0;var d=d+("<b>\u042f\u0447\u0435\u0439\u043a\u0430 \u043f\u0430\u043c\u044f\u0442\u0438 \u043f\u0440\u0438\u0431\u043e\u0440\u0430:</b> "+e.deviceMapping+"<br><br>"),d=d+("<b>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435:</b> <br> "+
e.deviceMappingInfo),r="#srcHelpBtn"+b.metaOrder+"srcProp";c.setToolTip("\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430",d,r,r,10,500)})}b.ctxId="management_rma_objects_page";a.messages={};a.messages.signClientsObjects="\u041d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u043e\u0432";a.messages.deleteObjects="\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b";
a.messages.deleteObject="\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442";a.messages.viewProps="\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0430";a.messages.addZpoint="\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443 \u0443\u0447\u0435\u0442\u0430";a.messages.setClient="\u041d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u043e\u0432";a.messages.viewDevices=
"\u041f\u0440\u0438\u0431\u043e\u0440\u044b";a.messages.markAllOn="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435";a.messages.markAllOff="\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435";a.messages.moveToNode="\u041f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c \u043a \u0443\u0437\u043b\u0443";a.messages.releaseFromNode="\u041e\u0442\u0432\u044f\u0437\u0430\u0442\u044c \u043e\u0442 \u0443\u0437\u043b\u0430";a.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";
a.messages.loadIndicators="\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f";a.messages.noObjects="\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";a.crudTableName=e.getObjectsUrl();a.objectCtrlSettings={};a.objectCtrlSettings.isCtrlEnd=!1;a.objectCtrlSettings.allSelected=!1;a.objectCtrlSettings.anySelected=!1;a.objectCtrlSettings.anyClientSelected=!1;a.objectCtrlSettings.objectsPerScroll=e.OBJECT_PER_SCROLL;a.objectCtrlSettings.objectsOnPage=
a.objectCtrlSettings.objectsPerScroll;a.objectCtrlSettings.vzletSystemList=[];a.objectCtrlSettings.extendedInterfaceFlag=!0;a.objectCtrlSettings.serverTimeZone=3;a.objectCtrlSettings.dateFormat="DD.MM.YYYY";a.objectCtrlSettings.ctxId="management_objects_2nd_menu_item";a.objectCtrlSettings.rmaUrl="../api/rma";a.objectCtrlSettings.clientsUrl="../api/rma/subscribers";a.objectCtrlSettings.subscrObjectsSuffix="/subscrContObjects";a.objectCtrlSettings.tempSchBaseUrl="../api/rma/temperatureCharts/byContObject";
var C=function(){c.getContextIds().forEach(function(a){var b=document.getElementById(a.permissionTagId);angular.isUndefined(b)||null==b||$("#"+a.permissionTagId).removeClass("nmc-hide")})};C();b.$on("servicePermissions:loaded",function(){C()});a.data={};a.data.currentGroupId=null;a.object={};a.objects=[];a.objectsOnPage=[];a.currentSug=null;a.groupUrl="../api/subscr/contGroup";var H=function(b){if(c.checkUndefinedNull(b))return"moveToObject: object id is undefined or null.";var d=e.findObjectById(Number(b),
a.objects);if(null!=d){d=a.objects.indexOf(d);if(d>a.objectCtrlSettings.objectsOnPage){var r=a.objects.slice(a.objectCtrlSettings.objectsOnPage,d+1);Array.prototype.push.apply(a.objectsOnPage,r);a.objectCtrlSettings.objectsOnPage=d+1}c.checkUndefinedNull(b)||q(function(){var a=document.getElementById("obj"+b);c.checkUndefinedNull(a)||a.scrollIntoView()},50)}},r=function(d){a.messages.noObjects="\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";var r=d.data;a.objects=d.data;var U=
0;a.objects.forEach(function(a){c.checkUndefinedNull(a.contObjectStats)||(U+=a.contObjectStats.contZpointCount)});console.log("\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0442\u043e\u0447\u0435\u043a \u0443\u0447\u0435\u0442\u0430 \u0443 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u044b\u0445 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432: "+U);e.sortObjectsByFullName(a.objects);angular.isUndefined(a.filter)||""===a.filter?
(a.objectsWithoutFilter=a.objects,a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,r=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll),a.objectsOnPage=r,angular.isDefined(g.contObject)&&"null"!==g.contObject&&(a.toggleShowGroupDetails(Number(g.contObject)),g.contObject=null),b.$broadcast("objectSvc:loaded"),c.checkUndefinedNull(a.data.moveToObjectId)||(H(a.data.moveToObjectId),a.data.moveToObjectId=null)):a.searchObjects(a.filter);a.loading=!1},I=function(d){b.$broadcast("objectSvc:requestReloadData",
{contGroupId:a.data.currentGroupId});a.loading=!0;c.checkUndefinedNull(d)||(a.data.moveToObjectId=d);e.getRmaPromise().then(r)};a.objectsDataFilteredByGroup=function(b){a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;c.checkUndefinedNull(b)?(a.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",a.data.currentGroupId=null):(a.messages.groupMenuHeader=b.contGroupName,a.data.currentGroupId=
b.id,a.data.currentGroup=b);I()};a.loading=e.getLoadingStatus();a.columns=[{name:"fullName",header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","class":"col-md-5"},{name:"fullAddress",header:"\u0410\u0434\u0440\u0435\u0441","class":"col-md-5"}];a.captions={loading:"loading",totalElements:"totalElements"};a.extraProps={idColumnName:"id",defaultOrderBy:"fullName",nameColumnName:"fullName"};a.addMode=!1;a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.filter="";a.filterType="";a.bGroupByObject=
!1;a.bObject=!1;a.bList=!0;a.oldColumns=[{name:"zpointName",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-xs-5"},{name:"zpointModel",header:"\u041c\u043e\u0434\u0435\u043b\u044c","class":"col-xs-2"},{name:"zpointNumber",header:"\u041d\u043e\u043c\u0435\u0440","class":"col-xs-2"},{name:"tsNumber",header:"\u0422\u0435\u043f\u043b\u043e\u0441\u0438\u0441\u0442\u0435\u043c\u0430","class":"col-xs-2"}];a.refRange={};a.urlRefRange="../api/subscr/contObjects/";
a.cont_zpoint_setting_mode_check=[{keyname:"summer",caption:"\u041b\u0435\u0442\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"},{keyname:"winter",caption:"\u0417\u0438\u043c\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"}];a.data.metadataSchema=[{header:"\u041f\u043e\u043b\u0435 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a",headClass:"col-xs-3 col-md-3",name:"srcProp",type:"select_src_field"},{header:"\u0414\u0435\u043b\u0438\u0442\u0435\u043b\u044c",headClass:"col-xs-1 col-md-1",name:"srcPropDivision",
type:"input/text",disabled:!1},{header:"\u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430",headClass:"col-xs-1 col-md-1",name:"srcMeasureUnit",type:"select_measure_units",disabled:!1},{header:"\u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f \u043f\u0440\u0438\u0435\u043c\u043d\u0438\u043a\u0430",headClass:"col-xs-1 col-md-1",name:"destMeasureUnit",
type:"select_measure_units",disabled:!1},{header:"\u041f\u043e\u043b\u0435 \u043f\u0440\u0438\u0435\u043c\u043d\u0438\u043a",headClass:"col-xs-1 col-md-1",name:"destProp",type:"input/text",disabled:!0},{header:"\u0424\u0443\u043d\u043a\u0446\u0438\u044f",headClass:"col-xs-1 col-md-1",name:"propFunc",type:"input/text",disabled:!0}];a.toggleAddMode=function(){a.addMode=!a.addMode;a.object={};a.addMode&&a.newIdProperty&&a.newIdValue&&(a.object[a.newIdProperty]=a.newIdValue)};a.toggleEditMode=function(a){a.editMode=
!a.editMode};var B=function(a){var b={};b.id=a.id;b.zpointOrder=a.contServiceType.serviceOrder+a.customServiceName;b.exSystemKeyname=a.exSystemKeyname;b.tsNumber=a.tsNumber;b.exCode=a.exCode;b.version=a.version;b.contObjectId=a.contObjectId;b.startDate=a.startDate;b._activeDeviceObjectId=a._activeDeviceObjectId;b.rsoId=a.rsoId;b.zpointType=a.contServiceType.keyname;b.isManualLoading=a.isManualLoading;b.customServiceName=a.customServiceName;b.contServiceTypeKeyname=a.contServiceTypeKeyname;b.zpointName=
a.customServiceName;b.contZPointComment=a.contZPointComment;"undefined"!=typeof a.rso&&null!=a.rso?(b.zpointRSO=a.rso.organizationFullName||a.rso.organizationName,b.rsoId=a.rsoId):b.zpointRSO="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e";b.checkoutTime=a.checkoutTime;b.checkoutDay=a.checkoutDay;"undefined"==typeof a.doublePipe?b.piped=!1:(b.piped=!0,b.doublePipe=null===a.doublePipe?!1:a.doublePipe,b.singlePipe=!b.doublePipe);"undefined"!=typeof a.deviceObjects&&0<a.deviceObjects.length&&(a.deviceObjects[0].hasOwnProperty("deviceModel")?
b.zpointModel=a.deviceObjects[0].deviceModel.modelName:b.zpointModel="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e",b.zpointNumber=c.checkUndefinedNull(a.deviceObjects[0].number)?"":a.deviceObjects[0].number);b._activeDeviceObjectId=a._activeDeviceObjectId;b.zpointLastDataDate=a.lastDataDate;b.isDroolsDisable=a.isDroolsDisable;b.temperatureChartId=a.temperatureChartId;return b},z=function(a,b){var c=-1;b.some(function(b,e){if(b.id==a)return c=e,!0});return c},K=function(b){var e=B(b.data);l.success();
$("#showZpointOptionModal").modal("hide");var d=z(a.currentObject.id,a.objects),r=z(a.currentObject.id,a.objectsOnPage);-1<d&&"POST"===b.config.method&&(a.objects[d].contObjectStats.contZpointCount+=1);if(!c.checkUndefinedNull(a.currentObject.zpoints)&&angular.isArray(a.currentObject.zpoints)){var N=-1;a.currentObject.zpoints.some(function(b,c){if(b.id===a.zpointSettings.id)return N=c,!0});-1<N?(d=-1,d=z(a.currentObject.id,a.objects),r=z(a.currentObject.id,a.objectsOnPage),-1<d&&(a.objects[d].zpoints[N]=
e,a.objectsOnPage[r].zpoints[N]=e),!0===a.objectsOnPage[r].showGroupDetails&&(c.sortItemsBy(a.objectsOnPage[d].zpoints,"zpointOrder"),x(a.objectsOnPage[r]))):-1<d&&(a.objects[d].zpoints.push(e),!0===a.objectsOnPage[r].showGroupDetails&&(c.sortItemsBy(a.objectsOnPage[d].zpoints,"zpointOrder"),x(a.objectsOnPage[r])))}},O=function(b){l.success();a.objectCtrlSettings.allSelected=!1;a.objects.forEach(function(b){!0===b.selected&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+
".png");b.selected=!1});a.objectsOnPage.forEach(function(b){!0===b.selected&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png");b.selected=!1})},P=function(a,b){var c=z(a,b);-1!=c&&b.splice(c,1)},L=function(a,b){l.success();$("#deleteObjectModal").modal("hide");$("#showObjOptionModal").modal("hide");$("#setClientModal").modal("hide")},J=function(d){b.$broadcast("objectSvc:requestReloadData");a.currentObject._activeContManagement=d._activeContManagement;
e.getZpointsDataByObject(d,"Ex").then(function(a){var b=[];angular.copy(a.data);a=b=a.data.map(function(a){var b;b=a.object;b.lastDataDate=a.lastDataDate;return b});var b=[],e;for(e=0;e<a.length;e+=1){var r=B(a[e]);b[e]=r}c.sortItemsBy(b,"zpointOrder");d.zpoints=b});var r=null,r=z(d.id,a.objects);null!=r&&(a.objects[r]=d);r=null;r=z(d.id,a.objectsOnPage);null!=r&&(a.objectsOnPage[r]=d);L(d,null)},R=function(b){a.getDevices(a.currentObject,!0);$("#deleteDeviceModal").modal("hide");$("#showDeviceModal").modal("hide")},
da=function(b,c){P(a.currentObject.id,a.objects);P(a.currentObject.id,a.objectsOnPage);L(b,null)},T=function(b,c){a.currentObject.deleteObjectIds.forEach(function(b){P(b,a.objects);P(b,a.objectsOnPage)});L(b,null)},ba=function(b){$("#deleteZpointModal").modal("hide");P(a.currentZpoint.id,a.currentObject.zpoints);x(a.currentObject);var c=z(a.currentObject.id,a.objects);-1<c&&(--a.objects[c].contObjectStats.contZpointCount,P(a.currentZpoint.id,a.objects[c].zpoints));L(b,null)},D=function(b){console.log(b);
var e="-1";if(c.checkUndefinedNull(b)||c.checkUndefinedNull(b.data))e="ERR_CONNECTION";c.checkUndefinedNull(b)||c.checkUndefinedNull(b.resultCode)&&(c.checkUndefinedNull(b.data)||c.checkUndefinedNull(b.data.resultCode))||(e=b.resultCode||b.data.resultCode);b=c.getServerErrorByResultCode(e);l.errorInfo(b.caption,b.description);a.zpointSettings.isSaving=!1;c.checkUndefinedNull(a.currentObject)||(a.currentObject.isSaving=!1)},S=function(b){L(b,null);if(0==a.objectCtrlSettings.isTreeView||c.checkUndefinedNull(a.data.currentTree)){if(I(b.id),
!c.checkUndefinedNull(a.data.currentGroupId)&&!c.checkUndefinedNull(a.data.currentGroup)){var e=a.groupUrl,d=a.objects.map(function(a){return a.id});d.push(b.id);n(e).update({contObjectIds:d},a.data.currentGroup,u,D)}}else c.checkUndefinedNull(a.data.selectedNode)||!c.checkUndefinedNull(a.data.selectedNode.type)&&"root"==a.data.selectedNode.type?a.loadTree(a.data.currentTree,b.id):(a.data.selectedNodeForMove=angular.copy(a.data.selectedNode),a.data.treeForMove=angular.copy(a.data.currentTree),a.data.treeForMove.childObjectList.shift(),
a.data.treeForMove.movingObjects=[b.id],c.checkUndefinedNull(b.id)||(a.data.moveToObjectId=b.id),a.moveToNode())};a.addObject=function(b,e){angular.isDefined(e.contManagementId)&&null!=e.contManagementId&&(b+="/?cmOrganizationId="+e.contManagementId);e._daDataSraw=null;c.checkUndefinedNull(a.currentSug)||(e._daDataSraw=JSON.stringify(a.currentSug));n(b).save(e,S,D)};a.deleteObject=function(b){var c=e.getRmaObjectsUrl();angular.isDefined(b)&&angular.isDefined(b.id)&&null!=b.id&&n(c)["delete"]({id:b[a.extraProps.idColumnName]},
da,D)};a.deleteObjects=function(b){var c=e.getRmaObjectsUrl();angular.isDefined(b)&&angular.isDefined(b.id)&&null!=b.id?n(c)["delete"]({id:b[a.extraProps.idColumnName]},da,D):angular.isDefined(b.deleteObjects)&&null!=b.deleteObjects&&angular.isArray(b.deleteObjects)&&n(c)["delete"]({contObjectIds:b.deleteObjectIds},T,D)};a.deleteZpoint=function(b){var c=e.getRmaObjectsUrl()+"/"+a.currentObject.id+"/zpoints";n(c)["delete"]({id:b[a.extraProps.idColumnName]},ba,D)};a.updateObject=function(b,e){var d=
{id:e[a.extraProps.idColumnName]};angular.isDefined(e.contManagementId)&&null!=e.contManagementId&&(d={cmOrganizationId:e.contManagementId});e._daDataSraw=null;c.checkUndefinedNull(a.currentSug)||(e._daDataSraw=JSON.stringify(a.currentSug));n(b).update(d,e,J,D)};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};a.sendObjectToServer=function(b){var c=b.isSaving=!0;a.emptyString(b.fullName)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430!"),
c=!1);a.emptyString(b.timezoneDefKeyname)&&1!=b.isLightForm&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0447\u0430\u0441\u043e\u0432\u043e\u0439 \u043f\u043e\u044f\u0441 \u043e\u0431\u044a\u0435\u043a\u0442\u0430!"),c=!1);a.checkUndefinedNull(b.contManagementId)&&1!=b.isLightForm&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0430\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f!"),
c=!1);a.emptyString(b.currentSettingMode)&&1!=b.isLightForm&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0440\u0435\u0436\u0438\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f!"),c=!1);if(!c)return b.isSaving=!1;c=e.getRmaObjectsUrl();angular.isDefined(b.id)&&null!=b.id?a.updateObject(c,b):a.addObject(c,b)};a.selectedItem=function(b){a.currentObject=angular.copy(b)};var V=function(){a.currentObject.geoState=
"red";a.currentObject.geoStateText="\u041d\u0435 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u0430\u0440\u0442\u0435";if(a.currentObject.isValidGeoPos||!c.checkUndefinedNull(a.currentSug)&&null!=a.currentSug.data.geo_lat&&null!=a.currentSug.data.geo_lon)a.currentObject.geoState="green",a.currentObject.geoStateText="\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u0430\u0440\u0442\u0435"};a.selectedObject=
function(b,d){e.getRmaObject(b).then(function(b){a.currentObject=b.data;angular.isDefined(a.currentObject._activeContManagement)&&null!=a.currentObject._activeContManagement&&(a.currentObject.contManagementId=a.currentObject._activeContManagement.organization.id);v();c.checkUndefinedNull(d)||(a.currentObject.isLightForm=d);c.checkUndefinedNull(a.currentObject.buildingType)||(y(a.currentObject.buildingType),F());V()},function(a){console.log(a)})};var W=function(b,e){m.get(a.objectCtrlSettings.tempSchBaseUrl+
"/"+b).then(function(a){e.tempSchedules=a.data;if(c.checkUndefinedNull(e.temperatureChartId))return"temperatureChartId is null";e.tempSchedules.some(function(a){if(a.id==e.temperatureChartId)return e.tChart=a,!0})},D)};a.selectedZpoint=function(b,c){a.selectedItem(e.findObjectById(b,a.objects));var d=null;angular.isDefined(a.currentObject.zpoints)&&angular.isArray(a.currentObject.zpoints)&&a.currentObject.zpoints.some(function(a){a.id===c&&(d=angular.copy(a))});a.currentZpoint=d};a.toggleShowGroupDetails=
function(b){var d=e.findObjectById(b,a.objects);null!=d&&(b=document.getElementById("zpointTable"+d.id),d.showGroupDetails=1==d.showGroupDetails&&null==b?!0:!d.showGroupDetails,!0===d.showGroupDetails?e.getZpointsDataByObject(d,"/vo").then(function(a){a=angular.copy(a.data);var b=[],e;for(e=0;e<a.length;e+=1){var r=B(a[e]);b[e]=r}c.sortItemsBy(b,"zpointOrder");d.zpoints=b;x(d);a=document.getElementById("btnDetail"+d.id);c.checkUndefinedNull(a)||(a.classList.remove("glyphicon-chevron-right"),a.classList.add("glyphicon-chevron-down"));
d.showGroupDetailsFlag=!d.showGroupDetailsFlag},D):(document.getElementById("obj"+d.id).getElementsByClassName("nmc-tr-zpoint")[0].innerHTML="",b=document.getElementById("btnDetail"+d.id),b.classList.remove("glyphicon-chevron-down"),b.classList.add("glyphicon-chevron-right")))};a.dateFormat=function(b){b=new Date(b+Math.round(36E5*a.objectCtrlSettings.serverTimeZone));return null==b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]).format(a.objectCtrlSettings.dateFormat)};a.onlyNoRead=
!1;a.showRow=function(b){return"undefined"!=typeof b.isRead||a.onlyNoRead?a.onlyNoRead&&a.onlyNoRead!=!b.isRead?!1:!0:!0};a.zpointSettings={};a.addZpoint=function(b){a.selectedItem(b);a.zpointSettings={};c.checkUndefinedNull(g.recentContServiceTypeKeyname)||(a.zpointSettings.contServiceTypeKeyname=g.recentContServiceTypeKeyname,a.changeServiceType(a.zpointSettings));c.checkUndefinedNull(g.recentRsoId)||(a.zpointSettings.rsoId=Number(g.recentRsoId));a.getDevices(b,!1);W(a.currentObject.id,a.zpointSettings)};
a.getZpointSettings=function(b,e){a.selectedZpoint(b,e);if(c.checkUndefinedNull(a.currentZpoint))return"currentZpoint is undefined or null.";var d=angular.copy(a.currentZpoint),r={};r.id=d.id;r.exSystemKeyname=d.exSystemKeyname;r.tsNumber=d.tsNumber;r.exCode=d.exCode;r.version=d.version;r.contObjectId=d.contObjectId;r.startDate=d.startDate;r._activeDeviceObjectId=d._activeDeviceObjectId;r.rsoId=d.rsoId;r.isManualLoading=d.isManualLoading;r.customServiceName=d.customServiceName;r.contServiceTypeKeyname=
d.contServiceTypeKeyname;r.contZPointComment=d.contZPointComment;r.zpointName=d.zpointName;switch(d.zpointType){case "heat":r.zpointType="\u0422\u0435\u043f\u043b\u043e\u0441\u043d\u0430\u0431\u0436\u0435\u043d\u0438\u0435";break;case "hw":r.zpointType="\u0413\u0412\u0421";break;case "cw":r.zpointType="\u0425\u0412\u0421";break;default:r.zpointType=d.zpointType}r.piped=d.piped;r.singlePipe=d.singlePipe;r.doublePipe=d.doublePipe;r.zpointModel=d.zpointModel;r.zpointRSO=d.zpointRSO;r.checkoutTime=d.checkoutTime;
r.checkoutDay=d.checkoutDay;r.isDroolsDisable=d.isDroolsDisable;r.temperatureChartId=d.temperatureChartId;r.winter={};r.summer={};a.zpointSettings=r;a.getDevices(a.currentObject,!1);W(a.currentObject.id,a.zpointSettings)};a.getZpointSettingsEx=function(b,c){a.getZpointSettings(b,c);w()};a.getZpointSettingsExpl=function(b,c){a.getZpointSettings(b,c);var d={},e={},r;n(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").query(function(b){for(r=0;r<b.length;r+=1)"winter"==
b[r].settingMode?d=b[r]:"summer"==b[r].settingMode&&(e=b[r]);a.zpointSettings.winter=d;a.zpointSettings.summer=e})};var Q=function(a){l.success();$("#showZpointOptionModal").modal("hide");$("#showZpointExplParameters").modal("hide")},X=function(b){l.success();n(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").update({id:a.zpointSettings.winter.id},a.zpointSettings.winter,Q,D)};a.emptyString=function(a){return c.checkUndefinedEmptyNullValue(a)};a.checkUndefinedNull=
function(a){return c.checkUndefinedNull(a)};a.updateZpointCommonSettings=function(){var b=a.zpointSettings.isSaving=!0;a.emptyString(a.zpointSettings.customServiceName)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430!"),b=!1);a.emptyString(a.zpointSettings.contServiceTypeKeyname)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0442\u0438\u043f \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430!"),b=!1);a.checkUndefinedNull(a.zpointSettings._activeDeviceObjectId)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043f\u0440\u0438\u0431\u043e\u0440 \u0434\u043b\u044f \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430!"),b=!1);a.checkUndefinedNull(a.zpointSettings.rsoId)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0420\u0421\u041e \u0434\u043b\u044f \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430!"),b=!1);if(!b)return a.zpointSettings.isSaving=!1;c.checkUndefinedNull(a.zpointSettings.tChart)||(a.zpointSettings.temperatureChartId=a.zpointSettings.tChart.id,a.zpointSettings.tChart=null);b=e.getRmaObjectsUrl()+"/"+a.currentObject.id+"/zpoints";angular.isDefined(a.zpointSettings.id)&&null!=a.zpointSettings.id?(b=b+"/"+a.zpointSettings.id,m({url:b,
method:"PUT",data:a.zpointSettings}).then(K,D)):(a.zpointSettings.startDate=Date.now(),m({url:b,method:"POST",data:a.zpointSettings}).then(K,D))};a.updateZpointModeSettings=function(){a.zpointSettings.isSaving=!0;n(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").update({id:a.zpointSettings.summer.id},a.zpointSettings.summer,X,D)};a.searchObjects=function(b){if(!(0>=a.objects.length)){a.objectsOnPage.forEach(function(a){if(1==a.showGroupDetailsFlag){var b=document.getElementById("obj"+
a.id);c.checkUndefinedNull(b)||(b.getElementsByClassName("nmc-tr-zpoint")[0].innerHTML="",b=document.getElementById("btnDetail"+a.id),b.classList.remove("glyphicon-chevron-down"),b.classList.add("glyphicon-chevron-right"))}a.showGroupDetailsFlag=!1});var d=[];angular.isUndefined(b)||""===b?(a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,d=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll)):a.objects.forEach(function(a){angular.isDefined(a.fullName)&&-1!=a.fullName.toUpperCase().indexOf(b.toUpperCase())&&
d.push(a)});a.objectsOnPage=d}};a.changeServiceType=function(b){c.checkUndefinedNull(b.contServiceTypeKeyname)||(g.recentContServiceTypeKeyname=b.contServiceTypeKeyname);if(a.emptyString(b.customServiceName))switch(b.contServiceTypeKeyname){case "heat":b.customServiceName="\u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u043e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u044f";break;default:a.data.serviceTypes.some(function(a){if(a.keyname==b.contServiceTypeKeyname)return b.customServiceName=a.caption,!0})}};
a.changeRso=function(a){c.checkUndefinedNull(a.rsoId)||(g.recentRsoId=a.rsoId)};a.$on("$destroy",function(){window.onkeydown=void 0});window.onkeydown=function(b){var c=document.getElementById("divWithObjectTable");38==b.keyCode?c.scrollTop-=20:40==b.keyCode?c.scrollTop+=20:34==b.keyCode?c.scrollTop+=10*a.objectCtrlSettings.objectsPerScroll:33==b.keyCode?c.scrollTop-=10*a.objectCtrlSettings.objectsPerScroll:b.ctrlKey&&36==b.keyCode?c.scrollTop=0:b.ctrlKey&&35==b.keyCode&&(a.objectCtrlSettings.objectsOnPage<
a.objects.length&&(a.loading=!0,q(function(){a.loading=!1},a.objects.length)),b=a.objects.slice(a.objectCtrlSettings.objectsOnPage,a.objects.length),Array.prototype.push.apply(a.objectsOnPage,b),a.objectCtrlSettings.objectsOnPage+=a.objects.length,a.$apply(),c.scrollTop=c.scrollHeight)};a.addMoreObjects=function(){if(!(0>=a.objects.length)){var b=a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll;b>=a.objects.length&&(b=a.objects.length);var c=a.objects.slice(a.objectCtrlSettings.objectsOnPage,
b);Array.prototype.push.apply(a.objectsOnPage,c);a.objectCtrlSettings.objectsOnPage=b>=a.objects.length?a.objects.length:a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll}};$("#divWithObjectTable").scroll(function(){if(angular.isUndefined(a.filter)||""==a.filter)a.addMoreObjects(),a.$apply()});a.isSystemuser=function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};a.isTestMode=function(){return c.isTestMode()};a.toggleObjects=
function(b){a.objectCtrlSettings.anySelected=b;a.objects.forEach(function(a){a.selected=b});a.objectsOnPage.forEach(function(a){a.selected=b})};a.toggleObject=function(b){var c=!1;a.objectsOnPage.some(function(a){if(1==a.selected)return c=!0});a.objectCtrlSettings.anySelected=c};a.setModeForObjects=function(b){a.settedMode=b;var c=[];!0===a.objectCtrlSettings.allSelected?c=a.objects.map(function(a){return a.id}):a.objectsOnPage.forEach(function(a){!0===a.selected&&c.push(a.id)});var d=e.getObjectsUrl()+
"/settingModeType";m({url:d,method:"PUT",params:{contObjectIds:c,currentSettingMode:b},data:null}).then(O,D)};a.getDevices=function(b,d){e.getDevicesByObject(b).then(function(e){e=e.data;e.forEach(function(a){angular.isDefined(a.contObjectInfo)&&null!=a.contObjectInfo&&(a.contObjectId=a.contObjectInfo.contObjectId);angular.isDefined(a.activeDataSource)&&null!=a.activeDataSource&&(a.subscrDataSourceId=a.activeDataSource.subscrDataSource.id,a.curDatasource=a.activeDataSource.subscrDataSource,a.subscrDataSourceAddr=
a.activeDataSource.subscrDataSourceAddr,a.dataSourceTable1h=a.activeDataSource.dataSourceTable1h,a.dataSourceTable24h=a.activeDataSource.dataSourceTable24h);var b=a.deviceModel.modelName||"",b=b+(a.number?", \u2116"+a.number:"");a.devCaption=b});b.devices=e;a.selectedItem(b);!c.checkUndefinedNull(b.devices)&&0<b.devices.length&&c.checkUndefinedNull(a.zpointSettings._activeDeviceObjectId)&&(a.zpointSettings._activeDeviceObjectId=b.devices[0].id);1==d&&$("#contObjectDevicesModal").modal()},D)};a.invokeHelp=
function(){alert("This is SPRAVKA!!!111")};var ca=function(b){a.confirmCode=null;b=c.getConfirmCode(b);a.confirmLabel=b.label;a.sumNums=b.result};a.deleteObjectInit=function(b){a.selectedItem(b);ca()};a.deleteZpointInit=function(b,c){a.selectedZpoint(b,c);a.deleteObjectInit(a.currentObject)};a.addObjectInit=function(b){a.currentObject={};a.currentObject.isLightForm=b;c.checkUndefinedNull(g.recentTimezone)||(a.currentObject.timezoneDefKeyname=g.recentTimezone);c.checkUndefinedNull(g.recentContManagementId)||
(a.currentObject.contManagementId=Number(g.recentContManagementId));c.checkUndefinedNull(g.recentSettingMode)||(a.currentObject.currentSettingMode=g.recentSettingMode);c.checkUndefinedNull(g.recentBuildingType)||(a.currentObject.buildingType=g.recentBuildingType,a.changeBuildingType(a.currentObject.buildingType));c.checkUndefinedNull(g.recentBuildingTypeCategory)||(a.currentObject.buildingTypeCategory=g.recentBuildingTypeCategory);V();$("#showObjOptionModal").modal();$("#showObjOptionModal").css("z-index",
"1041")};a.changeTimeZone=function(){c.checkUndefinedNull(a.currentObject.timezoneDefKeyname)||(g.recentTimezone=a.currentObject.timezoneDefKeyname)};a.changeContManagement=function(){c.checkUndefinedNull(a.currentObject.contManagementId)||(g.recentContManagementId=a.currentObject.contManagementId)};a.changeSettingMode=function(){c.checkUndefinedNull(a.currentObject.currentSettingMode)||(g.recentSettingMode=a.currentObject.currentSettingMode)};a.getDeviceModels=function(){e.getDeviceModels().then(function(b){a.data.deviceModels=
b.data},D)};a.getDeviceModels();(function(b){m.get(b).then(function(b){a.data.dataSources=b.data;c.sortItemsBy(a.data.dataSources,"dataSourceName")},D)})(e.getDatasourcesUrl());a.deviceDatasourceChange=function(){a.currentDevice.dataSourceTable1h=null;a.currentDevice.dataSourceTable24h=null;var b=a.currentDevice.subscrDataSourceAddr=null;a.data.dataSources.some(function(c){if(c.id===a.currentDevice.subscrDataSourceId)return b=c,!0});a.currentDevice.curDatasource=b};a.selectDevice=function(b){a.currentDevice=
angular.copy(b)};a.addDevice=function(){a.currentDevice={};a.currentDevice.contObjectId=a.currentObject.id;$("#showDeviceModal").modal()};a.deleteDeviceInit=function(b){ca();a.selectDevice(b)};a.deleteObjectsInit=function(){ca();a.currentObject={};var b=[];if(1==a.objectCtrlSettings.allSelected)b=a.objects,a.currentObject.deleteObjects=angular.copy(a.objects),a.currentObject.deleteObjectIds=a.objects.map(function(a){return a.id}),a.currentObject.countDeleteObjects=a.objects.length,$("#deleteObjectModal").modal();
else{var b=a.objectsOnPage,c=0,d=[],e=[];b.forEach(function(a){1==a.selected&&(d.push(angular.copy(a)),e.push(a.id),c+=1)});0<c&&(a.currentObject.deleteObjects=d,a.currentObject.deleteObjectIds=e,a.currentObject.countDeleteObjects=c,$("#deleteObjectModal").modal())}};a.saveDevice=function(a){var b=!0;null==a.contObjectId&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043e\u0431\u044a\u0435\u043a\u0442 \u0443\u0447\u0435\u0442\u0430"),b=!1);null==
a.subscrDataSourceId&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445"),b=!1);!1!==b&&e.sendDeviceToServer(a).then(R,D)};a.deleteDevice=function(a){var b=e.getRmaObjectsUrl(),b=b+"/"+a.contObjectInfo.contObjectId+"/deviceObjects/"+a.id;m["delete"](b).then(R,D)};var E=function(a){a=angular.copy(a);a=a.sort();for(var b=a.length;2<=b;)--b,a[b]==a[b-1]&&a.splice(b,1);
return a},fa=function(a,b){var c=angular.copy(b);m.get(a).then(function(b){b=b.data.map(function(a){return a.id});Array.prototype.push.apply(c,b);c=E(c);m.put(a,c).then(S,D)},function(a){console.log(a)})};a.setClientsInit=function(b){a.currentObject={};a.data.clientsOnPage=angular.copy(a.data.clients);c.checkUndefinedNull(b)?$("#setClientModal").modal():(a.selectedItem(b),a.objectCtrlSettings.isSetClientForOneObject=!0,e.getRmaObjectSubscribers(b.id).then(function(b){if(!angular.isArray(b.data))return $("#setClientModal").modal(),
"Object subscribers array is empty.";b.data.forEach(function(b){a.data.clientsOnPage.some(function(a){if(b==a.id)return a.selected=!0,a.selectionDisabled=!0})});$("#setClientModal").modal()},function(a){console.log(a)}))};var ga=function(){var b=[];1==a.objectCtrlSettings.allSelected?a.objects.forEach(function(a){1==a.selected&&(b.push(a.id),a.selected=!1)}):a.objectsOnPage.forEach(function(a){1==a.selected&&(b.push(a.id),a.selected=!1)});return b};a.setClients=function(){var b=[];1==a.objectCtrlSettings.isSetClientForOneObject?
(b.push(a.currentObject.id),a.objectCtrlSettings.isSetClientForOneObject=!1):(b=ga(),a.objectCtrlSettings.anySelected=!1);a.data.clientsOnPage.forEach(function(c){null!=c.id&&"undefined"!=typeof c.id&&1==c.selected&&1!=c.selectionDisabled&&fa(a.objectCtrlSettings.rmaUrl+"/"+c.id+a.objectCtrlSettings.subscrObjectsSuffix,b)})};a.selectAllClients=function(){a.data.clientsOnPage.forEach(function(b){1!=b.selectionDisabled&&(b.selected=a.objectCtrlSettings.selectedAllClients)});a.objectCtrlSettings.anyClientSelected=
a.objectCtrlSettings.selectedAllClients};a.selectClient=function(){var b=!1;a.data.clientsOnPage.some(function(a){if(1==a.selected&&1!=a.selectionDisabled)return b=!0});a.objectCtrlSettings.anyClientSelected=b};a.objectCtrlSettings.objectModalWindowTabs=[{name:"main_object_properties_tab",tabpanel:"main_object_properties"},{name:"extra_object_properties_tab",tabpanel:"extra_object_properties"}];a.checkEmptyNullValue=function(a){return""===a||null==a?!0:!1};a.checkNumericValue=function(b){return a.checkEmptyNullValue(b)?
!0:isNaN(parseFloat(b))||!isFinite(b)?!1:!0};a.checkPositiveNumberValue=function(b){var c;c=a.checkNumericValue(b);return c?c=0<=parseInt(b,10)?!0:!1:c};a.isPositiveNumberValue=function(a){return c.isPositiveNumberValue(a)};a.checkNumericInterval=function(b,c){return a.checkEmptyNullValue(b)||a.checkEmptyNullValue(c)||!a.checkNumericValue(b)||!a.checkNumericValue(c)?!1:parseInt(c,10)>=parseInt(b,10)?!0:!1};a.checkHHmm=function(a){return/(0[0-9]|1[0-9]|2[0-3]){1,2}:([0-5][0-9]){1}/.test(a)?!0:!1};
a.checkZpointSettingsFrom=function(b){return null!=b&&b.hasOwnProperty("summer")&&b.hasOwnProperty("winter")?a.checkPositiveNumberValue(b.summer.ov_BalanceM_ctrl)&&a.checkPositiveNumberValue(b.winter.ov_BalanceM_ctrl)&&a.checkHHmm(b.summer.ov_Worktime)&&a.checkHHmm(b.winter.ov_Worktime)&&a.checkPositiveNumberValue(b.summer.leak_Gush)&&a.checkPositiveNumberValue(b.winter.leak_Gush)&&a.checkPositiveNumberValue(b.summer.leak_Night)&&a.checkPositiveNumberValue(b.winter.leak_Night)&&a.checkNumericInterval(b.summer.wm_deltaT_min,
b.summer.wm_deltaT_max)&&a.checkNumericInterval(b.summer.wm_deltaQ_min,b.summer.wm_deltaQ_max)&&a.checkNumericInterval(b.winter.wm_deltaT_min,b.winter.wm_deltaT_max)&&a.checkNumericInterval(b.winter.wm_deltaQ_min,b.winter.wm_deltaQ_max)&&a.checkNumericInterval(b.summer.wm_P2_min,b.summer.wm_P2_max)&&a.checkNumericInterval(b.summer.wm_P1_min,b.summer.wm_P1_max)&&a.checkNumericInterval(b.winter.wm_P2_min,b.winter.wm_P2_max)&&a.checkNumericInterval(b.winter.wm_P1_min,b.winter.wm_P1_max)&&a.checkNumericInterval(b.summer.wm_T2_min,
b.summer.wm_T2_max)&&a.checkNumericInterval(b.summer.wm_T1_min,b.summer.wm_T1_max)&&a.checkNumericInterval(b.winter.wm_T2_min,b.winter.wm_T2_max)&&a.checkNumericInterval(b.winter.wm_T1_min,b.winter.wm_T1_max)&&a.checkNumericInterval(b.summer.wm_M2_min,b.summer.wm_M2_max)&&a.checkNumericInterval(b.summer.wm_M1_min,b.summer.wm_M1_max)&&a.checkNumericInterval(b.winter.wm_M2_min,b.winter.wm_M2_max)&&a.checkNumericInterval(b.winter.wm_M1_min,b.winter.wm_M1_max):!0};a.checkObjectPropertiesForm=function(b){return null!=
b&&b.hasOwnProperty("cwTemp")&&b.hasOwnProperty("heatArea")?a.checkNumericValue(b.cwTemp)&&a.checkNumericValue(b.heatArea):!0};$(document).ready(function(){$("#inputTSNumber").inputmask();$("#inputEXCode").inputmask();$("#inputObjAddress").suggestions({serviceUrl:"https://dadata.ru/api/v2",token:"f9879c8518e9c9e794ff06a6e81eebff263f97d5",type:"ADDRESS",count:10,onSelect:function(b){a.currentObject.fullAddress=b.value;a.currentSug=b;a.currentObject.isAddressAuto=!0;V();a.$apply()},onSearchComplete:function(a,
b){}});$("#inputObjAddress").change(function(){a.currentSug=null;a.currentObject.isAddressAuto=!1;a.currentObject.isValidGeoPos=!1;V();a.$apply()})});$("#showZpointOptionModal").on("hidden.bs.modal",function(){a.zpointSettings={}});$("#showZpointExplParameters").on("hidden.bs.modal",function(){a.zpointSettings={}});$("#showObjOptionModal").on("hidden.bs.modal",function(){a.currentObject.isSaving=!1;a.currentSug=null;p("main_object_properties_tab")});a.zpointMetadataIntegratorsFlag=!1;a.openZpointMetadata=
function(b,c){a.selectedZpoint(b,c);e.getZpointMetaSrcProp(b,c).then(function(d){d.data.forEach(function(a){a.title="\u0425\u0438\u043d\u0442 \u0434\u043b\u044f "+a.columnName});a.currentZpoint.metaData={};a.currentZpoint.metaData.srcProp=d.data;a.currentZpoint.metaData.srcProp.push({columnName:"",title:"\u041f\u0443\u0441\u0442\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430"});e.getZpointMetaDestProp(b,c).then(function(d){a.currentZpoint.metaData.destProp=d.data;e.getZpointMetaMeasureUnits(b,c)},
D)},D)};a.$on("objectSvc:zpointMetadataMeasuresLoaded",function(){a.currentZpoint.metaData.measures=e.getZpointMetadataMeasures();e.getZpointMetadata(a.currentZpoint.contObjectId,a.currentZpoint.id).then(function(b){c.sortItemsBy(b.data,"destProp");a.currentZpoint.metaData.metaData=b.data;$("#metaDataEditorModal").modal()},D)});a.updateZpointMetaData=function(a){e.saveZpointMetadata(a.contObjectId,a.id,a.metaData.metaData).then(function(a){$("#metaDataEditorModal").modal("hide");l.success()},D)};
a.log=function(a){console.log(a)};a.showMetaSrcHelp=function(b,d,e,r){console.log(r);if(c.checkUndefinedNull(b)||c.checkUndefinedNull(a.currentZpoint.metaData.srcProp))return"Input params is incorrect!";var N=null;r="";console.log(b);console.log(a.currentZpoint.metaData.srcProp);a.currentZpoint.metaData.srcProp.some(function(a){if(b===a.columnName)return N=a,!0});console.log(N);if(c.checkUndefinedNull(N))return!1;r="\u041f\u043e\u043b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430: "+N.deviceMapping+
"<br>";r="\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435: <br> "+N.deviceMappingInfo;d="#srcHelpBtn"+d+e;c.setToolTip("\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430",r,d,d,10,500)};a.viewFullObjectList=function(){a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;a.data.currentTree=null;a.data.selectedNode=null;a.objectCtrlSettings.isFullObjectView=!0;a.messages.treeMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";
I()};a.objectCtrlSettings.isTreeView=!0;a.objectCtrlSettings.isFullObjectView=!1;a.data.trees=[];a.data.currentTree={};a.data.newTree={};a.data.defaultTree=null;a.data.selectedNode=null;a.selectNode=function(b){var d=a.data.currentTree,p=a.data.selectedNode;if(!c.checkUndefinedNull(p)){if(p.id==b.id||p.type==b.type=="root")return;d=c.findNodeInTree(p,d);c.checkUndefinedNull(d)||(d.isSelected=!1)}b.isSelected=!0;a.data.selectedNode=angular.copy(b);a.loading=!0;"root"==b.type?e.loadSubscrFreeObjectsByTree(a.data.currentTree.id).then(r):
e.loadSubscrObjectsByTreeNode(a.data.currentTree.id,b.id).then(r)};a.loadTree=function(d,r){a.loading=!0;c.checkUndefinedNull(r)||(a.data.moveToObjectId=r);e.loadSubscrTree(d.id).then(function(e){a.messages.treeMenuHeader=d.objectName||d.id;e=angular.copy(e.data);c.sortTreeNodesBy(e,"objectName");a.data.currentTree=e;a.data.selectedNode=null;a.objects=[];a.objectsOnPage=[];a.loading=!1;b.$broadcast("objectSvc:loaded");a.messages.noObjects="";c.checkUndefinedNull(a.data.moveToObjectId)||(H(a.data.moveToObjectId),
a.data.moveToObjectId=null)},D)};var Y=function(b){a.treeLoading=!0;e.loadSubscrTrees().then(function(d){a.treeLoading=!1;c.sortItemsBy(d.data,"objectName");a.data.trees=angular.copy(d.data);c.checkUndefinedNull(b)||1!=b.isActive||(a.data.defaultTree=c.findItemBy(a.data.trees,"id",Number(b.value)));if(!angular.isArray(a.data.trees)||0>=a.data.trees.length||c.checkUndefinedNull(a.data.defaultTree))return a.viewFullObjectList(),"View full object list!";a.loadTree(a.data.defaultTree)},D)},Z=function(b){a.objectCtrlSettings.isTreeView=
b.data.isActive;Y(b.data)};a.toggleTreeView=function(){a.objectCtrlSettings.isTreeView=!a.objectCtrlSettings.isTreeView;a.data.currentGroupId=null;0==a.objectCtrlSettings.isTreeView?I():e.loadDefaultTreeSetting().then(Z,D)};a.moveToNode=function(){e.putObjectsToTreeNode(a.data.currentTree.id,a.data.selectedNodeForMove.id,a.data.treeForMove.movingObjects).then(function(b){a.loading=!0;"root"==a.data.selectedNode.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(r):e.loadObjectsByTreeNode(a.data.currentTree.id,
a.data.selectedNode.id).then(r)},D)};a.data.buildingTypes=[];a.data.buildingCategories=[];a.data.preparedBuildingCategoryList=[];a.data.buildingCategories=e.getBuildingCategories();a.data.buildingTypes=e.getBuildingTypes();a.$on(e.BROADCASTS.BUILDING_TYPES_LOADED,function(){a.data.buildingTypes=e.getBuildingTypes()});a.$on(e.BROADCASTS.BUILDING_CATEGORIES_LOADED,function(){a.data.buildingCategories=e.getBuildingCategories()});a.changeBuildingType=function(b){a.currentObject.buildingTypeCategory=null;
g.recentBuildingTypeCategory=a.currentObject.buildingTypeCategory;$("#inputBuildingCategory").removeClass("nmc-select-form-high");$("#inputBuildingCategory").addClass("nmc-select-form");if(c.checkUndefinedNull(b))return!1;g.recentBuildingType=b;y(b)};a.changeBuildingCategory=function(){F();g.recentBuildingTypeCategory=a.currentObject.buildingTypeCategory};$("#showTreeOptionModal").on("shown.bs.modal",function(){$("#inputTreeName").focus()});$("#treeLevelModal").on("shown.bs.modal",function(){$("#inputLevelName").focus()});
$("#showObjOptionModal").on("shown.bs.modal",function(){$("#inputContObjectName").focus();$("#inputNumOfStories").inputmask("integer",{min:1,max:200})});$("#showZpointOptionModal").on("shown.bs.modal",function(){$("#inputZpointName").focus()});a.changeMetaToolTips=function(){G()};$("#metaDataEditorModal").on("shown.bs.modal",function(){G()});(function(){e.getRsoOrganizations().then(function(b){a.data.rsoOrganizations=b.data})})();(function(){e.getCmOrganizations().then(function(b){c.sortOrganizationsByName(b.data);
a.data.cmOrganizations=b.data})})();(function(){e.getServiceTypes().then(function(b){a.data.serviceTypes=b.data})})();(function(){e.getTimezones().then(function(b){a.data.timezones=b.data})})();(function(){m.get(a.objectCtrlSettings.clientsUrl).then(function(b){if(c.checkUndefinedNull(b)||c.checkUndefinedNull(b.data)||!angular.isArray(b.data))return!1;b.data.forEach(function(a){if(c.checkUndefinedNull(a.organization))return!1;a.organizationName=a.organization.organizationFullName||a.organization.organizationName});
a.data.clients=b.data},function(a){console.log(a)})})();0==a.objectCtrlSettings.isTreeView?I():e.loadDefaultTreeSetting().then(Z,D)}]);app=angular.module("portalNMC");
app.controller("MngmtOrganizationsCtrl",["$rootScope","$scope","$http","objectSvc","notificationFactory","crudGridDataFactory","mainSvc",function(a,b,d,h,g,k,f){a.ctxId="management_rma_organizations_page";b.extraProps={idColumnName:"id",defaultOrderBy:"organizationName",nameColumnName:"organizationName"};b.orderBy={field:b.extraProps.defaultOrderBy,asc:!0};b.ctrlSettings={};b.ctrlSettings.rmaUrl="../api/rma";b.ctrlSettings.organizationsUrl="../api/rma/organizations";b.headers={};b.ctrlSettings.organizationTypes=
{rso:{caption:"\u0420\u0421\u041e",fullCaption:"\u0420\u0435\u0441\u0443\u0440\u0441\u043e\u0441\u043d\u0430\u0431\u0436\u0430\u044e\u0449\u0430\u044f \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f"},cm:{caption:"\u0423\u041a",fullCaption:"\u0423\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0430\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f"},serv:{caption:"\u0421\u041a",fullCaption:"\u0421\u0435\u0440\u0432\u0438\u0441\u043d\u0430\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f"}};
b.isSystemuser=function(){return f.isSystemuser()};!0===b.isSystemuser()&&(b.ctrlSettings.organizationTypes.rma={caption:"\u0420\u041c\u0410",fullCaption:"\u0420\u0435\u0433\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0435 \u043c\u0435\u0442\u0440\u043e\u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0430\u0433\u0435\u043d\u0441\u0442\u0432\u043e"});b.ctrlSettings.organizationColumns=[{name:"organizationName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",
"class":"col-xs-3 col-md-3",type:"name"},{name:"organizationTypeName",caption:"\u0422\u0438\u043f \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438","class":"col-xs-2 col-md-2"},{name:"organizationDescription",caption:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","class":"col-xs-3 col-md-3"},{name:"organizationFullAddress",caption:"\u041f\u043e\u043b\u043d\u044b\u0439 \u0430\u0434\u0440\u0435\u0441","class":"col-xs-2 col-md-2"}];b.data={};b.data.organizations=[];b.data.currentOrganization=
{};var n=function(){d.get(b.ctrlSettings.organizationsUrl).then(function(a){a=angular.copy(a.data);a.forEach(function(a){if(!0===a.flagCm)return a.organizationType="cm",a.organizationTypeName=b.ctrlSettings.organizationTypes.cm.fullCaption,!0;if(!0===a.flagRso)return a.organizationType="rso",a.organizationTypeName=b.ctrlSettings.organizationTypes.rso.fullCaption,!0;if(!0===a.flagServ)return a.organizationType="serv",a.organizationTypeName=b.ctrlSettings.organizationTypes.serv.fullCaption,!0;if(!0===
a.flagRma)return a.organizationType="rma",a.organizationTypeName=b.ctrlSettings.organizationTypes.rma.fullCaption,!0});b.data.organizations=a},function(a){console.log(a)})};b.selectOrganization=function(a){b.data.currentOrganization=a};b.selectedItem=function(a){a=angular.copy(a);b.data.currentOrganization=a};b.editObjectList=function(a){b.selectedItem(a);b.getAvailableObjects(b.data.currentOrganization.id);b.getSelectedObjects(b.data.currentOrganization.id);b.showAvailableObjects_flag=!1};b.addOrganization=
function(){b.data.currentOrganization={};$("#showOrganizationOptionModal").modal()};b.setOrderBy=function(a){b.orderBy={field:a,asc:b.orderBy.field===a?!b.orderBy.asc:!0}};var l=function(a,b){g.success();$("#deleteOrganizationModal").modal("hide");$("#showOrganizationOptionModal").modal("hide");n()},m=function(a){a=f.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};b.sendOrganizationToServer=function(a){var c=!0;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.organizationName)||
null==a.organizationName||""==a.organizationName)g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438!"),c=!1;if(0!=c){a.flagCm=!1;a.flagRso=!1;a.flagServ=!1;a.flagRma=!1;switch(a.organizationType){case "cm":a.flagCm=!0;break;case "rso":a.flagRso=!0;break;case "serv":a.flagServ=!0;break;case "rma":a.flagRma=!0}c=
b.ctrlSettings.organizationsUrl;angular.isDefined(a.id)&&null!=a.id?b.updateObject(c,a):b.saveNewOrganization(c,a)}};b.saveNewOrganization=function(a,b){k(a).save(b,l,m)};b.deleteObject=function(a){k(b.ctrlSettings.organizationsUrl)["delete"]({id:a[b.extraProps.idColumnName]},l,m)};b.updateObject=function(a,c){var d={id:c[b.extraProps.idColumnName]};k(a).update(d,c,l,m)};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=f.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};
b.isTestMode=function(){return f.isTestMode()};b.initCtrl=function(){n()};b.initCtrl()}]);app=angular.module("portalNMC");app.filter("viewHistory",function(){return function(a,b){if(angular.isArray(a,b)){var d=[];if(b)return a;a.forEach(function(a){angular.isUndefined(a.factEndDate)&&!a.isArchive&&d.push(a)});return d}}});
app.controller("MngmtPriceCtrl",["$rootScope","$scope","$http","mainSvc","notificationFactory","$log",function(a,b,d,h,g,k){a.ctxId="management_rma_price_page";b.messages={};b.messages.priceMenuItem1="\u0410\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c";b.messages.priceMenuItem2="\u041d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u0430\u043c";b.messages.priceMenuItem3="\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0446\u0435\u043d\u044b";
b.messages.priceMenuItem4="\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c";b.messages.priceMenuItem5="\u0423\u0434\u0430\u043b\u0438\u0442\u044c";b.messages.priceMenuItem6="\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430";b.messages.priceMenuItem7="\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0446\u0435\u043d\u044b";b.ctrlSettings={};b.ctrlSettings.dateFormat="DD.MM.YYYY";b.ctrlSettings.modeView=!1;b.ctrlSettings.subscrUrl="../api/subscr";b.ctrlSettings.rmaUrl="../api/rma";
b.ctrlSettings.priceSuffix="/priceList";b.ctrlSettings.clientsUrl="../api/rma/subscribers";b.ctrlSettings.rmaClientsUrl="../api/rma/priceList/rma";b.ctrlSettings.modesUrl="../api/rma/priceList/subscribers";b.ctrlSettings.servicesUrl=b.ctrlSettings.subscrUrl+"/manage/service";b.ctrlSettings.packagesUrl=b.ctrlSettings.servicesUrl+"/servicePackList";b.ctrlSettings.itemsUrl=b.ctrlSettings.servicesUrl+"/serviceItemList";b.ctrlSettings.priceUrl=b.ctrlSettings.servicesUrl+"/servicePriceList";b.ctrlSettings.accountServicesUrl=
b.ctrlSettings.servicesUrl+"/access";b.ctrlSettings.subscriberContObjectCountUrl=b.ctrlSettings.subscrUrl+"/info/subscriberContObjectCount";b.ctrlSettings.MASTER_RMA_ID=0;b.ctrlSettings.priceListColumns=[{name:"priceListName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-xs-3 col-md-3"},{name:"factBeginDate",caption:"\u0414\u0430\u0442\u0430 \u0432\u0432\u043e\u0434\u0430","class":"col-xs-1 col-md-1"},{name:"factEndDate",caption:"\u0414\u0430\u0442\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f",
"class":"col-xs-1 col-md-1"}];b.ctrlSettings.subscriberContObjectCount=null;b.ctrlSettings.currency="";b.availablePackages=null;b.serviceListEdition=null;b.availablePackages=[];b.data={};b.data.currentClient={};b.data.currentPrice={};b.data.currentMode={};b.data.priceModes=[];b.data.clients=[];b.data.clientsAtWindow=[];b.data.prices=[];var f=function(a,c){g.success();$("#deletePriceModal").modal("hide");$("#pricePropModal").modal("hide");$("#clonePriceModal").modal("hide");$("#editPriceModal").modal("hide");
b.data.currentPrice={};l(b.data.currentMode.id)},n=function(a){a=h.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)},l=function(a){d.get(b.ctrlSettings.rmaUrl+"/"+a+b.ctrlSettings.priceSuffix).then(function(a){if(angular.isUndefined(a.data)||null==a.data||!angular.isArray(a.data))return!1;b.data.prices=a.data},n)};b.cloneInit=function(a){b.selectItem(a);b.data.clientsAtWindow=angular.copy(b.data.clients)};b.selectedAllPressed=function(){b.data.selectedAll=!b.data.selectedAll;b.data.clientsAtWindow.forEach(function(a){a.selected=
b.data.selectedAll})};b.activatedAllPressed=function(){b.data.activatedAll=!b.data.activatedAll;b.data.clientsAtWindow.forEach(function(a){a.selected&&(a.activated=b.data.activatedAll)})};b.selectItem=function(a){b.data.currentPrice=angular.copy(a)};b.dblClickPriceList=function(a){b.selectItem(a);$("#pricePropModal").modal()};b.deletePriceInit=function(a){b.selectItem(a);b.confirmCode=null;a=h.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.deletePrice=function(a){d["delete"](b.ctrlSettings.rmaUrl+
"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/"+a.id).then(f,n)};b.savePriceProp=function(a){d.put(b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/"+a.id,a).then(f,n)};b.copyPriceList=function(a){d.post(b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/?srcPriceListId="+a.id,null).then(f,n)};b.clonePriceList=function(){var a=[];b.data.clientsAtWindow.forEach(function(b){b.selected&&a.push(b.id)});var c=[];b.data.clientsAtWindow.forEach(function(a){a.activated&&
c.push(a.id)});if(0==a.length)return g.info("\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u0430!"),1;d({method:"POST",url:b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/"+b.data.currentPrice.id+"/subscr",params:{subscriberIds:a,activeIds:c}}).then(f,n)};b.activatePriceList=function(a){b.selectItem(a);d.put(b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+
"/"+b.data.currentPrice.id+"/activate").then(f,n)};var m=function(a){d.get(a).then(function(a){if(angular.isUndefined(a.data)||null==a.data||!angular.isArray(a.data))return!1;a.data.forEach(function(a){a.organizationName=angular.isDefined(a.organization)&&null!=a.organization?a.organization.organizationFullName:a.subscriberName});b.data.clients=a.data},function(a){console.log(a)})};(function(){d.get(b.ctrlSettings.modesUrl).then(function(a){if(angular.isUndefined(a.data)||null==a.data||!angular.isArray(a.data))return!1;
b.data.priceModes=angular.copy(a.data);b.data.currentMode=angular.copy(b.data.priceModes[0]);l(b.data.currentMode.id);a=b.ctrlSettings.clientsUrl;b.data.currentMode.id==b.ctrlSettings.MASTER_RMA_ID&&(a=b.ctrlSettings.rmaClientsUrl);m(a)},function(a){console.log(a)})})();b.changeMode=function(a){var c=null;b.data.priceModes.some(function(b){if(b.id==a)return c=angular.copy(b),!0});b.data.currentMode=angular.copy(c);l(b.data.currentMode.id);var d=b.ctrlSettings.clientsUrl;b.data.currentMode.id==b.ctrlSettings.MASTER_RMA_ID&&
(d=b.ctrlSettings.rmaClientsUrl);m(d)};b.getSubscriberContObjectCount=function(a){d.get(a).then(function(a){b.ctrlSettings.subscriberContObjectCount=a.data},function(a){console.log(a)})};b.getSubscriberContObjectCount(b.ctrlSettings.subscriberContObjectCountUrl);b.getPriceList=function(a){d.get(a).then(function(a){var c=angular.copy(a.data);if(angular.isUndefined(c)||null==c||!angular.isArray(c))return!1;b.serviceListEdition.forEach(function(a){c.forEach(function(c){c.packId!==a.id||!angular.isUndefined(c.itemId)&&
null!==c.itemId||(a.price=c,b.ctrlSettings.currency=c.currency,angular.isDefined(c.priceValue)&&angular.isNumber(c.priceValue)&&(a.isAvailable=!0))});a.serviceItems.forEach(function(a){c.forEach(function(c){!angular.isUndefined(c.packId)&&null!==c.packId||c.itemId!==a.id||(a.price=c,b.ctrlSettings.currency=c.currency,angular.isDefined(c.priceValue)&&angular.isNumber(c.priceValue)&&(a.isAvailable=!0))})})});b.ctrlSettings.currency="";$("#editPriceModal").modal()},function(a){console.log(a)})};b.getPackages=
function(a){d.get(a).then(function(a){b.availablePackages=a.data},function(a){console.log(a)})};var e=function(a,b){$(a).qtip({suppress:!1,content:{text:b,button:!0},show:{event:"click"},style:{classes:"qtip-nmc-indicator-tooltip",width:1E3},hide:{event:"unfocus"},position:{my:"top left",at:"bottom left"}})};b.getPackages(b.ctrlSettings.packagesUrl);var c=function(a){var c=[];b.serviceListEdition.forEach(function(a){if(angular.isDefined(a.price)&&null!=a.price){if(angular.isUndefined(a.price.id)||
null==a.price.id)a.price.packId=a.id,a.price.priceValue=Number(a.price.priceValue);c.push(a.price)}a.serviceItems.forEach(function(a){if(angular.isDefined(a.price)&&null!=a.price){if(angular.isUndefined(a.price.id)||null==a.price.id)a.price.itemId=a.id,a.price.priceValue=Number(a.price.priceValue);c.push(a.price)}})});return c};b.updatePriceList=function(){var a=b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/"+b.data.currentPrice.id+"/items",e=[],e=c(b.serviceListEdition),
h=!0;e.some(function(a){if(!b.checkNumericValue(a.priceValue))return g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430!","\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u0430 \u0446\u0435\u043d\u0430 \u0443\u0441\u043b\u0443\u0433\u0438!"),h=!1,!0});if(!h)return!1;d.put(a,e).then(f,n)};b.toggleShowGroupDetails=function(a){a.showDetailsFlag=!a.showDetailsFlag};b.editPrice=function(a){b.confirmCode=null;var c=h.getConfirmCode();b.confirmLabel=c.label;
b.sumNums=c.result;b.viewPrice(a,!1)};b.viewPrice=function(a,c){b.ctrlSettings.modeView=c;b.selectItem(a);b.serviceListEdition=angular.copy(b.availablePackages);b.getPriceList(b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/"+b.data.currentPrice.id+"/items")};$("#editPriceModal").on("show.bs.modal",function(a){window.setTimeout(function(){b.availablePackages.forEach(function(a){e("#editpackage"+a.id,a.packDescription);a.serviceItems.forEach(function(a){e("#editservice"+
a.id,a.itemDescription)})});$("input[name='inputPrice']").inputmask()},500)});b.isSystemuser=function(){return h.isSystemuser()};b.checkNumericValue=function(a){return h.checkNumericValue(a)};b.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:b.ctrlSettings.dateFormat};$(document).ready(function(){$("#inputPlanBeginDate").datepicker({dateFormat:"yy-mm-dd",firstDay:b.dateOptsParamsetRu.locale.firstDay,dayNamesMin:b.dateOptsParamsetRu.locale.daysOfWeek,monthNames:b.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputPlanEndDate").datepicker({dateFormat:"yy-mm-dd",
firstDay:b.dateOptsParamsetRu.locale.firstDay,dayNamesMin:b.dateOptsParamsetRu.locale.daysOfWeek,monthNames:b.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});$(document).ready(function(){setTimeout(function(){$(":input").inputmask()},10)});$(document).ready(function(){$("#history-view").bootstrapToggle({on:"\u0434\u0430",
off:"\u043d\u0435\u0442"});$("#history-view").change(function(){b.ctrlSettings.viewHistoryFlag=!!$(this).prop("checked");b.$apply()})});$("#pricePropModal").on("shown.bs.modal",function(){$("#inputName").focus();$("#pricePropModal").keydown(function(a){13==a.keyCode&&(b.savePriceProp(b.data.currentPrice),b.$apply())})});$("#pricePropModal").on("hide.bs.modal",function(){$("#pricePropModal").off("keydown")});b.checkPropBtn=function(a){return!0};b.checkViewBtn=function(a){return!0};b.checkActivateBtn=
function(a){return(b.isSystemuser()&&0!=b.data.currentMode.id||!b.isSystemuser()&&b.isRma()&&!b.data.currentMode.rma)&!a.isActive&&!a.isArchive};b.checkDeleteBtn=function(a){return a.isDraft&&!a.isArchive};b.checkEditBtn=function(a){return a.isDraft&&!a.isArchive};b.checkCopyBtn=function(a){return!a.isArchive};b.checkCloneBtn=function(a){return a.isDraft&&!a.isArchive&&b.data.currentMode.rma}}]);app=angular.module("portalNMC");app.directive("fileread",[function(){return{scope:{fileread:"="},link:function(a,b,d){b.bind("change",function(b){var d=new FileReader;d.onload=function(b){a.$apply(function(){a.fileread=b.target.result})};d.readAsText(b.target.files[0])})}}}]);
app.controller("TempSchCtrl",["$scope","$rootScope","$cookies","$window","$http","$location","crudGridDataFactory","FileUploader","notificationFactory","indicatorSvc","mainSvc","$timeout","objectSvc",function(a,b,d,h,g,k,f,n,l,m,e,c,q){a.ctrlSettings={};a.ctrlSettings.ctxId="temp_sch_page";a.ctrlSettings.dateFormat="DD.MM.YYYY";a.ctrlSettings.systemDateFormat="YYYY-MM-DD";a.ctrlSettings.isTempSchSort=!0;a.ctrlSettings.localPlacesUrl="../api/rma/localPlaces";a.ctrlSettings.tempSchUrl="../api/rma/temperatureCharts";
a.extraProps={idColumnName:"id",defaultOrderBy:"place",nameColumnName:"name"};a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.ctrlSettings.tempSchColumns=[{name:"localPlaceName",caption:"\u041d\u0430\u0441\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u043f\u0443\u043d\u043a\u0442","class":"col-xs-3 col-md-3",type:"name",sortable:!0},{name:"rsoOrganizationName",caption:"\u0420\u0421\u041e","class":"col-xs-4 col-md-4",type:"name",sortable:!0},{name:"chartName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",
"class":"col-xs-3 col-md-3",type:"name",sortable:!0},{name:"flagAdjPump",caption:"\u041a\u043e\u0440. \u043d\u0430\u0441","class":"nmc-td-for-buttons",type:"checkbox",sortable:!1},{name:"flagElevator",caption:"\u042d\u043b\u0435\u0432\u0430\u0442\u043e\u0440","class":"nmc-td-for-buttons",type:"checkbox",sortable:!1}];a.ctrlSettings.sstColumns=[{name:"sstDate",caption:"\u0414\u0430\u0442\u0430","class":"col-xs-3 col-md-3",type:"name",sortable:!0},{name:"sstCalcValue",caption:"\u0420\u0430\u0441\u0447\u0438\u0442\u0430\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435",
"class":"col-xs-4 col-md-4",type:"outnumber",sortable:!0,temperature:!0},{name:"sstValue",caption:"\u0412\u043d\u0435\u0441\u0435\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435","class":"col-xs-4 col-md-4",type:"input",editable:!0,temperature:!0}];a.ctrlSettings.emptySchedule={t_Ambience:"",t_In:"",t_Out:"",isDeleted:!1};a.data={};a.data.currentTempSch={};a.data.currentTempSch.schedules=[angular.copy(a.ctrlSettings.emptySchedule)];a.data.tempSchedules=[];a.data.currentLocalPlace=
{};a.data.aveTemps=[];a.data.rsoOrganizations=[];a.data.localPlaces=[];a.data.currentLocalPlace={};var t=function(a,b){var c=null;b.some(function(b){if(b.id==a)return c=angular.copy(b),!0});return c},u=function(a){a=e.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)},v=function(b){g.get(a.ctrlSettings.tempSchUrl+"/"+b.id+"/items").then(function(a){b.schedules=a.data;b.schedules.forEach(function(a){a.isDeleted=!1})},u)},x=function(){g.get(a.ctrlSettings.tempSchUrl).then(function(b){a.data.tempSchedules=
angular.copy(b.data);a.data.tempSchedules.forEach(function(b){var c=t(b.localPlaceId,a.data.localPlaces);b.localPlaceName=null==c?"\u041d\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043e":c.localPlaceName;c=t(b.rsoOrganizationId,a.data.rsoOrganizations);b.rsoOrganizationName=null==c?"\u041d\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043e":c.organizationName;v(b)})},u)},w=function(){$("#showTempSchModal").modal("hide");$("#deleteWindowModal").modal("hide");x()},p=
function(){q.getRsoOrganizations().then(function(b){a.data.rsoOrganizations=b.data;x()},u)};a.getSST=function(b,d){if(e.checkUndefinedNull(d))return"dateString is undefined or null!";if(e.checkUndefinedNull(b))return"localPlaceId is undefined or null!";g.get(a.ctrlSettings.localPlacesUrl+"/"+b+"/sst?sstDateStr="+d).then(function(b){a.data.aveTemps=b.data;a.orderBy={field:"sstDate",asc:!0};c(function(){$(".nmc-input-numeric").inputmask()},10)},u)};a.saveSST=function(b,c){g.put(a.ctrlSettings.localPlacesUrl+
"/"+b+"/sst/array?sstDateStr="+c,a.data.aveTemps).then(function(d){l.success();a.getSST(b,c)},u)};a.sstKeydown=function(a,b,c){13==a.keyCode&&c<b.length-1&&$("#inputsstValue"+b[c+1].id).focus()};a.selectedItem=function(b){a.confirmCode=null;var c=e.getConfirmCode();a.confirmLabel=c.label;a.sumNums=c.result;a.data.currentTempSch=angular.copy(b)};a.setOrderBy=function(b){if(0==b.sortable)return"The field is not sortable.";a.orderBy={field:b.name,asc:a.orderBy.field===b.name?!a.orderBy.asc:!0}};a.addTempSch=
function(){a.data.currentTempSch={};a.data.currentTempSch.chartDeviationValue=3;a.data.currentTempSch.schedules=[angular.copy(a.ctrlSettings.emptySchedule)]};var y=function(b,c){g.post(a.ctrlSettings.tempSchUrl+"/"+b+"/items",c).then(function(a){},u)},F=function(b,c){g.put(a.ctrlSettings.tempSchUrl+"/"+b+"/items/"+c.id,c).then(function(a){},u)},G=function(b,c){g["delete"](a.ctrlSettings.tempSchUrl+"/"+b+"/items/"+c.id).then(function(a){},u)};a.addSchedule=function(b){b.schedules.push(angular.copy(a.ctrlSettings.emptySchedule));
a.ctrlSettings.isTempSchSort=!1};a.sortSchedulesByTAmbience=function(b){if(!angular.isArray(b))return"Schedules is not array;";e.sortItemsBy(b,"t_Ambience");a.ctrlSettings.isTempSchSort=!0};a.deleteSchedule=function(a,b){var c=e.checkUndefinedNull(a)?-1:a;-1!=c&&b.splice(c,1)};a.delSchItem=function(a){a.isDeleted=!0};a.isNumeric=function(a){return e.isNumeric(a)};a.checkSchRow=function(b){return a.isNumeric(b.t_Ambience)&&""<b.t_In&&""<b.t_Out&&0<Number(b.t_In)&&0<Number(b.t_Out)&&Number(b.t_In)>=
Number(b.t_Out)};a.isAddButtonEnabled=function(a,b){var c=0;b.forEach(function(a){1!=a.isDeleted&&(c+=1)});return a==c-1};a.isRemoveButtonEnabled=function(a){var b=!1,c=0;a.forEach(function(a){1!=a.isDeleted&&(c+=1)});1<c&&(b=!0);return b};var C=function(b){var c=!0;e.checkPositiveNumberValue(b.maxT)||(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u043f\u043e\u043b\u043e\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0447\u0438\u0441\u043b\u043e\u043c!"),
c=!1);e.checkPositiveNumberValue(b.minT)||(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u043f\u043e\u043b\u043e\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0447\u0438\u0441\u043b\u043e\u043c!"),c=!1);Number(b.maxT)<Number(b.minT)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0439!"),
c=!1);e.checkUndefinedEmptyNullValue(b.chartName)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u0435 "\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),c=!1);e.checkUndefinedNull(b.localPlaceId)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u0435 "\u041d\u0430\u0441\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u043f\u0443\u043d\u043a\u0442" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),
c=!1);e.checkUndefinedNull(b.rsoOrganizationId)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u0435 "\u0420\u0421\u041e" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),c=!1);e.checkUndefinedEmptyNullValue(b.chartDeviationValue)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u0435 "\u0414\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e\u0435 \u043e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0438\u0435" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),
c=!1);b.schedules.some(function(b){if(1!=b.isDeleted&&0==a.checkSchRow(b))return l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u043d\u044b\u0439 \u0433\u0440\u0430\u0444\u0438\u043a!"),c=!1,!0});return c},H=function(a){a.t_Ambience=Number(a.t_Ambience);a.t_In=Number(a.t_In);a.t_Out=Number(a.t_Out)},r=function(b){var c=
b.data.id;angular.isArray(a.data.currentTempSch.schedules)&&(a.sortSchedulesByTAmbience(a.data.currentTempSch.schedules),a.data.currentTempSch.schedules.forEach(function(a){1!=a.isDeleted&&(H(a),y(c,a))}));w()},I=function(b){var c=b.data.id;angular.isArray(a.data.currentTempSch.schedules)&&(a.sortSchedulesByTAmbience(a.data.currentTempSch.schedules),a.data.currentTempSch.schedules.forEach(function(a){if(1==a.isDeleted&&!e.checkUndefinedNull(a.id))return G(c,a),"Item (id = "+a.id+") of tempSch ("+
c+") was deleted!";H(a);e.checkUndefinedNull(a.id)?y(c,a):F(c,a)}));w()};a.saveTempSch=function(b,c){if(0==C(b))return"Temperature schedule is not valid!";var d=a.ctrlSettings.tempSchUrl,p="POST",F=r;e.checkUndefinedNull(b.id)||(p="PUT",F=I,d+="/"+b.id,b.localPlaceInfo=null,b.rsoOrganizationInfo=null);e.checkUndefinedNull(c)||(b.isOk=c);g({url:d,method:p,data:b}).then(F,u)};a.isSystemuser=function(){return e.isSystemuser()};a.deleteTempSch=function(b){g["delete"](a.ctrlSettings.tempSchUrl+"/"+b.id).then(w,
u)};a.inputTempBlur=function(a){if(e.checkUndefinedNull(a.maxT)||e.checkUndefinedNull(a.minT))return"Tmax or Tmin is null or undefined";if(e.checkUndefinedNull(a.chartName)||""==a.chartName)a.chartName=a.maxT+"/"+a.minT};var B=!1,z=function(){B=!0},K=function(a){B=!1;$("#"+a.currentTarget.id).off("focus",z)},O=function(b){if(107==b.keyCode||187==b.keyCode)a.addSchedule(a.data.currentTempSch),a.$apply();0==b.shiftKey&&9==b.keyCode&&1==B&&(a.addSchedule(a.data.currentTempSch),a.$apply())};a.scheduleKeydown=
function(b,c,d){13==b.keyCode&&(c==d-1?a.addSchedule(a.data.currentTempSch):$("#inputtAmbience"+(c+1)).focus())};a.initSchedule=function(b){c(function(){$("#inputtAmbience"+b).inputmask();$("#inputtAmbience"+b).focus();$("#inputTIn"+b).inputmask();$("#inputTOut"+b).inputmask();b<a.data.currentTempSch.schedules.length-1||($("#inputTOut"+b).focus(z),$("#inputTOut"+b).blur(K))},10)};$("#showTempSchModal").on("shown.bs.modal",function(){$("#inputTmax").focus();$("#showTempSchModal").keydown(O);$("#inputChartDeviation").inputmask()});
$("#showTempSchModal").on("hidden.bs.modal",function(){$("#showTempSchModal").off("keydown",O)});a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:a.ctrlSettings.dateFormat};$(document).ready(function(){c(function(){$(":input").inputmask()},10);$("#inputSSTDate").datepicker({dateFormat:"MM, yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,monthNamesShort:"\u042f\u043d\u0432 \u0424\u0435\u0432 \u041c\u0430\u0440 \u0410\u043f\u0440 \u041c\u0430\u0439 \u0418\u044e\u043d \u0418\u044e\u043b \u0410\u0432\u0433 \u0421\u0435\u043d \u041e\u043a\u0442 \u041d\u043e\u044f \u0414\u0435\u043a".split(" "),
changeMonth:!0,changeYear:!0,showButtonPanel:!0,closeText:"\u041e\u043a",currentText:"",onClose:function(b,c){$(this).datepicker("setDate",new Date(c.selectedYear,c.selectedMonth,1));a.data.currentSSTDate=moment(new Date(c.selectedYear,c.selectedMonth,1)).format(a.ctrlSettings.systemDateFormat);a.getSST(a.data.currentLocalPlace.id,a.data.currentSSTDate);setTimeout(function(){$(".ui-datepicker-calendar").addClass("nmc-hide")},1)},beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").addClass("nmc-hide");
$(".ui-datepicker-current").addClass("nmc-hide")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-current").addClass("nmc-hide");$(".ui-datepicker-calendar").addClass("nmc-hide")},1)}})});a.uploadFile=function(){if(e.checkUndefinedNull(a.data.dataFile))return l.errorInfo("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u0430","\u0424\u0430\u0439\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d."),"Management temperature schedules. File loading is failed";
var b=!1;a.data.dataFile.split("\n").forEach(function(c){var d=c.split(",");if(!angular.isArray(d))return console.log(c+" is not a correct data string!"),c+" is not a correct data string!";var r=new Date('"'+d[0]+'"');a.data.aveTemps.some(function(a){var c=new Date('"'+a.sstDate+'"');if(r.getTime()==c.getTime())return c=d[1],e.isNumeric(c)?(a.sstValue=Number(c),b=a.isChanged=!0):console.log(c+" is not a number"),!0})});1==b?l.successInfo("\u0424\u0430\u0439\u043b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d."):
l.errorInfo("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u0444\u0430\u0439\u043b\u0430");$("#upLoadFileModal").modal("hide")};a.uploadFileAlter=function(){if(e.checkUndefinedNull(a.data.dataFile))return l.errorInfo("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u0430","\u0424\u0430\u0439\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d."),
"Management temperature schedules. File loading is failed";var b=a.data.dataFile.split("\n");a.dataArray=[];b.forEach(function(b){var c=b.split(";");if(!angular.isArray(c))return console.log(b+" is not a correct data string!"),b+" is not a correct data string!";a.dataArray.push(c)});$("#upLoadFileModal").modal("hide")};(function(){g.get(a.ctrlSettings.localPlacesUrl+"/all").then(function(b){a.data.localPlaces=b.data;0<a.data.localPlaces.length&&(a.data.currentLocalPlace.id=a.data.localPlaces[0].id);
p()},u)})()}]);app=angular.module("portalNMC");
app.controller("MngmtUsersCtrl",["$scope","$rootScope","$resource","crudGridDataFactory","notificationFactory","$http","objectSvc","mainSvc",function(a,b,d,h,g,k,f,n){b.ctxId="management_rma_users_page";a.extraProps={idColumnName:"id",defaultOrderBy:"fullName",nameColumnName:"fullName"};a.ctrlSettings={};a.ctrlSettings.orgUrl="../api/rma/contObjects/cmOrganizations";a.ctrlSettings.clientsUrl="../api/rma/subscribers";a.ctrlSettings.rmaUrl="../api/rma";a.ctrlSettings.userUrlSuffix="/subscrUsers";a.ctrlSettings.userColumns=
[{name:"userName",caption:"\u041b\u043e\u0433\u0438\u043d","class":"col-xs-2 col-md-2"},{name:"userNickname",caption:"\u0418\u043c\u044f","class":"col-xs-3 col-md-3"},{name:"userComment",caption:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439","class":"col-xs-7 col-md-7"}];a.data={};a.data.organizations=[];a.data.clients=[];a.data.users=[];a.data.currentUser={};a.data.currentClient={};var l=function(b){k.get(a.ctrlSettings.rmaUrl+"/"+b+a.ctrlSettings.userUrlSuffix).then(function(b){b.data.forEach(function(a){a.subscrRoles.some(function(b){"ROLE_SUBSCR_ADMIN"==
b.roleName&&(a.isAdmin=!0);"ROLE_SUBSCR_READONLY"==b.roleName&&(a.isReadonly=!0)})});a.data.users=b.data},function(a){console.log(a)})},m=function(){k.get(a.ctrlSettings.clientsUrl).then(function(b){if(!angular.isArray(b.data)||0===b.data.length)return"Subscribers is incorrect!";b.data.forEach(function(a){if(n.checkUndefinedNull(a.organization))return!1;a.organizationName=a.organization.organizationFullName||a.organization.organizationName});a.data.clients=b.data;a.data.currentClient.id=a.data.clients[0].id;
l(a.data.currentClient.id)},function(a){console.log(a)})};(function(){k.get(a.ctrlSettings.orgUrl).then(function(b){a.data.organizations=b.data;m()},function(a){console.log(a)})})();a.selectedItem=function(b){b=angular.copy(b);a.data.currentUser=b};a.addUser=function(){a.data.currentUser={};a.data.currentUser.id=null;a.data.currentUser.isAdmin=!1;a.data.currentUser.isReadonly=!1;$("#showUserOptionModal").modal()};var e=function(b,c){g.success();$("#deleteUserModal").modal("hide");$("#showUserOptionModal").modal("hide");
l(a.data.currentClient.id)},c=function(a){a=n.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};a.sendUserToServer=function(b){if(0==a.checkForm(b))return!1;var c=a.ctrlSettings.rmaUrl+"/"+a.data.currentClient.id+a.ctrlSettings.userUrlSuffix;angular.isDefined(b.id)&&null!=b.id?a.updateObject(c,b):a.addObject(c,b)};a.addObject=function(a,b){a+="/?isAdmin="+b.isAdmin;angular.isDefined(b.password)&&null!=b.password&&""!=b.password&&(a+="&newPassword="+b.password);angular.isDefined(b.isReadonly)&&
null!=b.isReadonly&&(a+="&isReadonly="+b.isReadonly);h(a).save(b,e,c)};a.deleteObject=function(b){h(a.ctrlSettings.rmaUrl+"/"+a.data.currentClient.id+a.ctrlSettings.userUrlSuffix)["delete"]({id:b[a.extraProps.idColumnName]},e,c)};a.updateObject=function(b,d){var f={id:d[a.extraProps.idColumnName]};angular.isDefined(d.isAdmin)&&null!=d.isAdmin&&(f.isAdmin=d.isAdmin);angular.isDefined(d.password)&&null!=d.password&&""!=d.password&&(f.oldPassword=d.curpassword,f.newPassword=d.password);angular.isDefined(d.isReadonly)&&
null!=d.isReadonly&&(f.isReadonly=d.isReadonly);h(b).update(f,d,e,c)};a.deleteObjectInit=function(b){a.selectedItem(b);a.confirmCode=null;b=n.getConfirmCode();a.confirmLabel=b.label;a.sumNums=b.result};a.changeClient=function(){l(a.data.currentClient.id)};a.emptyString=function(a){return n.checkUndefinedEmptyNullValue(a)};a.checkPassword=function(){return!(null==a.data.currentUser.id&&a.emptyString(a.data.currentUser.password)||a.data.currentUser.password!=a.data.currentUser.passwordConfirm)};a.checkForm=
function(b){var c=!0;a.emptyString(b.userNickname)&&(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f!"),c=!1);a.emptyString(b.userName)&&(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043b\u043e\u0433\u0438\u043d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f!"),c=!1);a.checkPassword()||
(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043f\u0430\u0440\u043e\u043b\u044c!"),c=!1);return c};a.isSystemuser=function(){return n.isSystemuser()};a.isTestMode=function(){return n.isTestMode()};$(document).ready(function(){$("#inputUserName").inputmask({mask:"a[*{1,20}]",greedy:!1,definitions:{"*":{validator:"[0-9a-z!_-]",cardinality:1,casing:"lower"}}})});$("#showUserOptionModal").on("shown.bs.modal",
function(){$("#inputFirstName").focus()})}]);app=angular.module("portalNMC");
app.controller("ManagementServicesCtrl",["$rootScope","$scope","$http","mainSvc","notificationFactory",function(a,b,d,h,g){a.ctxId="management_services_page";b.ctrlSettings={};b.ctrlSettings.dateFormat="DD.MM.YYYY";b.ctrlSettings.subscrUrl="../api/subscr";b.ctrlSettings.servicesUrl=b.ctrlSettings.subscrUrl+"/manage/service";b.ctrlSettings.packagesUrl=b.ctrlSettings.servicesUrl+"/servicePackList";b.ctrlSettings.itemsUrl=b.ctrlSettings.servicesUrl+"/serviceItemList";b.ctrlSettings.priceUrl=b.ctrlSettings.servicesUrl+
"/servicePriceList";b.ctrlSettings.accountServicesUrl=b.ctrlSettings.servicesUrl+"/access";b.ctrlSettings.subscriberContObjectCountUrl=b.ctrlSettings.subscrUrl+"/info/subscriberContObjectCount";b.ctrlSettings.subscriberContObjectCount=null;b.ctrlSettings.currency="";b.availablePackages=null;b.serviceListEdition=null;b.packages=[];b.availablePackages=[];b.getSubscriberContObjectCount=function(a){d.get(a).then(function(a){b.ctrlSettings.subscriberContObjectCount=a.data},function(a){console.log(a)})};
b.getSubscriberContObjectCount(b.ctrlSettings.subscriberContObjectCountUrl);b.getPriceList=function(a){d.get(a).then(function(a){var c=a.data;b.availablePackages.forEach(function(a){c.forEach(function(c){c.packId!==a.id||!angular.isUndefined(c.itemId)&&null!==c.itemId||(a.price=c,b.ctrlSettings.currency=c.currency)});a.serviceItems.forEach(function(a){c.forEach(function(c){!angular.isUndefined(c.packId)&&null!==c.packId||c.itemId!==a.id||(a.price=c,b.ctrlSettings.currency=c.currency)})})});b.ctrlSettings.currency=
""},function(a){console.log(a)})};b.getPackages=function(a){d.get(a).then(function(a){b.availablePackages=a.data;b.getPriceList(b.ctrlSettings.priceUrl);b.getSelectedPackages(b.ctrlSettings.accountServicesUrl)},function(a){console.log(a)})};var k=function(a,b){$(a).qtip({suppress:!1,content:{text:b,button:!0},show:{event:"click"},style:{classes:"qtip-nmc-indicator-tooltip",width:1E3},hide:{event:"unfocus"},position:{my:"top left",at:"bottom left"}})};b.getSelectedPackages=function(a){d.get(a).then(function(a){a.data.forEach(function(a){b.availablePackages.forEach(function(b){b.id!==
a.packId||a.hasOwnProperty("itemId")||(b.selected=!0);b.serviceItems.forEach(function(c){b.id===a.packId&&a.hasOwnProperty("itemId")&&c.id===a.itemId&&(c.selected=!0)})})});b.availablePackages.forEach(function(a){k("#package"+a.id,a.packDescription);a.serviceItems.forEach(function(a){k("#service"+a.id,a.itemDescription)})})},function(a){console.log(a)})};b.getPackages(b.ctrlSettings.packagesUrl);var f=function(a){!0===a.selected?a.changedFlag+=1:--a.changedFlag};b.serviceClick=function(a,b){f(b);
var c=!1;a.serviceItems.some(function(a){if(1!=a.selected)return c=!0});!1===c&&(a.selected=!0)};var n=function(a,b){var c=[];angular.isArray(a)&&a.forEach(function(a){var d=angular.copy(a),e=!1;d.serviceItems=[];a.serviceItems.forEach(function(a){a.changedFlag==b&&(a=angular.copy(a),d.serviceItems.push(a),e=!0)});1==e&&c.push(d)});return c};b.checkPackages=function(){b.serviceAddedList=[];b.serviceRemovedList=[];b.serviceAddedList=n(b.serviceListEdition,1);b.serviceRemovedList=n(b.serviceListEdition,
-1);b.confirmCode=null;var a=h.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result;$("#confirmSavingModal").modal()};var l=function(a){var c=[];b.serviceListEdition.forEach(function(a){!0===a.selected&&c.push({packId:a.id});a.serviceItems.forEach(function(b){!0===b.selected&&c.push({packId:a.id,itemId:b.id})})});return c},m=function(a){a=h.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};b.savePackages=function(){var a=b.ctrlSettings.accountServicesUrl,e=null,e=l(b.serviceListEdition);
d.put(a,e).then(function(a){location.reload()},m)};b.toggleShowGroupDetails=function(a){a.showDetailsFlag=!a.showDetailsFlag};var e=function(a){a.forEach(function(a){a.changedFlag=0;a.serviceItems.forEach(function(a){a.changedFlag=0})})};b.editPackages=function(){b.serviceListEdition=angular.copy(b.availablePackages);e(b.serviceListEdition);$("#editServiceListModal").modal()};$("#editServiceListModal").on("show.bs.modal",function(a){window.setTimeout(function(){b.serviceListEdition.forEach(function(a){k("#editpackage"+
a.id,a.packDescription);a.serviceItems.forEach(function(a){k("#editservice"+a.id,a.itemDescription)})})},500)});b.packClick=function(a){!0===a.selected?a.changedFlag+=1:--a.changedFlag;angular.isArray(a.serviceItems)&&a.serviceItems.forEach(function(b){b.selected!==a.selected&&(b.selected=a.selected,f(b))})};b.isSystemuser=function(){return h.isSystemuser()};b.isAdmin=function(){return h.isAdmin()};b.isSystemViewInfo=function(){return h.getViewSystemInfo()}}]);app=angular.module("portalNMC");
app.controller("MonitorCtrl",["$rootScope","$http","$scope","$compile","$interval","$cookies","$location","objectSvc","monitorSvc","mainSvc","$timeout",function(a,b,d,h,g,k,f,n,l,m,e){function c(a){var b=null;d.objects.some(function(c){if(c.contObject.id===a)return b=c,!0});return b}function q(b){var c=document.getElementById("obj"+b.contObject.id);if(!angular.isUndefined(c)&&null!=c&&(c=c.getElementsByClassName("nmc-tr-object-events")[0],!angular.isUndefined(c)&&null!=c)){var e="",e='<td colspan=\'5\' style="padding-top: 2px !important;"><table id="eventTable'+
b.contObject.id+'" class="crud-grid table table-lighter table-bordered table-condensed table-hover nmc-child-table">',e=e+"<thead>",e=e+'<tr class="nmc-child-table-header">',e=e+'<th class="nmc-td-for-buttons">',e=e+"</th>";d.eventColumns.forEach(function(a){e+="<th>";e+=a.header||a.name;e+="</th>"});e+="</tr>";e+="</thead>";!angular.isUndefined(b)&&b.hasOwnProperty("eventTypes")&&0!=b.eventTypes.length&&(b.eventTypes.forEach(function(c){e+='<tr id="trEvent'+c.id+'" >';e+='<td class="nmc-td-for-buttons"><a href="#/notices/list/?objectMonitorId='+
b.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"&typeId="+c.id+'" ng-mousedown="setNoticeFilterByObjectAndType('+b.contObject.id+","+c.id+')"> <i class="btn btn-xs glyphicon glyphicon-list nmc-button-in-table"title="\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"></i></a></td>';d.eventColumns.forEach(function(a){switch(a.name){case "typeName":e+='<td class="col-md-11" ng-class="{\'nmc-positive-notice\':'+
!c.isBaseEvent+'}">'+c[a.name];d.isSystemuser()&&(e+="<span>(id = "+c.id+")</span>");e+="</td>";break;case "typeCategory":var b=16,r="";"green"==c[a.name]&&(b=1);switch(c[a.name]){case "red":r="\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f";break;case "orange":r="\u041d\u0435\u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f";break;case "yellow":r="\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435";
break;case "red-mono":r="\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f";break;case "orange-mono":r="\u041d\u0435\u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f";break;case "yellow-mono":r="\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435"}e+='<td><img title="'+r+'" height="'+b+'" width="'+b+'" src="images/object-state-'+c[a.name]+'.png"/></td>';
break;default:e+="<td ng-class=\"{'nmc-positive-notice':"+!c.isBaseEvent+'}"> '+c[a.name]+"</td>"}});e+="</tr>"}),e+="</table></td>",c.innerHTML=e,h(c)(d))}}function t(a,b){return"<div style='font-size:8pt; text-align:center; padding:2px; color:black;'>"+a+" ("+Math.round(b.percent)+"%)</div>"}a.ctxId="monitor_page";d.messages={};d.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";d.messages.treeMenuHeader=
"\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";d.messages.noObjects="";d.objects=l.getAllMonitorObjects();a.monitorStart=f.search().fromDate||l.getMonitorSettings().fromDate||moment().subtract(6,"days").startOf("day").format("YYYY-MM-DD");a.monitorEnd=f.search().toDate||l.getMonitorSettings().toDate||moment().endOf("day").format("YYYY-MM-DD");d.monitorSettings={};d.monitorSettings.refreshPeriod=l.getMonitorSettings().refreshPeriod;
d.monitorSettings.createRoundDiagram=!1;d.monitorSettings.loadingFlag=l.getMonitorSettings().loadingFlag;d.monitorSettings.treeLoadingFlag=!0;d.monitorSettings.noGreenObjectsFlag=l.getMonitorSettings().noGreenObjectsFlag||!1;d.monitorSettings.objectsPerScroll=34;d.monitorSettings.objectsOnPage=d.monitorSettings.objectsPerScroll;d.monitorSettings.currentScrollYPos=window.pageYOffset||document.documentElement.scrollTop;d.monitorSettings.objectTopOnPage=0;d.monitorSettings.objectBottomOnPage=34;d.monitorSettings.isCtrlEnd=
!1;d.monitorSettings.ctxId="monitor_page";var u={timeout:l.getRequestCanceler().promise};d.monitorSettings.dateRangeSettings=m.getDateRangeOptions("monitor-ru");d.monitorSettings.monitorDates={startDate:a.monitorStart,endDate:a.monitorEnd};d.objectsOnPage=0===d.objects.length?[]:d.objects.slice(0,d.monitorSettings.objectsPerScroll);d.objectsOnPage.forEach(function(a){l.getMonitorEventsByObject(a)});var v=function(a){d.monitorSettings.loadingFlag=!1;d.monitorSettings.treeLoadingFlag=!1;l.setMonitorSettings({loadingFlag:!1});
console.log(a)};d.monitorState={};d.getMonitorState=function(){b.get("../api/subscr/contEvent/notifications/monitorColor?fromDate="+a.monitorStart+"&toDate="+a.monitorEnd,u).success(function(a){d.monitorState=a;a=document.getElementById("monitorTab");a.style.backgroundColor=d.monitorState.statusColor.toLowerCase();if("RED"===d.monitorState.statusColor||"ORANGE"==d.monitorState.statusColor)a.style.color="#eee";a.title=d.monitorState.colorDescription}).error(function(a){console.log(a)})};d.eventColumns=
[{name:"typeCategory",header:" ","class":""},{name:"typeEventCount",header:" ","class":""},{name:"typeName",header:"\u0422\u0438\u043f\u044b \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439","class":"col-md-10"}];d.getEventTypesByObject=function(e,f){var p=c(e);null!=p&&b.get("../api/subscr/contEvent/notifications/contObject/"+p.contObject.id+"/eventTypes/statusCollapse?fromDate="+a.monitorStart+"&toDate="+a.monitorEnd,u).success(function(a){if(a.hasOwnProperty("length")&&0!=a.length){var b=
[];a.forEach(function(a){var c={};c.id=a.contEventType.id;c.isBaseEvent=a.contEventType.isBaseEvent;c.typeCategory=a.statusColor.toLowerCase();var d=!1;angular.isArray(p.monitorEventsForMap)&&p.monitorEventsForMap.some(function(a){if(a.contEventType.id==c.id)return d=!0});d||(c.typeCategory+="-mono");c.typeEventCount=a.totalCount;c.typeName=a.contEventType.caption;b.push(c)});b.sort(function(a,b){return a.typeEventCount>b.typeEventCount?-1:a.typeEventCount<b.typeEventCount?1:0});p.eventTypes=b;f?
d.runChart(p.contObject.id):q(p)}}).error(function(a){console.log(a)})};d.toggleShowGroupDetails=function(a){var b=null;d.objects.some(function(c){if(c.contObject.id===a)return b=c,!0});if(null!=b){var c=document.getElementById("eventTable"+b.contObject.id);b.showGroupDetails=1==b.showGroupDetails&&null==c?!0:!b.showGroupDetails;c=null;!0===b.showGroupDetails?(d.getEventTypesByObject(b.contObject.id,!1),c=document.getElementById("btnDetail"+b.contObject.id),c.classList.remove("glyphicon-chevron-right"),
c.classList.add("glyphicon-chevron-down")):(document.getElementById("obj"+b.contObject.id).getElementsByClassName("nmc-tr-object-events")[0].innerHTML="",c=document.getElementById("btnDetail"+b.contObject.id),c.classList.remove("glyphicon-chevron-down"),c.classList.add("glyphicon-chevron-right"))}};d.getNoticesByObjectOnRightClick=function(a){d.setNoticeFilterByObject(a);window.open("#/notices/list/")};d.getNoticesByObjectAndRevisionOnRightClick=function(a){d.setNoticeFilterByObjectAndRevision(a);
window.open("#/notices/list/")};d.setNoticeFilterByObject=function(b){a.monitor={};l.setMonitorSettings({objectMonitorId:b});a.reportStart=a.monitorStart;a.reportEnd=a.monitorEnd};d.setNoticeFilterByObjectAndRevision=function(a){d.setNoticeFilterByObject(a);k.isNew=!0};d.setNoticeFilterByObjectAndType=function(a,b){d.setNoticeFilterByObject(a);k.typeIds=[b]};d.getNoticesByObjectAndType=function(a,b){d.setNoticeFilterByObjectAndType(a,b);window.open("#/notices/list/")};d.isSystemuser=function(){d.userInfo=
a.userInfo;return d.userInfo._system};d.refreshData=function(){d.monitorSettings.loadingFlag=!0;a.$broadcast("monitor:updateObjectsRequest")};d.getMonitor=function(a){l.checkUndefinedNull(a)?(d.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",d.monitorSettings.contGroupId=null,l.setMonitorSettings({contGroupId:null})):(d.monitorSettings.contGroupId=a.id,l.setMonitorSettings({contGroupId:a.id}),d.messages.groupMenuHeader=
a.contGroupName);d.refreshData()};d.getAllColorObjects=function(){d.monitorSettings.loadingFlag=!0;d.monitorSettings.noGreenObjectsFlag=!1;l.setMonitorSettings({noGreenObjectsFlag:!1});a.$broadcast("monitor:updateObjectsRequest")};d.getNoGreenObjects=function(){d.monitorSettings.loadingFlag=!0;d.monitorSettings.noGreenObjectsFlag=!0;l.setMonitorSettings({noGreenObjectsFlag:!0});a.$broadcast("monitor:updateObjectsRequest")};d.$watch("monitorSettings.monitorDates",function(b,c){c!==b&&(d.monitorSettings.loadingFlag=
!0,a.monitorStart=moment(b.startDate).format("YYYY-MM-DD"),a.monitorEnd=moment(b.endDate).format("YYYY-MM-DD"),l.setMonitorSettings({fromDate:a.monitorStart,toDate:a.monitorEnd}),d.monitorSettings.dateRangeSettings.startDate=moment(a.monitorStart).startOf("day"),d.monitorSettings.dateRangeSettings.endDate=moment(a.monitorEnd).endOf("day"),f.search("fromDate",a.monitorStart),f.search("toDate",a.monitorEnd),a.$broadcast("monitor:updateObjectsRequest"))},!1);d.$on("monitorObjects:getObjectEvents",function(a,
b){var c=b.obj;$("#imgObj"+c.contObject.id).qtip({content:{text:c.monitorEvents},style:{classes:"qtip-bootstrap qtip-nmc-monitor-tooltip"}})});d.$on("monitorObjects:updated",function(){d.monitorSettings.isTreeView=l.getMonitorSettings().isTreeView;d.objects=l.getAllMonitorObjects();window.scrollTo(0,0);d.monitorSettings.currentScrollYPos=window.pageYOffset||document.documentElement.scrollTop;d.monitorSettings.objectTopOnPage=0;d.monitorSettings.objectBottomOnPage=34;var a=d.objects.slice(0,d.monitorSettings.objectsPerScroll);
d.monitorSettings.loadingFlag=l.getMonitorSettings().loadingFlag;d.monitorSettings.noGreenObjectsFlag=l.getMonitorSettings().noGreenObjectsFlag;d.monitorSettings.objectsOnPage=d.monitorSettings.objectsPerScroll;d.objectsOnPage=a;d.objectsOnPage.forEach(function(a){l.getMonitorEventsByObject(a)});var a=document.getElementsByClassName("qtip"),b;for(b=0;b<a.length;b+=1)a[b].style.display="none"});d.$on("$destroy",function(){window.onkeydown=void 0});window.onkeydown=function(b){var c=null;38==b.keyCode?
(c=document.getElementById("divWithMonitorTable"),c.scrollTop-=20):40==b.keyCode?(c=document.getElementById("divWithMonitorTable"),c.scrollTop+=20):34==b.keyCode?(c=document.getElementById("divWithMonitorTable"),c.scrollTop+=10*d.monitorSettings.objectsPerScroll):33==b.keyCode?(c=document.getElementById("divWithMonitorTable"),c.scrollTop-=10*d.monitorSettings.objectsPerScroll):b.ctrlKey&&36==b.keyCode?(c=document.getElementById("divWithMonitorTable"),c.scrollTop=0):b.ctrlKey&&35==b.keyCode&&(d.monitorSettings.objectsOnPage<
d.objects.length&&(d.monitorSettings.loadingFlag=!0,e(function(){d.monitorSettings.loadingFlag=!1},d.objects.length)),b=d.objects.slice(d.monitorSettings.objectsOnPage,d.objects.length),b.forEach(function(b){"RED"===b.statusColor||"ORANGE"===b.statusColor?l.getMonitorEventsByObject(b):"YELLOW"===b.statusColor&&(b.monitorEvents="\u041d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043d\u0435\u0442 \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439",
a.$broadcast("monitorObjects:getObjectEvents",{obj:b}))}),Array.prototype.push.apply(d.objectsOnPage,b),d.monitorSettings.objectsOnPage+=d.objects.length,d.$apply(),c=document.getElementById("divWithMonitorTable"),c.scrollTop=c.scrollHeight)};d.$watch("monitorSettings.refreshPeriod",function(b,c){b!==c&&(l.setMonitorSettings({refreshPeriod:d.monitorSettings.refreshPeriod}),a.$broadcast("monitor:periodChanged"))},!1);0!=d.objects.length?(d.objects.slice(0,d.monitorSettings.objectsPerScroll),d.monitorSettings.loadingFlag=
l.getMonitorSettings().loadingFlag,angular.isDefined(l.getMonitorSettings().objectMonitorId)&&"null"!==l.getMonitorSettings().objectMonitorId&&(d.getEventTypesByObject(Number(l.getMonitorSettings().objectMonitorId),!1),l.setMonitorSettings({objectMonitorId:null}))):!1===d.monitorSettings.loadingFlag&&a.$broadcast("monitor:updateObjectsRequest");d.$on("$destroy",function(){window.onscroll=void 0});d.setMonitorEventsForObject=function(a){if(!angular.isUndefined(a.monitorEvents)){var b="#imgObj"+a.contObject.id;
$(b).ready(function(){$(b).qtip({content:{text:a.monitorEvents},style:{classes:"qtip-bootstrap qtip-nmc-monitor-tooltip"}})})}};d.addMoreObjectsForMonitor=function(){if(!(0>=d.objects.length)){var a=d.monitorSettings.objectsOnPage+d.monitorSettings.objectsPerScroll;a>=d.objects.length&&(a=d.objects.length);var b=d.objects.slice(d.monitorSettings.objectsOnPage,a);Array.prototype.push.apply(d.objectsOnPage,b);b.forEach(function(a){l.getMonitorEventsByObject(a)});d.monitorSettings.objectsOnPage=a>=d.objects.length?
d.objects.length:d.monitorSettings.objectsOnPage+d.monitorSettings.objectsPerScroll}};$("#divWithMonitorTable").scroll(function(){d.addMoreObjectsForMonitor();d.$apply()});var x=function(a){var b=!1;m.getContextIds().forEach(function(c){0==c.permissionTagId.localeCompare(a)&&(b=!0);var d=document.getElementById(c.permissionTagId);angular.isUndefined(d)||null==d||$("#"+c.permissionTagId).removeClass("nmc-hide")});0==b&&window.location.assign("#/notices/list")};x(d.monitorSettings.ctxId);a.$on("servicePermissions:loaded",
function(){x(d.monitorSettings.ctxId)});window.setTimeout(function(){x(d.monitorSettings.ctxId)},500);d.runChart=function(a){var b=-1;d.objects.some(function(c,d){if(c.contObject.id==a)return b=d,!0});if(-1!=b){var c=[],e;for(e=0;e<d.objects[b].eventTypes.length;e+=1)c[e]={label:d.objects[b].eventTypes[e].typeName,data:d.objects[b].eventTypes[e].typeEventCount};d.monitorSettings.createRoundDiagram=!1;$("#noticeChart-area").width(300);$("#noticeChart-area").height(300);$("#chartModal.modal-dialog").width(700);
$("#chartModal").modal();$.plot("#noticeChart-area",c,{series:{pie:{show:!0,label:{show:!1,formatter:t}}},legend:{show:!0,labelFormatter:t,position:"ne",margin:[-400,0]}})}};d.monitorSettings.isTreeView=!0;d.monitorSettings.isFullObjectView=!1;d.data.currentTree={};d.data.newTree={};d.data.defaultTree=null;d.viewFullObjectList=function(){d.monitorSettings.isFullObjectView=!0;d.monitorSettings.loadingFlag=!0;d.messages.treeMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";
l.setMonitorSettings({curTreeId:null,curTreeNodeId:null,isFullObjectView:!0});l.setMonitorSettings({currentTree:null,currentTreeNode:null});a.$broadcast("monitor:updateObjectsRequest")};d.selectNode=function(b){var c=d.data.currentTree,e=d.data.selectedNode;if(!m.checkUndefinedNull(e)){if(e.id==b.id||e.type==b.type=="root")return;c=m.findNodeInTree(e,c);m.checkUndefinedNull(c)||(c.isSelected=!1)}b.isSelected=!0;d.data.selectedNode=angular.copy(b);d.monitorSettings.loadingFlag=!0;d.messages.noObjects=
"\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";l.setMonitorSettings({loadingFlag:!0,curTreeId:d.data.currentTree.id,curTreeNodeId:b.id});l.setMonitorSettings({currentTree:angular.copy(d.data.currentTree),currentTreeNode:angular.copy(b)});a.$broadcast("monitor:updateObjectsRequest")};d.data.trees=[];d.loadTree=function(a,b){d.monitorSettings.treeLoadingFlag=!0;n.loadSubscrTree(a.id).then(function(c){d.monitorSettings.treeLoadingFlag=!1;d.messages.treeMenuHeader=a.objectName||
a.id;c=angular.copy(c.data);m.sortTreeNodesBy(c,"objectName");d.data.currentTree=c;l.setMonitorSettings({currentTree:angular.copy(d.data.currentTree),curTreeId:d.data.currentTree.id});if(!m.checkUndefinedNull(b))return m.findItemBy(d.data.trees,"id",c.id),c=m.findNodeInTree(b,d.data.currentTree),d.selectNode(c),"Current node is set.";d.objects=[];d.objectsOnPage=[];d.monitorSettings.isFullObjectView=!1;l.setMonitorSettings({isFullObjectView:!1});l.setMonitorSettings({currentTreeNode:null,curTreeNodeId:null});
d.messages.noObjects=""},v)};var w=function(a){d.monitorSettings.treeLoadingFlag=!0;n.loadSubscrTrees().then(function(b){d.monitorSettings.treeLoadingFlag=!1;m.sortItemsBy(b.data,"objectName");d.data.trees=angular.copy(b.data);m.checkUndefinedNull(a)||1!=a.isActive||(d.data.defaultTree=m.findItemBy(d.data.trees,"id",Number(a.value)));b=l.getMonitorSettings().currentTree;var c=l.getMonitorSettings().currentTreeNode;d.monitorSettings.isFullObjectView=l.getMonitorSettings().isFullObjectView;if(!m.checkUndefinedNull(b)&&
!m.checkUndefinedNull(c))return d.loadTree(b,c),"Current tree and current tree node is defined.";if(!angular.isArray(d.data.trees)||0>=d.data.trees.length||m.checkUndefinedNull(d.data.defaultTree)||1==d.monitorSettings.isFullObjectView)return d.viewFullObjectList(),"View full object list";l.setMonitorSettings({currentTree:d.data.defaultTree,curTreeId:d.data.defaultTree.id});d.loadTree(d.data.defaultTree)},v)};(function(){d.data.selectedNode=null;l.loadDefaultMonitorTreeSetting().then(function(a){w(a.data)},
v)})()}]);angular.module("portalNMC").controller("MonitorMapCtrl",function(a,b,d,h,g,k,f,n,l){function m(a){var c=null;b.objects.some(function(b){if(b.contObject.id===a)return c=b,!0});return c}a.ctxId="monitor_map_page";b.mapSettings={};b.mapSettings.zoomBound=9;b.mapSettings.loadingFlag=k.getLoadingStatus();b.mapSettings.ctxId="monitor_map_page";var e=[],c=[];b.objects=k.getAllMonitorObjects();console.log(b.objects);b.cities=k.getAllMonitorCities();console.log(b.cities);angular.isDefined(k.getMonitorSettings().mapZoomDetail)&&
(b.mapSettings.zoomDetail=Number(k.getMonitorSettings().mapZoomDetail));b.izhevsk={lat:56.85,lng:53.216667,zoom:8};d=b.izhevsk;angular.isDefined(k.getMonitorSettings().mapZoom)&&(d.zoom=Number(k.getMonitorSettings().mapZoom));angular.isDefined(k.getMonitorSettings().mapCenterLat)&&(d.lat=Number(k.getMonitorSettings().mapCenterLat));angular.isDefined(k.getMonitorSettings().mapCenterLng)&&(d.lng=Number(k.getMonitorSettings().mapCenterLng));angular.extend(b,{mapCenter:d});var q={type:"extraMarker",icon:"fa-home",
markerColor:"blue",prefix:"fa",shape:"circle"};b.currentTile={url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}};b.getEventTypesByObjectModFn=function(b){b=m(b);if(null!=b)return g.get("../api/subscr/contEvent/notifications/contObject/"+b.contObject.id+"/eventTypes/statusCollapse?fromDate="+a.monitorStart+"&toDate="+a.monitorEnd)};b.prepareObjectMarker=function(c){var d="<div id='"+
c.contObject.id+"'>",d=d+(""+c.contObject.fullName+"<br>"),d=d+"<hr class='nmc-hr-in-modal'>"+("\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439: <a title='\u0412\u0441\u0435\u0433\u043e \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439' href='#/notices/list/?objectMonitorId="+c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"' ng-mousedown='setNoticeFilterByObject("+c.contObject.id+")'>"+c.eventsCount+"</a>, \u043d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0445: <a title='\u041d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f' href='#/notices/list/?objectMonitorId="+
c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"&isNew=true' ng-mousedown='setNoticeFilterByObjectAndRevision("+c.contObject.id+")'>"+c.newEventsCount+"</a><br>");marker={focus:!1};marker.lng=c.contObject.contObjectGeo.geoPosX;marker.lat=c.contObject.contObjectGeo.geoPosY;marker.getMessageScope=function(){var a=b.$new(!0);angular.extend(a,{setNoticeFilterByObject:b.setNoticeFilterByObject});angular.extend(a,{setNoticeFilterByObjectAndRevision:b.setNoticeFilterByObjectAndRevision});
angular.extend(a,{setNoticeFilterByObjectAndType:b.setNoticeFilterByObjectAndType});b.getEventTypesByObjectModFn(c.contObject.id).success(function(b){if(b.hasOwnProperty("length")&&0!=b.length){var d=[];b.forEach(function(a){var b={};b.id=a.contEventType.id;b.isBaseEvent=a.contEventType.isBaseEvent;b.typeCategory=a.statusColor.toLowerCase();b.typeEventCount=a.totalCount;b.typeName=a.contEventType.caption;d.push(b)});d.sort(function(a,b){return a.typeEventCount>b.typeEventCount?-1:a.typeEventCount<
b.typeEventCount?1:0});c.eventTypes=d;if(angular.isDefined(c.eventTypes)){var e=[];c.eventTypes.forEach(function(a){var b={};b.id=a.id;var c=16,d="";"green"==a.typeCategory&&(c=1);switch(a.typeCategory){case "red":d="\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f";break;case "orange":d="\u041d\u0435\u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f"}b.size=c;b.title=
d;b.imgpath="images/object-state-"+a.typeCategory+".png";b.name=a.typeName;b.count=a.typeEventCount;e.push(b)});angular.extend(a,{eventMessages:e})}}}).error(function(a){console.log(a)});return a};marker.message=""+(d+"<hr class='nmc-hr-in-modal'>")+"<div ng-repeat='em in eventMessages'> <a href='#/notices/list/?objectMonitorId="+c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"&typeId=em.id' ng-mousedown='setNoticeFilterByObjectAndType("+c.contObject.id+",em.id)'><img ng-attr-title='{{em.title}}'ng-src='{{em.imgpath}}'/>{{em.name}} ({{em.count}}) </a></div></div>";
marker.compileMessage=!0;marker.icon={};marker.icon=angular.copy(q);marker.contObjectId=c.contObject.id;marker.isCityMarker=!1;marker.icon.markerColor="orange"===c.statusColor.toLowerCase()?"orange":c.statusColor.toLowerCase();return marker};var t=function(a){document.getElementsByClassName("leaflet-pane leaflet-popup-pane")[0].innerHTML="";var c={},d=null;b.cities.some(function(b){if(b.cityFiasUUID===a)return c.lat=b.cityGeoPosY,c.lng=b.cityGeoPosX,d=b,!0});c.zoom=b.mapSettings.zoomDetail||b.mapSettings.zoomBound+
2;angular.extend(b,{mapCenter:c});var f=d.contEventNotificationStatuses;e=[];e=b.setObjectsOnMap(f);b.viewCurrentCityObjectsFlag=!0;b.markersOnMap=e},u=function(a){b.currentCity={};b.cities.some(function(c){if(c.cityFiasUUID===a)return b.currentCity=angular.copy(c),!0});var c=b.currentCity.contEventNotificationStatuses;f.sortObjectsByConObjectFullName(c);c.forEach(function(a){"RED"!==a.statusColor&&"ORANGE"!==a.statusColor||k.getMonitorEventsByObject(a)});$("#showObjectsDetailModal").modal()};b.prepareCityMarker=
function(a){if(null!==a.cityGeoPosX&&null!==a.cityGeoPosY){var c="<div id='"+a.cityFiasUUID+"'>",c=c+(""+a.cityName+", "+a.contEventNotificationStatuses.length+" \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 <button class='glyphicon glyphicon-search marginLeft5' ng-click='viewObjectsOnMap(\""+a.cityFiasUUID+"\")' title='\u0421\u043c. \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043a\u0430\u0440\u0442\u0435'></button><br>"),c=c+"<hr class='nmc-hr-in-modal'>"+(""+a.monitorEventCount+
" \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439");0!==a.monitorEventCount&&(c+="<button class='marginLeft5' ng-click='viewObjectDetails(\""+a.cityFiasUUID+"\")'>\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435...</button>");var d={focus:!1};d.lng=a.cityGeoPosX;d.lat=a.cityGeoPosY;d.getMessageScope=function(){var a=b.$new(!0);angular.extend(a,{curMarker:d});angular.extend(a,{viewObjectsOnMap:t});angular.extend(a,{viewObjectDetails:u});
return a};d.message=""+c+"";d.compileMessage=!0;d.icon=angular.copy(q);d.cityFiasUUID=a.cityFiasUUID;d.icon.markerColor="orange"===a.cityContEventLevelColor.toLowerCase()?"orange":a.cityContEventLevelColor.toLowerCase();d.isCityMarker=!0;return d}};b.setCitiesOnMap=function(a,c){if(angular.isArray(a)&&0!==a.length&&angular.isArray(c))return a.forEach(function(a){if(angular.isUndefined(a.cityGeoPosX)||angular.isUndefined(a.cityGeoPosY)||null===a.cityGeoPosX||null===a.cityGeoPosY)console.warn("Warning. City without coordinates."),
console.warn(a);else{var d={},e=!1;angular.isDefined(c.length)&&0!=c.length&&c.some(function(b){if(angular.isUndefined(b.cityFiasUUID))return!1;if(a.cityFiasUUID===b.cityFiasUUID)return d=b,e=!0});d=b.prepareCityMarker(a);!0!==e&&c.push(d)}}),c};b.setObjectsOnMap=function(a){var c=[];if(angular.isArray(a)&&0!==a.length&&angular.isArray(c))return a.forEach(function(a){angular.isUndefined(a.contObject.contObjectGeo)||angular.isUndefined(a.contObject.contObjectGeo.geoPosX)||null===a.contObject.contObjectGeo||
null===a.contObject.contObjectGeo.geoPosX?(console.warn("Warning. Object without coordinates."),console.warn(a)):(a=b.prepareObjectMarker(a),c.push(a))}),c};b.mapCenter.zoom>b.mapSettings.zoomBound?(e=[],e=b.setObjectsOnMap(b.objects)):(e=[],b.setCitiesOnMap(b.cities,e));c=e;angular.extend(b,{markersOnMap:c});b.$on("monitorObjects:updated",function(){b.objects=k.getAllMonitorObjects();b.cities=k.getAllMonitorCities();b.mapCenter.zoom>b.mapSettings.zoomBound?(e=[],e=b.setObjectsOnMap(b.objects)):(e=
[],b.setCitiesOnMap(b.cities,e));l(function(){angular.isArray(b.markersOnMap)&&0===b.markersOnMap.length?(c=e,angular.extend(b,{markersOnMap:c})):b.markersOnMap=e},10);b.mapSettings.loadingFlag=!1});b.$watch("mapCenter.zoom",function(a,d){k.setMonitorSettings({mapZoom:a});if(a>b.mapSettings.zoomBound&&d<=b.mapSettings.zoomBound){var f=document.getElementsByClassName("leaflet-pane leaflet-popup-pane");f[0].innerHTML="";if(!0===b.viewCurrentCityObjectsFlag){b.viewCurrentCityObjectsFlag=!1;return}e=
[];e=b.setObjectsOnMap(b.objects)}a<=b.mapSettings.zoomBound&&d>b.mapSettings.zoomBound&&(f=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),f[0].innerHTML="",e=[],b.setCitiesOnMap(b.cities,e));l(function(){angular.isArray(b.markersOnMap)&&0===b.markersOnMap.length?(c=e,angular.extend(b,{markersOnMap:c})):b.markersOnMap=e},10)},!1);b.$watch("mapCenter.lat",function(a){k.setMonitorSettings({mapCenterLat:a})});b.$watch("mapCenter.lng",function(a){k.setMonitorSettings({mapCenterLng:a})});
b.setNoticeFilterByObject=function(b){a.reportStart=a.monitorStart;a.reportEnd=a.monitorEnd};b.setNoticeFilterByObjectAndRevision=function(a){b.setNoticeFilterByObject(a)};b.setNoticeFilterByObjectAndType=function(a,c){b.setNoticeFilterByObject(a)};b.isSystemuser=function(){return n.isSystemuser()};a.$on("monitor:updateObjectsRequest",function(){b.mapSettings.loadingFlag=!0});window.onkeydown=function(a){27==a.keyCode&&(a=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),angular.isDefined(a)&&
(a[0].innerHTML=""),b.mapSettings.abortCompareFlag=!0)};b.$on("$destroy",function(){window.onkeydown=void 0});var v=function(a){var b=!1;n.getContextIds().forEach(function(c){0==c.permissionTagId.localeCompare(a)&&(b=!0);var d=document.getElementById(c.permissionTagId);angular.isUndefined(d)||null==d||$("#"+c.permissionTagId).removeClass("nmc-hide")});0==b&&window.location.assign("#/")};v(b.mapSettings.ctxId);a.$on("servicePermissions:loaded",function(){v(b.mapSettings.ctxId)});window.setTimeout(function(){v(b.mapSettings.ctxId)},
500);b.data.currentTree=k.getMonitorSettings().currentTree;b.data.currentTreeNode=k.getMonitorSettings().currentTreeNode});app=angular.module("portalNMC");
app.controller("MonitorMapCtrl",["$rootScope","$scope","$compile","$cookies","$http","monitorSvc","objectSvc","mainSvc","$timeout",function(a,b,d,h,g,k,f,n,l){function m(a){var c=null;b.objects.some(function(b){if(b.contObject.id===a)return c=b,!0});return c}a.ctxId="monitor_map_page";b.mapSettings={};b.mapSettings.zoomBound=9;b.mapSettings.loadingFlag=k.getLoadingStatus();b.mapSettings.ctxId="monitor_map_page";var e=[],c=[];b.objects=k.getAllMonitorObjects();b.cities=k.getAllMonitorCities();angular.isDefined(k.getMonitorSettings().mapZoomDetail)&&
(b.mapSettings.zoomDetail=Number(k.getMonitorSettings().mapZoomDetail));b.izhevsk={lat:56.85,lng:53.216667,zoom:8};d=b.izhevsk;angular.isDefined(k.getMonitorSettings().mapZoom)&&(d.zoom=Number(k.getMonitorSettings().mapZoom));angular.isDefined(k.getMonitorSettings().mapCenterLat)&&(d.lat=Number(k.getMonitorSettings().mapCenterLat));angular.isDefined(k.getMonitorSettings().mapCenterLng)&&(d.lng=Number(k.getMonitorSettings().mapCenterLng));angular.extend(b,{mapCenter:d});var q={type:"extraMarker",icon:"fa-home",
markerColor:"blue",prefix:"fa",shape:"circle"};b.currentTile={url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}};b.getEventTypesByObjectModFn=function(b){b=m(b);if(null!=b)return g.get("../api/subscr/contEvent/notifications/contObject/"+b.contObject.id+"/eventTypes/statusCollapse?fromDate="+a.monitorStart+"&toDate="+a.monitorEnd)};b.prepareObjectMarker=function(c){var d="<div id='"+
c.contObject.id+"'>",d=d+(c.contObject.fullName+"<br>"),d=d+"<hr class='nmc-hr-in-modal'>"+("\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439: <a title='\u0412\u0441\u0435\u0433\u043e \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439' href='#/notices/list/?objectMonitorId="+c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"' ng-mousedown='setNoticeFilterByObject("+c.contObject.id+")'>"+c.eventsCount+"</a>, \u043d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0445: <a title='\u041d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f' href='#/notices/list/?objectMonitorId="+
c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"&isNew=true' ng-mousedown='setNoticeFilterByObjectAndRevision("+c.contObject.id+")'>"+c.newEventsCount+"</a><br>"),e={focus:!1};e.lng=c.contObjectGeo.geoPosX;e.lat=c.contObjectGeo.geoPosY;e.getMessageScope=function(){var a=b.$new(!0);angular.extend(a,{setNoticeFilterByObject:b.setNoticeFilterByObject});angular.extend(a,{setNoticeFilterByObjectAndRevision:b.setNoticeFilterByObjectAndRevision});angular.extend(a,{setNoticeFilterByObjectAndType:b.setNoticeFilterByObjectAndType});
return a};e.message=d+"<hr class='nmc-hr-in-modal'><div ng-repeat='em in eventMessages'> <a href='#/notices/list/?objectMonitorId="+c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"&typeId=em.id' ng-mousedown='setNoticeFilterByObjectAndType("+c.contObject.id+",em.id)'><img ng-attr-title='{{em.title}}'ng-src='{{em.imgpath}}'/>{{em.name}} ({{em.count}}) </a></div></div>";e.compileMessage=!0;e.icon={};e.icon=angular.copy(q);e.contObjectId=c.contObject.id;e.isCityMarker=
!1;e.icon.markerColor="orange"===c.statusColor.toLowerCase()?"orange":c.statusColor.toLowerCase();return e};var t=function(a){document.getElementsByClassName("leaflet-pane leaflet-popup-pane")[0].innerHTML="";var c={},d=null;b.cities.some(function(b){if(b.cityFiasUUID===a)return c.lat=b.cityGeoPosY,c.lng=b.cityGeoPosX,d=b,!0});c.zoom=b.mapSettings.zoomDetail||b.mapSettings.zoomBound+2;angular.extend(b,{mapCenter:c});var f=d.contEventNotificationStatuses;e=[];e=b.setObjectsOnMap(f);b.viewCurrentCityObjectsFlag=
!0;b.markersOnMap=[];l(function(){b.markersOnMap=e},10)},u=function(a){b.currentCity={};b.cities.some(function(c){if(c.cityFiasUUID===a||n.checkUndefinedNull(c.cityFiasUUID)&&"null"==a)return b.currentCity=angular.copy(c),!0});if(!n.checkEmptyObject(b.currentCity)){var c=b.currentCity.contEventNotificationStatuses;f.sortObjectsByConObjectFullName(c);c.forEach(function(a){"RED"!==a.statusColor&&"YELLOW"!==a.statusColor||k.getMonitorEventsByObjectForMap(a)})}$("#showObjectsDetailModal").modal()};b.prepareCityMarker=
function(a){if(null!==a.cityGeoPosX&&null!==a.cityGeoPosY){var c="<div id='"+a.cityFiasUUID+"'>",c=c+(a.cityName+", "+a.contEventNotificationStatuses.length+" \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 <button class='glyphicon glyphicon-search marginLeft5' ng-click='viewObjectsOnMap(\""+a.cityFiasUUID+"\")' title='\u0421\u043c. \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043a\u0430\u0440\u0442\u0435'></button><br>"),c=c+"<hr class='nmc-hr-in-modal'>"+(a.monitorEventCount+" \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439");
0!==a.monitorEventCount&&(c+="<button class='marginLeft5' ng-click='viewObjectDetails(\""+a.cityFiasUUID+"\")'>\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435...</button>");var d={focus:!1};d.lng=a.cityGeoPosX;d.lat=a.cityGeoPosY;d.getMessageScope=function(){var a=b.$new(!0);angular.extend(a,{curMarker:d});angular.extend(a,{viewObjectsOnMap:t});angular.extend(a,{viewObjectDetails:u});return a};d.message=c;d.compileMessage=!0;d.icon=angular.copy(q);d.cityFiasUUID=a.cityFiasUUID;d.icon.markerColor=
"orange"===a.cityContEventLevelColor.toLowerCase()?"orange":a.cityContEventLevelColor.toLowerCase();d.isCityMarker=!0;return d}};b.setCitiesOnMap=function(a,c){if(angular.isArray(a)&&0!==a.length&&angular.isArray(c))return a.forEach(function(a){if(angular.isUndefined(a.cityGeoPosX)||angular.isUndefined(a.cityGeoPosY)||null===a.cityGeoPosX||null===a.cityGeoPosY)console.warn("Warning. City without coordinates."),console.warn(a);else{var d={},e=!1;angular.isDefined(c.length)&&0!=c.length&&c.some(function(b){if(angular.isUndefined(b.cityFiasUUID))return!1;
if(a.cityFiasUUID===b.cityFiasUUID)return d=b,e=!0});d=b.prepareCityMarker(a);!0!==e&&c.push(d)}}),c};b.setObjectsOnMap=function(a){var c=[];if(angular.isArray(a)&&0!==a.length&&angular.isArray(c))return a.forEach(function(a){angular.isUndefined(a.contObjectGeo)||angular.isUndefined(a.contObjectGeo.geoPosX)||null===a.contObjectGeo||null===a.contObjectGeo.geoPosX?(console.warn("Warning. Object without coordinates."),console.warn(a)):(a=b.prepareObjectMarker(a),c.push(a))}),c};b.mapCenter.zoom>b.mapSettings.zoomBound?
(e=[],e=b.setObjectsOnMap(b.objects)):(e=[],b.setCitiesOnMap(b.cities,e));c=e;angular.extend(b,{markersOnMap:c});b.$on("monitorObjects:updated",function(){b.objects=k.getAllMonitorObjects();b.cities=k.getAllMonitorCities();b.mapCenter.zoom>b.mapSettings.zoomBound?(e=[],e=b.setObjectsOnMap(b.objects)):(e=[],b.setCitiesOnMap(b.cities,e));angular.isArray(b.markersOnMap)&&0===b.markersOnMap.length?(c=e,angular.extend(b,{markersOnMap:c})):(b.markersOnMap=[],l(function(){b.markersOnMap=e},10));b.mapSettings.loadingFlag=
!1});b.$watch("mapCenter.zoom",function(a,d){k.setMonitorSettings({mapZoom:a});var f=null;if(a>b.mapSettings.zoomBound&&d<=b.mapSettings.zoomBound){f=document.getElementsByClassName("leaflet-pane leaflet-popup-pane");f[0].innerHTML="";if(!0===b.viewCurrentCityObjectsFlag){b.viewCurrentCityObjectsFlag=!1;return}e=[];e=b.setObjectsOnMap(b.objects)}a<=b.mapSettings.zoomBound&&d>b.mapSettings.zoomBound&&(f=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),f[0].innerHTML="",e=[],b.setCitiesOnMap(b.cities,
e));angular.isArray(b.markersOnMap)&&0===b.markersOnMap.length?(c=e,angular.extend(b,{markersOnMap:c})):(b.markersOnMap=[],l(function(){b.markersOnMap=e},10))},!1);b.$watch("mapCenter.lat",function(a){k.setMonitorSettings({mapCenterLat:a})});b.$watch("mapCenter.lng",function(a){k.setMonitorSettings({mapCenterLng:a})});b.setNoticeFilterByObject=function(b){a.reportStart=a.monitorStart;a.reportEnd=a.monitorEnd};b.setNoticeFilterByObjectAndRevision=function(a){b.setNoticeFilterByObject(a)};b.setNoticeFilterByObjectAndType=
function(a,c){b.setNoticeFilterByObject(a)};b.isSystemuser=function(){return n.isSystemuser()};a.$on("monitor:updateObjectsRequest",function(){b.mapSettings.loadingFlag=!0});window.onkeydown=function(a){27==a.keyCode&&(a=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),angular.isDefined(a)&&(a[0].innerHTML=""),b.mapSettings.abortCompareFlag=!0)};b.$on("$destroy",function(){window.onkeydown=void 0});var v=function(a){var b=!1;n.getContextIds().forEach(function(c){0==c.permissionTagId.localeCompare(a)&&
(b=!0);var d=document.getElementById(c.permissionTagId);angular.isUndefined(d)||null==d||$("#"+c.permissionTagId).removeClass("nmc-hide")});0==b&&window.location.assign("#/")};v(b.mapSettings.ctxId);a.$on("servicePermissions:loaded",function(){v(b.mapSettings.ctxId)});window.setTimeout(function(){v(b.mapSettings.ctxId)},500);b.data.currentTree=k.getMonitorSettings().currentTree;b.data.currentTreeNode=k.getMonitorSettings().currentTreeNode}]);app=angular.module("portalNMC");app.filter("filterByCategories",function(){return function(a,b){if(!angular.isArray(b)||0==b.length)return a;var d=[];a.forEach(function(a){1==b.some(function(b){if(a.contEventCategoryKeyname==b.keyname)return!0})&&d.push(a)});return d}});
app.controller("NoticeCtrl",["$scope","$http","$resource","$rootScope","$cookies","$location","crudGridDataFactory","objectSvc","notificationFactory","mainSvc","$filter","$timeout",function(a,b,d,h,g,k,f,n,l,m,e,c){function q(){a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.selectedObjects=[];a.objects=angular.copy(a.objectsInWindow);a.objects.map(function(b){b.selected&&a.selectedObjects.push(b.id)});0==a.selectedObjects.length?(a.selectedObjects_list.caption=a.messages.defaultFilterCaption,
a.states.isSelectedAllObjects=!0):(a.selectedObjects_list.caption=a.selectedObjects.length,a.states.isSelectedAllObjects=!1)}function t(){a.noticeTypes=angular.copy(a.typesInWindow);a.states.criticalTypes_flag=a.states.tempCriticalTypes_flag;a.states.noCriticalTypes_flag=a.states.tempNoCriticalTypes_flag;a.states.undefinedCriticalTypes_flag=a.states.tempUndefinedCriticalTypes_flag;a.selectedNoticeTypes_list.caption="";a.selectedNoticeTypes=[];a.noticeTypes.map(function(b){b.selected&&a.selectedNoticeTypes.push(b.id)});
0==a.selectedNoticeTypes.length?(a.selectedNoticeTypes_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllTypes=!0):(a.selectedNoticeTypes_list.caption=a.selectedNoticeTypes.length,a.states.isSelectedAllTypes=!1)}function u(c){b.get(a.groupUrl+"/"+c.id+"/contObject").then(function(a){c.objects=a.data})}function v(){a.selectedObjects_list.caption="";a.selectedGroups=[];a.selectedObjects=[];a.groups=angular.copy(a.objectsInWindow);var b=a.joinObjectsFromSelectedGroups(a.groups);n.sortObjectsByFullName(b);
a.deleteDoublesObjects(b);a.addUniqueObjectsFromGroupsToSelectedObjects(b,a.selectedObjects);b=a.selectedObjects.map(function(a){return a.id});a.selectedObjects=b;a.groups.map(function(b){b.selected&&a.selectedGroups.push(b.id)});0==a.selectedGroups.length?(a.selectedObjects_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllObjects=!0):(a.selectedObjects_list.caption=a.selectedGroups.length,a.states.isSelectedAllObjects=!1)}function x(){a.noticeCategories=angular.copy(a.categoriesInWindow);
a.selectedNoticeCategories_list.caption="";a.selectedNoticeCategories=[];a.noticeCategories.map(function(b){b.selected&&a.selectedNoticeCategories.push(b.keyname)});0==a.selectedNoticeCategories.length?(a.selectedNoticeCategories_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllCategories=!0):(a.selectedNoticeCategories_list.caption=a.selectedNoticeCategories.length,a.states.isSelectedAllCategories=!1)}function w(){a.noticeDeviations=angular.copy(a.deviationsInWindow);a.selectedNoticeDeviations_list.caption=
"";a.selectedNoticeDeviations=[];a.noticeDeviations.map(function(b){b.selected&&a.selectedNoticeDeviations.push(b.keyname)});0==a.selectedNoticeDeviations.length?(a.selectedNoticeDeviations_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllDeviations=!0):(a.selectedNoticeDeviations_list.caption=a.selectedNoticeDeviations.length,a.states.isSelectedAllDeviations=!1)}function p(a,b){a.hasOwnProperty("length")&&0!==a.length&&"undefined"!=typeof b&&a.forEach(function(a){a.selected&&b.push(a.id)})}
function y(b){$("#confirmActionModal").modal("hide");a.allSelected=!1;a.getResultsPage(1);l.success()}function F(a,c,d){b({url:a,method:"PUT",params:{notificationIds:c,isNew:d},data:null}).then(y)["catch"](H)}function G(a,b){return"<div style='font-size:8pt; text-align:center; padding:2px; color:black;'>"+a+" ("+Math.round(b.percent)+"%)</div>"}h.ctxId="notice_page";a.ctrlSettings={};a.ctrlSettings.dateFormat="DD.MM.YYYY HH:mm";a.ctrlSettings.serverTimeZone=3;a.ctrlSettings.showObjectsFlag=!0;a.ctrlSettings.loading=
!0;a.ctrlSettings.ctxId="notice_page";a.TEXT_CAPTION_LENGTH=135;a.TYPE_CAPTION_LENGTH=55;a.ZPOINT_CAPTION_LENGTH=10;a.OBJECT_CAPTION_LENGTH=35;a.objectsUrl="../api/subscr/contObjects";a.groupUrl="../api/subscr/contGroup";a.crudTableName="../api/subscr/contEvent/notifications";a.noticeTypesUrl="../api/contEvent/types";a.zpointListUrl=a.objectsUrl+"/zpoints";a.zpointShortInfoUrl=a.objectsUrl+"/zpoints/shortInfo";a.noticeCategoriesUrl="../api/subscr/contEvent/categories";a.noticeDeviationsUrl="../api/subscr/contEvent/deviations";
a.imgPathTmpl="images/notice-state-";var C=k.search();a.messages={};a.messages.markSelectedAsRevision="\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043a\u0430\u043a \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435";a.messages.markSelectedAsNew="\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043a\u0430\u043a \u043d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435";
a.messages.markOnPageAsRevision="\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435 \u043a\u0430\u043a \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435";a.messages.markAllAsRevision="\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u043a\u0430\u043a \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435";a.messages.markAllAsNew="\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u043a\u0430\u043a \u043d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435";
a.states={};a.states.applyObjects_flag=!1;a.states.applyTypes_flag=!1;a.states.criticalTypes_flag=!1;a.states.noCriticalTypes_flag=!1;a.states.undefinedCriticalTypes_flag=!1;a.states.tempCriticalTypes_flag=!1;a.states.tempNoCriticalTypes_flag=!1;a.states.tempUndefinedCriticalTypes_flag=!1;a.allSelected=!1;a.states.isSelectedAllObjects=!0;a.states.isSelectedAllCategories=!0;a.states.isSelectedAllDeviations=!0;a.states.isSelectedAllTypes=!0;a.states.isSelectedAllObjectsInWindow=!0;a.states.isSelectedAllCategoriesInWindow=
!0;a.states.isSelectedAllDeviationsInWindow=!0;a.states.isSelectedAllTypesInWindow=!0;a.messages.defaultFilterCaption="\u0412\u0441\u0435";a.selectedObjects_list={};a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeTypes_list={};a.selectedNoticeTypes_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeCategories_list={};a.selectedNoticeCategories_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeDeviations_list={};a.selectedNoticeDeviations_list.caption=
a.messages.defaultFilterCaption;a.zpointList=null;a.tableDef={tableClass:"crud-grid table table-lighter table-condensed table-hover table-striped",hideHeader:!1,headerClassTR:"nmc-main-table-header",columns:[{fieldName:"noticeObjectName",header:"\u041e\u0431\u044a\u0435\u043a\u0442",headerClass:"col-xs-2 nmc-text-align-center nmc-hide",dataClass:"col-xs-2 nmc-hide"},{fieldName:"noticeObjectNameCaption",header:"\u041e\u0431\u044a\u0435\u043a\u0442",headerClass:"col-xs-2 nmc-text-align-center",dataClass:"col-xs-2"},
{fieldName:"noticeZpoint",header:"\u0422\u043e\u0447\u043a\u0430 \u0443\u0447\u0435\u0442\u0430",headerClass:"col-xs-1 nmc-hide",dataClass:"col-xs-1 nmc-hide"},{fieldName:"noticeZpointCaption",header:" ",headerClass:"col-xs-1 nmc-td-for-button",dataClass:"col-xs-1 nmc-td-for-button nmc-text-align-center"},{fieldName:"noticeDate",header:"\u0414\u0430\u0442\u0430",headerClass:"col-xs-1 nmc-text-align-center",dataClass:"col-xs-1"},{fieldName:"noticeMessage",header:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435",
headerClass:"col-xs-1 nmc-hide",dataClass:"col-xs-1 nmc-hide"},{fieldName:"noticeCaption",header:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435",headerClass:"col-xs-7 nmc-text-align-center",dataClass:"col-xs-7"}]};a.data={};a.currentObject={};a.selectedObjects=[];a.selectedNoticeCategories=[];a.selectedNoticeDeviations=[];a.notices=[];a.noticesPromise=null;a.currentNotices=null;a.totalNotices=0;a.noticesPerPage=25;a.noticesPerPageList=[15,25,50,75,100];a.groups=[];a.isSystemuser=
function(){return m.isSystemuser()};a.isTestMode=function(){return m.isTestMode()};var H=function(a){a=m.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)};a.initCtrl=function(){a.categoriesInWindow=angular.copy(a.noticeCategories);a.deviationsInWindow=angular.copy(a.noticeDeviations);if(angular.isDefined(C)&&C.hasOwnProperty("monitorFlag")&&"true"===C.monitorFlag){a.objectsInWindow=angular.copy(a.objects);var b=-1;a.objectsInWindow.some(function(a,c){if(a.id===Number(C.objectMonitorId))return b=
c,!0});if(-1<b){a.objectsInWindow[b].selected=!0;q();a.isNew=m.checkUndefinedNull(C.isNew)||"null"===C.isNew?null:!!C.isNew;!0===a.isNew&&(a.visibleText="\u0422\u043e\u043b\u044c\u043a\u043e \u043d\u043e\u0432\u044b\u0435");var c=[Number(C.typeId)];angular.isDefined(c)&&c.hasOwnProperty("length")&&0<c.length&&(a.typesInWindow=angular.copy(a.noticeTypes),c.forEach(function(b){var c=-1;a.typesInWindow.some(function(a,d){if(a.id===b)return c=d,!0});-1<c&&(a.typesInWindow[c].selected=!0)}),t())}}};var r=
function(a,c,d,e,r,z,f,H){c={fromDate:c,toDate:d,contEventTypeIds:r,contEventCategories:z,contEventDeviations:f,contObjectIds:e};m.checkUndefinedNull(H)||(c.isNew=H);return b({url:a,method:"GET",params:c})};a.pagination={current:1};a.pageChanged=function(b){a.getResultsPage(b)};var I=function(b){var c=null;null!=a.zpointList&&a.zpointList.some(function(a){if(b===a.contZPointId)return c=a,!0});return c},B=function(b){var c={};return b.map(function(b){c={};c.id=b.id;var d=b.contEventType.caption||b.contEventType.name;
c.contEventCategoryKeyname=b.contEventCategoryKeyname;c.noticeType=d;c.isBaseEvent=b.contEventType.isBaseEvent;c.noticeMessage=m.checkUndefinedNull(b.contEvent)?"":b.contEvent.message;c.zpoint=null;c.imgSTPath=a.imgPathTmpl+"green.png";angular.isString(d)&&(c.noticeTypeCaption=d.length>a.TYPE_CAPTION_LENGTH?d.substr(0,a.TYPE_CAPTION_LENGTH)+"...":d);if(!m.checkUndefinedNull(b.contEvent))switch(c.noticeCaption=null==b.contEvent.message?"":b.contEvent.message.length>a.TEXT_CAPTION_LENGTH?b.contEvent.message.substr(0,
a.TEXT_CAPTION_LENGTH)+"...":b.contEvent.message,c.zpoint=I(b.contEvent.contZPointId),b.contEvent.contServiceType){case "heat":c.imgSTPath="vendor_components/glyphicons_free/glyphicons/png/glyphicons-85-heat.png";break;case "hw":c.imgSTPath="vendor_components/glyphicons_free/glyphicons/png/glyphicons-93-tint.png";break;case "cw":c.imgSTPath="vendor_components/glyphicons_free/glyphicons/png/glyphicons-22-snowflake.png";break;case "gas":c.imgSTPath="vendor_components/glyphicons_free/glyphicons/png/glyphicons-23-fire.png";
break;case "env":c.imgSTPath="images/es.png";break;case "el":c.imgSTPath="vendor_components/glyphicons_free/glyphicons/png/glyphicons-242-flash.png";break;case null:c.imgSTPath="null";break;default:c.noticeZpoint=b.contServiceType,c.imgSTPath=b.contServiceType}c.contObjectId=b.contObjectId;for(d=0;d<a.objects.length;d+=1)if(a.objects[d].id==b.contObjectId){c.noticeObjectName=a.objects[d].fullName;break}angular.isString(c.noticeObjectName)&&(c.noticeObjectNameCaption=c.noticeObjectName.length>a.OBJECT_CAPTION_LENGTH?
c.noticeObjectName.substr(0,a.OBJECT_CAPTION_LENGTH)+"...":c.noticeObjectName);c.noticeDate=a.dateFormat(b.contEventTime);c.contEventLevelColor=m.checkUndefinedNull(b.contEventLevelColor)?"GREEN":b.contEventLevelColor;c.imgpath=a.imgPathTmpl+c.contEventLevelColor.toLowerCase()+".png";c.imgclass="GREEN"===c.contEventLevelColor?"":"nmc-img-critical-indicator";c.isNew=b.isNew;null!=c.zpoint&&(c.noticeZpoint=c.zpoint.customServiceName||c.zpoint.contServiceTypeCaption);c.noticeZpointCaption="";return c})};
a.getResultsPage=function(b){a.ctrlSettings.loading=!0;a.pagination.current=b;b=a.crudTableName+"/paged?page="+(b-1)+"&size="+a.noticesPerPage;angular.isDefined(C.fromDate)&&angular.isDefined(C.toDate)?(a.startDate=C.fromDate,a.endDate=C.toDate):(a.startDate=h.reportStart||moment().subtract(6,"days").format("YYYY-MM-DD"),a.endDate=h.reportEnd||moment().format("YYYY-MM-DD"));a.noticesPromise=r(b,a.startDate,a.endDate,a.selectedObjects,a.selectedNoticeTypes,a.selectedNoticeCategories,a.selectedNoticeDeviations,
a.isNew);a.currentNotices=a.noticesPromise.then(function(b){b=b.data;a.data=b;a.totalNotices=b.totalElements;b=B(b.objects);a.notices=b;a.ctrlSettings.loading=!1},function(b){H(b);a.ctrlSettings.loading=!1})};a.dateFormat=function(b){b=new Date(b+Math.round(36E5*a.ctrlSettings.serverTimeZone));return null==b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes()]).format(a.ctrlSettings.dateFormat)};a.selectObjectsClick=function(){a.states.isSelectElement=!1;
a.states.isSelectedAllObjectsInWindow=angular.copy(a.states.isSelectedAllObjects);a.objectsInWindow=1==a.ctrlSettings.showObjectsFlag?angular.copy(a.objects):angular.copy(a.groups)};a.selectNoticeTypesClick=function(){a.states.isSelectElement=!1;a.states.tempCriticalTypes_flag=angular.copy(a.states.criticalTypes_flag);a.states.tempNoCriticalTypes_flag=angular.copy(a.states.noCriticalTypes_flag);a.states.tempUndefinedCriticalTypes_flag=angular.copy(a.states.undefinedCriticalTypes_flag);angular.copy(a.noticeCategories);
a.selectedCategories=[];a.noticeCategories.forEach(function(b){1==b.selected&&a.selectedCategories.push(b)});a.typesInWindow=angular.copy(a.noticeTypes);a.states.isSelectedAllTypesInWindow=angular.copy(a.states.isSelectedAllTypes)};a.selectNoticeCategoriesClick=function(){a.states.isSelectElement=!1;a.categoriesInWindow=angular.copy(a.noticeCategories);a.states.isSelectedAllCategoriesInWindow=angular.copy(a.states.isSelectedAllCategories)};a.selectNoticeDeviationsClick=function(){a.states.isSelectElement=
!1;a.deviationsInWindow=angular.copy(a.noticeDeviations);a.states.isSelectedAllDeviationsInWindow=angular.copy(a.states.isSelectedAllDeviations)};a.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};a.deleteDoublesObjects=function(a){for(var b=a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&a.splice(b,1)};a.addUniqueObjectsFromGroupsToSelectedObjects=function(a,b){var c,d;for(c=0;c<a.length;c+=1){var e=!0;for(d=
0;d<b.length;d+=1)if(a[c].fullName===b[d].fullName){e=!1;break}e&&b.push(a[c])}};var z=function(){var b=document.getElementsByClassName("btn-group open");m.checkUndefinedNull(b)||0==b.length||b[0].classList.remove("open");a.states.isSelectElement=!1};a.selectObjects=function(){z();1==a.ctrlSettings.showObjectsFlag?q():v();a.getResultsPage(1)};a.selectNoticeTypes=function(){z();t();a.getResultsPage(1)};a.selectNoticeCategories=function(){z();x();a.getResultsPage(1)};a.selectNoticeDeviations=function(){z();
w();a.getResultsPage(1)};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b};a.showNoticeDetail=function(b){a.selectedItem(b);$("#showNoticeModal").modal()};var K=function(b){a.objects=b.data;n.sortObjectsByFullName(a.objects);angular.isDefined(a.zpointList)&&angular.isArray(a.zpointList)?a.$broadcast("notices:getNoticeTypes"):a.$broadcast("notices:getZpointList")};a.getObjects=function(){m.isRma()?n.rmaPromise.then(K):n.promise.then(K)};a.getObjects();a.getGroups=function(){b.get(a.groupUrl).then(function(b){b=
b.data;b.forEach(function(a){u(a)});m.sortItemsBy(b,"contGroupName");a.groups=b},function(a){console.log(a)})};a.getGroups();a.performAllNoticesOnPage=function(){a.notices.forEach(function(b){b.selected=a.allSelected})};a.getNoticeDeviations=function(c){b.get(c).success(function(b){a.noticeDeviations=b;a.$broadcast("notices:getNoticeTypes")}).error(function(a){console.log(a)})};a.getNoticeCategories=function(c){b.get(c).success(function(b){a.noticeCategories=b;a.getNoticeDeviations(a.noticeDeviationsUrl)}).error(function(a){console.log(a)})};
a.getNoticeTypes=function(c){b.get(c).success(function(b){a.noticeTypes=b;a.initCtrl();a.getResultsPage(1)}).error(function(a){console.log(a)})};a.getZpointList=function(c){b.get(c).success(function(b){a.zpointList=b;a.getNoticeCategories(a.noticeCategoriesUrl)}).error(function(a){console.log(a)})};a.$on("notices:getNoticeTypes",function(){a.getNoticeTypes(a.noticeTypesUrl)});a.$on("notices:getZpointList",function(){a.getZpointList(a.zpointShortInfoUrl)});a.$on("notices:selectObjects",function(){a.selectObjects()});
a.getAllNotices=function(){a.isNew=null;a.getResultsPage(1)};a.getOnlyNewNotices=function(){a.isNew=!0;a.getResultsPage(1)};a.noticeFilterCritical=function(a){if(!0===a.isCriticalEvent)return a};a.noticeFilterNoCritical=function(a){if(!1===a.isCriticalEvent)return a};a.noticeFilterUndefinedCritical=function(a){if(!a.hasOwnProperty("isCriticalEvent")||null==a.isCriticalEvent)return a};a.selectAllCritical=function(){a.states.tempCriticalTypes_flag?a.typesInWindow.forEach(function(a){!0===a.isCriticalEvent&&
(a.selected=!0)}):a.typesInWindow.forEach(function(a){!0===a.isCriticalEvent&&(a.selected=!1)})};a.selectAllNoCritical=function(){a.states.tempNoCriticalTypes_flag?a.typesInWindow.forEach(function(a){!1!==a.isCriticalEvent&&a.hasOwnProperty("isCriticalEvent")&&null!=a.isCriticalEvent||(a.selected=!0)}):a.typesInWindow.forEach(function(a){!1!==a.isCriticalEvent&&a.hasOwnProperty("isCriticalEvent")&&null!=a.isCriticalEvent||(a.selected=!1)})};a.selectAllUndefinedCritical=function(){a.states.tempUndefinedCriticalTypes_flag?
a.typesInWindow.forEach(function(a){a.hasOwnProperty("isCriticalEvent")&&null!=a.isCriticalEvent||(a.selected=!0)}):a.typesInWindow.forEach(function(a){a.hasOwnProperty("isCriticalEvent")&&null!=a.isCriticalEvent||(a.selected=!1)})};a.selectAllElements=function(b){a.states.isSelectElement=!0;b.forEach(function(a){a.selected=!1})};a.selectElement=function(b){a.states.isSelectElement=!0;return a.states[b]=!1};a.isFilterApplyDisabled=function(a,b){return 1==b?!1:!a.some(function(a){if(1==a.selected)return!0})};
a.revisionNotices=function(b){var c=[],d=a.crudTableName+"/revision";p(a.notices,c);"undefined"!=typeof c&&c.hasOwnProperty("length")&&0!=c.length&&F(d,c,b)};a.revisionAllNotices=function(c){b({url:a.crudTableName+"/revision/all",method:"PUT",params:{fromDate:a.startDate,toDate:a.endDate,contObjectIds:a.selectedObjects,contEventTypeIds:a.selectedNoticeTypes,isNew:a.isNew,revisionIsNew:c},data:null}).then(y)["catch"](H)};a.revisionNoticesOnPage=function(){var b=a.notices.map(function(a){return a.id}),
c=a.crudTableName+"/revision";"undefined"!=typeof b&&b.hasOwnProperty("length")&&0!=b.length&&F(c,b,!1)};a.confirmAction=function(){a.confirmationText===a.messages.markOnPageAsRevision&&a.revisionNoticesOnPage();a.confirmationText===a.messages.markAllAsRevision&&a.revisionAllNotices(!1)};a.clearAllFilters=function(){a.clearObjectFilter();a.clearTypeFilter();a.clearCategoryFilter();a.clearDeviationFilter();a.isNew=null;a.getResultsPage(1)};a.clearObjectFilter=function(){a.objects.forEach(function(a){a.selected=
!1});a.groups.forEach(function(a){a.selected=!1});a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.selectedObjects=[];a.selectedGroups=[];a.states.isSelectedAllObjects=!0};a.clearTypeFilter=function(){a.states.criticalTypes_flag=!1;a.states.noCriticalTypes_flag=!1;a.states.undefinedCriticalTypes_flag=!1;a.noticeTypes.forEach(function(a){a.selected=!1});a.selectedNoticeTypes_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeTypes=[];a.states.isSelectedAllTypes=!0};a.clearCategoryFilter=
function(){a.noticeCategories.forEach(function(a){a.selected=!1});a.selectedNoticeCategories_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeCategories=[];a.states.isSelectedAllCategories=!0};a.clearDeviationFilter=function(){a.noticeDeviations.forEach(function(a){a.selected=!1});a.selectedNoticeDeviations_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeDeviations=[];a.states.isSelectedAllDeviations=!0};var O=function(a){var b=!1;m.getContextIds().forEach(function(c){0==
c.permissionTagId.localeCompare(a)&&(b=!0);var d=document.getElementById(c.permissionTagId);angular.isUndefined(d)||null==d||$("#"+c.permissionTagId).removeClass("nmc-hide")});0==b&&window.location.assign("#/")};O(a.ctrlSettings.ctxId);h.$on("servicePermissions:loaded",function(){O(a.ctrlSettings.ctxId)});window.setTimeout(function(){O(a.ctrlSettings.ctxId)},500);a.isDisabledFilters=function(){return a.ctrlSettings.loading};a.$on("navPlayerDatesChanged",function(){a.getResultsPage(1)});$(document).ready(function(){$("#object-toggle-view").bootstrapToggle();
$("#object-toggle-view").change(function(){a.ctrlSettings.showObjectsFlag=!!$(this).prop("checked");a.$apply();a.selectObjectsClick();if(a.selectedObjects_list.caption==a.messages.defaultFilterCaption)return"Object / group filter. No changes";a.clearObjectFilter();a.$broadcast("notices:selectObjects")})});a.runChart=function(){var b=[],c=[],d=[],e,r;for(e=0;e<a.notices.length;e+=1)if(0<c.length){var z=!1;for(r=0;r<c.length;r+=1)c[r]===a.notices[e].noticeType&&(d[r]+=1,z=!0);z||(c.push(a.notices[e].noticeType),
d.push(1))}else c.push(a.notices[e].noticeType),d.push(1);for(e=0;e<c.length;e+=1)b[e]={label:c[e],data:d[e]};$("#noticeChart-area").width(300);$("#noticeChart-area").height(300);$("#chartModal.modal-dialog").width(700);$("#chartModal").modal();$.plot("#noticeChart-area",b,{series:{pie:{show:!0,label:{show:!1,formatter:G}}},legend:{show:!0,labelFormatter:G,position:"ne",margin:[-400,0]}})}}]);app=angular.module("portalNMC");app.controller("ObjectsCtrl",["$scope","$rootScope","$cookies","$http","mainSvc",function(a,b,d,h,g){a.ctrlSettings={};a.ctrlSettings.pageAccess=!1;a.ctrlSettings.pageCtxId="object_list_view_page";b.ctxId="object_list_view_page";a.ctrlSettings.loadingPermissions=g.getLoadingServicePermissionFlag();a.ctrlSettings.pageAccess=g.checkContext(a.ctrlSettings.pageCtxId)||g.isCabinet()}]);app=angular.module("portalNMC");
app.controller("ObjectsMapCtrl",["$rootScope","$scope","$cookies","objectSvc","mainSvc","$timeout",function(a,b,d,h,g,k){a.ctxId="object_map_page";b.mapSettings={};b.mapSettings.userFormat="DD.MM.YYYY";b.mapSettings.systemFormat="YYYY-MM-DD";b.mapSettings.zoomBound=9;b.mapSettings.dateFrom=moment().subtract(30,"days").startOf("day").format(b.mapSettings.systemFormat);b.mapSettings.dateTo=moment().endOf("day").format(b.mapSettings.systemFormat);b.mapSettings.loadingFlag=h.getLoadingStatus();b.mapSettings.drawMarkersFlag=
!b.mapSettings.loadingFlag;b.mapSettings.abortCompareFlag=!1;b.mapSettings.ctxId="object_map";var f=[],n=[];b.objects=[];b.cities=[];b.objectsOfCities=[];b.izhevsk={lat:56.85,lng:53.216667,zoom:8};d=b.izhevsk;angular.isDefined(h.getObjectSettings().mapZoomDetail)&&(b.mapSettings.zoomDetail=Number(h.getObjectSettings().mapZoomDetail));angular.isDefined(h.getObjectSettings().mapZoom)&&(d.zoom=Number(h.getObjectSettings().mapZoom));angular.isDefined(h.getObjectSettings().mapCenterLat)&&(d.lat=Number(h.getObjectSettings().mapCenterLat));
angular.isDefined(h.getObjectSettings().mapCenterLng)&&(d.lng=Number(h.getObjectSettings().mapCenterLng));angular.extend(b,{mapCenter:d});var l={type:"extraMarker",icon:"fa-home",markerColor:"blue",prefix:"fa",shape:"circle"};angular.extend(b,{currentTile:{url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}}});var m=function(a,b){var c=[];if(!angular.isArray(a)||0===a.length)return[];
a.forEach(function(a){angular.isArray(a.cityObjects)&&0!==a.cityObjects.length&&a.cityObjects.forEach(function(a){c.push(a)})});return c},e=function(a){var b=0,c=0,d=0;a.cityObjects.forEach(function(a){angular.isDefined(a.contObject.heatArea)&&null!=a.contObject.heatArea&&(d+=a.contObject.heatArea);angular.isUndefined(a.serviceTypeARTs)||null===a.serviceTypeARTs||0===a.serviceTypeARTs.length||a.serviceTypeARTs.forEach(function(a){switch(a.contServiceType){case "heat":c+=a.absConsValue;break;case "hw":b+=
a.absConsValue}})});var e={hw:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",hwMeasureUnit:"",heat:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",heatMeasureUnit:"",heatArea:null,heatAreaMeasureUnit:"",heatAverage:"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",heatAverageMeasureUnit:"",hwAverage:"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",hwAverageMeasureUnit:""};e.hw=b.toFixed(2);
e.hwMeasureUnit="\u043c3";e.heat=c.toFixed(2);e.heatMeasureUnit="\u0413\u041a\u0430\u043b";e.heatArea=d.toFixed(2);e.heatAreaMeasureUnit="\u043c2";0!=d&&(e.heatAverage=(c/d).toFixed(2),e.heatAverageMeasureUnit="\u0413\u041a\u0430\u043b/\u043c2",e.hwAverage=(b/d).toFixed(2),e.hwAverageMeasureUnit="\u043c3/\u043c2");a.servicesSummary=e},c=function(a,c){h.getCityConsumingData(a.cityFiasUUID,c).then(function(c){!0===b.mapSettings.abortCompareFlag?(b.mapSettings.abortCompareFlag=!1,b.comparingFlag=!1):
angular.isArray(c.data)&&0!==c.data.length?(b.newCityData=c.data[0],b.markerSettings.isNewDataFlag=!0,e(b.newCityData),c={},c.heatArea=a.servicesSummary.heatArea,"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==a.servicesSummary.hw&&"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==b.newCityData.servicesSummary.hw&&(c.hw=(a.servicesSummary.hw-b.newCityData.servicesSummary.hw).toFixed(2),c.hwPerCent=Math.abs(100*(a.servicesSummary.hw-b.newCityData.servicesSummary.hw)/b.newCityData.servicesSummary.hw).toFixed(2),
c.hwMeasureUnit="\u043c3",c.hwAveragePerCent=0<c.heatArea?Math.abs(100*(a.servicesSummary.hwAverage-b.newCityData.servicesSummary.hwAverage)/b.newCityData.servicesSummary.hwAverage).toFixed(2):null,c.hwAverage=(a.servicesSummary.hwAverage-b.newCityData.servicesSummary.hwAverage).toFixed(2)),"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==a.servicesSummary.heat&&"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==b.newCityData.servicesSummary.heat&&(c.heat=(a.servicesSummary.heat-
b.newCityData.servicesSummary.heat).toFixed(2),c.heatPerCent=Math.abs(100*(a.servicesSummary.heat-b.newCityData.servicesSummary.heat)/b.newCityData.servicesSummary.heat).toFixed(2),c.heatMeasureUnit="\u043c3",c.heatAveragePerCent=0<c.heatArea?Math.abs(100*(a.servicesSummary.heatAverage-b.newCityData.servicesSummary.heatAverage)/b.newCityData.servicesSummary.heatAverage).toFixed(2):null,c.heatAverage=(a.servicesSummary.heatAverage-b.newCityData.servicesSummary.heatAverage).toFixed(2)),b.diffCityData=
c,b.diffData=c,b.newData=angular.copy(b.newCityData.servicesSummary),b.markerSettings.isDiffDataFlag=!0,b.comparingFlag=!1):(console.log("Not enough objects for the city."),console.log(c.data))},function(a){console.log(a);b.comparingFlag=!1})},q=function(){h.getCitiesConsumingData(b.mapSettings).then(function(a){b.cities=a.data;b.objectsOfCities=m(b.cities,b.objectsOfCities);b.mapCenter.zoom>b.mapSettings.zoomBound?(f=b.setObjectsOnMap(b.objectsOfCities,f),b.markersOnMap=[],angular.extend(b,{markersOnMap:f})):
(n=b.setCitiesOnMap(b.cities,n),b.markersOnMap=[],angular.extend(b,{markersOnMap:n}));b.mapSettings.loadingFlag=!1;b.mapSettings.drawMarkersFlag=!b.mapSettings.loadingFlag},function(a){console.log(a);b.mapSettings.loadingFlag=!1;b.mapSettings.drawMarkersFlag=!b.mapSettings.loadingFlag})},t=function(a){var b={hw:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",hwMeasureUnit:"",heat:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",heatMeasureUnit:"",hwAverage:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",
hwAverageMeasureUnit:"",heatAverage:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",heatAverageMeasureUnit:""};if(angular.isUndefined(a.serviceTypeARTs)||null===a.serviceTypeARTs||0===a.serviceTypeARTs.length)b.hw="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.hwMeasureUnit="",b.hwTemp="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.heat="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.heatMeasureUnit="",b.heatTemp="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",
b.hwAverage="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.hwAverageMeasureUnit="",b.heatAverage="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.heatAverageMeasureUnit="";a.serviceTypeARTs.forEach(function(c){switch(c.contServiceType){case "hw":!angular.isNumber(c.absConsValue)||angular.isUndefined(c.absConsValue)||null===c.absConsValue?(b.hw="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.hwMeasureUnit="",b.hwAverage="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",
b.hwAverageMeasureUnit=""):(b.hw=c.absConsValue.toFixed(2),b.hwMeasureUnit="\u043c<sup>3</sup>",0<a.contObject.heatArea?(b.hwAverage=(c.absConsValue/a.contObject.heatArea).toFixed(2),b.hwAverageMeasureUnit="\u043c<sup>3</sup>/\u043c<sup>2</sup>"):(b.hwAverage="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",b.hwAverageMeasureUnit=""));break;case "heat":!angular.isNumber(c.absConsValue)||angular.isUndefined(c.absConsValue)||null===c.absConsValue?(b.heat=
"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.heatMeasureUnit="",b.heatAverage="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.heatAverageMeasureUnit=""):(b.heat=c.absConsValue.toFixed(2),b.heatMeasureUnit="\u0413\u041a\u0430\u043b",0<a.contObject.heatArea?(b.heatAverage=(c.absConsValue/a.contObject.heatArea).toFixed(2),b.heatAverageMeasureUnit="\u0413\u041a\u0430\u043b/\u043c<sup>2</sup>"):(b.heatAverage="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",
b.heatAverageMeasureUnit=""));break;default:b.wtf=c.absConsValue,b.wtfMeasureUnit="Wtf"}});return b};q();var u=function(a){document.getElementsByClassName("leaflet-pane leaflet-popup-pane")[0].innerHTML="";var c={},d={};b.cities.some(function(b){if(b.cityFiasUUID===a)return c.lat=b.cityGeoPosY,c.lng=b.cityGeoPosX,d=b,!0});c.zoom=b.mapSettings.zoomDetail||b.mapSettings.zoomBound+2;var e=d.cityObjects;f=[];b.setObjectsOnMap(e,f);b.markersOnMap=f;b.viewCurrentCityObjectsFlag=!0;angular.extend(b,{mapCenter:c})},
v=function(){b.markerSettings.cmpFlag=!b.markerSettings.cmpFlag},x=function(a,c,d){b.markerSettings.runFlag=!1;d={};d.dateFrom=moment(a.dateFrom).subtract(c,"days").format(b.mapSettings.systemFormat);d.dateTo=moment(a.dateTo).subtract(c,"days").format(b.mapSettings.systemFormat);d.dateFromUserformat=moment(d.dateFrom).format(b.mapSettings.userFormat);d.dateToUserformat=moment(d.dateTo).format(b.mapSettings.userFormat);return b.cmpPeriod=d},w=function(a,c){b.mapSettings.abortCompareFlag=!1;b.markerSettings.cmpDataFlag=
!0;b.markerSettings.runFlag=!0;var d=angular.copy(c);h.getObjectConsumingData(d,a.contObject.id).then(function(c){if(!0===b.mapSettings.abortCompareFlag)b.mapSettings.abortCompareFlag=!1;else{b.newObjectData=c.data;var d,e=null;for(d=0;d<b.newObjectData.serviceTypeARTs.length;d+=1)e=b.newObjectData.serviceTypeARTs[d],e.absConsValue=null===e.absConsValue?null:Number(e.absConsValue.toFixed(2)),e.tempValue=null===e.tempValue?null:Number(e.tempValue.toFixed(2));d={};b.newData=t(c.data);e=t(a);"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==
e.hw&&"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==b.newData.hw&&(d.hw=(e.hw-b.newData.hw).toFixed(2),d.hwPerCent=Math.abs(100*(e.hw-b.newData.hw)/b.newData.hw).toFixed(2),d.hwMeasureUnit=" \u043c3",0<a.contObject.heatArea?(d.hwAverage=(e.hwAverage-b.newData.hwAverage).toFixed(2),d.hwAveragePerCent=Math.abs(100*(e.hwAverage-b.newData.hwAverage)/b.newData.hwAverage).toFixed(2),d.hwAverageMeasureUnit="m3/m2"):(d.hwAverage="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",
d.hwAverageMeasureUnit=""));"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==e.heat&&"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==b.newData.heat&&(d.heat=(e.heat-b.newData.heat).toFixed(2),d.heatPerCent=Math.abs(100*(e.heat-b.newData.heat)/b.newData.heat).toFixed(2),d.heatMeasureUnit=" \u0413\u041a\u0430\u043b",0<a.contObject.heatArea?(d.heatAverage=(e.heatAverage-b.newData.heatAverage).toFixed(2),d.heatAveragePerCent=Math.abs(100*(e.heatAverage-b.newData.heatAverage)/b.newData.heatAverage).toFixed(2),
d.heatAverageMeasureUnit="\u0413\u041a\u0430\u043b/m2"):(d.heatAverage="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",d.heatAverageMeasureUnit=""));var r=[];a.serviceTypeARTs.forEach(function(c){var d;for(d=0;d<b.newObjectData.serviceTypeARTs.length;d+=1)if(e=b.newObjectData.serviceTypeARTs[d],c.contServiceType===e.contServiceType){var z={};z.contServiceType=c.contServiceType;z.measureUnit=c.measureUnit;z.absConsValue=Number((c.absConsValue-e.absConsValue).toFixed(2));
z.absConsValueAverage=0<a.contObject.heatArea?Number((z.absConsValue/a.contObject.heatArea).toFixed(2)):null;z.absConsValueAveragePerCent=0<a.contObject.heatArea&&null!==e.absConsValue&&0!==e.absConsValue?Number((z.absConsValueAverage/e.absConsValue*a.contObject.heatArea*100).toFixed(2)):null;z.tempValue=Number((c.tempValue-e.tempValue).toFixed(2));z.absConsValuePerCent=0<e.absConsValue?Number(((c.absConsValue-e.absConsValue)/e.absConsValue*100).toFixed(2)):null;z.tempValuePerCent=0<e.tempValue?Number(((c.tempValue-
e.tempValue)/e.tempValue*100).toFixed(2)):null;r.push(z)}});b.diffObjectData=r;b.diffData=d}b.comparingFlag=!1})},p=function(a,d){b.mapSettings.abortCompareFlag=!1;b.markerSettings.cmpDataFlag=!0;b.markerSettings.runFlag=!0;var e=angular.copy(d);e.cityCompareFlag=!0;c(a,e)},y=function(a){var c="<div id='"+a.cityFiasUUID+"' class=''>",c=c+("<label>"+a.cityName+"</label>, "+a.cityObjects.length+" \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 <button class='glyphicon glyphicon-search marginLeft5' ng-click='viewObjectsOnMap(\""+
a.cityFiasUUID+"\")' title='\u0421\u043c. \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043a\u0430\u0440\u0442\u0435'></button><br>"),c=c+"<hr class='nmc-hr-in-modal'>"+("\u041f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435 \u0432 \u043f\u0435\u0440\u0438\u043e\u0434 \u0441 "+moment(b.mapSettings.dateFrom).format(b.mapSettings.userFormat)+" \u043f\u043e "+moment(b.mapSettings.dateTo).format(b.mapSettings.userFormat)+"<br>"),c=c+"<div class='row nmc-hide' ng-class=\"{'nmc-hide':!markerSettings.cmpFlag,'nmc-show':markerSettings.cmpFlag}\">    <div class='col-md-8'>\u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441 \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u044b\u043c \u043f\u0435\u0440\u0438\u043e\u0434\u043e\u043c        <select ng-model='daysAgo' ng-init='daysAgo=\"30\";changeCmpPeriod(markerSettings, daysAgo, cmpPeriod)' ng-change='changeCmpPeriod(markerSettings, daysAgo, cmpPeriod)'>            <option value='30'>\u043c\u0435\u0441\u044f\u0446 \u043d\u0430\u0437\u0430\u0434</option>            <option value='92'>\u043a\u0432\u0430\u0440\u0442\u0430\u043b \u043d\u0430\u0437\u0430\u0434</option>            <option value='182'>\u043f\u043e\u043b \u0433\u043e\u0434\u0430 \u043d\u0430\u0437\u0430\u0434</option>            <option value='365'>\u0433\u043e\u0434 \u043d\u0430\u0437\u0430\u0434</option>        </select>        <div>            \u0441 {{cmpPeriod.dateFromUserformat}} \u043f\u043e {{cmpPeriod.dateToUserformat}}        </div>    </div>    <div class='col-md-3'>        <button title='\u0421\u0440\u0430\u0432\u043d\u0438\u0442\u044c' ng-disabled='markerSettings.runFlag' class='btn btn-xs btn-primary' ng-click='comparingFlag=true;getObjectsConsumingForCity(curCity, cmpPeriod)'>\u0421\u0440\u0430\u0432\u043d\u0438\u0442\u044c</button><span ng-show=\"comparingFlag\" class=\"nmc-loading marginLeft5\"><i class=\"fa fa-spinner fa-spin\"></i> </span>    </div></div><div class='text-center'>    <i class='btn btn-xs glyphicon glyphicon-chevron-down' ng-class=\"{'glyphicon-chevron-down':!markerSettings.cmpFlag,'glyphicon-chevron-up':markerSettings.cmpFlag}\" ng-click='compareWith()'></i></div><hr class='nmc-hr-in-modal'><table class='table table-striped table-condensed nmc-table-popup'>    <tr>        <td class='col-md-4'>            <label>\u0413\u043e\u0440\u044f\u0447\u0430\u044f \u0432\u043e\u0434\u0430:</label>        </td>        <td class='col-md-4'>        </td>        <td class='col-md-4'>            <span ng-if='markerSettings.cmpDataFlag'><label>\u0413\u043e\u0440\u044f\u0447\u0430\u044f \u0432\u043e\u0434\u0430:</label></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>"+
("            "+a.servicesSummary.hw+" "+a.servicesSummary.hwMeasureUnit),c=c+"        </td>        <td>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")&&(diffData.hw>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.hwPerCent<100),'nmc-alert':(diffData.hwPerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")&&(diffData.hw<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.hwPerCent<100),'nmc-alert':(diffData.hwPerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")'>{{diffData.hwPerCent}}% <span class='marginRight5'></span> {{diffData.hw}} \u043c<sup>3</sup></span>        </td>        <td>            <span ng-if='markerSettings.cmpDataFlag'><span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>            {{newData.hw}} <span ng-if='(newData.hw!=null)&&(newData.hw!=\"NaN\")&&(newData.hw!=\"Infinity\")&&(newData.hw!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.hw!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u043c<sup>3</sup></span></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>"+
("            "+a.servicesSummary.hwAverage+" "+a.servicesSummary.hwAverageMeasureUnit),c=c+"        </td>        <td>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")&&(diffData.hwAverage>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.hwAveragePerCent<100),'nmc-alert':(diffData.hwAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")&&(diffData.hwAverage<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.hwAveragePerCent<100),'nmc-alert':(diffData.hwAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")'>{{diffData.hwAveragePerCent}}% <span class='marginRight5'></span> {{diffData.hwAverage}} \u043c<sup>3</sup>/\u043c<sup>2</sup></span>        </td>        <td>           <span ng-if='markerSettings.cmpDataFlag'> <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>            {{newData.hwAverage}} <span ng-if='(newData.hwAverage!=null)&&(newData.hwAverage!=\"NaN\")&&(newData.hwAverage!=\"Infinity\")&&(newData.hwAverage!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.hwAverage!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u043c<sup>3</sup>/\u043c<sup>2</sup></span></span>        </td>    </tr>    <tr >        <td>            <label >\u041e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u0435:</label>        </td>        <td>        </td>        <td>            <span ng-if='markerSettings.cmpDataFlag'><label>\u041e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u0435:</label></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>"+
("            "+a.servicesSummary.heat+" "+a.servicesSummary.heatMeasureUnit),c=c+"        </td>        <td>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!=\"Infinity\")&&(diffData.heat>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.heatPerCent<100),'nmc-alert':(diffData.heatPerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!=\"Infinity\")&&(diffData.heat<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.heatPerCent<100),'nmc-alert':(diffData.heatPerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!==\"Infinity\")'>{{diffData.heatPerCent}}% <span class='marginRight5'></span> {{diffData.heat}} \u0413\u041a\u0430\u043b</span>        </td>        <td>           <span ng-if='markerSettings.cmpDataFlag'> <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>            {{newData.heat}} {{newData.heatMeasureUnit}}</span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>"+
("            "+a.servicesSummary.heatAverage+" "+a.servicesSummary.heatAverageMeasureUnit);return c+"        </td>        <td>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!=\"Infinity\")&&(diffData.heatAverage>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.heatAveragePerCent<100),'nmc-alert':(diffData.heatAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!=\"Infinity\")&&(diffData.heatAverage<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.heatAveragePerCent<100),'nmc-alert':(diffData.heatAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!==\"Infinity\")'>{{diffData.heatAveragePerCent}}% <span class='marginRight5'></span> {{diffData.heatAverage}} \u0413\u041a\u0430\u043b/\u043c<sup>2</sup></span>        </td>        <td>            <span ng-if='markerSettings.cmpDataFlag'><span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>            {{newData.heatAverage}} <span ng-if='(newData.heatAverage!=null)&&(newData.heatAverage!=\"NaN\")&&(newData.heatAverage!=\"Infinity\")&&(newData.heatAverage!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.heatAverage!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u0413\u041a\u0430\u043b/\u043c<sup>2</sup></span></span>        </td>    </tr></table>    </div></div>"};
b.prepareCityMarker=function(a,c){if(null!==a.cityGeoPosX&&null!==a.cityGeoPosY){e(a);var d=y(a);c.focus=!1;c.city=a;c.lng=a.cityGeoPosX;c.lat=a.cityGeoPosY;c.getMessageScope=null;c.getMessageScope=function(){angular.extend(b,{markerSettings:{cmpFlag:!1,dateFrom:b.mapSettings.dateFrom,dateTo:b.mapSettings.dateTo}});var a=angular.copy(c.city);angular.extend(b,{curCity:a});angular.extend(b,{changeCmpPeriod:x});angular.extend(b,{compareWith:v});angular.extend(b,{viewObjectsOnMap:u});angular.extend(b,
{getObjectsConsumingForCity:p});return b};c.message=d;c.compileMessage=!0;c.icon=angular.copy(l);c.cityFiasUUID=a.cityFiasUUID;return c}};var F=function(a,b){var c=[];angular.isDefined(b.length)&&0!=b.length&&(b.forEach(function(b,d){if(!angular.isUndefined(b.cityFiasUUID)){var e=!0;a.some(function(a){if(a.cityFiasUUID===b.cityFiasUUID)return e=!1,!0});!0===e&&c.push(d)}}),c.forEach(function(a){b.splice(a,1)}));return b};b.setCitiesOnMap=function(a,c){if(!angular.isArray(a)||0===a.length||!angular.isArray(c))return[];
c=F(a,c);var d=[];a.forEach(function(a){if(angular.isUndefined(a.cityGeoPosX)||angular.isUndefined(a.cityGeoPosY)||null===a.cityGeoPosX||null===a.cityGeoPosY)console.warn("Warning. City without coordinates."),console.warn(a);else{var c={},e=!1;angular.isDefined(d.length)&&0!=d.length&&d.some(function(b){if(angular.isUndefined(b.cityFiasUUID))return!1;if(a.cityFiasUUID===b.cityFiasUUID)return c=b,e=!0});c=b.prepareCityMarker(a,c);c.focus=!1;!0!==e&&d.push(c)}});for(var e=d.length;1<=e;)--e,angular.isUndefined(d[e].cityFiasUUID)&&
d.splice(e,1);b.mapSettings.drawMarkersFlag=!1;return d};var G=function(a){var c=t(a),d="<div id='"+a.contObject.id+"' class=''>",d=d+("<label>"+a.contObject.fullName+"</label><br>"),d=d+"<hr class='nmc-hr-in-modal'>"+("\u041f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435 \u0432 \u043f\u0435\u0440\u0438\u043e\u0434 \u0441 "+moment(b.mapSettings.dateFrom).format(b.mapSettings.userFormat)+" \u043f\u043e "+moment(b.mapSettings.dateTo).format(b.mapSettings.userFormat)+"<br>"),d=d+"<div class='row nmc-hide' ng-class=\"{'nmc-hide':!markerSettings.cmpFlag,'nmc-show':markerSettings.cmpFlag}\">    <div class='col-md-9'>\u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441 \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u044b\u043c \u043f\u0435\u0440\u0438\u043e\u0434\u043e\u043c        <select ng-model='daysAgo' ng-init='daysAgo=\"30\";changeCmpPeriod(markerSettings, daysAgo, cmpPeriod)' ng-change='changeCmpPeriod(markerSettings, daysAgo, cmpPeriod)'>            <option value='30'>\u043c\u0435\u0441\u044f\u0446 \u043d\u0430\u0437\u0430\u0434</option>            <option value='92'>\u043a\u0432\u0430\u0440\u0442\u0430\u043b \u043d\u0430\u0437\u0430\u0434</option>            <option value='182'>\u043f\u043e\u043b \u0433\u043e\u0434\u0430 \u043d\u0430\u0437\u0430\u0434</option>            <option value='365'>\u0433\u043e\u0434 \u043d\u0430\u0437\u0430\u0434</option>        </select>        <div>            \u0441 {{cmpPeriod.dateFromUserformat}} \u043f\u043e {{cmpPeriod.dateToUserformat}}        </div>    </div>    <div class='col-md-2'>        <button title='\u0421\u0440\u0430\u0432\u043d\u0438\u0442\u044c' ng-diabled='markerSettings.runFlag' class='btn btn-xs btn-primary' ng-click='getObjectsConsumingForObject(curObject,cmpPeriod)'>\u0421\u0440\u0430\u0432\u043d\u0438\u0442\u044c</button><span ng-show=\"comparingFlag\" class=\"nmc-loading marginLeft5\"><i class=\"fa fa-spinner fa-spin\"></i> </span>    </div></div><div class='text-center'>    <i class='btn btn-xs glyphicon glyphicon-chevron-down' ng-class=\"{'glyphicon-chevron-down':!markerSettings.cmpFlag,'glyphicon-chevron-up':markerSettings.cmpFlag}\" ng-click='compareWith()'></i></div><hr class='nmc-hr-in-modal'><table class='table table-striped table-condensed nmc-table-popup'>    <tr>        <td class='col-md-4'>            <label>\u0413\u043e\u0440\u044f\u0447\u0430\u044f \u0432\u043e\u0434\u0430:</label>        </td>        <td class='col-md-4'>        </td>        <td class='col-md-4'>            <span ng-if='markerSettings.cmpDataFlag'><label>\u0413\u043e\u0440\u044f\u0447\u0430\u044f \u0432\u043e\u0434\u0430:</label></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>"+
("            "+c.hw+" "+c.hwMeasureUnit),d=d+"        </td>        <td>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")&&(diffData.hw>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.hwPerCent<100),'nmc-alert':(diffData.hwPerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")&&(diffData.hw<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.hwPerCent<100),'nmc-alert':(diffData.hwPerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")'>{{diffData.hwPerCent}}% <span class='marginRight5'></span> {{diffData.hw}} \u043c<sup>3</sup></span>        </td>        <td>            <span ng-if='markerSettings.cmpDataFlag'><span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span></span>            {{newData.hw}} <span ng-if='(newData.hw!=null)&&(newData.hw!=\"NaN\")&&(newData.hw!=\"Infinity\")&&(newData.hw!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.hw!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u043c<sup>3</sup></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>"+
("            "+c.hwAverage+" "+c.hwAverageMeasureUnit),d=d+"        </td>        <td>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")&&(diffData.hwAverage>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.hwAveragePerCent<100),'nmc-alert':(diffData.hwAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")&&(diffData.hwAverage<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.hwAveragePerCent<100),'nmc-alert':(diffData.hwAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")'>{{diffData.hwAveragePerCent}}% <span class='marginRight5'></span> {{diffData.hwAverage}} \u043c<sup>3</sup>/\u043c<sup>2</sup></span>        </td>        <td>            <span ng-if='markerSettings.cmpDataFlag'><span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span></span>            {{newData.hwAverage}} <span ng-if='(newData.hwAverage!=null)&&(newData.hwAverage!=\"NaN\")&&(newData.hwAverage!=\"Infinity\")&&(newData.hwAverage!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.hwAverage!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u043c<sup>3</sup>/\u043c<sup>2</sup></span>        </td>    </tr>    <tr >        <td>            <label >\u041e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u0435:</label>        </td>        <td>        </td>        <td>           <span ng-if='markerSettings.cmpDataFlag'> <label>\u041e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u0435:</label></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>"+
("            "+c.heat+" "+c.heatMeasureUnit),d=d+"        </td>        <td>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!=\"Infinity\")&&(diffData.heat>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.heatPerCent<100),'nmc-alert':(diffData.heatPerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!=\"Infinity\")&&(diffData.heat<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.heatPerCent<100),'nmc-alert':(diffData.heatPerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!=\"Infinity\")'>{{diffData.heatPerCent}}% <span class='marginRight5'></span> {{diffData.heat}} \u0413\u041a\u0430\u043b</span>        </td>        <td>           <span ng-if='markerSettings.cmpDataFlag'> <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>            {{newData.heat}} {{newData.heatMeasureUnit}}</span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>"+
("            "+c.heatAverage+" "+c.heatAverageMeasureUnit);return d+"        </td>        <td>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!=\"Infinity\")&&(diffData.heatAverage>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.heatAveragePerCent<100),'nmc-alert':(diffData.heatAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!=\"Infinity\")&&(diffData.heatAverage<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.heatAveragePerCent<100),'nmc-alert':(diffData.heatAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!==\"Infinity\")'>{{diffData.heatAveragePerCent}}% <span class='marginRight5'></span> {{diffData.heatAverage}} \u0413\u041a\u0430\u043b/\u043c<sup>2</sup></span>        </td>        <td>           <span ng-if='markerSettings.cmpDataFlag'> <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>            {{newData.heatAverage}} <span ng-if='(newData.heatAverage!=null)&&(newData.heatAverage!=\"NaN\")&&(newData.heatAverage!=\"Infinity\")&&(newData.heatAverage!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.heatAverage!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u0413\u041a\u0430\u043b/\u043c<sup>2</sup></span> </span>        </td>    </tr></table>    </div></div>"};
b.prepareObjectMarker=function(a,c){if(null!==a.contObjectGeo.geoPosX&&null!==a.contObjectGeo.geoPosY){var d=G(a);c.focus=!1;c.object=a;c.lng=a.contObjectGeo.geoPosX;c.lat=a.contObjectGeo.geoPosY;c.getMessageScope=null;c.getMessageScope=function(){angular.extend(b,{markerSettings:{cmpFlag:!1,dateFrom:b.mapSettings.dateFrom,dateTo:b.mapSettings.dateTo}});var a=angular.copy(c.object);angular.extend(b,{curObject:a});angular.extend(b,{changeCmpPeriod:x});angular.extend(b,{compareWith:v});angular.extend(b,
{viewObjectsOnMap:u});angular.extend(b,{getObjectsConsumingForObject:w});a=angular.copy(c.city);angular.extend(b,{curCity:a});angular.extend(b,{getObjectsConsumingForCity:p});return b};c.message=d;c.compileMessage=!0;c.icon=angular.copy(l);c.contObjectId=a.contObject.id;return c}};var C=function(a,b){var c=[];angular.isDefined(b.length)&&0!=b.length&&(b.forEach(function(b,d){if(!angular.isUndefined(b.contObjectId)){var e=!0;a.some(function(a){if(a.contObject.id===b.contObjectId)return e=!1,!0});!0===
e&&c.push(d)}}),c.forEach(function(a){b.splice(a,1)}));return b};b.setObjectsOnMap=function(a,c){if(!angular.isArray(a)||0===a.length||!angular.isArray(c))return[];c=C(a,c);a.forEach(function(a){if(angular.isUndefined(a.contObjectGeo.geoPosX)||angular.isUndefined(a.contObjectGeo.geoPosY)||null===a.contObjectGeo.geoPosX||null===a.contObjectGeo.geoPosY)console.warn("Warning. Object without coordinates."),console.warn(a);else{var d={},e=!1;angular.isDefined(c.length)&&0!=c.length&&c.some(function(b){if(angular.isUndefined(b.contObjectId))return!1;
if(a.contObject.id===b.contObjectId)return d=b,e=!0});d=b.prepareObjectMarker(a,d);d.focus=!1;!0!==e&&c.push(d)}});for(var d=c.length;1<=d;)--d,angular.isUndefined(c[d].contObjectId)&&c.splice(d,1);b.mapSettings.drawMarkersFlag=!1;return c};b.mapCenter.zoom>b.mapSettings.zoomBound?(f=b.setObjectsOnMap(b.objectsOfCities,f),b.markersOnMap=f):(n=b.setCitiesOnMap(b.cities,n),b.markersOnMap=n);b.$watch("mapCenter.zoom",function(a,c){h.setObjectSettings({mapZoom:a});var d=null;if(a>b.mapSettings.zoomBound&&
c<=b.mapSettings.zoomBound){if(!0===b.viewCurrentCityObjectsFlag){b.viewCurrentCityObjectsFlag=!1;return}d=document.getElementsByClassName("leaflet-pane leaflet-popup-pane");d[0].innerHTML="";f=b.setObjectsOnMap(b.objectsOfCities,f);b.markersOnMap=[];k(function(){b.markersOnMap=f},10)}a<=b.mapSettings.zoomBound&&c>b.mapSettings.zoomBound&&(d=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),d[0].innerHTML="",n=b.setCitiesOnMap(b.cities,n),b.markersOnMap=[],k(function(){b.markersOnMap=
n},10))},!1);b.$watch("mapCenter.lat",function(a){h.setObjectSettings({mapCenterLat:a})});b.$watch("mapCenter.lng",function(a){h.setObjectSettings({mapCenterLng:a})});b.objectDates={startDate:moment().subtract(30,"days").startOf("day"),endDate:moment().endOf("day")};b.queryDateOptsObjMapRu={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",fromLabel:"\u0441",toLabel:"\u043f\u043e",cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",
daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
ranges:{"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0434\u0435\u043d\u044c":[moment().startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 7 \u0434\u043d\u0435\u0439":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 30 \u0434\u043d\u0435\u0439":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},startDate:moment().subtract(30,"days").startOf("day"),endDate:moment().endOf("day"),maxDate:moment().endOf("day"),format:"DD.MM.YYYY",
separator:" \u043f\u043e "};b.$watch("objectDates",function(a,c){if(!angular.isUndefined(c)&&c!==a){b.mapSettings.dateFrom=moment(a.startDate).format("YYYY-MM-DD");b.mapSettings.dateTo=moment(a.endDate).format("YYYY-MM-DD");var d=document.getElementsByClassName("leaflet-pane leaflet-popup-pane");angular.isDefined(d)&&(d[0].innerHTML="");b.mapSettings.loadingFlag=!0;b.mapSettings.drawMarkersFlag=!b.mapSettings.loadingFlag;q()}},!1);b.$on("leafletDirectiveMarker.click",function(a,c){b.diffObjectData=
[];b.newObjectData=[];b.newCityData={};b.diffCityData={};b.diffData={};b.newData={}});a.$on("objectSvc:loaded",function(){b.mapSettings.loadingFlag=h.getLoadingStatus()});window.onkeydown=function(a){27==a.keyCode&&(a=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),angular.isDefined(a)&&(a[0].innerHTML=""),b.mapSettings.abortCompareFlag=!0)};b.$on("$destroy",function(){window.onkeydown=void 0});var H=function(a){var b=!1;g.getContextIds().forEach(function(c){0==c.permissionTagId.localeCompare(a)&&
(b=!0);var d=document.getElementById(c.permissionTagId);angular.isUndefined(d)||null==d||$("#"+c.permissionTagId).removeClass("nmc-hide")});0==b&&window.location.assign("#/")};H(b.mapSettings.ctxId);a.$on("servicePermissions:loaded",function(){H(b.mapSettings.ctxId)})}]);app=angular.module("portalNMC");
app.controller("ObjectGroupsCtrl",["$rootScope","$scope","crudGridDataFactory","notificationFactory","objectSvc","mainSvc",function(a,b,d,h,g,k){a.ctxId="object_groups_page";b.ctrlSettings={};b.ctrlSettings.selectedAll=!1;b.groups=[];b.objects=[];b.availableObjects=[];b.selectedObjects=[];b.objectsBackup=[];b.currentGroup={};b.orderBy={field:"contGroupName",asc:!0};b.objectUrl="../api/subscr/contObjects";b.groupUrl="../api/subscr/contGroup";var f=function(a){h.success();$("#deleteGroupModal").modal("hide");
$("#editGroupModal").modal("hide");b.currentGroup={};b.getData(b.groupUrl,"groups")},n=function(a){a=k.errorCallbackHandler(a);h.errorInfo(a.caption,a.description)};b.saveGroup=function(){var a=b.selectedObjects.map(function(a,b,c){return a.id});null==b.currentGroup.id?d(b.groupUrl).save({contObjectIds:a},b.currentGroup,f,n):d(b.groupUrl).update({contObjectIds:a},b.currentGroup,f,n)};b.deleteGroup=function(a){d(b.groupUrl)["delete"]({id:a.id},f,n)};b.getData=function(a,f){d(a).query(function(a){switch(f){case "groups":k.sortItemsBy(a,
"contGroupName");b.groups=angular.copy(a);break;case "availableObjects":b.availableObjects=angular.copy(a);g.sortObjectsByFullName(b.availableObjects);break;case "selectedObjects":b.selectedObjects=angular.copy(a);g.sortObjectsByFullName(b.selectedObjects);break;default:console.log("Data type is undefined.")}})};b.selectedGroup=function(a){b.showAvailableObjects_flag=!1;b.currentGroup=a;b.getData(b.groupUrl+"/"+a.id+"/contObject","selectedObjects");b.getData(b.groupUrl+"/"+a.id+"/contObject/available",
"availableObjects")};b.addGroup=function(){b.currentGroup={};b.selectedObjects=[];b.showAvailableObjects_flag=!1;b.getData(b.groupUrl+"/0/contObject/available","availableObjects");$("#editGroupModal").modal()};b.checkForm=function(){return!(""===b.currentGroup.contGroupName||null==b.currentGroup.contGroupName)};b.removeSelectedObject=function(a){b.availableObjects.push(a);b.selectedObjects.splice(b.selectedObjects.indexOf(a),1)};b.selectAllAvailableEntities=function(){var a;for(a=0;a<b.availableObjects.length;a+=
1)b.availableObjects[a].selected=b.ctrlSettings.selectedAll};b.addSelectedObjects=function(){var a=angular.copy(b.availableObjects),d;for(d=0;d<b.availableObjects.length;d+=1){var e=b.availableObjects[d];if(e.selected){var c=angular.copy(e);c.selected=null;var f=-1;a.some(function(a,b,c){return a.fullName===e.fullName?(f=b,!0):!1});a.splice(f,1);b.selectedObjects.push(c);e.selected=null}}b.availableObjects=a;b.showAvailableObjects_flag=!1};b.isSystemuser=function(){b.userInfo=a.userInfo;return b.userInfo._system};
b.isSystemViewInfo=function(){return k.getViewSystemInfo()};b.setOrderBy=function(a){b.orderBy={field:a,asc:b.orderBy.field===a?!b.orderBy.asc:!0}};b.getData(b.groupUrl,"groups");b.isAdmin=function(){return k.isAdmin()};b.isReadonly=function(){return k.isReadonly()};b.isROfield=function(){return b.isReadonly()}}]);app=angular.module("portalNMC");
app.controller("ParamSetsCtrl",["$scope","$rootScope","$resource","$http","crudGridDataFactory","notificationFactory","objectSvc","mainSvc","reportSvc","$filter",function(a,b,d,h,g,k,f,n,l,m){function e(a){return null!=a.paramSpecialType.specialTypeDirectoryUrl&&"undefined"!=typeof a.paramSpecialType.specialTypeDirectoryUrl&&null!=a.paramSpecialType.specialTypeDirectoryKey&&"undefined"!=typeof a.paramSpecialType.specialTypeDirectoryKey&&null!=a.paramSpecialType.specialTypeDirectoryCaption&&"undefined"!=
typeof a.paramSpecialType.specialTypeDirectoryCaption&&null!=a.paramSpecialType.specialTypeDirectoryValue&&"undefined"!=typeof a.paramSpecialType.specialTypeDirectoryValue}function c(){var b=null,b=a.currentReportType.reportMetaParamSpecialList.map(function(b){var c={};c.paramSpecialCaption=b.paramSpecialCaption;c.reportMetaParamSpecialId=b.id;c.paramSpecialRequired=b.paramSpecialRequired;c.paramSpecialTypeKeyname=b.paramSpecialType.keyname;c.reportMetaParamCategory=b.reportMetaParamCategory;c.reportMetaParamCategoryOrder=
b.reportMetaParamCategory.categoryOrder;c.reportMetaParamCategoryKeyname=b.reportMetaParamCategoryKeyname;c.reportMetaParamOrder=b.reportMetaParamOrder;c.reportMetaParamFullOrder=1E3*b.reportMetaParamCategory.categoryOrder+(n.checkUndefinedNull(b.reportMetaParamOrder)?0:b.reportMetaParamOrder);e(b)&&(c.specialTypeDirectoryUrl=b.paramSpecialType.specialTypeDirectoryUrl,c.specialTypeDirectoryKey=b.paramSpecialType.specialTypeDirectoryKey,c.specialTypeDirectoryCaption=b.paramSpecialType.specialTypeDirectoryCaption,
c.specialTypeDirectoryValue=b.paramSpecialType.specialTypeDirectoryValue,a.getDirectory(".."+c.specialTypeDirectoryUrl,c));c.textValue=null;c.boolValue=null;c.numericValue=null;c.oneDateValue=null;c.startDateValue=null;c.endDateValue=null;c.oneDateValueFormatted=null;c.startDateValueFormatted=null;c.endDateValueFormatted=null;return c});q(b);n.sortNumericItemsBy(b,"reportMetaParamFullOrder");a.currentParamSpecialList=b}function q(a){var b=[];a.forEach(function(a){var c=!1;b.forEach(function(b){if(b.keyname===
a.reportMetaParamCategory.keyname)return c=!0});!1===c&&b.push(angular.copy(a.reportMetaParamCategory))});var c=[];b.forEach(function(b,d){a.some(function(a){if(a.reportMetaParamCategory.keyname===b.keyname&&"SPECIAL_CATEGORY_SWITCH"===a.paramSpecialTypeKeyname)return c.push(b.keyname),!0})});c.forEach(function(a){b.some(function(c,d){if(c.keyname===a)return b.splice(d,1),!0})});b.forEach(function(b){var c=angular.copy(b);c.paramSpecialCaption=b.caption;c.paramSpecialTypeKeyname="SPECIAL_CATEGORY_CAPTION";
c.reportMetaParamFullOrder=1E3*b.categoryOrder-1;c.paramSpecialRequired=!1;c.reportMetaParamCategory=angular.copy(b);a.push(c)})}function t(a){a.forEach(function(b,c){"SPECIAL_CATEGORY_CAPTION"===b.paramSpecialTypeKeyname&&a.splice(c,1)})}b.ctxId="param_sets_page";var u=36E5*n.getServerTimeZone();a.ctrlSettings={};a.ctrlSettings.dateFormat="DD.MM.YYYY";a.ctrlSettings.selectedAll=!1;a.ctrlSettings.ctxId="paramset_page";a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.currentSign=9999;a.columns=
[{name:"reportType",header:"\u0422\u0438\u043f \u043e\u0442\u0447\u0435\u0442\u0430","class":"col-xs-11 col-md-11"}];a.paramsetColumns=[{name:"name",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-xs-5 col-md-5"},{name:"period",header:"\u041f\u0435\u0440\u0438\u043e\u0434","class":"col-xs-2 col-md-2"},{name:"fileType",header:"\u0422\u0438\u043f \u0444\u0430\u0439\u043b\u0430","class":"col-xs-1 col-md-1"},{name:"outputFileNameTemplate",header:"\u0428\u0430\u0431\u043b\u043e\u043d \u0438\u043c\u0435\u043d\u0438 \u0444\u0430\u0439\u043b\u0430",
"class":"col-xs-3 col-md-3"}];a.extraProps={idColumnName:"id",defaultOrderBy:"name",deleteConfirmationProp:"name"};a.createParamset_flag=!1;a.editParamset_flag=!1;a.createByTemplate_flag=!1;a.currentObject={};a.createByTemplate_flag=!1;a.archiveParamset={};a.activeStartDateFormat=new Date;a.activeStartDateFormatted=moment().format(a.ctrlSettings.dateFormat);a.currentParamSpecialList=null;a.fileTypes=["PDF","HTML","XLSX"];a.groupUrl="../api/subscr/contGroup";a.crudTableName="../api/reportParamset";
a.headers={};a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b";a.objects=[];a.availableObjectGroups=[];a.categories=l.getReportCategories();a.contServiceTypes=l.getContServiceTypes();a.isSystemuser=function(){return n.isSystemuser()};l.getReportPeriodsIsLoaded()&&(a.reportPeriods=angular.copy(l.getReportPeriods()));var v=function(b){k.success();$("#moveToArchiveModal").modal("hide");a.createByTemplate_flag||a.getActive();$("#createParamsetModal").modal("hide");
a.setDefault()},x=function(b){k.success();$("#deleteObjectModal").modal("hide");a.getArchive();a.setDefault()},w=function(a){a=n.errorCallbackHandler(a);k.errorInfo(a.caption,a.description)};a.deleteObject=function(b){g(a.crudTableName+"/archive"+a.currentReportType.suffix)["delete"]({id:b[a.extraProps.idColumnName]},x,w)};a.getActive=function(){a.currentMode="";l.getReportTypesIsLoaded()&&(a.reportTypes=l.getReportTypes(),l.getParamsetsForTypes(a.reportTypes,a.currentMode))};a.getActive();a.getArchive=
function(){a.currentMode="/archive";l.getReportTypesIsLoaded()&&(a.reportTypes=l.getReportTypes(),l.getParamsetsForTypes(a.reportTypes,a.currentMode))};a.$on("reportSvc:reportTypesIsLoaded",function(){a.setCurrentServiceType(a.contServiceTypes[0]);var b=m("withReportTypes")(a.categories);angular.isArray(b)&&0<b.length&&(b[0]["class"]="active");a.setCurrentCategory(b[0]);a.reportTypes=l.getReportTypes();l.getParamsetsForTypes(a.reportTypes,a.currentMode)});a.$on("reportSvc:reportPeriodsIsLoaded",function(){a.reportPeriods=
l.getReportPeriods()});a.toggleShowGroupDetails=function(a,b){n.checkUndefinedNull(a.showGroupDetails)&&(a.showGroupDetails={});a.showGroupDetails[b.keyname]=!a.showGroupDetails[b.keyname]};a.selectedItem=function(b,c){a.setCurrentReportType(b);var d=angular.copy(c);a.currentObject=d;a.activeStartDateFormat=null==d.activeStartDate?null:new Date(d.activeStartDate);var e=new Date(d.activeStartDate);a.activeStartDateFormatted=null==d.activeStartDate?"":moment([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]).format(a.ctrlSettings.dateFormat);
a.getTemplates()};a.checkAndSaveParamset=function(b,c){if(!c.name||""==c.name)return k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430 \u043e\u0442\u0447\u0435\u0442\u0430. \u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u043f\u043e\u043b\u0435 '\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435'."),
"Add / edit paramset: no name";if(!n.checkUndefinedNull(b)&&angular.isArray(b)){var d;for(d=0;d<b.length;d+=1)if(c.id!=b[d].id&&0==c.name.localeCompare(b[d].name))return k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u0412\u0430\u0440\u0438\u0430\u043d\u0442 \u043e\u0442\u0447\u0435\u0442\u0430 \u0434\u043e\u043b\u0436\u0435\u043d \u0438\u043c\u0435\u0442\u044c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0435 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 . \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u0435 \u043f\u043e\u043b\u0435 '\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435'."),
"Add / edit paramset: name is not unique."}!1===a.checkRequiredFieldsOnSave()?$("#messageForUserModal").modal():a.saveParamset(c)};a.saveParamset=function(b){angular.isArray(a.currentParamSpecialList)&&a.currentParamSpecialList.forEach(function(b){var c=(new Date(moment(b.oneDateValueFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD"))).getTime();b.oneDateValue=isNaN(c)?null:c-u;b.startDateValue=null==b.startDateValueFormatted?null:b.startDateValueFormatted.getTime();b.endDateValue=null==b.endDateValueFormatted?
null:b.endDateValueFormatted.getTime()});b.paramSpecialList=a.currentParamSpecialList;var c="",d=a.selectedObjects.map(function(a){return a.id}),c=new Date(moment(a.activeStartDateFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD")),c=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate());b.activeStartDate=n.checkStrForDate(a.activeStartDateFormatted)?c:null;b.allRequiredParamsPassed=!b.showParamsBeforeRunReport;null==a.currentSign||"undefined"==typeof a.currentSign?(c=new Date(moment(a.psStartDateFormatted,
a.ctrlSettings.dateFormat).format("YYYY-MM-DD")),c=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate()),b.paramsetStartDate=isNaN(c)?null:new Date(c),c=new Date(moment(a.psEndDateFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD")),c=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate()),b.paramsetEndDate=isNaN(c)?null:new Date(c)):(b.paramsetStartDate=null,b.paramsetEndDate=null);if(a.createByTemplate_flag)b.id=null,c=a.crudTableName+"/createByTemplate/"+a.archiveParamset.id,g(c).save({contObjectIds:d},
b,v,w);else if(c=a.crudTableName+a.currentReportType.suffix,a.createParamset_flag&&(b._active=!0,g(c).save({reportTemplateId:b.reportTemplate.id,contObjectIds:d},b,v,w)),a.editParamset_flag){var e=!1;if(n.checkUndefinedNull(d)||0==d.length)e=!0;g(c).update({reportParamsetId:b.id,contObjectIds:d,clearContObjectIds:e},b,v,w)}};a.toArchive=function(a,b){return d(a,{},{update:{method:"PUT",params:{reportParamsetId:b}}})};a.moveToArchive=function(b){a.toArchive(a.crudTableName+"/archive/move",b.id).update({},
b,v,w)};var p=function(){$("#main_properties_tab").addClass("active");$("#set_of_objects_tab").removeClass("active");$("#extra_properties_tab").removeClass("active");$("#createParamsetModal").modal()};a.createByTemplate=function(b,c){a.selectedItem(b,c);a.createByTemplate_flag=!0;a.archiveParamset={};a.archiveParamset.id=c.id;a.archiveParamset.name=c.name;a.currentParamSpecialList=y(c,a.currentReportType);a.currentObject=angular.copy(c);a.currentObject.id=null;a.currentObject._active=!0;a.currentObject.activeEndDate=
null;a.getAvailableObjects(c.id);a.getSelectedObjects(a.archiveParamset.id);a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;p()};a.setDefault=function(){a.currentObject={};a.createByTemplate_flag=!1;a.archiveParamset={};a.activeStartDateFormat=null;a.activeStartDateFormatted="";a.currentReportType={};a.createParamset_flag=!1;a.editParamset_flag=!1;a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.currentSign=9999;a.selectedObjects=[]};a.currentReportType={};a.setCurrentReportType=
function(b){a.currentReportType=b};a.getDirectory=function(a,b){h.get(a).success(function(a){b.specialTypeDirectoryValues=a;n.checkUndefinedNull(b.directoryValue)&&(b.directoryValue=null,angular.isArray(a)&&0<a.length&&a.some(function(a){if(1==a.isDefault)return b.directoryValue=a[b.specialTypeDirectoryValue],!0}))}).error(function(a){console.log(a)})};a.addParamSet=function(b){a.setCurrentReportType(b);c();a.psStartDateFormatted=moment().format(a.ctrlSettings.dateFormat);a.psEndDateFormatted=moment().format(a.ctrlSettings.dateFormat);
a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.createByTemplate_flag=!1;a.createParamset_flag=!0;a.editParamset_flag=!1;a.currentSign=9999;a.getTemplates();a.getAvailableObjects(0);a.selectedObjects=[];p();a.currentObject={};a.currentObject.reportPeriodKey="CURRENT_MONTH";a.currentObject.outputFileType=a.fileTypes[0];a.currentReportPeriod={};a.currentObject.showParamsBeforeRunReport=!0;a.currentObject._active=!0;a.currentObject.paramSpecialList=[]};var y=function(b,c){var d=c.reportMetaParamSpecialList.map(function(c){var d=
{};d.paramSpecialCaption=c.paramSpecialCaption;d.reportMetaParamSpecialId=c.id;d.paramSpecialRequired=c.paramSpecialRequired;d.paramSpecialTypeKeyname=c.paramSpecialType.keyname;d.reportMetaParamCategory=c.reportMetaParamCategory;d.reportMetaParamCategoryOrder=c.reportMetaParamCategory.categoryOrder;d.reportMetaParamCategoryKeyname=c.reportMetaParamCategoryKeyname;d.reportMetaParamOrder=c.reportMetaParamOrder;d.reportMetaParamFullOrder=1E3*c.reportMetaParamCategory.categoryOrder+(n.checkUndefinedNull(c.reportMetaParamOrder)?
0:c.reportMetaParamOrder);e(c)&&(d.specialTypeDirectoryUrl=c.paramSpecialType.specialTypeDirectoryUrl,d.specialTypeDirectoryKey=c.paramSpecialType.specialTypeDirectoryKey,d.specialTypeDirectoryCaption=c.paramSpecialType.specialTypeDirectoryCaption,d.specialTypeDirectoryValue=c.paramSpecialType.specialTypeDirectoryValue,a.getDirectory(".."+d.specialTypeDirectoryUrl,d));if(0==b.paramSpecialList.length)return d.textValue=null,d.boolValue=null,d.numericValue=null,d.oneDateValue=null,d.startDateValue=
null,d.endDateValue=null,d.oneDateValueFormatted=null,d.startDateValueFormatted=null,d.endDateValueFormatted=null,d.directoryValue=null,d;var f=-1;b.paramSpecialList.some(function(a,b,d){return a.reportMetaParamSpecialId===c.id?(f=b,!0):!1});-1!=f?(d.id=b.paramSpecialList[f].id||null,d.textValue=b.paramSpecialList[f].textValue||null,d.boolValue=b.paramSpecialList[f].boolValue||null,d.numericValue=b.paramSpecialList[f].numericValue||null,d.oneDateValue=b.paramSpecialList[f].oneDateValue||null,d.startDateValue=
b.paramSpecialList[f].startDateValue||null,d.endDateValue=b.paramSpecialList[f].endDateValue||null,d.oneDateValueFormatted=null!==b.paramSpecialList[f].oneDateValue?moment.utc(b.paramSpecialList[f].oneDateValue+u).format(a.ctrlSettings.dateFormat):"",d.startDateValueFormatted=angular.isUndefined(b.paramSpecialList[f].startDateValue)||null==b.paramSpecialList[f].startDateValue?null:new Date(b.paramSpecialList[f].startDateValue),d.endDateValueFormatted=null==b.paramSpecialList[f].endDateValue?null:
new Date(b.paramSpecialList[f].endDateValue),n.checkUndefinedNull(b.paramSpecialList[f].directoryValue)?d.directoryValue=null:n.isNumeric(b.paramSpecialList[f].directoryValue)?d.directoryValue=Number(b.paramSpecialList[f].directoryValue):d.directoryValue=b.paramSpecialList[f].directoryValue,d.version=b.paramSpecialList[f].version||null):(d.id=null,d.textValue=null,d.boolValue=null,d.numericValue=null,d.oneDateValue=null,d.startDateValue=null,d.endDateValue=null,d.oneDateValueFormatted=null,d.startDateValueFormatted=
null,d.endDateValueFormatted=null,d.directoryValue=null);return d});q(d);n.sortNumericItemsBy(d,"reportMetaParamFullOrder");return d};a.editParamSet=function(b,c){a.selectedItem(b,c);a.currentParamSpecialList=y(c,a.currentReportType);a.currentObject.showParamsBeforeRunReport=!a.currentObject.allRequiredParamsPassed;a.createParamset_flag=!1;a.editParamset_flag=!0;a.createByTemplate_flag=!1;a.getAvailableObjects(c.id);a.getSelectedObjects(a.currentObject.id);a.currentSign=c.reportPeriod.sign;if(null==
a.currentSign||"undefined"==typeof a.currentSign)a.paramsetStartDateFormat=new Date(c.paramsetStartDate),a.psStartDateFormatted=null!=c.paramsetStartDate?moment([a.paramsetStartDateFormat.getUTCFullYear(),a.paramsetStartDateFormat.getUTCMonth(),a.paramsetStartDateFormat.getUTCDate()]).format(a.ctrlSettings.dateFormat):"",a.paramsetEndDateFormat=new Date(c.paramsetEndDate),a.psEndDateFormatted=null!=c.paramsetEndDate?moment([a.paramsetEndDateFormat.getUTCFullYear(),a.paramsetEndDateFormat.getUTCMonth(),
a.paramsetEndDateFormat.getUTCDate()]).format(a.ctrlSettings.dateFormat):"";a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;p()};a.availableObjects=[];a.selectedObjects=[];a.getAvailableObjects=function(b){g(a.crudTableName+"/"+b+"/contObject/available").query(function(b){a.availableObjects=angular.copy(b)})};a.getSelectedObjects=function(b){g(a.crudTableName+"/"+b+"/contObject").query(function(b){a.selectedObjects=b;f.sortObjectsByFullName(a.selectedObjects)})};a.prepareObjectsList=function(){a.availableObjectGroups.forEach(function(a){a.selected=
!1});a.ctrlSettings.selectedAll=!1};a.getGroupObjects=function(b){g(a.groupUrl+"/"+b.id+"/contObject").query(function(a){b.objects=a})};a.getAvailableObjectGroups=function(){g(a.groupUrl).query(function(b){b.forEach(function(b){a.getGroupObjects(b)});n.sortItemsBy(b,"contGroupName");a.availableObjectGroups=b})};a.getAvailableObjectGroups();a.viewAvailableObjects=function(b){a.showAvailableObjects_flag=!a.showAvailableObjects_flag;(a.showAvailableObjectGroups_flag=b)?(a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",
a.availableEntities=a.availableObjectGroups):(a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b",a.availableObjects=f.sortObjectsByFullNameEx(a.availableObjects),a.availableEntities=a.availableObjects)};a.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};a.deleteDoublesObjects=function(a){for(var b=a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&
a.splice(b,1)};a.addUniqueObjectsFromGroupsToSelectedObjects=function(a,b){var c,d;for(c=0;c<a.length;c+=1){var e=!0;for(d=0;d<b.length;d+=1)if(a[c].fullName===b[d].fullName){e=!1;break}e&&b.push(a[c])}};a.removeGroupObjectsFromAvailableObjects=function(a,b){var c,d;for(d=0;d<a.length;d+=1){var e=-1;for(c=0;c<b.length;c+=1)if(a[d].fullName===b[c].fullName){e=c;break}0<=e&&b.splice(e,1)}};var F=function(b,c){var d={},e=[],f=[],g=[];a.addObject_flag?(e=a.availableObjects,g=f=a.selectedObjects):(f=a.availableObjects,
g=e=a.selectedObjects);var r;for(r=0;r<e.length;r+=1)if(e[r].id==a.currentObjectId){d=angular.copy(e[r]);d.selected=!1;e.splice(r,1);break}f.push(d);return g.map(function(a){return a.id})};a.getResource=function(a,b){return d(a,{},{update:{method:"PUT",params:{reportParamsetId:b}},addObject:{method:"POST",params:{contObjectId:b}},removeObject:{method:"DELETE"}})};a.removeSelectedObject=function(b){a.availableObjects.push(b);a.selectedObjects.splice(a.selectedObjects.indexOf(b),1);a.availableObjects=
f.sortObjectsByFullNameEx(a.availableObjects)};a.selectAllAvailableEntities=function(){var b;for(b=0;b<a.availableEntities.length;b+=1)a.availableEntities[b].selected=a.ctrlSettings.selectedAll};a.addSelectedEntities=function(){if(a.showAvailableObjectGroups_flag){var b=a.joinObjectsFromSelectedGroups(a.availableEntities);f.sortObjectsByFullName(b);a.deleteDoublesObjects(b);a.addUniqueObjectsFromGroupsToSelectedObjects(b,a.selectedObjects);a.removeGroupObjectsFromAvailableObjects(b,a.availableObjects)}var b=
angular.copy(a.availableObjects),c;for(c=0;c<a.availableObjects.length;c+=1){var d=a.availableObjects[c];if(d.selected){var e=angular.copy(d);e.selected=null;var g=-1;b.some(function(a,b,c){return a.fullName===d.fullName?(g=b,!0):!1});b.splice(g,1);a.selectedObjects.push(e);d.selected=null}}a.availableObjects=b;a.showAvailableObjects_flag=!1;f.sortObjectsByFullName(a.selectedObjects)};a.removeObject=function(b){a.addObject_flag=!1;a.currentObjectId=b.id;F(!1,b.id)};a.templatesForCurrentParaset=[];
a.getTemplates=function(){g("../api/reportTemplate"+a.currentReportType.suffix).query(function(b){a.templatesForCurrentParaset=b;a.createParamset_flag&&(a.currentObject.reportTemplate=a.templatesForCurrentParaset[0])})};a.closeSaveObjectModal=function(){$("#saveObjectModal").hide()};var G=function(){$("#inputSettlementMonth").datepicker({dateFormat:"MM, yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,
monthNamesShort:"\u042f\u043d\u0432 \u0424\u0435\u0432 \u041c\u0430\u0440 \u0410\u043f\u0440 \u041c\u0430\u0439 \u0418\u044e\u043d \u0418\u044e\u043b \u0410\u0432\u0433 \u0421\u0435\u043d \u041e\u043a\u0442 \u041d\u043e\u044f \u0414\u0435\u043a".split(" "),changeMonth:!0,changeYear:!0,showButtonPanel:!0,closeText:"\u041e\u043a",currentText:"",onClose:function(b,c){$(this).datepicker("setDate",new Date(c.selectedYear,c.selectedMonth,1));a.currentObject.settlementMonth=c.selectedMonth+1;a.currentObject.settlementYear=
c.selectedYear;setTimeout(function(){$(".ui-datepicker-calendar").addClass("nmc-hide")},1)},beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").addClass("nmc-hide");$(".ui-datepicker-current").addClass("nmc-hide")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-current").addClass("nmc-hide");$(".ui-datepicker-calendar").addClass("nmc-hide")},1)}});$("#inputSettlementMonth").datepicker("setDate",new Date(a.currentObject.settlementYear,a.currentObject.settlementMonth-
1,1))};a.$watch("currentObject.reportPeriodKey",function(b){if(n.checkUndefinedNull(a.reportPeriods))return console.log(a.reportPeriods),"reportPeriods is undefined or null.";var c;for(c=0;c<a.reportPeriods.length;c+=1)b==a.reportPeriods[c].keyname&&(a.currentSign=a.reportPeriods[c].sign,a.currentReportPeriod=a.reportPeriods[c],null==a.currentSign||"undefined"==typeof a.currentSign)&&(a.paramsetStartDateFormat=null==a.currentObject.paramsetStartDate?null:new Date(a.currentObject.paramsetStartDate),
a.paramsetEndDateFormat=null==a.currentObject.paramsetEndDate?null:new Date(a.currentObject.paramsetEndDate));n.checkUndefinedNull(a.currentReportPeriod)||1!=a.currentReportPeriod.isSettlementMonth||(n.checkUndefinedNull(a.currentObject.settlementMonth)&&(a.currentObject.settlementMonth=(new Date).getMonth()+1),n.checkUndefinedNull(a.currentObject.settlementYear)&&(a.currentObject.settlementYear=(new Date).getFullYear()),G())},!1);a.isDisabled=function(){return a.isROfield()||a.currentObject.common||
!a.currentObject._active};a.isSpecialParamDisabled=function(b,c){var d=!1;c.some(function(a){if(b.reportMetaParamCategory.keyname===a.reportMetaParamCategory.keyname&&"SPECIAL_CATEGORY_SWITCH"===a.paramSpecialTypeKeyname&&!0!==a.boolValue)return d=!0});return a.isDisabled()||d};a.showAddObjectButton=function(){return!a.showAvailableObjects_flag&&a.set_of_objects_flag};a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),
firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},singleDatePicker:!0,format:a.ctrlSettings.dateFormat};
$(document).ready(function(){$("#inputSingleDateStart").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputSingleDateEnd").datepicker({dateFormat:"dd.mm.yy",
firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputStartDate").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,
monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});var C=function(a){n.getContextIds().forEach(function(b){b.permissionTagId.localeCompare(a);var c=document.getElementById(b.permissionTagId);angular.isUndefined(c)||null==c||$("#"+b.permissionTagId).removeClass("nmc-hide")})};C(a.ctrlSettings.ctxId);
b.$on("servicePermissions:loaded",function(){C(a.ctrlSettings.ctxId)});a.checkDateInterval=function(b,c){if(!n.checkStrForDate(b)||!n.checkStrForDate(c)||null==b||null==c||""==b||""==c)return!1;var d=n.strDateToUTC(b,a.ctrlSettings.dateFormat),d=null!=d?new Date(d):null,e=n.strDateToUTC(c,a.ctrlSettings.dateFormat),e=null!=e?new Date(e):null;return null==d||null==e?!1:e>=d};a.checkOutputFileZipped=function(){if(!a.currentReportType.hasOwnProperty("reportMetaParamCommon"))return!1;var b=!1;a.currentReportType.reportMetaParamCommon.manyContObjectsZipOnly&&
(1<a.selectedObjects.length||0===a.selectedObjects.length)&&(b=a.currentObject.outputFileZipped=!0);return b};a.checkRequiredFieldsOnSave=function(){a.currentObject.psStartDateFormatted=a.psStartDateFormatted;a.currentObject.psEndDateFormatted=a.psEndDateFormatted;a.currentObject.selectedObjects=a.selectedObjects;t(a.currentParamSpecialList);a.currentObject.currentParamSpecialList=a.currentParamSpecialList;a.currentObject.currentReportPeriod=a.currentReportPeriod;var b=l.checkPSRequiredFieldsOnSave(a.currentReportType,
a.currentObject,a.currentSign,"create");a.messageForUser=b.message;return b.flag};a.isAdmin=function(){return n.isAdmin()};a.isReadonly=function(){return n.isReadonly()};a.isTestMode=function(){return n.isTestMode()};a.isSystemViewInfo=function(){return n.getViewSystemInfo()};a.isROfield=function(){return a.isReadonly()};a.setActiveTab=function(a){var b;b=document.getElementById("a_teplo_sys");b.classList.remove("active");b=document.getElementById("a_electro_sys");b.classList.remove("active");b=document.getElementById("a_gas_sys");
b.classList.remove("active");b=document.getElementById(a);b.classList.add("active")};$("#createParamsetModal").on("shown.bs.modal",function(){3<Number(a.currentObject.settlementDay)&&9>=Number(a.currentObject.settlementDay)&&(a.currentObject.settlementDay="0"+a.currentObject.settlementDay,a.$apply());$("#inputSettlementDay").inputmask("d",{placeholder:""});$("#inputFileTemplate").inputmask("Regex",{regex:"[a-zA-Z0-9]+"});a.currentParamSpecialList.forEach(function(b){if("SPECIAL_DATE"!==b.paramSpecialTypeKeyname)return!0;
$("#inputSpecialDate"+b.reportMetaParamSpecialId).datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(a){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})})});a.setCurrentServiceType=function(b){a.currentServiceType=
angular.copy(b)};a.setCurrentCategory=function(b){a.currentCategory=b};a.setCurrentServiceType(a.contServiceTypes[0]);b=m("withReportTypes")(a.categories);angular.isArray(b)&&0<b.length&&(b[0]["class"]="active");a.setCurrentCategory(b[0]);a.preview=function(a){window.open(a.previewUrl)}}]);app=angular.module("portalNMC");
app.controller("ReportsCtrl",["$scope","$rootScope","$http","crudGridDataFactoryWithCanceler","notificationFactory","objectSvc","mainSvc","$timeout","reportSvc","$q","$filter",function(a,b,d,h,g,k,f,n,l,m,e){function c(b){$("#creationReportModal").modal("hide");!0===a.createReportInProgress&&0===b.status?a.createReportInProgress=!1:p(b)}function q(a){var b=[];a.forEach(function(a){var c=!1;b.forEach(function(b){if(b.keyname===a.reportMetaParamCategory.keyname)return c=!0});!1===c&&b.push(angular.copy(a.reportMetaParamCategory))});
var c=[];b.forEach(function(b,d){a.some(function(a){if(a.reportMetaParamCategory.keyname===b.keyname&&"SPECIAL_CATEGORY_SWITCH"===a.paramSpecialTypeKeyname)return c.push(b.keyname),!0})});c.forEach(function(a){b.some(function(c,d){if(c.keyname===a)return b.splice(d,1),!0})});b.forEach(function(b){var c=angular.copy(b);c.paramSpecialCaption=b.caption;c.paramSpecialTypeKeyname="SPECIAL_CATEGORY_CAPTION";c.reportMetaParamFullOrder=1E3*b.categoryOrder-1;c.paramSpecialRequired=!1;c.reportMetaParamCategory=
angular.copy(b);a.push(c)})}function t(a){a.forEach(function(b,c){"SPECIAL_CATEGORY_CAPTION"===b.paramSpecialTypeKeyname&&a.splice(c,1)})}var u=0,v=0,x=36E5*f.getServerTimeZone();b.ctxId="reports_page";a.ctrlSettings={};a.ctrlSettings.dateFormat="DD.MM.YYYY";a.ctrlSettings.selectedAll=!1;a.ctrlSettings.htmlLoading=f.getHtmlLoading();a.ctrlSettings.openModes={create:{name:"create",isContext:!1},edit:{name:"edit"},preview:{name:"preview"}};a.ctrlSettings.currentReportPreviewEnabledFlag=!1;a.contServiceTypes=
l.getContServiceTypes();var w=l.getRequestCanceler();a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.currentSign=9999;a.extraProps={idColumnName:"id",defaultOrderBy:"name",deleteConfirmationProp:"name"};a.activeStartDateFormat=new Date;a.activeStartDateFormatted=moment().format(a.ctrlSettings.dateFormat);a.fileTypes=["PDF","HTML","XLSX"];a.currentObject={};a.currentReportPeriod={};a.reportObjects=[];a.paramsetColumns=[{name:"name",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",
"class":"col-xs-5 col-md-5"},{name:"period",header:"\u041f\u0435\u0440\u0438\u043e\u0434","class":"col-xs-2 col-md-2"},{name:"fileType",header:"\u0422\u0438\u043f \u0444\u0430\u0439\u043b\u0430","class":"col-xs-1 col-md-1"},{name:"outputFileNameTemplate",header:"\u0428\u0430\u0431\u043b\u043e\u043d \u0438\u043c\u0435\u043d\u0438 \u0444\u0430\u0439\u043b\u0430","class":"col-xs-3 col-md-3"}];a.groupUrl="../api/subscr/contGroup";a.paramsetsUrl="../api/reportParamset";a.headers={};a.headers.addObjects=
"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b";a.ctrlSettings.reportCountList=5;a.createReportWithParamsInProgress=!1;a.isSystemuser=function(){a.userInfo=b.userInfo;return a.userInfo._system};a.categories=l.getReportCategories();a.resourceCategories=l.getResourceCategories();a.currentResourceCategory=l.getDefaultResourceCategory();a.setCurrentServiceType=function(b){a.currentServiceType=angular.copy(b)};a.setCurrentCategory=function(b){a.currentCategory=
b};a.$on("reportSvc:reportTypesIsLoaded",function(){a.setCurrentServiceType(a.contServiceTypes[0]);a.reportObjects=l.getReportTypes();u=a.reportObjects.length;a.getActive()});a.$on("reportSvc:reportPeriodsIsLoaded",function(){a.reportPeriods=l.getReportPeriods()});l.getReportPeriodsIsLoaded()&&(a.reportPeriods=angular.copy(l.getReportPeriods()));a.oldColumns=[{name:"name",header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430","class":"col-xs-5 col-md-5"},
{name:"activeStartDate",header:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 \u0441","class":"col-xs-2 col-md-2"}];var p=function(b){a.createReportWithParamsInProgress=!1;b=f.errorCallbackHandler(b);g.errorInfo(b.caption,b.description)};a.getSelectedObjectsByParamset=function(b,c,d){h(a.paramsetsUrl+"/"+c.id+"/contObject",w).query(function(a){f.checkUndefinedNull(d)||1!=d?c.selectedObjects=a:c.selectedObjects=[k.getCurrentObject()];k.sortObjectsByFullName(c.selectedObjects);c.currentParamSpecialList=
y(b,c);c.currentReportPeriod=angular.copy(c.reportPeriod);a=l.checkPSRequiredFieldsOnSave(b,c,c.reportPeriod.sign,"run");c.checkFlag=a.flag;c.messageForUser=a.message;f.checkUndefinedNull(b)||(b.checkedParamsetsCount+=1)})};a.getParamsets=function(b,c){h(b,w).query(function(b){c.paramsetsCount=b.length;c.checkedParamsetsCount=0;b=angular.copy(b);b.forEach(function(b){var d=b.reportPeriod.sign;if(null==d||"undefined"==typeof d)d=new Date(b.paramsetStartDate),b.psStartDateFormatted=null!=b.paramsetStartDate?
moment([d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()]).format(a.ctrlSettings.dateFormat):"",d=new Date(b.paramsetEndDate),b.psEndDateFormatted=null!=b.paramsetEndDate?moment([d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()]).format(a.ctrlSettings.dateFormat):"";a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.getSelectedObjectsByParamset(c,b)});f.sortItemsBy(b,"name");c.paramsets=b;v+=1;v===u&&n(function(){var b=e("notEmptyCategories")(a.categories);angular.isArray(b)&&0<b.length&&
(b[0]["class"]="active");a.setCurrentCategory(b[0])},100)})};a.getActive=function(){if(0!==a.reportObjects.length&&"undefined"!=typeof a.reportObjects[0].suffix){var b;for(b=0;b<a.reportObjects.length;b+=1)a.getParamsets(a.paramsetsUrl+a.reportObjects[b].suffix,a.reportObjects[b])}};l.getReportTypesIsLoaded()&&(a.reportObjects=l.getReportTypes(),u=a.reportObjects.length,a.getActive());a.toggleReportShowGroupDetails=function(a,b){f.checkUndefinedNull(a.showGroupDetails)&&(a.showGroupDetails={});a.showGroupDetails[b.keyname]=
!a.showGroupDetails[b.keyname]};a.selectedReport=function(b,c){a.setCurrentReportType(b);var d=angular.copy(c);a.currentObject=d;f.checkUndefinedNull(a.currentObject.settlementYear)&&(a.currentObject.settlementYear=(new Date).getFullYear());f.checkUndefinedNull(a.currentObject.settlementMonth)&&(a.currentObject.settlementMonth=(new Date).getMonth());a.activeStartDateFormat=null==d.activeStartDate?null:new Date(d.activeStartDate);var e=new Date(d.activeStartDate);a.activeStartDateFormatted=null==d.activeStartDate?
"":moment([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]).format(a.ctrlSettings.dateFormat);a.getTemplates()};a.checkAndRunParamset=function(b,c,d){if(!1===a.checkRequiredFieldsOnSave())$("#messageForUserModal").modal();else{var e=null,f=new Blob([a.ctrlSettings.htmlLoading],{type:"text/html"});d&&(e=window.URL.createObjectURL(f),e=window.open(e,"PreviewWin"));a.createReportWithParams(b,c,a.selectedObjects,d,e)}};a.currentReportType={};a.setCurrentReportType=function(b){a.currentReportType=b};
a.getDirectory=function(a,b){d.get(a,{timeout:w.promise}).success(function(a){b.specialTypeDirectoryValues=a}).error(function(a){console.log(a)})};var y=function(b,c){if(f.checkUndefinedNull(b)||f.checkUndefinedNull(c))return console.log("Paramset:"),console.log(c),console.log("Report type:"),console.log(b),null;var d=b.reportMetaParamSpecialList.map(function(b){var d={};d.paramSpecialCaption=b.paramSpecialCaption;d.reportMetaParamSpecialId=b.id;d.paramSpecialRequired=b.paramSpecialRequired;d.paramSpecialTypeKeyname=
b.paramSpecialType.keyname;d.reportMetaParamCategory=b.reportMetaParamCategory;d.reportMetaParamCategoryOrder=b.reportMetaParamCategory.categoryOrder;d.reportMetaParamCategoryKeyname=b.reportMetaParamCategoryKeyname;d.reportMetaParamOrder=b.reportMetaParamOrder;d.reportMetaParamFullOrder=1E3*b.reportMetaParamCategory.categoryOrder+(f.checkUndefinedNull(b.reportMetaParamOrder)?0:b.reportMetaParamOrder);null!=b.paramSpecialType.specialTypeDirectoryUrl&&"undefined"!=typeof b.paramSpecialType.specialTypeDirectoryUrl&&
null!=b.paramSpecialType.specialTypeDirectoryKey&&"undefined"!=typeof b.paramSpecialType.specialTypeDirectoryKey&&null!=b.paramSpecialType.specialTypeDirectoryCaption&&"undefined"!=typeof b.paramSpecialType.specialTypeDirectoryCaption&&null!=b.paramSpecialType.specialTypeDirectoryValue&&"undefined"!=typeof b.paramSpecialType.specialTypeDirectoryValue&&(d.specialTypeDirectoryUrl=b.paramSpecialType.specialTypeDirectoryUrl,d.specialTypeDirectoryKey=b.paramSpecialType.specialTypeDirectoryKey,d.specialTypeDirectoryCaption=
b.paramSpecialType.specialTypeDirectoryCaption,d.specialTypeDirectoryValue=b.paramSpecialType.specialTypeDirectoryValue,a.getDirectory(".."+d.specialTypeDirectoryUrl,d));if(0===c.paramSpecialList.length)return d.textValue=null,d.boolValue=null,d.numericValue=null,d.oneDateValue=null,d.startDateValue=null,d.endDateValue=null,d.oneDateValueFormatted=null,d.startDateValueFormatted=null,d.endDateValueFormatted=null,d.directoryValue=null,d;var e=-1;c.paramSpecialList.some(function(a,c,d){return a.reportMetaParamSpecialId===
b.id?(e=c,!0):!1});-1!=e?(d.id=c.paramSpecialList[e].id||null,d.textValue=c.paramSpecialList[e].textValue||null,d.boolValue=c.paramSpecialList[e].boolValue||null,d.numericValue=c.paramSpecialList[e].numericValue||null,d.oneDateValue=c.paramSpecialList[e].oneDateValue||null,d.startDateValue=c.paramSpecialList[e].startDateValue||null,d.endDateValue=c.paramSpecialList[e].endDateValue||null,d.oneDateValueFormatted=null!==c.paramSpecialList[e].oneDateValue?moment.utc(c.paramSpecialList[e].oneDateValue+
x).format(a.ctrlSettings.dateFormat):"",d.startDateValueFormatted=null==c.paramSpecialList[e].startDateValue?null:new Date(c.paramSpecialList[e].startDateValue),d.endDateValueFormatted=null==c.paramSpecialList[e].endDateValue?null:new Date(c.paramSpecialList[e].endDateValue),f.checkUndefinedNull(c.paramSpecialList[e].directoryValue)?d.directoryValue=null:f.isNumeric(c.paramSpecialList[e].directoryValue)?d.directoryValue=Number(c.paramSpecialList[e].directoryValue):d.directoryValue=c.paramSpecialList[e].directoryValue,
d.version=c.paramSpecialList[e].version||null):(d.id=null,d.textValue=null,d.boolValue=null,d.numericValue=null,d.oneDateValue=null,d.startDateValue=null,d.endDateValue=null,d.directoryValue=null,d.oneDateValueFormatted=null,d.startDateValueFormatted=null,d.endDateValueFormatted=null);return d});q(d);f.sortNumericItemsBy(d,"reportMetaParamFullOrder");return d};a.editParamSet=function(b,c,d,e){a.createReportWithParamsInProgress=!1;a.showMessageForUserModalExFlag=!1;a.selectedReport(b,c);a.currentParamSpecialList=
y(a.currentReportType,c);a.currentObject.showParamsBeforeRunReport=!a.currentObject.allRequiredParamsPassed;a.editParamset_flag=!0;a.createByTemplate_flag=!1;a.getAvailableObjects(c.id);a.currentSign=c.reportPeriod.sign;if(null==a.currentSign||"undefined"==typeof a.currentSign)a.paramsetStartDateFormat=new Date(c.paramsetStartDate),a.psStartDateFormatted=null!=c.paramsetStartDate?moment([a.paramsetStartDateFormat.getUTCFullYear(),a.paramsetStartDateFormat.getUTCMonth(),a.paramsetStartDateFormat.getUTCDate()]).format(a.ctrlSettings.dateFormat):
"",a.paramsetEndDateFormat=new Date(c.paramsetEndDate),a.psEndDateFormatted=null!=c.paramsetEndDate?moment([a.paramsetEndDateFormat.getUTCFullYear(),a.paramsetEndDateFormat.getUTCMonth(),a.paramsetEndDateFormat.getUTCDate()]).format(a.ctrlSettings.dateFormat):"";a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.getSelectedObjects(d,e)};a.availableObjects=[];a.selectedObjects=[];a.availableObjectGroups=[];a.getAvailableObjects=function(b){h(a.paramsetsUrl+"/"+b+"/contObject/available",w).query(function(b){a.availableObjects=
angular.copy(b)})};a.getSelectedObjects=function(b,c){h(a.paramsetsUrl+"/"+a.currentObject.id+"/contObject",w).query(function(d){a.selectedObjects=d;f.checkUndefinedNull(c)||1!=c||(a.selectedObjects=[k.getCurrentObject()]);k.sortObjectsByFullName(a.selectedObjects);switch(b){case a.ctrlSettings.openModes.edit:$("#main_properties_tab").addClass("active");$("#set_of_objects_tab").removeClass("active");$("#extra_properties_tab").removeClass("active");$("#editParamsetModal").modal();break;case a.ctrlSettings.openModes.create:d=
a.checkRequiredFieldsOnSave();!1===d?(a.showMessageForUserModalExFlag=!0,$("#messageForUserModal").modal()):a.createReport(a.currentReportType,a.currentObject,c);break;case a.ctrlSettings.openModes.preview:a.checkRequiredFieldsOnSave()}})};a.prepareObjectsList=function(){a.availableObjectGroups.forEach(function(a){a.selected=!1});a.ctrlSettings.selectedAll=!1};a.getGroupObjects=function(b){h(a.groupUrl+"/"+b.id+"/contObject",w).query(function(a){b.objects=a})};a.getAvailableObjectGroups=function(){h(a.groupUrl,
w).query(function(b){b.forEach(function(b){a.getGroupObjects(b)});f.sortItemsBy(b,"contGroupName");a.availableObjectGroups=b})};a.getAvailableObjectGroups();a.viewAvailableObjects=function(b){a.showAvailableObjects_flag=!a.showAvailableObjects_flag;(a.showAvailableObjectGroups_flag=b)?(a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",a.availableEntities=a.availableObjectGroups):(a.headers.addObjects=
"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b",a.availableObjects=k.sortObjectsByFullNameEx(a.availableObjects),a.availableEntities=a.availableObjects)};a.removeSelectedObject=function(b){a.availableObjects.push(b);a.selectedObjects.splice(a.selectedObjects.indexOf(b),1);k.sortObjectsByFullName(a.availableObjects)};a.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};
a.deleteDoublesObjects=function(a){for(var b=a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&a.splice(b,1)};a.addUniqueObjectsFromGroupsToSelectedObjects=function(a,b){var c,d;for(d=0;d<a.length;d+=1){var e=!0;for(c=0;c<b.length;c+=1)if(a[d].fullName===b[c].fullName){e=!1;break}e&&b.push(a[d])}};a.removeGroupObjectsFromAvailableObjects=function(a,b){var c,d;for(d=0;d<a.length;d+=1){var e=-1;for(c=0;c<b.length;c+=1)if(a[d].fullName===b[c].fullName){e=c;break}0<=e&&b.splice(e,1)}};a.selectAllAvailableEntities=
function(){var b;for(b=0;b<a.availableEntities.length;b+=1)a.availableEntities[b].selected=a.ctrlSettings.selectedAll};a.addSelectedEntities=function(){if(a.showAvailableObjectGroups_flag){var b=a.joinObjectsFromSelectedGroups(a.availableEntities);k.sortObjectsByFullName(b);a.deleteDoublesObjects(b);a.addUniqueObjectsFromGroupsToSelectedObjects(b,a.selectedObjects);a.removeGroupObjectsFromAvailableObjects(b,a.availableObjects)}var b=angular.copy(a.availableObjects),c;for(c=0;c<a.availableObjects.length;c+=
1){var d=a.availableObjects[c];if(d.selected){var e=angular.copy(d);e.selected=null;var f=-1;b.some(function(a,b,c){return a.fullName===d.fullName?(f=b,!0):!1});b.splice(f,1);a.selectedObjects.push(e);d.selected=null}}a.availableObjects=b;k.sortObjectsByFullName(a.selectedObjects);a.showAvailableObjects_flag=!1};a.removeObject=function(b){a.addObject_flag=!1;a.currentObjectId=b.id;objectPerform(!1,b.id)};a.templatesForCurrentParaset=[];a.getTemplates=function(){h("../api/reportTemplate"+a.currentReportType.suffix,
w).query(function(b){a.templatesForCurrentParaset=b;a.createParamset_flag&&(a.currentObject.reportTemplate=a.templatesForCurrentParaset[0])})};a.$watch("currentObject.reportPeriodKey",function(b){if(!angular.isArray(a.reportPeriods))return"reportPeriods is no array.";var c;for(c=0;c<a.reportPeriods.length;c+=1)b==a.reportPeriods[c].keyname&&(a.currentSign=a.reportPeriods[c].sign,a.currentReportPeriod=a.reportPeriods[c],null==a.currentSign||"undefined"==typeof a.currentSign)&&(a.paramsetStartDateFormat=
null==a.currentObject.paramsetStartDate?null:new Date(a.currentObject.paramsetStartDate),a.paramsetEndDateFormat=null==a.currentObject.paramsetEndDate?null:new Date(a.currentObject.paramsetEndDate))},!1);a.isDisabled=function(){return 1==a.createReportWithParamsInProgress};a.showAddObjectButton=function(){return!a.showAvailableObjects_flag&&a.set_of_objects_flag};a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),
firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},singleDatePicker:!0,format:a.ctrlSettings.dateFormat};
$(document).ready(function(){$("#inputSingleDateStart").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputSingleDateEnd").datepicker({dateFormat:"dd.mm.yy",
firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputStartDate").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,
monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});a.checkDateInterval=function(b,c){if(!f.checkStrForDate(b)||!f.checkStrForDate(c))return!1;if(null==b||null==c||""==b||""==c)return console.log("1"),!1;var d=f.strDateToUTC(b,a.ctrlSettings.dateFormat),d=null!=d?new Date(d):null,e=f.strDateToUTC(c,
a.ctrlSettings.dateFormat),e=null!=e?new Date(e):null;return null==d||null==e?!1:e>=d};a.checkRequiredFields=function(){if(!a.currentObject.hasOwnProperty("reportPeriodKey")||!a.currentObject.hasOwnProperty("reportTemplate"))return!1;var b=!0;if(null==a.currentSign)var b=f.strDateToUTC(a.psStartDateFormatted,a.ctrlSettings.dateFormat),b=new Date(b),c=f.strDateToUTC(a.psEndDateFormatted,a.ctrlSettings.dateFormat),c=new Date(c),b=!isNaN(b.getTime())&&!isNaN(c.getTime())&&a.checkDateInterval(a.psStartDateFormatted,
a.psEndDateFormatted);return!(null==a.currentObject.reportPeriodKey||null==a.currentObject.reportTemplate.id)&&b};a.checkPSRequiredFields=function(b){if(!b.hasOwnProperty("reportPeriodKey")||!b.hasOwnProperty("reportTemplate"))return!1;var c=!0;if(null==a.currentSign)var c=f.strDateToUTC(b.psStartDateFormatted,a.ctrlSettings.dateFormat),c=new Date(c),d=f.strDateToUTC(b.psEndDateFormatted,a.ctrlSettings.dateFormat),d=new Date(d),c=!isNaN(c.getTime())&&!isNaN(d.getTime())&&a.checkDateInterval(b.psStartDateFormatted,
b.psEndDateFormatted);return!(null==b.reportPeriodKey||null==b.reportTemplate.id)&&c};a.checkOutputFileZipped=function(){if(!a.currentReportType.hasOwnProperty("reportMetaParamCommon"))return!1;var b=!1;a.currentReportType.reportMetaParamCommon.manyContObjectsZipOnly&&(1<a.selectedObjects.length||0===a.selectedObjects.length)&&(b=a.currentObject.outputFileZipped=!0);return b};a.checkRequiredFieldsOnSave=function(){a.currentObject.psStartDateFormatted=a.psStartDateFormatted;a.currentObject.psEndDateFormatted=
a.psEndDateFormatted;a.currentObject.selectedObjects=a.selectedObjects;var b=angular.copy(a.currentParamSpecialList);t(b);a.currentObject.currentParamSpecialList=b;a.currentObject.currentReportPeriod=a.currentReportPeriod;b=l.checkPSRequiredFieldsOnSave(a.currentReportType,a.currentObject,a.currentSign,"run");a.messageForUser=b.message;return b.flag};a.createReport=function(b,e,g){b="../api/reportService"+b.suffix+"/"+e.id;b=f.checkUndefinedNull(g)||1!=g||f.checkUndefinedNull(k.getCurrentObject())?
b+"/download":b+("/context/"+k.getCurrentObject().id);a.createReportInProgress=!0;g=m.defer();g={url:b,method:"GET",responseType:"arraybuffer",timeout:g.promise,cancel:g,isReportRequest:!0};$("#creationReportModal").modal();d(g).then(function(b){if(0!=a.createReportInProgress){a.createReportInProgress=!1;$("#creationReportModal").modal("hide");var c=b.headers()["content-disposition"],c=c.substr(c.indexOf("=")+2,c.length-c.indexOf("=")-3);b=new Blob([b.data],{type:b.headers()["content-type"]});-1<
b.type.indexOf("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")?c+=".xlsx":-1<b.type.indexOf("application/zip")?c+=".zip":-1<b.type.indexOf("application/pdf")?c+=".pdf":-1<b.type.indexOf("text/html")&&(c+=".html");saveAs(b,c);a.ctrlSettings.openModes.create.isContext=!1}},c)["catch"](c)};a.previewReport=function(b,c,d){a.selectedReport(b,c);c.checkFlag?(b="../api/reportService"+b.suffix+"/"+c.id,f.checkUndefinedNull(d)||1!=d?b+="/preview":b+="/contextPreview/"+k.getCurrentObject().id,
d=window.open("","_blank"),d.document.write(a.ctrlSettings.htmlLoading),d.document.location.assign(b)):(a.showMessageForUserModalExFlag=!0,a.messageForUser=c.messageForUser,$("#messageForUserModal").modal())};a.createReportWithParams=function(b,e,g,h,t){e=angular.copy(e);g=g.map(function(a){return a.id});angular.isArray(a.currentParamSpecialList)&&a.currentParamSpecialList.forEach(function(b){b.startDateValue=null==b.startDateValueFormatted?null:b.startDateValueFormatted.getTime();b.endDateValue=
null==b.endDateValueFormatted?null:b.endDateValueFormatted.getTime();var c=(new Date(moment(b.oneDateValueFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD"))).getTime();b.oneDateValue=isNaN(c)?null:c-x});e.paramSpecialList=a.currentParamSpecialList;null==a.currentSign||"undefined"==typeof a.currentSign?(t=f.strDateToUTC(a.psStartDateFormatted,a.ctrlSettings.dateFormat),e.paramsetStartDate=null!=t?new Date(t):null,t=f.strDateToUTC(a.psEndDateFormatted,a.ctrlSettings.dateFormat),e.paramsetEndDate=
null!=t?new Date(t):null):(e.paramsetStartDate=null,e.paramsetEndDate=null);h?(e.outputFileType="HTML",e.outputFileZipped=!1):e.outputFileZipped||e.outputFileType.toLowerCase();var l="../api/reportService"+b.suffix+"/"+e.id+"/download";b=!1;if(f.checkUndefinedNull(g)||0==g.length)b=!0;a.createReportWithParamsInProgress=!0;t=m.defer();b={url:l,method:"PUT",params:{contObjectIds:g,clearContObjectIds:b},data:e,responseType:"arraybuffer",timeout:t.promise,cancel:t,isReportRequest:!0};$("#creationReportModal").modal();
d(b).then(function(b){if(0!=a.createReportWithParamsInProgress){a.createReportWithParamsInProgress=!1;$("#creationReportModal").modal("hide");var c=b.headers()["content-disposition"],c=c.substr(c.indexOf("=")+2,c.length-c.indexOf("=")-3);b=new Blob([b.data],{type:b.headers()["content-type"]});h?(c=window.URL.createObjectURL(b),window.open(c,"PreviewWin")):(-1<b.type.indexOf("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")?c+=".xlsx":-1<b.type.indexOf("application/zip")?c+=".zip":
-1<b.type.indexOf("application/pdf")?c+=".pdf":-1<b.type.indexOf("text/html")&&(c+=".html"),saveAs(b,c));a.ctrlSettings.openModes.create.isContext=!1}},function(b){if(0!=a.createReportWithParamsInProgress)if(a.createReportWithParamsInProgress=!1,a.ctrlSettings.openModes.create.isContext=!1,h){var d=window.open(l,"PreviewWin");f.checkUndefinedNull(d)||d.document.write(b.status+", "+b.statusText);alert("\u041f\u0440\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u0434\u043b\u044f \u043f\u0440\u0435\u0434\u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u043e\u0442\u0447\u0435\u0442\u0430 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b.");
f.checkUndefinedNull(d)||d.close();console.log(b)}else c(b)})["catch"](c)};a.setActiveTab=function(a){var b;b=document.getElementById("rep_a_teplo_sys");b.classList.remove("active");b=document.getElementById("rep_a_electro_sys");b.classList.remove("active");b=document.getElementById("rep_a_gas_sys");b.classList.remove("active");b=document.getElementById(a);b.classList.add("active")};a.setCurrentServiceType(a.contServiceTypes[0]);a.data={};l.loadReportsContextLaunch().then(function(b){b=angular.copy(b.data);
b.forEach(function(b){a.reportObjects.some(function(a){if(a.reportType===b.reportTemplate.reportTypeKeyname)return b.reportType=angular.copy(a),!0})});b.length>a.ctrlSettings.reportCountList?(a.data.reportEntities=angular.copy(a.categories),a.data.reportEntities.forEach(function(a){a.reports=[]}),b.forEach(function(b){var c;for(c=0;c<a.data.reportEntities.length;c+=1)if(0==b.reportType.reportCategory.localeCompare(a.data.reportEntities[c].name)){a.data.reportEntities[c].reports.push(b);break}})):
a.data.reportEntities=b;b.forEach(function(b){var c=b.reportPeriod.sign;if(null==c||"undefined"==typeof c)c=new Date(b.paramsetStartDate),b.psStartDateFormatted=null!=b.paramsetStartDate?moment([c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()]).format(a.ctrlSettings.dateFormat):"",c=new Date(b.paramsetEndDate),b.psEndDateFormatted=null!=b.paramsetEndDate?moment([c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()]).format(a.ctrlSettings.dateFormat):"";a.set_of_objects_flag=!1;a.showAvailableObjects_flag=
!1;a.getSelectedObjectsByParamset(b.reportType,b,!0)})},p);a.createContextReport=function(b){if(!f.checkUndefinedNull(b.reports))return"Entity is category";if(f.checkUndefinedNull(b.reportType))return g.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!","\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u0438\u043f \u043e\u0442\u0447\u0435\u0442\u0430. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043e\u0442\u0447\u0435\u0442\u0430."),
"Report type is not available.";a.ctrlSettings.openModes.create.isContext=!0;b.reportType.reportMetaParamSpecialList_flag=0<b.reportType.reportMetaParamSpecialList.length?!0:!1;a.editParamSet(b.reportType,b,a.ctrlSettings.openModes.create,!0)};a.previewContextReport=function(b){if(!f.checkUndefinedNull(b.reports))return"Entity is category";if(f.checkUndefinedNull(b.reportType))return g.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!","\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u0438\u043f \u043e\u0442\u0447\u0435\u0442\u0430. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043e\u0442\u0447\u0435\u0442\u0430."),
"Report type is not available.";if("COMMERCE_REPORT"==b.reportType.keyname||"COMMERCE_REPORT_M_V"==b.reportType.keyname)return g.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!","\u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u043b\u044f \u043a\u043e\u043c\u043c\u0435\u0440\u0447\u0435\u0441\u043a\u0438\u0445 \u043e\u0442\u0447\u0435\u0442\u043e\u0432 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d."),
"Preview for the commercial reports is not available.";b.reportType.reportMetaParamSpecialList_flag=0<b.reportType.reportMetaParamSpecialList.length?!0:!1;a.selectedObjects=[k.getCurrentObject()];a.previewReport(b.reportType,b,!0)};a.createReportWithParamsRequestCancel=function(){d.pendingRequests.forEach(function(a){a.cancel&&1==a.isReportRequest&&(a.cancel.resolve(),console.log("Cancelling Request "+a.method+" on URL:"+a.url))})};a.isSpecialParamDisabled=function(b,c){var d=!1;c.some(function(a){if(b.reportMetaParamCategory.keyname===
a.reportMetaParamCategory.keyname&&"SPECIAL_CATEGORY_SWITCH"===a.paramSpecialTypeKeyname&&!0!==a.boolValue)return d=!0});return a.isDisabled()||d}}]);app=angular.module("portalNMC");
app.controller("ReportSettingsCtrl",["$scope","$rootScope","$resource","crudGridDataFactory","notificationFactory","mainSvc","reportSvc",function(a,b,d,h,g,k,f){b.ctxId="report_settings_page";a.ctrlSettings={};a.ctrlSettings.dateFormat="DD.MM.YYYY";a.ctrlSettings.ctxId="report_template";a.isPositionSystemChanged=!1;a.active_tab_active_templates=!0;a.currentObject={};a.createByTemplate_flag=!1;a.archiveTemplate={};a.activeStartDateFormat=new Date;a.activeStartDateFormatted=moment().format(a.ctrlSettings.dateFormat);
a.currentReportType={};a.objects=[];a.columns=[{name:"reportTypeName",header:"\u0422\u0438\u043f \u043e\u0442\u0447\u0435\u0442\u0430","class":"col-md-11"}];a.crudTableName="../api/reportTemplate";a.extraProps={idColumnName:"id",defaultOrderBy:"name",deleteConfirmationProp:"name"};a.categories=f.getReportCategories();a.isSystemuser=function(){a.userInfo=b.userInfo;return a.userInfo._system};a.reportTypes=[];a.$on("reportSvc:reportTypesIsLoaded",function(){a.reportTypes=f.getReportTypes();a.objects=
a.reportTypes;a.getActive()});a.getReportTypes=function(){h("../api/reportSettings/reportType").query(function(b){a.reportTypes=b;var c=[],d,e;for(e=0;e<b.length;e+=1)!b[e]._enabled||!a.isSystemuser()&&b[e].isDevMode||(d={},d.reportType=b[e].keyname,d.reportTypeName=b[e].caption,d.reportCategory=b[e].reportCategory,d.suffix=b[e].suffix,c.push(d));a.objects=c;a.getActive()})};a.oldColumns=[{name:"name",header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0448\u0430\u0431\u043b\u043e\u043d\u0430",
"class":"col-md-5"},{name:"activeStartDate",header:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 \u0441","class":"col-md-2"}];var n=function(b){g.success();$("#editTemplateModal").modal("hide");$("#moveToArchiveModal").modal("hide");$("#createTemplateModal").modal("hide");a.createByTemplate_flag||a.getActive();a.setDefault()},l=function(b){g.success();$("#deleteObjectModal").modal("hide");a.getArchive();a.setDefault()},m=function(a){a=k.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};
a.selectToDelete=function(b,d){a.setCurrentReportType(b);a.selectedItem(d)};a.deleteObject=function(b){h(a.crudTableName+"/archive"+a.currentReportType.suffix)["delete"]({id:b[a.extraProps.idColumnName]},l,m)};a.getTemplates=function(a,b){h(a).query(function(a){b.templates=a;b.templatesCount=a.length})};a.getActive=function(){if(0!==a.objects.length&&"undefined"!=typeof a.objects[0].suffix){var b;for(b=0;b<a.objects.length;b+=1)a.getTemplates(a.crudTableName+a.objects[b].suffix,a.objects[b])}};a.getArchive=
function(){if(0!==a.objects.length&&"undefined"!=typeof a.objects[0].suffix){var b;for(b=0;b<a.objects.length;b+=1)a.getTemplates(a.crudTableName+"/archive"+a.objects[b].suffix,a.objects[b])}};a.toogleShowGroupDetails=function(a){a.showGroupDetails=!a.showGroupDetails};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b};a.updateTemplate=function(b){var c;a.createByTemplate_flag?(b.activeStartDate=null==a.activeStartDateFormat?null:a.activeStartDateFormat.getTime(),c=new Date(b.activeStartDate),
a.activeStartDateFormatted=null==b.activeStartDate?"":moment([c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()]).format(a.ctrlSettings.dateFormat),c=a.crudTableName+"/createByTemplate/"+a.archiveTemplate.id,h(c).save({},b,n,m)):(c=a.crudTableName+a.currentReportType.suffix,h(c).update({reportTemplateId:b.id},b,n,m))};a.saveTemplate=function(){var b={};b.reportTemplate=a.currentObject;var d=new Date(a.activeStartDateFormatted),d=Date.UTC(d.getFullYear(),d.getMonth(),d.getDate());b.reportTemplate.activeStartDate=
k.checkStrForDate(a.activeStartDateFormatted)?d:null;b.reportTemplate._active=!0;b.reportColumnSettings={};b.reportColumnSettings.allTsList=a.systems;a.isPositionSystemChanged?(b.reportColumnSettings.ts1List=a.system2.defineColumns,b.reportColumnSettings.ts2List=a.system1.defineColumns):(b.reportColumnSettings.ts1List=a.system1.defineColumns,b.reportColumnSettings.ts2List=a.system2.defineColumns);h("../api/reportWizard"+a.currentReportType.suffix).save(b,n,m)};a.toArchive=function(a,b){return d(a,
{},{update:{method:"PUT",params:{reportTemplateId:b}}})};a.moveToArchive=function(b){a.toArchive(a.crudTableName+"/archive/move",b.id).update({},b,n,m)};a.createByTemplate=function(b,d){a.setCurrentReportType(b);a.createByTemplate_flag=!0;a.archiveTemplate={};a.archiveTemplate.id=d.id;a.archiveTemplate.name=d.name;a.currentObject={};a.currentObject.name=angular.copy(d.name);a.currentObject.description=angular.copy(d.description)};a.systems=[];a.system1={};a.system2={};a.systems=[a.system1,a.system2];
a.getWizard=function(){h("../api/reportWizard/columnSettings"+a.currentReportType.suffix).get(function(b){a.obtainedSystems=b;a.systems=b.allTsList;a.system1=b.allTsList[0];a.system2=b.allTsList[1];a.system1.defaultColumns=b.ts1List;a.system2.defaultColumns=b.ts2List;a.system1.defineColumns=[];a.system2.defineColumns=[]})};a.addColumns=function(a,b){var c,d;for(c=0;c<a.length;c+=1)if(a[c].selected){a[c]["class"]="";a[c].selected=!1;if("undefined"!=typeof b){var e=!1;for(d=0;d<=b.length;d+=1)"undefined"!=
typeof b[d]&&b[d].columnNumber==a[c].columnNumber&&(e=!0);if(e)continue}d=angular.copy(a[c]);d.selected=!1;d["class"]="";b.push(d)}return b};a.removeColumns=function(a){var b=[],c;for(c=0;c<a.length;c+=1)a[c].selected||(a[c].selected=!1,b.push(a[c]));return b};a.moveColumnsUp=function(a){var b,c;for(c=1;c<a.length;c+=1)a[c].selected&&(b=a[c-1],a[c-1]=a[c],a[c]=b);return a};a.moveColumnsDown=function(a){var b,c;for(c=a.length-2;0<=c;--c)a[c].selected&&(b=a[c+1],a[c+1]=a[c],a[c]=b);return a};a.changeSystemPosition=
function(){a.isPositionSystemChanged=!a.isPositionSystemChanged;var b=a.systems[0];a.systems[0]=a.systems[1];a.systems[1]=b};a.selectColumn=function(a){a.selected=!a.selected;a["class"]=a.selected?"active":""};a.toggleEditColumnName=function(a){a.edit=!a.edit};a.cancelEditColumnName=function(b){b.columnHeader=b.oldColumnName;a.toggleEditColumnName(b)};a.editColumnName=function(b){b.oldColumnName=b.columnHeader;a.toggleEditColumnName(b)};a.setDefault=function(){a.currentObject={};a.createByTemplate_flag=
!1;a.archiveTemplate={};a.activeStartDateFormat=new Date;a.system1.defineColumns=[];a.system2.defineColumns=[]};a.setCurrentReportType=function(b){a.currentReportType.reportType=b.reportType;a.currentReportType.reportTypeName=b.reportTypeName;a.currentReportType.suffix=b.suffix};a.editTemplate=function(b,d){a.selectedItem(d);a.setCurrentReportType(b)};a.addTemplate=function(b){a.setCurrentReportType(b);a.getWizard();a.setDefault();$("#createTemplateModal").modal()};a.preview=function(a){window.open(a.reportType.previewUrl)};
a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:a.ctrlSettings.dateFormat};$(document).ready(function(){$("#inputStartDate").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});var e=
function(a){k.getContextIds().forEach(function(b){b.permissionTagId.localeCompare(a);var c=document.getElementById(b.permissionTagId);angular.isUndefined(c)||null==c||$("#"+b.permissionTagId).removeClass("nmc-hide")})};e(a.ctrlSettings.ctxId);b.$on("servicePermissions:loaded",function(){e(a.ctrlSettings.ctxId)});a.isDisabled=function(){return a.isROfield()||a.currentObject.common};a.isAdmin=function(){return k.isAdmin()};a.isReadonly=function(){return k.isReadonly()};a.isROfield=function(){return a.isReadonly()};
f.getReportTypesIsLoaded()&&(a.reportTypes=f.getReportTypes(),a.objects=a.reportTypes,a.getActive())}]);angular.module("portalNMC").controller("SettingsMeterPeriodSettingCtrl",["$scope","$rootScope","$routeParams","$resource","$cookies","$compile","$parse","crudGridDataFactory","notificationFactory","$http","objectSvc","mainSvc","$timeout","$window","meterPeriodsSvc",function(a,b,d,h,g,k,f,n,l,m,e,c,q,t,u){function v(a){var b=c.errorCallbackHandler(a);l.errorInfo(b.caption,b.description);console.log(a)}function x(b){console.log(b);b=angular.copy(b.data);c.sortItemsBy(b,a.extraProps.defaultOrderBy);
a.data.meterPeriodSettings=b}function w(b){console.log(b);var d=angular.copy(a.data.meterPeriodSettings);201===b.status&&(d.push(angular.copy(b.data)),c.sortItemsBy(d,a.extraProps.defaultOrderBy),a.data.meterPeriodSettings=d);if(200===b.status){var e=c.findItemBy(d,a.extraProps.idColumnName,b.data.id),e=d.indexOf(e);-1!==e&&(d[e]=angular.copy(b.data));c.sortItemsBy(d,a.extraProps.defaultOrderBy);a.data.meterPeriodSettings=d}$("#showMeterPeriodSettingModal").modal("hide")}function p(a){console.log(a);
u.loadMeterPeriods().then(x,v);$("#deleteWindowModal").modal("hide")}b.ctxId="management_rma_meter_period_setting_page";a.extraProps={idColumnName:"id",defaultOrderBy:"name",nameColumnName:"name"};a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.ctrlSettings={};a.ctrlSettings.periodColumns=[{name:"name",caption:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","class":"col-xs-3",type:"name"},{name:"description",caption:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","class":"col-xs-3"},
{name:"fromDay",caption:"\u041d\u0430\u0447\u0430\u043b\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430","class":"col-xs-1"},{name:"toDay",caption:"\u041a\u043e\u043d\u0435\u0446 \u043f\u0435\u0440\u0438\u043e\u0434\u0430","class":"col-xs-1"},{name:"valueCount",caption:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u0439","class":"col-xs-1"}];a.data={};a.data.meterPeriodSettings=[];a.data.currentMeterPeriodSetting={};a.checkPeriod=function(a){return Number(a.fromDay)>
Number(a.toDay)};a.saveMeterPeriodSetting=function(){var b;b=a.data.currentMeterPeriodSetting;if(angular.isUndefined(b)||null===b)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041f\u0435\u0440\u0438\u043e\u0434 \u043d\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u0435\u0434\u0435\u043d\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435!"),b=!1;else{var c=!0,d=!0,e=!0;if(angular.isUndefined(b.name)||null===b.name||
""===b.name)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u0435\u0440\u0438\u043e\u0434\u0430!"),c=!1;if(angular.isUndefined(b.fromDay)||null===b.fromDay||""===b.fromDay)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0447\u0430\u043b\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430!"),c=d=!1;if(angular.isUndefined(b.toDay)||
null===b.toDay||""===b.toDay)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043a\u043e\u043d\u0435\u0446 \u043f\u0435\u0440\u0438\u043e\u0434\u0430!"),c=e=!1;d&&e&&a.checkPeriod(b)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043f\u0435\u0440\u0438\u043e\u0434!"),c=!1);b=c}if(!1===b)return!1;b="PUT";if(angular.isUndefined(a.data.currentMeterPeriodSetting.id)||
null===a.data.currentMeterPeriodSetting.id)b="POST";u.saveMeterPeriod(b,a.data.currentMeterPeriodSetting).then(w,v)};a.addMeterPeriod=function(){a.data.currentMeterPeriodSetting={};$("#showMeterPeriodSettingModal").modal()};a.selectedItem=function(b){a.confirmCode=null;var d=c.getConfirmCode();a.confirmLabel=d.label;a.sumNums=d.result;a.data.currentMeterPeriodSetting=angular.copy(b)};a.deleteMeterPeriodSetting=function(a){u.deleteMeterPeriod(a.id).then(p,v)};a.isSystemuser=function(){return c.isSystemuser()};
a.isTestMode=function(){return c.isTestMode()};a.isSystemViewInfo=function(){return c.getViewSystemInfo()};u.loadMeterPeriods().then(x,v);$("#showMeterPeriodSettingModal").on("shown.bs.modal",function(){$("#inputMeterPeriodName").focus();$("#inputMeterPeriodFromDay").inputmask("integer",{mask:"9[9]",min:1,max:31});$("#inputMeterPeriodToDay").inputmask("integer",{mask:"9[9]",min:1,max:31});$("#inputMeterPeriodValueCount").inputmask("integer",{max:5})})}]);app=angular.module("portalNMC");
app.controller("SettingsNoticesCtrl",["$rootScope","$scope","$http","notificationFactory","mainSvc",function(a,b,d,h,g){a.ctxId="settings_notices_page";b.ctrlSettings={};b.ctrlSettings.ctxId="settings_notices";b.ctrlSettings.apiUrl="../api/subscr/contEventType";b.ctrlSettings.noticeTypesUrl=b.ctrlSettings.apiUrl+"/actions/available";b.ctrlSettings.contactsUrl="../api/subscr/subscrAction/users";b.ctrlSettings.imgPathTmpl="images/notice-state-";b.ctrlSettings.orderBy={field:"name",asc:!0};b.ctrlSettings.colorLevel=
{green:{name:"green",min:7E4,max:79999,title:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435"},yellow:{name:"yellow",min:3E4,max:59999,title:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435"},orange:{name:"orange",min:2E4,max:29999,title:"\u041d\u0435\u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f"},red:{name:"red",min:1E4,max:19999,title:"\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f"}};
b.currentNotice={};b.columns=[{name:"name",header:"\u0422\u0438\u043f",headerClass:"col-xs-5 col-md-5 nmc-button-sort ",dataClass:"col-xs-5 col-md-5"},{name:"comment",header:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",headerClass:"col-xs-5 col-md-5",dataClass:"col-xs-5 col-md-5"}];b.contactColumns=[{name:"userName",header:"\u0422\u0438\u043f","class":"col-xs-5 col-md-5 nmc-button-sort "},{name:"comment",header:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",
"class":"col-xs-5 col-md-5"}];b.noticeTypes=[];b.contacts=[];var k=function(a){a=g.errorCallbackHandler(a);h.errorInfo(a.caption,a.description)},f=function(a){var d=angular.copy(b.contacts);d.forEach(function(b){var c=a.length,d;for(d=0;d<c;d+=1)b.id==a[d].subscrActionUserId&&(b.isSms=a[d].isSms,b.isEmail=a[d].isEmail)});b.currentNotice.contacts=d;$("#editNoticeModal").modal()},n=function(a){$("#editNoticeModal").modal("hide");b.currentNotice={}};b.getContacts=function(a){d.get(a).success(function(a){b.contacts=
angular.copy(a)}).error(k)};b.getContacts(b.ctrlSettings.contactsUrl);b.getNoticeTypes=function(a){d.get(a).success(function(a){a=angular.copy(a);a.sort(function(a,b){return a.name>b.name?1:a.name<b.name?-1:0});a.forEach(function(a){for(var c in b.ctrlSettings.colorLevel)if(a.contEventLevel>=b.ctrlSettings.colorLevel[c].min&&a.contEventLevel<=b.ctrlSettings.colorLevel[c].max){a.color=b.ctrlSettings.colorLevel[c].name;a.imgpath=b.ctrlSettings.imgPathTmpl+a.color.toLowerCase()+".png";a.title=b.ctrlSettings.colorLevel[c].title;
break}});b.noticeTypes=a}).error(k)};b.getNoticeTypes(b.ctrlSettings.noticeTypesUrl);b.getNoticeTypeSettings=function(a){b.selectItem(a);d.get(b.ctrlSettings.apiUrl+"/"+a.id+"/actions").success(f).error(k)};b.putNoticeTypeSettings=function(a){var f=b.ctrlSettings.apiUrl+"/"+a.id+"/actions",e=[];a.contacts.forEach(function(a){g.checkUndefinedNull(a.isSms)&&g.checkUndefinedNull(a.isEmail)||e.push({subscrActionUserId:a.id,isSms:a.isSms||!1,isEmail:a.isEmail||!1})});d.put(f,e).success(n).error(k)};b.setOrderBy=
function(a){b.ctrlSettings.orderBy.field=a;b.ctrlSettings.orderBy.asc=!b.ctrlSettings.orderBy.asc};b.selectItem=function(a){b.currentNotice=angular.copy(a)};b.isSystemViewInfo=function(){return g.getViewSystemInfo()}}]);app=angular.module("portalNMC");
app.controller("SettingsObjectTreesCtrl",["$scope","$rootScope","$routeParams","$resource","$cookies","$compile","$parse","crudGridDataFactory","notificationFactory","$http","objectSvc","mainSvc","$timeout","$window",function(a,b,d,h,g,k,f,n,l,m,e,c,q,t){b.ctxId="management_rma_objects_page";a.messages={};a.messages.markAllOn="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435";a.messages.markAllOff="\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435";a.messages.moveToNode=
"\u041f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c \u043a \u0443\u0437\u043b\u0443";a.messages.releaseFromNode="\u041e\u0442\u0432\u044f\u0437\u0430\u0442\u044c \u043e\u0442 \u0443\u0437\u043b\u0430";a.crudTableName=e.getObjectsUrl();a.objectCtrlSettings={};a.objectCtrlSettings.isCtrlEnd=!1;a.objectCtrlSettings.allSelected=!1;a.objectCtrlSettings.anySelected=!1;a.objectCtrlSettings.anyClientSelected=!1;a.objectCtrlSettings.objectsPerScroll=34;a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;
a.objectCtrlSettings.vzletSystemList=[];a.objectCtrlSettings.extendedInterfaceFlag=!0;a.objectCtrlSettings.serverTimeZone=3;a.objectCtrlSettings.dateFormat="DD.MM.YYYY";a.objectCtrlSettings.ctxId="management_objects_2nd_menu_item";a.objectCtrlSettings.rmaUrl="../api/rma";a.objectCtrlSettings.clientsUrl="../api/rma/subscribers";a.objectCtrlSettings.subscrObjectsSuffix="/subscrContObjects";a.objectCtrlSettings.tempSchBaseUrl="../api/rma/temperatureCharts/byContObject";var u=function(){c.getContextIds().forEach(function(a){var b=
document.getElementById(a.permissionTagId);angular.isUndefined(b)||null==b||$("#"+a.permissionTagId).removeClass("nmc-hide")})};u();b.$on("servicePermissions:loaded",function(){u()});a.data={};a.object={};a.objects=[];a.objectsOnPage=[];a.currentSug=null;var v=function(c){a.objects=c.data;e.sortObjectsByFullName(a.objects);angular.isUndefined(a.filter)||""===a.filter?(a.objectsWithoutFilter=a.objects,a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,c=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll),
a.objectsOnPage=c,b.$broadcast("objectSvc:loaded")):a.searchObjects(a.filter);a.loading=!1},x=function(c){b.$broadcast("objectSvc:requestReloadData");a.loading=!0;e.getRmaPromise().then(v)};a.loading=e.getLoadingStatus();a.columns=[{name:"fullName",header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","class":"col-md-5"},{name:"fullAddress",header:"\u0410\u0434\u0440\u0435\u0441","class":"col-md-5"}];a.captions={loading:"loading",totalElements:"totalElements"};a.filter="";a.filterType="";a.bGroupByObject=
!1;a.bObject=!1;a.bList=!0;var w=function(a){a=c.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)},p=function(b){w(b);a.zpointSettings.isSaving=!1;a.currentObject.isSaving=!1};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b};a.selectedObject=function(b,c){e.getObject(b).then(function(b){a.currentObject=b.data},function(a){console.log(a)})};a.dateFormat=function(b){b=new Date(b+Math.round(36E5*
a.objectCtrlSettings.serverTimeZone));return null==b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]).format(a.objectCtrlSettings.dateFormat)};a.emptyString=function(a){return c.checkUndefinedEmptyNullValue(a)};a.checkUndefinedNull=function(a){return c.checkUndefinedNull(a)};a.searchObjects=function(b){if(!(0>=a.objects.length)){a.objectsOnPage.forEach(function(a){if(1==a.showGroupDetailsFlag){var b=document.getElementById("obj"+a.id);c.checkUndefinedNull(b)||(b.getElementsByClassName("nmc-tr-zpoint")[0].innerHTML=
"",b=document.getElementById("btnDetail"+a.id),b.classList.remove("glyphicon-chevron-down"),b.classList.add("glyphicon-chevron-right"))}a.showGroupDetailsFlag=!1});var d=[];angular.isUndefined(b)||""===b?(d=[],a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,d=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll)):(d=[],a.objects.forEach(function(a){angular.isDefined(a.fullName)&&-1!=a.fullName.toUpperCase().indexOf(b.toUpperCase())&&d.push(a)}));a.objectsOnPage=d}};a.$on("$destroy",
function(){window.onkeydown=void 0});window.onkeydown=function(b){var c=null;38==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop-=20):40==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop+=20):34==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop+=10*a.objectCtrlSettings.objectsPerScroll):33==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop-=10*a.objectCtrlSettings.objectsPerScroll):b.ctrlKey&&36==b.keyCode?(c=
document.getElementById("divWithObjectTable"),c.scrollTop=0):b.ctrlKey&&35==b.keyCode&&(a.objectCtrlSettings.objectsOnPage<a.objects.length&&(a.loading=!0,q(function(){a.loading=!1},a.objects.length)),b=a.objects.slice(a.objectCtrlSettings.objectsOnPage,a.objects.length),Array.prototype.push.apply(a.objectsOnPage,b),a.objectCtrlSettings.objectsOnPage+=a.objects.length,a.$apply(),c=document.getElementById("divWithObjectTable"),c.scrollTop=c.scrollHeight)};a.addMoreObjects=function(){if(!(0>=a.objects.length)){var b=
a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll;b>=a.objects.length&&(b=a.objects.length);var c=a.objects.slice(a.objectCtrlSettings.objectsOnPage,b);Array.prototype.push.apply(a.objectsOnPage,c);a.objectCtrlSettings.objectsOnPage=b>=a.objects.length?a.objects.length:a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll}};$("#divWithObjectTable").scroll(function(){if(angular.isUndefined(a.filter)||""==a.filter)a.addMoreObjects(),a.$apply()});a.isSystemuser=
function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};a.isSystemViewInfo=function(){return c.getViewSystemInfo()};a.toggleObjects=function(b){a.objectCtrlSettings.anySelected=b;a.objects.forEach(function(a){a.selected=b});a.objectsOnPage.forEach(function(a){a.selected=b})};a.toggleObject=function(b){var c=a.objectCtrlSettings.allSelected=!1;a.objectsOnPage.some(function(a){if(1==a.selected)return c=!0});a.objectCtrlSettings.anySelected=c};a.invokeHelp=
function(){alert("This is SPRAVKA!!!111")};var y=function(b){a.confirmCode=null;b=c.getConfirmCode(b);a.confirmLabel=b.label;a.sumNums=b.result},F=function(){var b=[];1==a.objectCtrlSettings.allSelected?a.objects.forEach(function(a){1==a.selected&&(b.push(a.id),a.selected=!1)}):a.objectsOnPage.forEach(function(a){1==a.selected&&(b.push(a.id),a.selected=!1)});return b};a.checkEmptyNullValue=function(a){return""===a||null==a?!0:!1};a.checkNumericValue=function(b){return a.checkEmptyNullValue(b)?!0:
isNaN(parseFloat(b))||!isFinite(b)?!1:!0};a.checkPositiveNumberValue=function(b){var c;c=a.checkNumericValue(b);return c?c=0<=parseInt(b,10)?!0:!1:c};a.checkNumericInterval=function(b,c){return a.checkEmptyNullValue(b)||a.checkEmptyNullValue(c)||!a.checkNumericValue(b)||!a.checkNumericValue(c)?!1:parseInt(c,10)>=parseInt(b,10)?!0:!1};a.checkHHmm=function(a){return/(0[0-9]|1[0-9]|2[0-3]){1,2}:([0-5][0-9]){1}/.test(a)?!0:!1};$("#showZpointOptionModal").on("hidden.bs.modal",function(){a.zpointSettings=
{}});$("#showZpointExplParameters").on("hidden.bs.modal",function(){a.zpointSettings={}});$("#showObjOptionModal").on("hidden.bs.modal",function(){a.currentObject.isSaving=!1;a.currentSug=null});a.data.treeTemplates=e.getRmaTreeTemplates();a.objectCtrlSettings.treeSettings={};a.objectCtrlSettings.treeSettings.nodesPropName="childObjectList";a.data.currentDeleteMessage="";var G={objectName:"",type:"root",childObjectList:[]};a.objectCtrlSettings.isTreeView=!0;a.data.currentTree={};a.data.newTree={};
a.findNodeInTree=function(a,b){return c.findNodeInTree(a,b)};a.selectNode=function(b){a.objectCtrlSettings.allSelected=!1;var d=a.data.currentTree,f=a.data.selectedNode;if(1==a.objectCtrlSettings.isObjectMoving){d=a.data.treeForMove;if(c.checkUndefinedNull(a.data.selectedNodeForMove)){b.isSelected=!0;a.data.selectedNodeForMove=angular.copy(b);return}f=a.data.selectedNodeForMove}f.id!=b.id&&f.type==b.type!="root"&&(c.checkUndefinedNull(f)||(d=c.findNodeInTree(f,d),c.checkUndefinedNull(d)||(d.isSelected=
!1)),b.isSelected=!0,1==a.objectCtrlSettings.isObjectMoving?a.data.selectedNodeForMove=angular.copy(b):(a.data.selectedNode=angular.copy(b),a.loading=!0,"root"==b.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(v):e.loadObjectsByTreeNode(a.data.currentTree.id,b.id).then(v)))};a.data.trees=[];a.loadTree=function(b,d){a.loading=!0;a.objectCtrlSettings.allSelected=!1;e.loadTree(b.id).then(function(d){a.messages.treeMenuHeader=b.objectName||b.id;var f=angular.copy(d.data);c.sortTreeNodesBy(f,
"objectName");f.childObjectList.unshift(angular.copy(G));a.data.currentTree=f;f.childObjectList[0].isSelected=!0;a.data.selectedNode=angular.copy(f.childObjectList[0]);e.loadFreeObjectsByTree(b.id).then(v);if(c.checkUndefinedNull(a.data.currentTree.templateId))return"Tree is free";e.loadTreeTemplateItems(a.data.currentTree.templateId).then(function(b){a.data.currentTreeTemplateItems=angular.copy(b.data);f.childObjectList[0].templateId=a.data.currentTree.templateId;f.childObjectList[0].templateItemId=
a.data.currentTree.templateItemId},w)},w)};var C=function(){a.data.currentTree={};e.loadTrees().then(function(b){c.sortItemsBy(b.data,"objectName");a.data.trees=angular.copy(b.data);if(!angular.isArray(a.data.trees)||0>=a.data.trees.length)return a.messages.treeMenuHeader="\u0412\u044b\u0431\u0435\u0440\u0435\u0442\u0435 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044e",x(),"Object tree array is empty.";a.loadTree(a.data.trees[0])},w)},H=function(b,d){var e;e="root"==d.type?a.data.currentTree:d;if(c.checkUndefinedNull(e)||
!angular.isArray(e.childObjectList))return"Parent is incorrect node!";e.childObjectList.push(b)},r=function(b){var c=!0;a.emptyString(b.objectName)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435!"),c=!1);return c},I=function(b){var c=null;a.data.currentTreeTemplateItems.some(function(a){if(b==a.id)return c=a,!0});return c},B=function(b){var c=null;a.data.currentTreeTemplateItems.some(function(a){if(b==
a.itemLevel)return c=a,!0});return c};a.saveNode=function(b,d,f){if(0==r(b))return"Node is no correct!";H(b,d);angular.isArray(a.data.currentTree.childObjectList)&&0<a.data.currentTree.childObjectList.length&&"root"==a.data.currentTree.childObjectList[0].type&&a.data.currentTree.childObjectList.shift();e.updateTree(a.data.currentTree).then(function(b){var e=b.data;c.sortTreeNodesBy(e,"objectName");e.childObjectList.unshift(angular.copy(G));c.checkUndefinedNull(e.templateId)||(e.childObjectList[0].templateId=
e.templateId);c.checkUndefinedNull(e.templateItemId)||(e.childObjectList[0].templateItemId=e.templateItemId);var g=-1;a.data.trees.some(function(a,b){if(a.id==e.id)return g=b,!0});-1!=g&&(a.data.trees[g]=e,a.data.currentTree=e);if(c.checkUndefinedNull(f)||1!=f)$("#treeLevelModal").modal("hide");else{a.data.parentLevel=c.findNodeInTree(d,a.data.currentTree);a.data.currentLevel={childObjectList:[]};if(!c.checkUndefinedNull(a.data.parentLevel.templateItemId)){b=I(a.data.parentLevel.templateItemId);b=
B(b.itemLevel+1);if(null==b)return"Template item is no find.";a.data.currentLevel.levelType=b.itemName;a.data.currentLevel.objectName=b.itemNameTemplate;a.data.currentLevel.templateId=b.templateId;a.data.currentLevel.templateItemId=b.id}$("#inputLevelName").focus()}},w)};a.saveTree=function(b){if(0==r(b))return"Tree is no correct!";angular.isArray(b.childObjectList)&&0<b.childObjectList.length&&"root"==b.childObjectList[0].type&&b.childObjectList.shift();e.createTree(b).then(function(b){b=angular.copy(b.data);
b.childObjectList.unshift(angular.copy(G));c.checkUndefinedNull(b.templateId)||(b.childObjectList[0].templateId=b.templateId);c.checkUndefinedNull(b.templateItemId)||(b.childObjectList[0].templateItemId=b.templateItemId);a.data.trees.push(b);c.sortItemsBy(a.data.trees,"objectName");a.loadTree(b);$("#showTreeOptionModal").modal("hide")},w)};a.removeNodeInit=function(b){a.data.currentDeleteItem=b;a.data.currentDeleteMessage="root"==b.type?a.data.currentTree.objectName||a.data.currentTree.id:b.objectName||
b.id;y(!0);a.deleteHandler=function(b){if(c.checkUndefinedNull(b))return"Deleting item is undefined or null.";c.checkUndefinedNull(b.type)||"root"!=b.type?e.deleteTreeNode(a.data.currentTree.id,b.id).then(function(b){a.loadTree(a.data.currentTree)},p):e.deleteTree(a.data.currentTree.id).then(function(a){C()},w);$("#deleteWindowModal").modal("hide")};$("#deleteWindowModal").modal()};a.moveToNodeInit=function(b){a.data.selectedNodeForMove=null;var d=[];c.checkUndefinedNull(b)?(d=F(),a.objectCtrlSettings.anySelected=
!1):(a.selectedItem(b),d.push(b.id));a.data.treeForMove=angular.copy(a.data.currentTree);a.data.treeForMove.childObjectList.shift();a.data.treeForMove.movingObjects=d};a.moveToNode=function(){e.putObjectsToTreeNode(a.data.currentTree.id,a.data.selectedNodeForMove.id,a.data.treeForMove.movingObjects).then(function(b){a.loading=!0;"root"==a.data.selectedNode.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(v):e.loadObjectsByTreeNode(a.data.currentTree.id,a.data.selectedNode.id).then(v);$("#viewTreeModal").modal("hide")},
p)};a.releaseFromNode=function(b){var d=[];c.checkUndefinedNull(b)?(d=F(),a.objectCtrlSettings.anySelected=!1):(a.selectedItem(b),d.push(b.id));e.releaseObjectsFromTreeNode(a.data.currentTree.id,a.data.selectedNode.id,d).then(function(b){a.loading=!0;"root"==a.data.selectedNode.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(v):e.loadObjectsByTreeNode(a.data.currentTree.id,a.data.selectedNode.id).then(v)},w)};a.toggleTreeView=function(){a.objectCtrlSettings.isTreeView=!a.objectCtrlSettings.isTreeView;
0==a.objectCtrlSettings.isTreeView?x():C()};a.createTreeByTemplate=function(b){e.loadTreeTemplateItems(b.id).then(function(c){a.data.currentTreeTemplateItems=angular.copy(c.data);var d=null;a.data.currentTreeTemplateItems.some(function(a){if(0==a.itemLevel)return d=a,!0});if(null==d)return"Incorrect template. itemLevel == 0 is absent.";a.data.newTree={};a.data.newTree.templateId=b.id;a.data.newTree.templateItemId=d.id;a.data.newTree.objectName=d.itemName;$("#showTreeOptionModal").modal()},w)};a.addNodeDisabled=
function(b){if(c.checkUndefinedNull(b.templateItemId))return!1;if(!angular.isArray(a.data.currentTreeTemplateItems))return!0;b=I(b.templateItemId);return null==b||b.itemLevel<a.data.currentTreeTemplateItems.length-1?!1:!0};a.createNodeInit=function(b){a.data.parentLevel=b;a.data.currentLevel={childObjectList:[]};if(!c.checkUndefinedNull(b.templateItemId)){b=I(b.templateItemId);b=B(b.itemLevel+1);if(null==b)return"Template item is no find.";a.data.currentLevel.levelType=b.itemName;a.data.currentLevel.objectName=
b.itemNameTemplate;a.data.currentLevel.templateId=b.templateId;a.data.currentLevel.templateItemId=b.id}};$("#viewTreeModal").on("shown.bs.modal",function(){a.objectCtrlSettings.isObjectMoving=!0;a.$apply()});$("#viewTreeModal").on("hidden.bs.modal",function(){a.objectCtrlSettings.isObjectMoving=!1;a.$apply()});$("#showTreeOptionModal").on("shown.bs.modal",function(){$("#inputTreeName").focus()});$("#treeLevelModal").on("shown.bs.modal",function(){$("#inputLevelName").focus()});$("#showObjOptionModal").on("shown.bs.modal",
function(){$("#inputContObjectName").focus()});$("#showZpointOptionModal").on("shown.bs.modal",function(){$("#inputZpointName").focus()});0==a.objectCtrlSettings.isTreeView?x():C()}]);angular.module("portalNMC").controller("SettingsObjectViewCtrl",["$scope","$rootScope","$routeParams","$resource","$cookies","$compile","$parse","$timeout","crudGridDataFactory","notificationFactory","$http","objectSvc","mainSvc","reportSvc","indicatorSvc",function(a,b,d,h,g,k,f,n,l,m,e,c,q,t,u){function v(b){var c=document.getElementById("obj"+b.id);if(!angular.isUndefined(c)&&null!==c){var c=c.getElementsByClassName("nmc-tr-zpoint")[0],d="",d=d+('<td class="nmc-td-for-buttons-in-object-page" ng-hide="!objectCtrlSettings.extendedInterfaceFlag"></td><td></td><td style="padding-top: 2px !important;"><table id="zpointTable'+
b.id+'" class="crud-grid table table-lighter table-bordered table-condensed table-hover nmc-child-object-table">'),d=d+'<thead><tr class="nmc-child-table-header">',d=d+'<th class="nmc-td-for-button"></th>';a.oldColumns.forEach(function(a){d+='<th class="'+a["class"]+'">';d+=a.header||a.name;d+="</th>"});d+="</tr></thead>";b.zpoints.forEach(function(c){d+='<tr id="trZpoint'+c.id+'" ng-dblclick="getIndicators('+b.id+","+c.id+')">';d+='<td class="nmc-td-for-button"><div class="btn-group"><i title="\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043d\u0430\u0434 \u0442\u043e\u0447\u043a\u043e\u0439 \u0443\u0447\u0435\u0442\u0430" type="button" class="btn btn-xs glyphicon glyphicon-menu-hamburger nmc-button-in-table dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-size: .9em;"></i><ul class="dropdown-menu"><li><a ng-click="getZpointSettings('+
b.id+","+c.id+')"data-target="#showZpointOptionModal"data-toggle="modal"data-placement="bottom"title="\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0451\u0442\u0430">\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430</a></li><li><a ng-click="getZpointSettingsExpl('+b.id+","+c.id+')"data-target="#showZpointExplParameters"data-toggle="modal"data-placement="bottom"title="\u042d\u043a\u0441\u043f\u043b\u0443\u0430\u0442\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0451\u0442\u0430">\u042d\u043a\u0441\u043f\u043b\u0443\u0430\u0442\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b</a></li><li><a ng-click="openDeviceProperties('+
b.id+","+c.id+')"title="\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0443\u0447\u0435\u0442\u0430">\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0443\u0447\u0435\u0442\u0430</a></li><li><a ng-click="openZpointMetadata('+b.id+","+c.id+')"title="\u041c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430">\u041c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430</a></li><li ng-if=\'isDirectDevice('+
b.id+","+c.id+")'><a ng-click=\"openSchedule("+b.id+","+c.id+')"title="\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043e\u043f\u0440\u043e\u0441\u0430">\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043e\u043f\u0440\u043e\u0441\u0430</a></li>';q.checkUndefinedNull(c.deviceObject.activeDataSource)||(d+='<li><a ng-click="openDatasource('+b.id+","+c.id+')"title="\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445">\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445</a></li>');
d+="<li>";d=!0===c.isImpulse?d+"<a href='#/objects/impulse-indicators/":"el"===c.zpointType?d+"<a href='#/objects/indicator-electricity/":d+"<a href='#/objects/indicators/";d+="?objectId="+encodeURIComponent(b.id)+"&zpointId="+encodeURIComponent(c.id)+"&objectName="+encodeURIComponent(b.fullName)+"&zpointName="+encodeURIComponent(c.zpointName)+"&deviceModel="+encodeURIComponent(c.zpointModel)+"&deviceSN="+encodeURIComponent(c.zpointNumber);q.checkUndefinedNull(c.measureUnitCaption)||(d+="&mu="+encodeURIComponent(c.measureUnitCaption));
d+='\' target="_blank" ng-mousedown="setIndicatorsParams('+b.id+","+c.id+')">\u041f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430</a>';d+="</li>";d+="</ul>";d+="</div>";d+="</td>";a.oldColumns.forEach(function(a){switch(a.name){case "zpointName":var b;switch(c.zpointType){case "cw":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-22-snowflake.png";break;case "hw":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-93-tint.png";
break;case "heat":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-85-heat.png";break;case "gas":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-23-fire.png";break;case "env":b="images/es.png";break;case "el":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-242-flash.png";break;default:b=a.zpointType}d+="<td>";d+="<img class='marginLeft5' height=12 width=12 src=\""+b+"\"> <span class='paddingLeft5'></span>";d+=(c[a.name]||"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e")+
'<span ng-show="isSystemuser()">(id = '+c.id+")</span></td>";break;case "zpointLastDataDate":d+="<td>{{"+c[a.name]+" | date: 'dd.MM.yyyy HH:mm'}} <i ng-if='"+c[a.name]+"' title=\"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0434\u0435\u0442\u0430\u043b\u0438 \u043f\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c \u0434\u0430\u043d\u043d\u044b\u043c\"ng-attr-id=\"{{'zldd'+"+c.id+'}}"class="btn btn-xs glyphicon glyphicon-eject gly-rotate-180"></i></td>';break;case "zpointRefRange":d+=
'<td id="zpointRefRange'+c.id+'"></td>';break;case "zpointTimeOffsetString":b="";q.checkUndefinedNull(c[a.name])||(0===c[a.name].indexOf("+")&&(b="\u0427\u0430\u0441\u044b \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0441\u043f\u0435\u0448\u0430\u0442"),0===c[a.name].indexOf("-")&&(b="\u0427\u0430\u0441\u044b \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u043e\u0442\u0441\u0442\u0430\u044e\u0442"));d+="<td title='"+b+"'>";q.checkUndefinedNull(c[a.name])||(d+=c[a.name]);d+="</td>";break;default:d+="<td>",
q.checkUndefinedNull(c[a.name])||(d+=c[a.name]),d+="</td>"}});d+="</tr>"});d+="</table></td>";c.innerHTML=d;k(c)(a)}}function x(b){var c=b.data[0];m.success();a.objects.forEach(function(b){b.id===c&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png",b.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,b.nextSettingModeTitle=
a.cont_zpoint_setting_mode_check[1].caption):b.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption))});a.objectsOnPage.forEach(function(b){b.id===c&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png",b.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?
(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption):b.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption))})}function w(){var b=a.currentObject.contManagementId,
d=!1;a.data.cmOrganizations.some(function(a){if(a.id===b)return d=!0});!1===d&&c.getCmOrganizationsWithId(b).then(function(b){a.data.cmOrganizations=b.data;q.sortOrganizationsByName(a.data.cmOrganizations)},function(a){console.log(a)})}function p(a){if(q.checkUndefinedNull(a)||q.checkEmptyObject(a))return!1;Object.keys(a).forEach(function(b){var c="#zldd"+b,d="",d=d+"<table class='table table-condensed noMargin'>",d=d+"<tboby>";a[b].forEach(function(a){d+="<tr><td>";switch(a.timeDetailType){case "1h":d+=
"\u0427\u0430\u0441\u043e\u0432\u044b\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f";break;case "24h":d+="\u0421\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f";break;case "1mon":d+="\u0415\u0436\u0435\u043c\u0435\u0441\u044f\u0447\u043d\u044b\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f";break;case "1h_abs":d+="\u0427\u0430\u0441\u043e\u0432\u044b\u0435 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u044b";
break;case "24h_abs":d+="\u0421\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u044b";break;case "1mon_abs":d+="\u0415\u0436\u0435\u043c\u0435\u0441\u044f\u0447\u043d\u044b\u0435 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u044b";break;case "abs":d+="\u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u044b";break;default:d+=a.timeDetailType}d+="</td>";d+="<td> "+a.dataDateString+"</td></tr>"});d+="</tboby>";d+="</table>";
q.setToolTip("\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435",d,c,c,1,300)})}function y(a){a=c.getObjectsUrl()+"/"+a+"/contZPoints/timeDetailLastDate";e.get(a).then(function(a){p(a.data)},function(a){console.log(a)})}function F(b,d){c.getRefRangeByObjectAndZpoint(b,d).success(function(b){if(null!=b[0]){var c=a.dateFormat(b[0].periodBeginDate),e=a.dateFormat(b[0].periodEndDate);d.zpointRefRange="c "+c+" \u043f\u043e "+e;d.zpointRefRangeAuto=b[0].isAuto?
"auto":"manual"}else d.zpointRefRange="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d",d.zpointRefRangeAuto="notSet";G(d)}).error(function(a){console.log(a)})}function G(b){var c=document.getElementById("zpointRefRange"+b.id);if(angular.isUndefined(c)||null==c)return!1;switch(b.zpointRefRangeAuto){case "auto":c.innerHTML='<div class="progress progress-striped noMargin"><div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"><strong>'+
b.zpointRefRange+"</strong></div></div>";break;case "manual":c.innerHTML='<div class="progress progress-striped noMargin"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"><strong>'+b.zpointRefRange+"</strong></div></div>";break;default:c.innerHTML=b.zpointRefRange}k(c)(a)}function C(a){var b=[];a.forEach(function(a){1==a.isVisible&&b.push(a.fieldName)});return b}function H(a,b,c){c=C(c);if(0<c.length){var d=
new Date,d=new Date(d.getFullYear()+10,d.getMonth(),d.getDate());document.cookie="indicator"+b+a.id+"="+c+";expires="+d.toUTCString()}else g["indicator"+b+a.id]=null}function r(a,b){var c=g["indicator"+b+a.id];return q.checkUndefinedNull(c)?null:c.split(",")}function I(a,b){var c=a.length,d=b.length,e=0,N=[],f;for(f=0;f<c;f+=1){for(var g=0,h=0;b[g]!==a[f]&&g<d;)g+=1;for(;N[h]!==a[f]&&h<e;)h+=1;g!=d&&h==e&&(N[e++]=a[f])}return N}function B(a,b){var c=b.length;return a==c-2?I(b[c-2],b[c-1]):I(b[a],
B(a+1,b))}function z(){var b=!0,c=C(a.data.waterColumns);0==C(a.data.electricityColumns).length&&0==c.length&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u0412\u044b\u0431\u0435\u0440\u0435\u0442\u0435 \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u043d\u0443 \u043a\u043e\u043b\u043e\u043d\u043a\u0443."),b=!1);return b}function K(b){var c=[];angular.isArray(b)&&0<b.length&&b.forEach(function(b){if(null===b.vcValue)return!1;var d=JSON.parse(b.vcValue);b.keyname=b.vcKey;b.caption=d.caption;
b.waterColumns=d.waterColumns;b.electricityColumns=d.electricityColumns;b.indicatorHwKind=d.indicatorHwKind;b.indicatorHwPerPage=d.indicatorHwPerPage;b.indicatorElKind=d.indicatorElKind;b.indicatorElMode=d.indicatorElMode;q.checkUndefinedNull(d.widgets)?(b.widgets={},0<a.data.heatWidgetList.length&&(b.widgets.heat=a.data.heatWidgetList[0].widgetName,a.data.heatWidgetList.some(function(a){if(!0===a.isDefault)return b.widgets.heat=a.widgetName,!0})),0<a.data.hwWidgetList.length&&(b.widgets.hw=a.data.hwWidgetList[0].widgetName,
a.data.hwWidgetList.some(function(a){if(!0===a.isDefault)return b.widgets.hw=a.widgetName,!0})),0<a.data.cwWidgetList.length&&(b.widgets.cw=a.data.cwWidgetList[0].widgetName,a.data.cwWidgetList.some(function(a){if(!0===a.isDefault)return b.widgets.cw=a.widgetName,!0})),0<a.data.elWidgetList.length&&(b.widgets.el=a.data.elWidgetList[0].widgetName,a.data.elWidgetList.some(function(a){if(!0===a.isDefault)return b.widgets.el=a.widgetName,!0}))):b.widgets=d.widgets;c.push(b)});angular.isArray(c)&&0!==
c.length||(b=angular.copy(M),a.data.selectedIndicatorMode=b,c.push(b));return c}function O(){var b="../api/subscr/vcookie";q.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||(b+="?vcMode=OBJECT_INDICATOR_PREFERENCES");e.get(b).then(function(b){a.data.indicatorModes=K(b.data);angular.isArray(a.data.indicatorModes)&&0<a.data.indicatorModes.length&&(q.sortItemsBy(a.data.indicatorModes,"caption"),a.data.selectedIndicatorMode=angular.copy(a.data.indicatorModes[0]),a.messages.modeHeader=a.data.selectedIndicatorMode.caption)},
E)}function P(a){var b={},c={};b.vcMode="OBJECT_INDICATOR_PREFERENCES";b.vcKey=a.keyname;c.caption=a.caption;c.waterColumns=a.waterColumns;c.electricityColumns=a.electricityColumns;c.indicatorHwKind=a.indicatorHwKind;c.indicatorHwPerPage=a.indicatorHwPerPage;c.indicatorElMode=a.indicatorElMode;c.indicatorElKind=a.indicatorElKind;c.widgets=a.widgets;b.vcValue=JSON.stringify(c);return b}function L(b){a.data.indicatorModes.forEach(function(a){a.isCurrentMode=!1});if(q.checkUndefinedNull("../api/subscr/vcookie/user")||
q.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||q.checkUndefinedNull(b))return console.log("Request required params is null!"),!1;e.get("../api/subscr/vcookie/user?vcMode=OBJECT_INDICATOR_PREFERENCES&vcKey=OIP_"+b).then(function(b){if(q.checkUndefinedNull(b)||q.checkUndefinedNull(b.data)||0===b.data.length)return!1;var c=JSON.parse(b.data[0].vcValue);a.data.indicatorModes.some(function(a){if(a.keyname===c)return a.isCurrentMode=!0})},E)}function J(b){var c=[],d=[],e=null;a.data.buildingCategories.forEach(function(a){a.buildingType===
b&&c.push(angular.copy(a))});c.forEach(function(b){a.data.buildingCategories.forEach(function(a){a.parentCategory===b.keyname&&(e=angular.copy(a),e.parentCategoryCaption=b.caption,d.push(e))})});a.data.preparedBuildingCategoryList=d}function R(){var b=null;a.data.preparedBuildingCategoryList.some(function(c){if(c.keyname===a.currentObject.buildingTypeCategory)return b=c,!0});null!==b&&50<=b.caption.length?($("#inputBuildingCategory").removeClass("nmc-select-form"),$("#inputBuildingCategory").addClass("nmc-select-form-high")):
($("#inputBuildingCategory").removeClass("nmc-select-form-high"),$("#inputBuildingCategory").addClass("nmc-select-form"));if(q.checkUndefinedNull(a.currentObject.buildingTypeCategory))return!1}function da(b){a.objectCtrlSettings.objectModalWindowTabs.forEach(function(a){var c,d;c=document.getElementById(a.name)||null;d=document.getElementById(a.tabpanel)||null;0!==a.name.localeCompare(b)?(c.classList.remove("active"),d.classList.remove("active")):(c.classList.add("active"),d.classList.add("in"),d.classList.add("active"))})}
var T=null;a.crudTableName=c.getObjectsUrl();a.messages={};a.messages.setSelectedInWinterMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u0437\u0438\u043c\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";a.messages.setSelectedInSummerMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043b\u0435\u0442\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";
a.messages.setAllInWinterMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u0441\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u0437\u0438\u043c\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";a.messages.setAllInSummerMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u0441\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043b\u0435\u0442\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";a.messages.markAllOn="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435";
a.messages.markAllOff="\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435";a.messages.setIndicatorInterfaceForObjects="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0442\u043e\u0447\u0435\u043a \u0443\u0447\u0435\u0442\u0430";a.messages.noObjects="\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";a.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";
a.messages.modeHeader="\u0412\u044b\u0431\u0435\u0440\u0435\u0442\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435";a.messages.setIndicatorInterface="\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0439 \u0434\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u0439";a.objectCtrlSettings={};a.objectCtrlSettings.isCtrlEnd=
!1;a.objectCtrlSettings.allSelected=!1;a.objectCtrlSettings.objectsPerScroll=c.OBJECT_PER_SCROLL;a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;a.objectCtrlSettings.vzletSystemList=[];a.objectCtrlSettings.extendedInterfaceFlag=!0;a.objectCtrlSettings.serverTimeZone=3;a.objectCtrlSettings.dateFormat="DD.MM.YYYY";a.objectCtrlSettings.mapAccess=!1;a.objectCtrlSettings.mapCtxId="object_map_2nd_menu_item";a.objectCtrlSettings.htmlLoading=q.getHtmlLoading();var ba=function(){q.getContextIds().forEach(function(a){var b=
document.getElementById(a.permissionTagId);angular.isUndefined(b)||null===b||$("#"+a.permissionTagId).removeClass("nmc-hide")})};ba();b.$on("servicePermissions:loaded",function(){ba()});a.object={};a.objects=[];a.objectsOnPage=[];a.data={};a.data.currentGroupId=null;a.data.currentDevice={};a.data.dataSourcesForCurDevice=[];a.data.deviceModelsForCurDevice=[];a.data.currentDatasource={};a.data.datasourceTypesForDatasource={};(function(){c.getCmOrganizations().then(function(b){a.data.cmOrganizations=
b.data;q.sortOrganizationsByName(a.data.cmOrganizations)})})();var D=function(d){a.messages.noObjects="\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";var e=d.data;e.forEach(function(b){b.imgsrc="images/object-mode-"+b.currentSettingMode+".png";b.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption):
b.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption);angular.isDefined(b._activeContManagement)&&null!==b._activeContManagement&&(b.contManagementId=b._activeContManagement.organizationId)});a.objects=d.data;c.sortObjectsByFullName(a.objects);e=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll);
a.objectsOnPage=e;a.loading=!1;angular.isDefined(g.contObject)&&"null"!==g.contObject&&(d=c.findObjectById(Number(g.contObject),a.objects),null!==d&&(d=a.objects.indexOf(d),d>a.objectCtrlSettings.objectsOnPage&&(e=a.objects.slice(a.objectCtrlSettings.objectsOnPage,d+1),Array.prototype.push.apply(a.objectsOnPage,e),a.objectCtrlSettings.objectsOnPage=d+1,a.objectCtrlSettings.tmpCurContObj=g.contObject,n(function(){var b=document.getElementById("obj"+a.objectCtrlSettings.tmpCurContObj);q.checkUndefinedNull(b)||
b.scrollIntoView();a.objectCtrlSettings.tmpCurContObj=null},50)),a.toggleShowGroupDetails(Number(g.contObject))),g.contObject=null);b.$broadcast("objectSvc:loaded")},S=function(){c.getPromise().then(D)};a.refreshObjectsData=function(){b.$broadcast("objectSvc:requestReloadData",{contGroupId:a.data.currentGroupId});a.loading=!0;S()};a.objectsDataFilteredByGroup=function(b){a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;q.checkUndefinedNull(b)?(a.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",
a.data.currentGroupId=null):(a.messages.groupMenuHeader=b.contGroupName,a.data.currentGroupId=b.id);a.refreshObjectsData()};a.viewFullObjectList=function(){a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;a.objectCtrlSettings.isFullObjectView=!0;a.messages.treeMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";S()};a.loading=c.getLoadingStatus();a.treeLoading=!0;a.columns=[{name:"fullName",
header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","class":"col-xs-10 col-md-10"}];a.captions={loading:"loading...",totalElements:"totalElements"};a.extraProps={idColumnName:"id",defaultOrderBy:"fullName",nameColumnName:"fullName"};a.addMode=!1;a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.filter="";a.filterType="";a.oldColumns=[{name:"zpointName",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430",
"class":"col-xs-3 col-md-3"},{name:"zpointModel",header:"\u041c\u043e\u0434\u0435\u043b\u044c \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0443\u0447\u0435\u0442\u0430","class":"col-xs-2 col-md-2"},{name:"zpointNumber",header:"\u0421\u0435\u0440\u0438\u0439\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0443\u0447\u0435\u0442\u0430","class":"col-xs-2 col-md-2"},{name:"zpointRefRange",header:"\u042d\u0442\u0430\u043b\u043e\u043d\u043d\u044b\u0439 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b",
"class":"col-xs-2 col-md-2 nmc-width-12-per-cent"},{name:"zpointLastDataDate",header:"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435","class":"col-xs-2 col-md-2"},{name:"zpointTimeOffsetString",header:"\u0420\u0430\u0441\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u0438","class":"col-xs-1 col-md-1 nmc-width-10-per-cent"}];a.refRange={};a.urlRefRange="../api/subscr/contObjects/";a.cont_zpoint_setting_mode_check=[{keyname:"summer",
caption:"\u041b\u0435\u0442\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"},{keyname:"winter",caption:"\u0417\u0438\u043c\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"}];a.toggleAddMode=function(){a.addMode=!a.addMode;a.object={};a.addMode&&a.newIdProperty&&a.newIdValue&&(a.object[a.newIdProperty]=a.newIdValue)};a.toggleEditMode=function(a){a.editMode=!a.editMode};var V=function(b){m.success();$("#showZpointOptionModal").modal("hide");var c=-1;a.currentObject.zpoints.some(function(b,d){if(b.id===
a.zpointSettings.id)return c=d,!0});if(-1<c){b=!1;a.currentObject.zpoints[c].zpointName!==a.zpointSettings.customServiceName&&(b=!0);var d=-1;a.objects.some(function(b,c){a.currentObject.id===b.id&&(d=c)});-1<d&&(a.objects[d].zpoints[c].customServiceName=a.zpointSettings.customServiceName,a.objectsOnPage[d].zpoints[c].zpointName=a.zpointSettings.customServiceName,a.objects[d].zpoints[c].isManualLoading=a.zpointSettings.isManualLoading,a.objectsOnPage[d].zpoints[c].isManualLoading=a.zpointSettings.isManualLoading);
b&&v(a.objectsOnPage[d])}a.zpointSettings={}},W=function(b){m.success();a.objectCtrlSettings.allSelected=!1;a.objects.forEach(function(b){!0===b.selected&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png",b.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption):
b.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption));b.selected=!1});a.objectsOnPage.forEach(function(b){!0===b.selected&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png",b.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?(b.currentSettingModeTitle=
a.cont_zpoint_setting_mode_check[0].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption):b.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption));b.selected=!1})},Q=function(b,c){m.success();$("#deleteObjectModal").modal("hide");
$("#showObjOptionModal").modal("hide");var d=-1;angular.isDefined(a.currentObject)&&a.currentObject!=={}&&(a.objects.some(function(b,c){if(b.id===a.currentObject.id)return d=c,!0}),-1!==d&&(a.currentObject.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?(a.currentObject.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption,a.currentObject.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,a.currentObject.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption):
a.currentObject.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(a.currentObject.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,a.currentObject.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,a.currentObject.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption),a.objects[d]=a.currentObject,a.objects[d].imgsrc="images/object-mode-"+a.currentObject.currentSettingMode+".png",a.objectsOnPage[d]=a.currentObject,a.objectsOnPage[d].imgsrc="images/object-mode-"+
a.currentObject.currentSettingMode+".png"),a.currentObject={})},X=function(c){b.$broadcast("objectSvc:requestReloadData");a.currentObject._activeContManagement=c._activeContManagement;Q(c,null)},ca=function(b){Q(b,function(){a.toggleAddMode()})},E=function(b){a.treeLoading=!1;b=q.errorCallbackHandler(b);m.errorInfo(b.caption,b.description)};a.addObject=function(){l(a.crudTableName).save(a.object,ca,E)};a.deleteObject=function(b){l(a.crudTableName)["delete"]({id:b[a.extraProps.idColumnName]},Q,E)};
a.deleteObject=function(a,b){l(a)["delete"]({id:b},Q,E)};a.updateObject=function(b){var c={id:b[a.extraProps.idColumnName]};angular.isDefined(b.contManagementId)&&null!==b.contManagementId&&(c={id:b[a.extraProps.idColumnName],cmOrganizationId:b.contManagementId});l(a.crudTableName).update(c,b,X,E)};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};a.selectedObjectBy=function(b){b=angular.copy(b);a.currentObject=b;c.setCurrentObject(a.currentObject);L(b.id)};a.selectedObject=
function(b){a.currentObject=c.findObjectById(b,a.objects);q.checkUndefinedNull(a.currentObject.buildingType)||(J(a.currentObject.buildingType),R())};a.selectedObjectEx=function(b){a.selectedObject(b);angular.isArray(a.data.cmOrganizations)&&w()};a.selectedZpoint=function(b,c){a.selectedObject(b);var d=null;a.currentObject.zpoints.some(function(a){if(a.id===c)return d=angular.copy(a),!0});a.currentZpoint=d};a.toggleShowGroupDetails=function(b){var d=c.findObjectById(b,a.objects);if(null!==d){var e=
document.getElementById("zpointTable"+d.id);d.showGroupDetails=!0===d.showGroupDetails&&null===e?!0:!d.showGroupDetails;!0===d.showGroupDetails?c.getZpointsDataByObject(d,"/vo").then(function(a){var c=[],e=c=a.data;a=[];var A;for(A=0;A<e.length;A+=1){var f={};f.id=e[A].id;f.zpointOrder=e[A].contServiceType.serviceOrder+e[A].customServiceName;f.zpointType=e[A].contServiceType.keyname;f.zpointTypeCaption=e[A].contServiceType.caption;f.isManualLoading=e[A].isManualLoading;f.customServiceName=e[A].customServiceName;
f.zpointName=e[A].customServiceName;f.zpointRSO="undefined"!=typeof e[A].rso&&null!=e[A].rso?e[A].rso.organizationFullName||e[A].rso.organizationName:"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e";f.checkoutTime=e[A].checkoutTime;f.checkoutDay=e[A].checkoutDay;"undefined"==typeof e[A].doublePipe?f.piped=!1:(f.piped=!0,f.doublePipe=null===e[A].doublePipe?!1:e[A].doublePipe,f.singlePipe=!f.doublePipe);"undefined"!=typeof e[A].deviceObjects&&0<e[A].deviceObjects.length&&(f.deviceObject=e[A].deviceObjects[0],
e[A].deviceObjects[0].hasOwnProperty("deviceModel")?(f.zpointModel=e[A].deviceObjects[0].deviceModel.modelName,f.devCaption=e[A].deviceObjects[0].deviceModel.modelName||"",f.isImpulse=e[A].deviceObjects[0].isImpulse,!0===f.isImpulse&&(q.checkUndefinedNull(T)||T.all.some(function(a){a.keyname===e[A].deviceObjects[0].impulseMu&&(f.measureUnitCaption=a.caption)}))):f.zpointModel="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e",f.zpointNumber=e[A].deviceObjects[0].number,f.devCaption+=e[A].deviceObjects[0].number?
", \u2116"+e[A].deviceObjects[0].number:"");f.zpointLastDataDate=e[A].lastDataDate;q.checkUndefinedNull(e[A].deviceObjectTimeOffset)||(f.zpointTimeOffsetString=q.prepareTimeOffset(e[A].deviceObjectTimeOffset));F(d,f);a[A]=f}q.sortItemsBy(a,"zpointOrder");d.zpoints=a;v(d);a=document.getElementById("btnDetail"+d.id);angular.isDefined(a)&&null!=a&&(a.classList.remove("glyphicon-chevron-right"),a.classList.add("glyphicon-chevron-down"));d.showGroupDetailsFlag=!d.showGroupDetailsFlag;y(b)}):(document.getElementById("obj"+
d.id).getElementsByClassName("nmc-tr-zpoint")[0].innerHTML="",e=document.getElementById("btnDetail"+d.id),e.classList.remove("glyphicon-chevron-down"),e.classList.add("glyphicon-chevron-right"))}};a.dateFormat=function(b){b=new Date(b+Math.round(36E5*a.objectCtrlSettings.serverTimeZone));return null===b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]).format(a.objectCtrlSettings.dateFormat)};a.onlyNoRead=!1;a.showRow=function(b){return"undefined"!=typeof b.isRead||a.onlyNoRead?a.onlyNoRead&&
a.onlyNoRead!=!b.isRead?!1:!0:!0};a.showDetails=function(b){a.bdirectories&&(a.currentObject=b,$("#showDirectoryStructModal").modal())};a.getIndicators=function(b,c){a.setIndicatorsParams(b,c);var d="#/objects",d=!0===a.currentZpoint.isImpulse?d+"/impulse-indicators":"el"===a.currentZpoint.zpointType?d+"/indicator-electricity":d+"/indicators",d=d+("/?objectId="+encodeURIComponent(b)+"&zpointId="+encodeURIComponent(c)+"&objectName="+encodeURIComponent(a.currentObject.fullName)+"&zpointName="+encodeURIComponent(a.currentZpoint.zpointName)),
d=d+("&deviceModel="+encodeURIComponent(a.currentZpoint.zpointModel)),d=d+("&deviceSN="+encodeURIComponent(a.currentZpoint.zpointNumber));q.checkUndefinedNull(a.currentZpoint.measureUnitCaption)||(d+="&mu="+encodeURIComponent(a.currentZpoint.measureUnitCaption));window.open(d,"_blank")};a.setIndicatorsParams=function(c,d){a.selectedZpoint(c,d);g.contZPoint=a.currentZpoint.id;g.contObject=a.currentObject.id;g.contZPointName=a.currentZpoint.zpointName;g.contObjectName=a.currentObject.fullName;g.deviceModel=
a.currentZpoint.zpointModel;g.deviceSN=a.currentZpoint.zpointNumber;if(angular.isUndefined(g.timeDetailType)||"undefined"==g.timeDetailType||"null"==g.timeDetailType)g.timeDetailType="24h";g.isManualLoading=(null===a.currentZpoint.isManualLoading?!1:a.currentZpoint.isManualLoading)||!1;b.reportStart=moment().subtract(6,"days").startOf("day").format("YYYY-MM-DD");b.reportEnd=moment().endOf("day").format("YYYY-MM-DD")};a.zpointSettings={};a.getZpointSettings=function(b,c){a.selectedZpoint(b,c);var d=
a.currentZpoint,e={};e.id=d.id;e.isManualLoading=d.isManualLoading;e.customServiceName=d.customServiceName;e.zpointTypeCaption=d.zpointTypeCaption;e.zpointName=d.zpointName;switch(d.zpointType){case "heat":e.zpointType="\u0422\u0421";break;case "hw":e.zpointType="\u0413\u0412\u0421";break;case "cw":e.zpointType="\u0425\u0412";break;default:e.zpointType=d.zpointType}e.piped=d.piped;e.singlePipe=d.singlePipe;e.doublePipe=d.doublePipe;e.zpointModel=d.zpointModel;e.devCaption=d.devCaption;e.zpointRSO=
d.zpointRSO;e.checkoutTime=d.checkoutTime;e.checkoutDay=d.checkoutDay;e.winter={};e.summer={};a.zpointSettings=e;a.prepareRefRange()};a.getZpointSettingsExpl=function(b,d){a.getZpointSettings(b,d);var e={},A={},f=c.getObjectsUrl()+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode";l(f).query(function(b){var c;for(c=0;c<b.length;c+=1)"winter"==b[c].settingMode?e=b[c]:"summer"==b[c].settingMode&&(A=b[c]);a.zpointSettings.winter=e;a.zpointSettings.summer=A})};a.prepareRefRange=function(){fa(a.currentObject.id,
a.zpointSettings.id);a.editRefRangeOff()};a.editRefRangeOn=function(){a.toggleFlag=!0;document.getElementById("i_ref_range_save").style.display="block";document.getElementById("i_ref_range_add").style.display="none";document.getElementById("inp_ref_range_start").disabled=!1;document.getElementById("inp_ref_range_end").disabled=!1};a.editRefRangeOff=function(){a.toggleFlag=!1;document.getElementById("i_ref_range_save").style.display="none";document.getElementById("i_ref_range_add").style.display="block";
document.getElementById("inp_ref_range_start").disabled=!0;document.getElementById("inp_ref_range_end").disabled=!0};var fa=function(b,c){e.get(a.urlRefRange+"/"+b+"/zpoints/"+c+"/referencePeriod").success(function(b){null!=b[0]?(a.refRange=b[0],a.refRange.cont_zpoint_id=c,a.beginDate=a.dateFormat(a.refRange.periodBeginDate),a.endDate=a.dateFormat(a.refRange.periodEndDate),0==a.refRange.isAuto?(document.getElementById("spn_if_manual").style.display="block",document.getElementById("spn_if_auto").style.display=
"none"):(document.getElementById("spn_if_manual").style.display="none",document.getElementById("spn_if_auto").style.display="block")):(a.refRange={},a.refRange.cont_zpoint_id=c,a.beginDate="",a.endDate="",document.getElementById("spn_if_manual").style.display="none",document.getElementById("spn_if_auto").style.display="none")}).error(function(a){m.errorInfo(a.statusText,a.description)})};a.addRefRange=function(){var b=a.urlRefRange+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/referencePeriod";
a.refRange.id="";var c=new Date(moment(a.beginDate,a.objectCtrlSettings.dateFormat).format("YYYY-MM-DD")),c=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate());a.refRange.periodBeginDate=isNaN(c)?null:(new Date(c)).getTime();c=new Date(moment(a.endDate,a.objectCtrlSettings.dateFormat).format("YYYY-MM-DD"));c=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate());a.refRange.periodEndDate=isNaN(c)?null:(new Date(c)).getTime();e.post(b,a.refRange).success(function(b){a.editRefRangeOff();a.refRange=b;document.getElementById("zpointRefRange"+
a.currentZpoint.id);a.beginDate=a.dateFormat(a.refRange.periodBeginDate);a.endDate=a.dateFormat(a.refRange.periodEndDate);a.currentZpoint.zpointRefRange="c "+a.beginDate+" \u043f\u043e "+a.endDate;a.currentZpoint.zpointRefRangeAuto=a.refRange.isAuto?"auto":"manual";G(a.currentZpoint)}).error(function(a){m.errorInfo(a.statusText,a.description)})};var ga=function(b){m.success();l(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").update({id:a.zpointSettings.winter.id},
a.zpointSettings.winter,Y,E)},Y=function(b){m.success();$("#showZpointOptionModal").modal("hide");$("#showZpointExplParameters").modal("hide");a.zpointSettings={}};a.updateZpointCommonSettings=function(){e({url:a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id,method:"PUT",data:a.zpointSettings}).then(V,E)};a.updateZpointModeSettings=function(){l(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").update({id:a.zpointSettings.summer.id},a.zpointSettings.summer,
ga,E)};a.searchObjects=function(b){if(!(0>=a.objects.length)){a.objectsOnPage.forEach(function(a){if(1==a.showGroupDetailsFlag){var b=document.getElementById("obj"+a.id);q.checkUndefinedNull(b)||(b.getElementsByClassName("nmc-tr-zpoint")[0].innerHTML="",b=document.getElementById("btnDetail"+a.id),b.classList.remove("glyphicon-chevron-down"),b.classList.add("glyphicon-chevron-right"))}a.showGroupDetailsFlag=!1});var c=[];angular.isUndefined(b)||""===b?(c=[],a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,
c=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll)):(c=[],a.objects.forEach(function(a){-1!=a.fullName.toUpperCase().indexOf(b.toUpperCase())&&c.push(a)}));a.objectsOnPage=c}};a.$on("$destroy",function(){window.onkeydown=void 0});window.onkeydown=function(b){38==b.keyCode?(b=document.getElementById("divWithSettingsObjectTable"),b.scrollTop-=20):40==b.keyCode?(b=document.getElementById("divWithSettingsObjectTable"),b.scrollTop+=20):34==b.keyCode?(b=document.getElementById("divWithSettingsObjectTable"),
b.scrollTop+=10*a.objectCtrlSettings.objectsPerScroll):33==b.keyCode?(b=document.getElementById("divWithSettingsObjectTable"),b.scrollTop-=10*a.objectCtrlSettings.objectsPerScroll):b.ctrlKey&&36==b.keyCode?(b=document.getElementById("divWithSettingsObjectTable"),b.scrollTop=0):b.ctrlKey&&35==b.keyCode&&(b=a.objects.slice(a.objectCtrlSettings.objectsOnPage,a.objects.length),Array.prototype.push.apply(a.objectsOnPage,b),a.objectCtrlSettings.objectsOnPage+=a.objects.length,a.$apply(),b=document.getElementById("divWithSettingsObjectTable"),
b.scrollTop=b.scrollHeight)};a.addMoreObjects=function(){if(!(0>=a.objects.length)){var b=a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll;b>=a.objects.length&&(b=a.objects.length);var c=a.objects.slice(a.objectCtrlSettings.objectsOnPage,b);Array.prototype.push.apply(a.objectsOnPage,c);a.objectCtrlSettings.objectsOnPage=b>=a.objects.length?a.objects.length:a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll}};a.isSystemViewInfo=function(){return q.getViewSystemInfo()};
a.isSystemuser=function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};a.toggleObjects=function(b){a.objects.forEach(function(a){a.selected=b});a.objectsOnPage.forEach(function(a){a.selected=b})};a.setModeForObject=function(b){var d=b.nextSettingMode;a.settedMode=d;b=[b.id];var f=c.getObjectsUrl()+"/settingModeType";e({url:f,method:"PUT",params:{currentSettingMode:d},data:b}).then(x,E)};a.setModeForObjects=function(b){a.settedMode=b;var d=[];!0===
a.objectCtrlSettings.allSelected?d=a.objects.map(function(a){return a.id}):a.objectsOnPage.forEach(function(a){!0===a.selected&&d.push(a.id)});var f=c.getObjectsUrl()+"/settingModeType";e({url:f,method:"PUT",params:{currentSettingMode:b},data:d}).then(W,E)};a.getVzletSystemList=function(){var b=c.getVzletSystemList();0===b.length?c.getDeviceMetaDataVzletSystemList().then(function(b){a.objectCtrlSettings.vzletSystemList=b.data},function(a){m.errorInfo(a.statusText,a.description)}):a.objectCtrlSettings.vzletSystemList=
b};a.getVzletSystemList();a.getDevices=function(a){c.getDevicesByObject(a).then(function(b){var c=[];b.data.forEach(function(a){!0===a.metaVzletExpected&&c.push(a)});a.devices=c},E)};a.getDeviceMetaDataVzlet=function(b,d){c.getDeviceMetaDataVzlet(b,d).then(function(b){d.metaData=b.data;a.currentDevice=d;$("#metaDataEditorModal").modal()},function(a){m.errorInfo(a.statusText,a.description)})};a.updateDeviceMetaData=function(b){var c="",c=angular.isDefined(b.metaData.id)&&null!==b.metaData.id?"PUT":
"POST";e({url:"../api/subscr/contObjects/"+b.contObject.id+"/deviceObjects/"+b.id+"/metaVzlet",method:c,data:b.metaData}).then(function(b){a.currentDevice={};$("#metaDataEditorModal").modal("hide")},function(a){console.log(a);m.errorInfo(a.statusText,a.description)})};a.selectedDevice=function(b){a.data.currentDevice=angular.copy(b);b=a.data.currentDevice;angular.isDefined(b.contObjectInfo)&&null!=b.contObjectInfo&&(b.contObjectId=b.contObjectInfo.contObjectId);angular.isDefined(b.activeDataSource)&&
null!=b.activeDataSource&&(b.subscrDataSourceId=Number(b.activeDataSource.subscrDataSource.id),b.curDatasource=b.activeDataSource.subscrDataSource,b.subscrDataSourceAddr=b.activeDataSource.subscrDataSourceAddr,b.dataSourceTable1h=b.activeDataSource.dataSourceTable1h,b.dataSourceTable24h=b.activeDataSource.dataSourceTable24h)};a.openDeviceProperties=function(b,c){a.selectedZpoint(b,c);if(q.checkUndefinedNull(a.currentZpoint))return!1;a.selectedDevice(a.currentZpoint.deviceObject);if(!q.checkUndefinedNull(a.data.currentDevice.activeDataSource)){var d=
angular.copy(a.data.currentDevice.activeDataSource.subscrDataSource);a.data.dataSourcesForCurDevice=[d]}q.checkUndefinedNull(a.data.currentDevice.deviceModel)||(a.data.deviceModelsForCurDevice=[a.data.currentDevice.deviceModel]);$("#showDeviceModal").modal()};a.isDirectDevice=function(b,d){a.selectedObject(b);var e=null;if(q.checkUndefinedNull(a.currentObject)||q.checkUndefinedNull(a.currentObject.zpoints))return!1;a.currentObject.zpoints.some(function(a){if(a.id===d)return e=angular.copy(a),!0});
return q.checkUndefinedNull(e)?!1:c.isDirectDevice(e.deviceObject)};a.invokeHelp=function(){alert("This is SPRAVKA!!!111")};a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:"dd.mm.yy"};$(document).ready(function(){$("#inp_ref_range_start").datepicker({dateFormat:a.dateOptsParamsetRu.format,firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames});$("#inp_ref_range_end").datepicker({dateFormat:a.dateOptsParamsetRu.format,firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames});
$("#divWithSettingsObjectTable").scroll(function(){if(angular.isUndefined(a.filter)||""==a.filter)a.addMoreObjects(),a.$apply()});$("#inputAddress").suggestions({serviceUrl:"https://dadata.ru/api/v2",token:"f9879c8518e9c9e794ff06a6e81eebff263f97d5",type:"ADDRESS",count:5,onSelect:function(b){console.log(b);a.currentObject.fullAddress=b.value;a.$apply()}})});a.checkEmptyNullValue=function(a){return""===a||null==a?!0:!1};a.checkNumericValue=function(b){return a.checkEmptyNullValue(b)?!0:isNaN(parseFloat(b))||
!isFinite(b)?!1:!0};a.checkPositiveNumberValue=function(a){return q.checkPositiveNumberValue(a)};a.checkNumericInterval=function(b,c){return a.checkEmptyNullValue(b)||a.checkEmptyNullValue(c)||!a.checkNumericValue(b)||!a.checkNumericValue(c)?!1:parseInt(c,10)>=parseInt(b,10)?!0:!1};a.checkHHmm=function(a){return q.checkHHmm(a)};a.checkZpointSettingsFrom=function(b){return null!=b&&b.hasOwnProperty("summer")&&b.hasOwnProperty("winter")?a.checkPositiveNumberValue(b.summer.ov_BalanceM_ctrl)&&a.checkPositiveNumberValue(b.winter.ov_BalanceM_ctrl)&&
a.checkHHmm(b.summer.ov_Worktime)&&a.checkHHmm(b.winter.ov_Worktime)&&a.checkPositiveNumberValue(b.summer.leak_Gush)&&a.checkPositiveNumberValue(b.winter.leak_Gush)&&a.checkPositiveNumberValue(b.summer.leak_Night)&&a.checkPositiveNumberValue(b.winter.leak_Night)&&a.checkNumericInterval(b.summer.wm_deltaT_min,b.summer.wm_deltaT_max)&&a.checkNumericInterval(b.summer.wm_deltaQ_min,b.summer.wm_deltaQ_max)&&a.checkNumericInterval(b.winter.wm_deltaT_min,b.winter.wm_deltaT_max)&&a.checkNumericInterval(b.winter.wm_deltaQ_min,
b.winter.wm_deltaQ_max)&&a.checkNumericInterval(b.summer.wm_P2_min,b.summer.wm_P2_max)&&a.checkNumericInterval(b.summer.wm_P1_min,b.summer.wm_P1_max)&&a.checkNumericInterval(b.winter.wm_P2_min,b.winter.wm_P2_max)&&a.checkNumericInterval(b.winter.wm_P1_min,b.winter.wm_P1_max)&&a.checkNumericInterval(b.summer.wm_T2_min,b.summer.wm_T2_max)&&a.checkNumericInterval(b.summer.wm_T1_min,b.summer.wm_T1_max)&&a.checkNumericInterval(b.winter.wm_T2_min,b.winter.wm_T2_max)&&a.checkNumericInterval(b.winter.wm_T1_min,
b.winter.wm_T1_max)&&a.checkNumericInterval(b.summer.wm_M2_min,b.summer.wm_M2_max)&&a.checkNumericInterval(b.summer.wm_M1_min,b.summer.wm_M1_max)&&a.checkNumericInterval(b.winter.wm_M2_min,b.winter.wm_M2_max)&&a.checkNumericInterval(b.winter.wm_M1_min,b.winter.wm_M1_max):!0};a.checkObjectPropertiesForm=function(b){return null!=b&&b.hasOwnProperty("cwTemp")&&b.hasOwnProperty("heatArea")?a.checkNumericValue(b.cwTemp)&&a.checkNumericValue(b.heatArea):!0};a.isAdmin=function(){return q.isAdmin()};a.isReadonly=
function(){return q.isReadonly()};a.isROfield=function(){return a.isReadonly()||!a.isAdmin()};a.isCabinet=function(){return q.isCabinet()};a.objectCtrlSettings.isTreeView=!q.isCabinet();a.objectCtrlSettings.isFullObjectView=!1;a.data.currentTree={};a.data.newTree={};a.data.defaultTree=null;a.selectNode=function(b){var d=a.data.currentTree,e=a.data.selectedNode;if(!q.checkUndefinedNull(e)){if(e.id==b.id||e.type==b.type=="root")return;d=q.findNodeInTree(e,d);q.checkUndefinedNull(d)||(d.isSelected=!1)}b.isSelected=
!0;a.data.selectedNode=angular.copy(b);a.loading=!0;"root"==b.type?c.loadSubscrFreeObjectsByTree(a.data.currentTree.id).then(D):c.loadSubscrObjectsByTreeNode(a.data.currentTree.id,b.id).then(D)};a.data.trees=[];a.loadTree=function(d,e){a.loading=!0;a.treeLoading=!0;c.loadSubscrTree(d.id).then(function(c){a.treeLoading=!1;a.messages.treeMenuHeader=d.objectName||d.id;c=angular.copy(c.data);q.sortTreeNodesBy(c,"objectName");a.data.currentTree=c;a.objects=[];a.objectsOnPage=[];a.loading=!1;b.$broadcast("objectSvc:loaded");
a.messages.noObjects=""},E)};var Z=function(b){a.treeLoading=!0;c.loadSubscrTrees().then(function(c){a.treeLoading=!1;q.sortItemsBy(c.data,"objectName");a.data.trees=angular.copy(c.data);q.checkUndefinedNull(b)||1!=b.isActive||(a.data.defaultTree=q.findItemBy(a.data.trees,"id",Number(b.value)));if(!angular.isArray(a.data.trees)||0>=a.data.trees.length||q.checkUndefinedNull(a.data.defaultTree))return a.viewFullObjectList(),"View full object list!";a.loadTree(a.data.defaultTree)},E)},U=function(b){a.objectCtrlSettings.isTreeView=
b.data.isActive;Z(b.data)};a.toggleTreeView=function(){a.objectCtrlSettings.isTreeView=!a.objectCtrlSettings.isTreeView;0==a.objectCtrlSettings.isTreeView?S():c.loadDefaultTreeSetting().then(U,E)};var ea=u.getWaterColumns();a.data.waterColumns=angular.copy(ea);var aa=u.getElectricityColumns();a.data.electricityColumns=angular.copy(aa);a.selectAllWaterColumns=function(){a.data.selectedIndicatorMode.waterColumns.forEach(function(b){b.isVisible=a.selectAllWaterColumnFlag})};a.selectAllElectricityColumns=
function(){a.data.selectedIndicatorMode.electricityColumns.forEach(function(b){b.isVisible=a.selectAllElectricityColumnFlag})};a.initIndicatorColumnsPref=function(){a.data.waterColumns=angular.copy(ea);a.data.electricityColumns=angular.copy(aa);var b=[],c=[];a.selectAllWaterColumnFlag=!1;a.selectAllElectricityColumnFlag=!1;a.objectsOnPage.forEach(function(a){if(!0===a.selected){var d=r(a,"hw");q.checkUndefinedNull(d)||b.push(d);d=r(a,"el");q.checkUndefinedNull(d)||c.push(d)}});1==b.length?b=b[0]:
1<b.length&&(b=B(0,b));0!=b.length?b.forEach(function(b){a.data.waterColumns.some(function(a){if(a.fieldName==b)return a.isVisible=!0})}):(a.selectAllWaterColumnFlag=!0,a.data.waterColumns.forEach(function(a){a.isVisible=!0}));1==c.length?c=c[0]:1<c.length&&(c=B(0,c));0!=c.length?c.forEach(function(b){a.data.electricityColumns.some(function(a){if(a.fieldName==b)return a.isVisible=!0})}):(a.selectAllElectricityColumnFlag=!0,a.data.electricityColumns.forEach(function(a){a.isVisible=!0}));$("#columnSettingsModal").modal()};
a.setIndicatorColumnsPref=function(){if(0==z())return"Columns are not tested.";a.objectsOnPage.forEach(function(b){!0===b.selected&&(H(b,"hw",a.data.waterColumns),H(b,"el",a.data.electricityColumns))});$("#columnSettingsModal").modal("hide")};a.data.selectedWaterColumns=[];a.data.selectedElectricityColumns=[];a.openSchedule=function(b,c){a.selectedZpoint(b,c);a.getDeviceSchedulerSettings(b,a.currentZpoint.deviceObject)};a.getDeviceSchedulerSettings=function(b,d){c.getDeviceSchedulerSettings(b,d.id).then(function(b){a.data.currentScheduler=
b.data;a.selectedDevice(d);$("#scheduleEditorModal").modal()},E)};var M={keyname:"INDICATOR_MODE_"+(new Date).getTime(),caption:"\u041d\u043e\u0432\u043e\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 1","class":"nmc-mode-menu-item-active",isActive:!0,waterColumns:angular.copy(ea),indicatorHwKind:"24h",indicatorHwPerPage:25,electricityColumns:angular.copy(aa),indicatorElMode:"",indicatorElKind:"24h"};M.waterColumns.forEach(function(a){a.isVisible=!0});M.electricityColumns.forEach(function(a){a.isVisible=
!0});a.data.indicatorModes=[];a.addIndicatorMode=function(){var b={keyname:"INDICATOR_MODE_"+(new Date).getTime(),caption:"\u041f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 "+(a.data.indicatorModes.length+1),waterColumns:angular.copy(ea),indicatorHwKind:"24h",indicatorHwPerPage:25,electricityColumns:angular.copy(aa),indicatorElMode:"",indicatorElKind:"24h"};a.data.indicatorModes.push(b)};a.deleteIndicatorModeInit=function(b){a.data.deletingMode=b;a.messages.deleteMessage=
'\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 "'+b.caption+'"?';$("#messageForUserModal").modal()};a.deleteIndicatorMode=function(b){if(q.checkUndefinedNull(b)||q.checkUndefinedNull(b.vcMode)||q.checkUndefinedNull(b.vcKey))return console.log("Indicator mode is incorrect!"),!1;var c={};c.vcMode=
b.vcMode;c.vcKey=b.vcKey;c.vcValue=null;e.put("../api/subscr/vcookie/list",[c]).then(function(b){m.success();$("#messageForUserModal").modal("hide");if(q.checkUndefinedNull(b.data)||!angular.isArray(b.data)||0===b.data.length)return console.log("Response from server on the mode deleting  is undefined or null!"),!1;var c=b.data[0],d=-1;a.data.indicatorModes.some(function(a,b){if(a.keyname===c.vcKey)return d=b,!0});-1!==d&&a.data.indicatorModes.splice(d,1);a.data.selectedIndicatorMode.keyname==c.vcKey&&
(0===a.data.indicatorModes.length&&(b=angular.copy(M),a.data.indicatorModes.push(b)),a.data.selectedIndicatorMode=a.data.indicatorModes[0],a.messages.modeHeader=a.data.selectedIndicatorMode.caption)},E)};a.modeClick=function(b){a.selectAllWaterColumnFlag=!1;a.selectAllElectricityColumnFlag=!1;a.data.selectedIndicatorMode=angular.copy(b);a.messages.modeHeader=a.data.selectedIndicatorMode.caption};a.initIndicatorPreferences=function(){a.selectAllWaterColumnFlag=!1;a.selectAllElectricityColumnFlag=!1;
angular.isArray(a.data.indicatorModes)&&0<a.data.indicatorModes.length&&(q.sortItemsBy(a.data.indicatorModes,"caption"),a.data.selectedIndicatorMode=angular.copy(a.data.indicatorModes[0]),a.messages.modeHeader=a.data.selectedIndicatorMode.caption)};a.saveIndicatorPreferencesAsInit=function(b){a.data.selectedIndicatorModeSaveAs=angular.copy(b);a.data.selectedIndicatorModeSaveAs.keyname="INDICATOR_MODE_"+(new Date).getTime();$("#editIndicatorModeModal").modal()};a.saveIndicatorPreferencesAs=function(b){if(q.checkUndefinedNull(b))return console.log("Saving mode is undefined or null!"),
!1;a.data.selectedIndicatorModeSaveAs=angular.copy(b);a.data.selectedIndicatorModeSaveAs.keyname="INDICATOR_MODE_"+(new Date).getTime();if(q.checkUndefinedNull(a.data.selectedIndicatorModeSaveAs))return console.log("$scope.data.selectedIndicatorModeSaveAs is undefined or null!"),!1;var c=!0;a.data.indicatorModes.some(function(a){if(a.caption===b.caption&&!q.checkUndefinedNull(a.vcKey))return m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u043c. \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u0435 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443."),
c=!1,!0});if(!1===c)return!1;a.saveIndicatorPreferences(a.data.selectedIndicatorModeSaveAs)};a.saveIndicatorPreferences=function(b){var c=[];if(q.checkUndefinedNull(b))return console.log("Saving mode is undefined or null!"),!1;var d=!0;""<b.caption||(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f!"),
d=!1);if(!1===d)return!1;c.push(P(b));e.put("../api/subscr/vcookie/list",c).then(function(b){if(q.checkUndefinedNull(b.data)||!angular.isArray(b.data)||0===b.data.length)return console.log("Response data = "+b.data),!1;if(1===b.data.length){var c=K(b.data),d=-1;a.data.indicatorModes.some(function(a,b){if(a.keyname===c[0].keyname)return d=b,!0});-1!==d?a.data.indicatorModes[d]=c[0]:a.data.indicatorModes.push(c[0]);if(1<a.data.indicatorModes.length){var e=-1;a.data.indicatorModes.some(function(a,b){if(q.checkUndefinedNull(a.vcKey))return e=
b,!0});-1!==e&&a.data.indicatorModes.splice(e,1)}a.messages.modeHeader=c[0].caption}else a.data.indicatorModes=K(b.data);$("#columnSettingsModal").modal("hide");$("#editIndicatorModeModal").modal("hide")},E)};a.setDefaultObjectIndicatorModeForObjects=function(b){if(q.checkUndefinedNull("../api/subscr/vcookie/user")||q.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||q.checkUndefinedNull(b))return console.log("Request required params is null!"),!1;var c=[];!0===a.objectCtrlSettings.allSelected?
c=a.objects.map(function(a){var c={vcMode:"OBJECT_INDICATOR_PREFERENCES"};c.vcKey="OIP_"+a.id;c.vcValue=JSON.stringify(b.keyname);return c}):a.objectsOnPage.forEach(function(a){!0===a.selected&&c.push({vcMode:"OBJECT_INDICATOR_PREFERENCES",vcKey:"OIP_"+a.id,vcValue:JSON.stringify(b.keyname)})});if(0===c.length)return!1;e.put("../api/subscr/vcookie/user/list",c).then(function(a){m.success()},E)};a.setDefaultObjectIndicatorMode=function(a,b){if(q.checkUndefinedNull("../api/subscr/vcookie/user")||q.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||
q.checkUndefinedNull(a))return console.log("Request required params is null!"),!1;var c={vcMode:"OBJECT_INDICATOR_PREFERENCES"};c.vcKey="OIP_"+a;c.vcValue=JSON.stringify(b.keyname);e.put("../api/subscr/vcookie/user/list",[c]).then(function(a){m.success()},E)};a.editDefaultIndicatorMode=function(){a.data.selectedIndicatorMode.isEditMode=!0};a.applyChangeCaption=function(){a.messages.modeHeader=a.data.selectedIndicatorMode.caption;a.data.selectedIndicatorMode.isEditMode=!1};a.cancelChangeCaption=function(){a.data.selectedIndicatorMode.caption=
a.messages.modeHeader;a.data.selectedIndicatorMode.isEditMode=!1};a.widgetPreview=function(b){a.data.widgetPreview={};a.data.widgetPreview.type=b;a.data.widgetPreview.options={zpointName:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430",contZpointId:1,contObjectId:1,previewMode:!0}};a.openZpointMetadata=function(b,d){a.selectedZpoint(b,d);c.getZpointMetaSrcProp(b,d).then(function(e){a.currentZpoint.metaData={};
a.currentZpoint.metaData.srcProp=e.data;a.currentZpoint.metaData.srcProp.push({columnName:""});c.getZpointMetaDestProp(b,d).then(function(e){a.currentZpoint.metaData.destProp=e.data;c.getZpointMetaMeasureUnits(b,d)},E)},E)};a.$on("objectSvc:zpointMetadataMeasuresLoaded",function(){a.currentZpoint.metaData.measures=c.getZpointMetadataMeasures();c.getZpointMetadata(a.currentObject.id,a.currentZpoint.id).then(function(b){q.sortItemsBy(b.data,"destProp");a.currentZpoint.metaData.metaData=b.data;$("#metaDataEditorModal").modal()},
E)});a.openDatasource=function(b,c){a.selectedZpoint(b,c);if(q.checkUndefinedNull(a.currentZpoint.deviceObject.activeDataSource))return console.log("Datasource is incorrect!"),!1;a.data.currentDatasource=angular.copy(a.currentZpoint.deviceObject.activeDataSource.subscrDataSource);if(q.checkUndefinedNull(a.data.currentDatasource.rawModemIdentity)&&!q.checkUndefinedNull(a.data.currentDatasource.rawModemModelId)){var d=findModemIdentity(a.data.currentDatasource.rawModemModelId);a.data.currentDatasource.rawModemIdentity=
d.rawModemModelIdentity;a.data.currentDatasource.rawModemDialupAvailable=d.isDialup}d=[angular.copy(a.data.currentDatasource.dataSourceType)];a.data.datasourceTypesForDatasource=d;$("#showDatasourceModal").modal()};a.data.buildingTypes=[];a.data.buildingCategories=[];a.data.preparedBuildingCategoryList=[];a.data.buildingCategories=c.getBuildingCategories();a.data.buildingTypes=c.getBuildingTypes();a.$on(c.BROADCASTS.BUILDING_TYPES_LOADED,function(){a.data.buildingTypes=c.getBuildingTypes()});a.$on(c.BROADCASTS.BUILDING_CATEGORIES_LOADED,
function(){a.data.buildingCategories=c.getBuildingCategories()});a.changeBuildingType=function(b){a.currentObject.buildingTypeCategory=null;g.recentBuildingTypeCategory=a.currentObject.buildingTypeCategory;$("#inputBuildingCategory").removeClass("nmc-select-form-high");$("#inputBuildingCategory").addClass("nmc-select-form");if(q.checkUndefinedNull(b))return!1;g.recentBuildingType=b;J(b)};a.changeBuildingCategory=function(){R();g.recentBuildingTypeCategory=a.currentObject.buildingTypeCategory};a.data.heatWidgetList=
[];a.data.hwWidgetList=[];a.data.cwWidgetList=[];a.data.elWidgetList=[];$("#showObjOptionModal").on("shown.bs.modal",function(){$("#inputContObjectName").focus();$("#inputNumOfStories").inputmask("integer",{min:1,max:200})});a.objectCtrlSettings.objectModalWindowTabs=[{name:"main_object_properties_tab",tabpanel:"main_object_properties"},{name:"extra_object_properties_tab",tabpanel:"extra_object_properties"}];$("#showObjOptionModal").on("hidden.bs.modal",function(){da("main_object_properties_tab")});
a.$on("objectSvc:deviceMetadataMeasuresLoaded",function(){T=c.getDeviceMetadataMeasures()});(function(){e.get("../api/subscr/vcookie/widgets/list").then(function(b){a.data.heatWidgetList=[];a.data.hwWidgetList=[];a.data.cwWidgetList=[];a.data.elWidgetList=[];if(!angular.isArray(b.data))return!1;b.data.forEach(function(b){switch(b.contServiceType){case "heat":a.data.heatWidgetList.push(b);break;case "hw":a.data.hwWidgetList.push(b);break;case "cw":a.data.cwWidgetList.push(b);break;case "el":a.data.elWidgetList.push(b)}});
M.widgets={};0<a.data.heatWidgetList.length&&(M.widgets.heat=a.data.heatWidgetList[0].widgetName,a.data.heatWidgetList.some(function(a){if(!0===a.isDefault)return M.widgets.heat=a.widgetName,!0}));0<a.data.hwWidgetList.length&&(M.widgets.hw=a.data.hwWidgetList[0].widgetName,a.data.hwWidgetList.some(function(a){if(!0===a.isDefault)return M.widgets.hw=a.widgetName,!0}));0<a.data.cwWidgetList.length&&(M.widgets.cw=a.data.cwWidgetList[0].widgetName,a.data.cwWidgetList.some(function(a){if(!0===a.isDefault)return M.widgets.cw=
a.widgetName,!0}));0<a.data.elWidgetList.length&&(M.widgets.el=a.data.elWidgetList[0].widgetName,a.data.elWidgetList.some(function(a){if(!0===a.isDefault)return M.widgets.el=a.widgetName,!0}));O()},E)})();0==a.objectCtrlSettings.isTreeView?S():c.loadDefaultTreeSetting().then(U,E);T=c.getDeviceMetadataMeasures()}]);app=angular.module("portalNMC");
app.controller("SettingsProgramCtrl",["$rootScope","$scope","$http","notificationFactory","mainSvc","$timeout",function(a,b,d,h,g,k){function f(){k(function(){b.data.modifySettings.forEach(function(a){if(!g.checkUndefinedNull(a.subscrPref.prefDescription)){var b=a.id;a=a.subscrPref.prefDescription;$("#prefHelpButton"+b).qtip({suppress:!1,content:{text:a,button:!0},show:{event:"click"},hide:{event:"unfocus"},style:{classes:"qtip-nmc-indicator-tooltip",width:1E3},position:{my:"bottom left",at:"top right",
target:$("#prefHelpButton"+b)}})}});$("#inputHourCountValue").inputmask();$("#inputDayCountValue").inputmask();$("#inputMapValueSUBSCR_ZOOM_MAP_PREF").inputmask();$("#inputMapValueSUBSCR_LNG_MAP_PREF").inputmask();$("#inputMapValueSUBSCR_LAT_MAP_PREF").inputmask()})}function n(a){var b=!0;g.isNumeric(a.value)||(h.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u0414\u043b\u044f "'+a.subscrPref.caption+'" \u0432\u0432\u0435\u0434\u0435\u043d\u043e \u043d\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435.'),
b=!1);0>=a.value&&(h.errorInfo('\u041e\u0448\u0438\u0431\u043a\u0430. \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e "'+a.subscrPref.caption+'"',"\u0412\u0432\u0435\u0434\u0435\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043c\u0435\u043d\u044c\u0448\u0435 \u0438\u043b\u0438 \u0440\u0430\u0432\u043d\u043e \u043d\u0443\u043b\u044e, \u0430 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0432 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0435 \u043e\u0442 1 \u0434\u043e 100"),
b=!1);100<a.value&&(h.errorInfo('\u041e\u0448\u0438\u0431\u043a\u0430. \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e "'+a.subscrPref.caption+'"',"\u0412\u0432\u0435\u0434\u0435\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 100, \u0430 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0432 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0435 \u043e\u0442 1 \u0434\u043e 100"),
b=!1);return b}function l(){var a={};b.data.modifySettings.forEach(function(b){"SUBSCR_SMS_PREF_TYPE"==b.subscrPrefCategory&&(a[b.subscrPrefKeyname]=b)});return a}function m(){var a={};b.data.modifySettings.forEach(function(b){"SUBSCR_MAP_PREF_TYPE"==b.subscrPrefCategory&&(a[b.subscrPrefKeyname]=b)});return a}function e(a){var b=!0;g.isNumeric(a.value)||(h.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u0414\u043b\u044f "'+a.subscrPref.caption+'" \u0432\u0432\u0435\u0434\u0435\u043d\u043e \u043d\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435.'),
b=!1);return b}function c(a){return!g.checkUndefinedNull(a)&&1==a.SUBSCR_SMS_PREF.isActive}function q(a){return!g.checkUndefinedNull(a)&&1==a.SUBSCR_MAP_PREF.isActive}function t(){var a=l(),b=m();if(!c(a)&&!q(b))return!0;var d=!0;if(c(a)){var d=a.SUBSCR_SMS_PREF.value,f=!0;g.checkUndefinedNull(d)||""==d?(h.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",'\u041f\u043e\u043b\u0435 "URL \u0441\u0435\u0440\u0432\u0438\u0441\u0430 \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0421\u041c\u0421" \u043d\u0435\u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),
d=!1):(-1>=d.indexOf("##PHONE##")&&(h.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435","\u0412 url \u0430\u0434\u0440\u0435\u0441\u0435 \u0441\u0435\u0440\u0432\u0438\u0441\u0430 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 '##PHONE##' - \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u043d\u0430 \u043c\u0435\u0441\u0442\u043e \u043f\u043e\u0434\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u043d\u043e\u0433\u043e \u043d\u043e\u043c\u0435\u0440\u0430."),
f=!1),-1>=d.indexOf("##MSG##")&&(h.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435","\u0412 url \u0430\u0434\u0440\u0435\u0441\u0435 \u0441\u0435\u0440\u0432\u0438\u0441\u0430 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 '##MSG##' - \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u043d\u0430 \u043c\u0435\u0441\u0442\u043e \u043f\u043e\u0434\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0442\u0435\u043a\u0441\u0442\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f."),
f=!1),d=f);a=n(a.SUBSCR_DAY_COUNT_SMS_PREF)&n(a.SUBSCR_HOUR_COUNT_SMS_PREF);d&=a}a=!0;q(b)&&(a=b.SUBSCR_ZOOM_MAP_PREF,f=!0,g.isNumeric(a.value)||(h.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u0414\u043b\u044f "'+a.subscrPref.caption+'" \u0432\u0432\u0435\u0434\u0435\u043d\u043e \u043d\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435.'),f=!1),0>a.value&&(h.errorInfo('\u041e\u0448\u0438\u0431\u043a\u0430. \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e "'+
a.subscrPref.caption+'"',"\u0412\u0432\u0435\u0434\u0435\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043c\u0435\u043d\u044c\u0448\u0435 \u043d\u0443\u043b\u044f"),f=!1),a=f&e(b.SUBSCR_LNG_MAP_PREF)&e(b.SUBSCR_LAT_MAP_PREF));return d&&a}b.testData={};b.testData.smsSetting={isActive:!0,subscrPrefCategory:"SUBSCR_SMS_PREF",subscrPref:{caption:"URL \u0441\u0435\u0440\u0432\u0438\u0441\u0430 \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0421\u041c\u0421",
isActiveCaption:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0443 \u0421\u041c\u0421",placeholder:"https://service/send.php?login=<\u041b\u043e\u0433\u0438\u043d>&psw=<\u041f\u0430\u0440\u043e\u043b\u044c>&phones=##PHONE##&mes=##MSG##",keyname:"SMS_PREF",prefName:"SMS_PREF"},dayCountValue:20,hourCountValue:10};a.ctxId="program_tree_settings_page";b.ctrlSettings={};b.ctrlSettings.settingsUrl="../api/subscr/subscrPrefValues";b.ctrlSettings.isSaving=
!1;b.data={};b.data.originalSettings=[];b.data.modifySettings=[];b.data.items=[];b.data.items.trees=[{name:"\u0414\u0435\u04401"},{name:"\u0414\u0435\u04402"}];var u=function(a){b.ctrlSettings.isSaving=!1;a=g.errorCallbackHandler(a);h.errorInfo(a.caption,a.description)};b.setActiveFlagForSmsSetting=function(a){b.data.modifySettings.forEach(function(b){if("SUBSCR_DAY_COUNT_SMS_PREF"==b.subscrPrefKeyname||"SUBSCR_HOUR_COUNT_SMS_PREF"==b.subscrPrefKeyname)b.isActive=a})};b.setActiveFlagForMapSetting=
function(a){b.data.modifySettings.forEach(function(b){if("SUBSCR_LNG_MAP_PREF"==b.subscrPrefKeyname||"SUBSCR_LAT_MAP_PREF"==b.subscrPrefKeyname||"SUBSCR_ZOOM_MAP_PREF"==b.subscrPrefKeyname)b.isActive=a})};var v=function(a){angular.isArray(a)&&a.forEach(function(a){g.isNumeric(a.value)&&(a.value=Number(a.value))});b.data.originalSettings=angular.copy(a);b.data.modifySettings=angular.copy(a);f()},x=function(a){if(g.checkUndefinedNull(a))return console.log("subscrPrefKey is undefined or null"),!1;d.get(b.ctrlSettings.settingsUrl+
"/objectTreeTypes?subscrPrefKeyname="+a).success(function(c){b.data.items[a]=angular.copy(c)}).error(u)};b.checkSMSUrl=function(a){var b=!0;if(g.checkUndefinedNull(a)||""==a)return!1;-1>=a.indexOf("##PHONE##")&&(b=!1);-1>=a.indexOf("##MSG##")&&(b=!1);return b};b.checkAttemptionCount=function(a){var b=!0;if(!g.isNumeric(a)||0>=a||100<a)b=!1;return b};b.checkPositiveNumberValue=function(a){return g.checkPositiveNumberValue(a)};b.isNumeric=function(a){return g.isNumeric(a)};b.saveSettings=function(){if(0==
t())return!1;b.ctrlSettings.isSaving=!0;d.put(b.ctrlSettings.settingsUrl,b.data.modifySettings).success(function(a){b.ctrlSettings.isSaving=!1;h.success();v(a)}).error(u)};b.cancelSettings=function(){b.data.modifySettings=angular.copy(b.data.originalSettings);f()};b.setOrderBy=function(a){b.ctrlSettings.orderBy.field=a;b.ctrlSettings.orderBy.asc=!b.ctrlSettings.orderBy.asc};b.selectItem=function(a){b.currentNotice=angular.copy(a)};b.isAdmin=function(){return g.isAdmin()};b.isDisabled=function(){return!b.isAdmin()||
1==b.ctrlSettings.isSaving};b.isSystemViewInfo=function(){return g.getViewSystemInfo()};(function(){d.get(b.ctrlSettings.settingsUrl).success(function(a){angular.isArray(a)&&a.forEach(function(a){"SUBSCR_OBJECT_TREE"==a.subscrPrefCategory&&x(a.subscrPrefKeyname)});v(a)}).error(u)})()}]);angular.module("portalNMC").controller("SettingsTenantsCtrl",["$scope","$rootScope","$routeParams","$resource","$cookies","$compile","$parse","crudGridDataFactory","notificationFactory","$http","subscrCabinetsSvc","mainSvc","$timeout","$window","objectSvc","meterPeriodsSvc",function(a,b,d,h,g,k,f,n,l,m,e,c,q,t,u,v){function x(){$("body").removeClass("printSelected");$(".printSelection").remove()}function w(a,b){a.some(function(a){if(a.contObjectInfo.contObjectId===b.contObjectId&&!c.checkUndefinedNull(b.meterPeriodSettings))return a.meterPeriodSettings=
b.meterPeriodSettings,!0})}function p(b){w(a.objects,b);w(a.objectsOnPage,b)}function y(b){console.log(b);if(c.checkUndefinedNull(b)||c.checkUndefinedNull(b.data))return console.log("successGetMeterPeriodByObjectCallback: response is empty!"),!1;p(b.data);a.data.resourceSystems.forEach(function(a){c.checkUndefinedNull(b.data.meterPeriodSettings)||c.checkUndefinedNull(b.data.meterPeriodSettings[a.keyname])||(a.value=b.data.meterPeriodSettings[a.keyname])});!0===ia&&$("#nmcMeterPeriodsModal").modal()}
function F(){u.loadObjectMeterPeriods().then(function(a){a.data.forEach(function(a){p(a)})},J)}function G(a){var b={};a.forEach(function(a){c.checkUndefinedNull(a.value)||(c.checkUndefinedNull(b.meterPeriodSettings)&&(b.meterPeriodSettings={}),b.meterPeriodSettings[a.keyname]=a.value)});return b.meterPeriodSettings}function C(a){if(!angular.isArray(a))return console.log("Meter period data for resource systems is incorrect."),!1;var b=R();if(0===b.length)return"Cabinet array is empty.";a={contObjectIds:b,
meterPeriodSettings:G(a)};if(c.checkUndefinedNull(a.meterPeriodSettings))return console.log("Meter period settings is incorrect."),!1;u.setMeterPeriods(a).then(function(a){console.log(a);if(c.checkUndefinedNull(a)||c.checkUndefinedNull(a.data)||!angular.isArray(a.data))return console.log("Success callback for setMeterPeriods: response is empty!"),!1;a.data.forEach(function(a){p(a)})},J)}function H(b){var d={};if(c.checkUndefinedNull(a.data.currentObjectData)||c.checkUndefinedNull(a.data.currentObjectData.contObjectInfo)||
c.checkUndefinedNull(a.data.currentObjectData.contObjectInfo.contObjectId))return console.log("Current object data is incorrect."),!1;if(!angular.isArray(b))return console.log("Meter period data for resource systems is incorrect."),!1;d.contObjectId=a.data.currentObjectData.contObjectInfo.contObjectId;d.meterPeriodSettings=G(b);if(c.checkUndefinedNull(d.meterPeriodSettings))return console.log("Meter period settings is incorrect."),!1;u.setMeterPeriodForObject(d).then(function(a){console.log(a);ia=
!1;u.getMeterPeriodByObject(a.data.id).then(y,J)},J)}b.ctxId="settings_tenants_page";var r=[{keyname:"heat",caption:"\u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u043e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u044f",shortCaption:"\u0421\u041e"},{keyname:"hw",caption:"\u0413\u043e\u0440\u044f\u0447\u0435\u0435 \u0432\u043e\u0434\u043e\u0441\u043d\u0430\u0431\u0436\u0435\u043d\u0438\u0435",shortCaption:"\u0413\u0412\u0421"},{keyname:"cw",caption:"\u0425\u043e\u043b\u043e\u0434\u043d\u043e\u0435 \u0432\u043e\u0434\u043e\u0441\u043d\u0430\u0431\u0436\u0435\u043d\u0438\u0435",
shortCaption:"\u0425\u0412\u0421"},{keyname:"el",caption:"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u044d\u043d\u0435\u0440\u0433\u0438\u044f",shortCaption:"\u042d\u043b-\u0432\u043e"}];a.messages={};a.messages.createTenants="\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439";a.messages.recreateTenantPasswords="\u041f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u0438";a.messages.sendLoginInfoByEmail=
"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0430 \u044d\u043b. \u043f\u043e\u0447\u0442\u0443";a.messages.deleteLogins="\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439";a.messages.deleteLogin="\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f";a.messages.viewProps="\u0414\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f";
a.messages.createTenant="\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f";a.messages.changeTenantPassword="\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c";a.messages.meterPeriods="\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0435 \u043f\u0435\u0440\u0438\u043e\u0434\u044b";a.messages.setMeterPeriods="\u041d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u043e\u0442\u0447\u0435\u0442\u043d\u044b\u0435 \u043f\u0435\u0440\u0438\u043e\u0434\u044b";
a.messages.markAllOn="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435";a.messages.markAllOff="\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435";a.messages.moveToNode="\u041f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c \u043a \u0443\u0437\u043b\u0443";a.messages.releaseFromNode="\u041e\u0442\u0432\u044f\u0437\u0430\u0442\u044c \u043e\u0442 \u0443\u0437\u043b\u0430";a.objectCtrlSettings={};a.objectCtrlSettings.isCtrlEnd=!1;a.objectCtrlSettings.allSelected=!1;a.objectCtrlSettings.anySelected=
!1;a.objectCtrlSettings.objectsPerScroll=u.OBJECT_PER_SCROLL;a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;a.objectCtrlSettings.vzletSystemList=[];a.objectCtrlSettings.extendedInterfaceFlag=!0;a.objectCtrlSettings.serverTimeZone=3;a.objectCtrlSettings.dateFormat="DD.MM.YYYY";a.objectCtrlSettings.ctxId="settings_tenants_2nd_menu_item";a.objectCtrlSettings.rmaUrl="../api/rma";var I=function(){c.getContextIds().forEach(function(a){var b=document.getElementById(a.permissionTagId);
angular.isUndefined(b)||null==b||$("#"+a.permissionTagId).removeClass("nmc-hide")})};I();b.$on("servicePermissions:loaded",function(){I()});a.data={};a.data.resourceSystems=[];a.object={};a.objects=[];a.objectsOnPage=[];a.currentSug=null;var B=function(d){var f=d.data,A=angular.copy(a.objects);angular.isArray(A)&&0<A.length&&f.forEach(function(a,b){A.some(function(b){if(b.contObjectInfo.contObjectId==a.contObjectInfo.contObjectId)return c.checkUndefinedNull(b.selected)||(a.selected=b.selected),!0})});
a.objects=d.data;e.sortCabinetsByContObjectFullName(a.objects);angular.isUndefined(a.filter)||""===a.filter?(a.objectsWithoutFilter=a.objects,a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,f=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll),a.objectsOnPage=f,b.$broadcast("subscrCabinets:loaded")):a.searchObjects(a.filter);a.loading=!1;$("#deleteCabinetModal").modal("hide");F()},z=function(a){B(a);l.success()},K=function(b){var d=angular.copy(b.data),e=-1;a.objects.some(function(a,
b){if(c.checkUndefinedNull(a.cabinet)||c.checkUndefinedNull(a.cabinet.subscrUser))return!1;if(a.cabinet.subscrUser.id==d.id)return e=b,!0});-1<e&&(a.objects[e].cabinet.subscrUser=d);e=-1;a.objectsOnPage.some(function(a,b){if(c.checkUndefinedNull(a.cabinet)||c.checkUndefinedNull(a.cabinet.subscrUser))return!1;if(a.cabinet.subscrUser.id==d.id)return e=b,!0});-1<e&&(a.objectsOnPage[e].cabinet.subscrUser=d);$("#createPasswordModal").modal("hide");$("#showTenantOptionModal").modal("hide");l.success()},
O=function(c){b.$broadcast("subscrCabinets:requestReloadCabinetsData");a.loading=!0;e.getPromise().then(B)};a.selectCabinet=function(b){a.data.selectedCabinet=angular.copy(b)};a.loading=e.getLoadingStatus();a.columns=[{name:"fullName",header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","class":"col-xs-5"},{name:"fullAddress",header:"\u0410\u0434\u0440\u0435\u0441","class":"col-xs-5"}];a.captions={loading:"loading",totalElements:"totalElements"};a.extraProps={idColumnName:"id",defaultOrderBy:"fullName",
nameColumnName:"fullName"};a.addMode=!1;a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.filter="";a.filterType="";a.bGroupByObject=!1;a.bObject=!1;a.bList=!0;var P=function(b){a.confirmCode=null;b=c.getConfirmCode(b);a.confirmLabel=b.label;a.sumNums=b.result},L=function(a){console.log(a);if(!c.checkUndefinedNull(a)&&!c.checkUndefinedNull(a.status)&&406===a.status)return l.warning("\u041d\u0435 \u0432\u0441\u0435 \u043a\u0430\u0431\u0438\u043d\u0435\u0442\u044b \u0431\u044b\u043b\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u044b."),
B(a),!0;var b="-1";if(c.checkUndefinedNull(a)||c.checkUndefinedNull(a.data))b="ERR_CONNECTION";c.checkUndefinedNull(a)||c.checkUndefinedNull(a.resultCode)&&(c.checkUndefinedNull(a.data)||c.checkUndefinedNull(a.data.resultCode))||(b=a.resultCode||a.data.resultCode);a=c.getServerErrorByResultCode(b);l.errorInfo(a.caption,a.description)},J=function(a){L(a)},R=function(){var b=[];a.objects.forEach(function(a){1==a.selected&&b.push(a.contObjectInfo.contObjectId)});return b},da=function(){var b=[],d=[],
d=a.objects;d.forEach(function(a){1==a.selected&&(c.checkUndefinedNull(a.cabinet)||b.push(a.cabinet.id))});return b},T=function(){var b=[],d=[],d=a.objects;d.forEach(function(a){1==a.selected&&(c.checkUndefinedNull(a.cabinet)||c.checkUndefinedNull(a.cabinet.subscrUser)||b.push(a.cabinet.subscrUser.id))});return b};a.createCabinets=function(a){var b=[];c.checkUndefinedNull(a)?b=R():b.push(a.contObjectInfo.contObjectId);if(0==b.length)return"Cabinet array is empty.";e.createCabinets(b).then(z,J)};a.deleteCabinetsInit=
function(b){P();a.data.selectedCabinet={};var d=[];c.checkUndefinedNull(b)?d=da():(a.selectCabinet(b),c.checkUndefinedNull(b.cabinet)||d.push(b.cabinet.id));a.data.selectedCabinet.cabinetsIdsForDelete=d};a.deleteCabinets=function(a){if(0==a.cabinetsIdsForDelete.length)return"Cabinet array is empty.";e.deleteCabinets(a.cabinetsIdsForDelete).then(z,J)};a.resetPasswords=function(b){a.data.selectedCabinet={};var d=[];c.checkUndefinedNull(b)?d=T():(a.selectCabinet(b),c.checkUndefinedNull(b.cabinet)||d.push(b.cabinet.subscrUser.id));
e.resetPassword(d).then(z,J)};a.checkPasswordFields=function(b){if(c.checkUndefinedNull(b)||c.checkUndefinedNull(b.cabinet)||c.checkUndefinedNull(b.cabinet.subscrUser))return!1;var d=!0;a.emptyString(b.cabinet.subscrUser.passwordPocket)&&(d=!1);b.cabinet.subscrUser.passwordPocket!=b.cabinet.subscrUser.passwordPocketConfirm&&(d=!1);return d};a.checkPassword=function(b){if(c.checkUndefinedNull(b)||c.checkUndefinedNull(b.cabinet)||c.checkUndefinedNull(b.cabinet.subscrUser))return!1;var d=!0;a.emptyString(b.cabinet.subscrUser.passwordPocket)&&
(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c!"),d=!1);b.cabinet.subscrUser.passwordPocket!=b.cabinet.subscrUser.passwordPocketConfirm&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u044f "\u041f\u0430\u0440\u043e\u043b\u044c" \u0438 "\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f" \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442!'),
d=!1);return d};a.updateCabinet=function(a,b){if(c.checkUndefinedNull(b)||1!=b)a.cabinet.subscrUser.passwordPocket=null;e.updateCabinet(a).then(K,J)};a.createPassword=function(b){if(c.checkUndefinedNull(b))return"Cabinet is null or undefined.";if(0==a.checkPassword(b))return"User password is incorrect!";a.updateCabinet(b,!0)};var ba=function(a,b){var d=!0;c.checkUndefinedNull(a.cabinet.subscrUser.contactEmail)&&(1==b&&l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u044d\u043b. \u043f\u043e\u0447\u0442\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"),
d=!1);return d},D=function(){var b="\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439:\n";a.objects.forEach(function(a){1!=a.selected||ba(a,!1)||(b+="- "+a.cabinet.subscrCabinetNr+"\n")});"\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439:\n"!=b&&(b="\u0423 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u044d\u043b. \u043f\u043e\u0447\u0442\u0430. \u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0438\u043c \u043f\u0438\u0441\u044c\u043c\u0430 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e. \u0417\u0430\u0434\u0430\u0439\u0442\u0435 \u0438\u043c \u044d\u043b. \u043f\u043e\u0447\u0442\u0443 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443.",
l.warning(b))},S=function(a,b){var d=!0;c.checkUndefinedNull(a.cabinet.subscrUser.passwordPocket)&&(1==b&&l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043f\u0430\u0440\u043e\u043b\u044c \u0431\u044b\u043b \u0438\u0437\u043c\u0435\u043d\u0435\u043d. \u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u043d\u0430 \u044d\u043b. \u043f\u043e\u0447\u0442\u0443 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430. \u0415\u0441\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u0431\u044b\u043b \u0443\u0442\u0435\u0440\u044f\u043d, \u0442\u043e \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0439\u0442\u0435 \u0435\u043c\u0443 \u043d\u043e\u0432\u044b\u0439 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443."),
d=!1);return d},V=function(){var b="\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439:\n";a.objects.forEach(function(a){1!=a.selected||S(a,!1)||(b+="- "+a.cabinet.subscrCabinetNr+"\n")});"\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439:\n"!=b&&(b="\u0423 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043f\u0430\u0440\u043e\u043b\u0438 \u0431\u044b\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u044b. \u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u043d\u0430 \u044d\u043b. \u043f\u043e\u0447\u0442\u0443 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430. \u0415\u0441\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u0438 \u0431\u044b\u043b\u0438 \u0443\u0442\u0435\u0440\u044f\u043d\u044b, \u0442\u043e \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0439\u0442\u0435 \u0438\u043c \u043d\u043e\u0432\u044b\u0435 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443.",
l.warning(b))};a.sendLDByEmail=function(b){a.data.selectedCabinet={};var d=[];if(c.checkUndefinedNull(b))V(),D(),d=T();else{if(!S(b,!0)||!ba(b,!0))return"User data is incorrect!";a.selectCabinet(b);c.checkUndefinedNull(b.cabinet)||d.push(b.cabinet.subscrUser.id)}e.sendLDByEmail(d).then(function(){l.success()},J)};var W=function(a,b){var c=-1;b.some(function(b,d){if(b.id==a)return c=d,!0});return c},Q=function(a,b){var c=W(a,b);-1!=c&&b.splice(c,1)},X=function(a,b){l.success();$("#deleteObjectModal").modal("hide");
$("#showObjOptionModal").modal("hide");$("#setClientModal").modal("hide")},ca=function(c){b.$broadcast("subscrCabinets:requestReloadCabinetsData");a.currentObject._activeContManagement=c._activeContManagement;var d;d=W(c.id,a.objects);null!=d&&(a.objects[d]=c);d=W(c.id,a.objectsOnPage);null!=d&&(a.objectsOnPage[d]=c);X(c,null)},E=function(b,c){Q(a.currentObject.id,a.objects);Q(a.currentObject.id,a.objectsOnPage);X(b,null)},fa=function(b,c){a.currentObject.deleteObjectIds.forEach(function(b){Q(b,a.objects);
Q(b,a.objectsOnPage)});X(b,null)},ga=function(b){X(b,null);0==a.objectCtrlSettings.isTreeView||c.checkUndefinedNull(a.data.currentTree)?O(b.id):c.checkUndefinedNull(a.data.selectedNode.type)||"root"!=a.data.selectedNode.type?(a.data.selectedNodeForMove=angular.copy(a.data.selectedNode),a.data.treeForMove=angular.copy(a.data.currentTree),a.data.treeForMove.childObjectList.shift(),a.data.treeForMove.movingObjects=[b.id],a.moveToNode()):a.loadTree(a.data.currentTree,b.id)};a.addObject=function(b,d){angular.isDefined(d.contManagementId)&&
null!=d.contManagementId&&(b+="/?cmOrganizationId="+d.contManagementId);d._daDataSraw=null;c.checkUndefinedNull(a.currentSug)||(d._daDataSraw=JSON.stringify(a.currentSug));n(b).save(d,ga,J)};a.deleteObject=function(b){var c=e.getRmaObjectsUrl();angular.isDefined(b)&&angular.isDefined(b.id)&&null!=b.id&&n(c)["delete"]({id:b[a.extraProps.idColumnName]},E,J)};a.deleteObjects=function(b){var c=e.getRmaObjectsUrl();angular.isDefined(b)&&angular.isDefined(b.id)&&null!=b.id?n(c)["delete"]({id:b[a.extraProps.idColumnName]},
E,J):angular.isDefined(b.deleteObjects)&&null!=b.deleteObjects&&angular.isArray(b.deleteObjects)&&n(c)["delete"]({contObjectIds:b.deleteObjectIds},fa,J)};a.updateObject=function(b,d){var e={id:d[a.extraProps.idColumnName]};angular.isDefined(d.contManagementId)&&null!=d.contManagementId&&(e={cmOrganizationId:d.contManagementId});d._daDataSraw=null;c.checkUndefinedNull(a.currentSug)||(d._daDataSraw=JSON.stringify(a.currentSug));n(b).update(e,d,ca,J)};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===
b?!a.orderBy.asc:!0}};a.sendObjectToServer=function(b){var c=b.isSaving=!0;a.emptyString(b.fullName)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430!"),c=!1);a.emptyString(b.timezoneDefKeyname)&&1!=b.isLightForm&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0447\u0430\u0441\u043e\u0432\u043e\u0439 \u043f\u043e\u044f\u0441 \u043e\u0431\u044a\u0435\u043a\u0442\u0430!"),
c=!1);a.checkUndefinedNull(b.contManagementId)&&1!=b.isLightForm&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0430\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f!"),c=!1);a.emptyString(b.currentSettingMode)&&1!=b.isLightForm&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0440\u0435\u0436\u0438\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f!"),
c=!1);if(!c)return b.isSaving=!1;c=e.getRmaObjectsUrl();angular.isDefined(b.id)&&null!=b.id?a.updateObject(c,b):a.addObject(c,b)};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b};var Y=function(){a.currentObject.geoState="red";a.currentObject.geoStateText="\u041d\u0435 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u0430\u0440\u0442\u0435";if(a.currentObject.isValidGeoPos||!c.checkUndefinedNull(a.currentSug)&&null!=a.currentSug.data.geo_lat&&
null!=a.currentSug.data.geo_lon)a.currentObject.geoState="green",a.currentObject.geoStateText="\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u0430\u0440\u0442\u0435"};a.selectedObject=function(b,d){e.getRmaObject(b).then(function(b){a.currentObject=b.data;angular.isDefined(a.currentObject._activeContManagement)&&null!=a.currentObject._activeContManagement&&(a.currentObject.contManagementId=a.currentObject._activeContManagement.organization.id);c.checkUndefinedNull(d)||
(a.currentObject.isLightForm=d);Y()},function(a){console.log(a)})};a.toggleShowGroupDetails=function(b){b=e.findObjectById(b,a.objects);null!=b&&(b.showGroupDetails=1==b.showGroupDetails?!0:!b.showGroupDetails)};a.dateFormat=function(b){b=new Date(b+Math.round(36E5*a.objectCtrlSettings.serverTimeZone));return null==b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]).format(a.objectCtrlSettings.dateFormat)};a.onlyNoRead=!1;a.showRow=function(b){return"undefined"!=typeof b.isRead||a.onlyNoRead?
a.onlyNoRead&&a.onlyNoRead!=!b.isRead?!1:!0:!0};a.showDetails=function(b){a.bdirectories&&(a.currentObject=b,$("#showDirectoryStructModal").modal())};a.emptyString=function(a){return c.checkUndefinedEmptyNullValue(a)};a.checkUndefinedNull=function(a){return c.checkUndefinedNull(a)};a.searchObjects=function(b){if(!(0>=a.objects.length)){var c=[];angular.isUndefined(b)||""===b?(c=[],a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,c=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll)):
(c=[],a.objects.forEach(function(a){angular.isDefined(a.contObjectInfo.fullName)&&-1!=a.contObjectInfo.fullName.toUpperCase().indexOf(b.toUpperCase())&&c.push(a)}));a.objectsOnPage=c}};a.$on("$destroy",function(){window.onkeydown=void 0});window.onkeydown=function(b){var c=null;38==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop-=20):40==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop+=20):34==b.keyCode?(c=document.getElementById("divWithObjectTable"),
c.scrollTop+=10*a.objectCtrlSettings.objectsPerScroll):33==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop-=10*a.objectCtrlSettings.objectsPerScroll):b.ctrlKey&&36==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop=0):b.ctrlKey&&35==b.keyCode&&(a.objectCtrlSettings.objectsOnPage<a.objects.length&&(a.loading=!0,q(function(){a.loading=!1},a.objects.length)),b=a.objects.slice(a.objectCtrlSettings.objectsOnPage,a.objects.length),Array.prototype.push.apply(a.objectsOnPage,
b),a.objectCtrlSettings.objectsOnPage+=a.objects.length,a.$apply(),c=document.getElementById("divWithObjectTable"),c.scrollTop=c.scrollHeight)};a.addMoreObjects=function(){if(!(0>=a.objects.length)){var b=a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll;b>=a.objects.length&&(b=a.objects.length);var c=a.objects.slice(a.objectCtrlSettings.objectsOnPage,b);Array.prototype.push.apply(a.objectsOnPage,c);a.objectCtrlSettings.objectsOnPage=b>=a.objects.length?a.objects.length:a.objectCtrlSettings.objectsOnPage+
a.objectCtrlSettings.objectsPerScroll}};$("#divWithObjectTable").scroll(function(){if(angular.isUndefined(a.filter)||""==a.filter)a.addMoreObjects(),a.$apply()});a.isSystemuser=function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};a.isSystemViewInfo=function(){return c.getViewSystemInfo()};a.toggleObjects=function(b){a.objectCtrlSettings.anySelected=b;a.objects.forEach(function(a){a.selected=b});a.objectsOnPage.forEach(function(a){a.selected=b})};
a.toggleObject=function(b){var c=!1;a.objectsOnPage.some(function(a){if(1==a.selected)return c=!0});a.objectCtrlSettings.anySelected=1==c?!0:!1};a.invokeHelp=function(){alert("This is SPRAVKA!!!111")};a.deleteObjectInit=function(b){a.selectedItem(b);P()};a.addObjectInit=function(b){a.currentObject={};a.currentObject.isLightForm=b;Y();$("#showObjOptionModal").modal();$("#showObjOptionModal").css("z-index","1041")};a.deleteObjectsInit=function(){P();a.currentObject={};var b=[];if(1==a.objectCtrlSettings.allSelected)b=
a.objects,a.currentObject.deleteObjects=angular.copy(a.objects),a.currentObject.deleteObjectIds=a.objects.map(function(a){return a.id}),a.currentObject.countDeleteObjects=a.objects.length,$("#deleteObjectModal").modal();else{var b=a.objectsOnPage,c=0,d=[],e=[];b.forEach(function(a){1==a.selected&&(d.push(angular.copy(a)),e.push(a.id),c+=1)});0<c&&(a.currentObject.deleteObjects=d,a.currentObject.deleteObjectIds=e,a.currentObject.countDeleteObjects=c,$("#deleteObjectModal").modal())}};a.checkEmptyNullValue=
function(a){return""===a||null==a?!0:!1};a.checkNumericValue=function(b){return a.checkEmptyNullValue(b)?!0:isNaN(parseFloat(b))||!isFinite(b)?!1:!0};a.checkPositiveNumberValue=function(b){var c;c=a.checkNumericValue(b);return c?c=0<=parseInt(b,10)?!0:!1:c};a.checkNumericInterval=function(b,c){return a.checkEmptyNullValue(b)||a.checkEmptyNullValue(c)||!a.checkNumericValue(b)||!a.checkNumericValue(c)?!1:parseInt(c,10)>=parseInt(b,10)?!0:!1};a.checkHHmm=function(a){return/(0[0-9]|1[0-9]|2[0-3]){1,2}:([0-5][0-9]){1}/.test(a)?
!0:!1};a.checkObjectPropertiesForm=function(b){return null!=b&&b.hasOwnProperty("cwTemp")&&b.hasOwnProperty("heatArea")?a.checkNumericValue(b.cwTemp)&&a.checkNumericValue(b.heatArea):!0};$(document).ready(function(){$("#inputTSNumber").inputmask();$("#inputEXCode").inputmask();$("#inputObjAddress").suggestions({serviceUrl:"https://dadata.ru/api/v2",token:"f9879c8518e9c9e794ff06a6e81eebff263f97d5",type:"ADDRESS",count:10,onSelect:function(b){a.currentObject.fullAddress=b.value;a.currentSug=b;a.currentObject.isAddressAuto=
!0;Y();a.$apply()},onSearchComplete:function(a,b){}});$("#inputObjAddress").change(function(){a.currentSug=null;a.currentObject.isAddressAuto=!1;a.currentObject.isValidGeoPos=!1;Y();a.$apply()})});$("#showObjOptionModal").on("hidden.bs.modal",function(){a.currentObject.isSaving=!1;a.currentSug=null});a.data.treeTemplates=e.getRmaTreeTemplates();a.objectCtrlSettings.treeSettings={};a.objectCtrlSettings.treeSettings.nodesPropName="childObjectList";a.data.currentDeleteMessage="";var Z={objectName:"",
type:"root",childObjectList:[]};a.objectCtrlSettings.isTreeView=!1;a.data.currentTree={};a.data.newTree={};a.findNodeInTree=function(a,b){return c.findNodeInTree(a,b)};a.selectNode=function(b){var d=a.data.currentTree,f=a.data.selectedNode;if(1==a.objectCtrlSettings.isObjectMoving){d=a.data.treeForMove;if(c.checkUndefinedNull(a.data.selectedNodeForMove)){b.isSelected=!0;a.data.selectedNodeForMove=angular.copy(b);return}f=a.data.selectedNodeForMove}f.id!=b.id&&f.type==b.type!="root"&&(c.checkUndefinedNull(f)||
(d=c.findNodeInTree(f,d),c.checkUndefinedNull(d)||(d.isSelected=!1)),b.isSelected=!0,1==a.objectCtrlSettings.isObjectMoving?a.data.selectedNodeForMove=angular.copy(b):(a.data.selectedNode=angular.copy(b),a.loading=!0,"root"==b.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(B):e.loadObjectsByTreeNode(a.data.currentTree.id,b.id).then(B)))};a.data.trees=[];a.loadTree=function(b,d){a.loading=!0;e.loadTree(b.id).then(function(d){a.messages.treeMenuHeader=b.objectName||b.id;var f=angular.copy(d.data);
f.childObjectList.unshift(angular.copy(Z));a.data.currentTree=f;f.childObjectList[0].isSelected=!0;a.data.selectedNode=angular.copy(f.childObjectList[0]);e.loadFreeObjectsByTree(b.id).then(B);if(c.checkUndefinedNull(a.data.currentTree.templateId))return"Tree is free";e.loadTreeTemplateItems(a.data.currentTree.templateId).then(function(b){a.data.currentTreeTemplateItems=angular.copy(b.data);f.childObjectList[0].templateId=a.data.currentTree.templateId;f.childObjectList[0].templateItemId=a.data.currentTree.templateItemId},
L)},L)};var U=function(){e.loadTrees().then(function(b){c.sortItemsBy(b.data,"objectName");a.data.trees=angular.copy(b.data);if(!angular.isArray(a.data.trees)||0>=a.data.trees.length)return a.messages.treeMenuHeader="\u0412\u044b\u0431\u0435\u0440\u0435\u0442\u0435 \u0434\u0435\u0440\u0435\u0432\u043e",O(),"Object tree array is empty.";a.loadTree(a.data.trees[0])},L)},ea=function(b,d){var e;e="root"==d.type?a.data.currentTree:d;if(c.checkUndefinedNull(e)||!angular.isArray(e.childObjectList))return"Parent is incorrect node!";
e.childObjectList.push(b)},aa=function(b){var c=!0;a.emptyString(b.objectName)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435!"),c=!1);return c},M=function(b){var c=null;a.data.currentTreeTemplateItems.some(function(a){if(b==a.id)return c=a,!0});return c},N=function(b){var c=null;a.data.currentTreeTemplateItems.some(function(a){if(b==a.itemLevel)return c=a,!0});return c};
a.saveNode=function(b,d,f){if(0==aa(b))return"Node is no correct!";ea(b,d);angular.isArray(a.data.currentTree.childObjectList)&&0<a.data.currentTree.childObjectList.length&&"root"==a.data.currentTree.childObjectList[0].type&&a.data.currentTree.childObjectList.shift();e.updateTree(a.data.currentTree).then(function(b){var e=b.data;e.childObjectList.unshift(angular.copy(Z));c.checkUndefinedNull(e.templateId)||(e.childObjectList[0].templateId=e.templateId);c.checkUndefinedNull(e.templateItemId)||(e.childObjectList[0].templateItemId=
e.templateItemId);var g=-1;a.data.trees.some(function(a,b){if(a.id==e.id)return g=b,!0});-1!=g&&(a.data.trees[g]=e,a.data.currentTree=e);if(c.checkUndefinedNull(f)||1!=f)$("#treeLevelModal").modal("hide");else{a.data.parentLevel=c.findNodeInTree(d,a.data.currentTree);a.data.currentLevel={childObjectList:[]};if(!c.checkUndefinedNull(a.data.parentLevel.templateItemId)){b=M(a.data.parentLevel.templateItemId);b=N(b.itemLevel+1);if(null==b)return"Template item is no find.";a.data.currentLevel.objectName=
b.itemName;a.data.currentLevel.templateId=b.templateId;a.data.currentLevel.templateItemId=b.id}$("#inputLevelName").focus()}},L)};a.saveTree=function(b){if(0==aa(b))return"Tree is no correct!";angular.isArray(b.childObjectList)&&0<b.childObjectList.length&&"root"==b.childObjectList[0].type&&b.childObjectList.shift();e.createTree(b).then(function(b){b=angular.copy(b.data);b.childObjectList.unshift(angular.copy(Z));c.checkUndefinedNull(b.templateId)||(b.childObjectList[0].templateId=b.templateId);c.checkUndefinedNull(b.templateItemId)||
(b.childObjectList[0].templateItemId=b.templateItemId);a.data.trees.push(b);a.loadTree(b);$("#showTreeOptionModal").modal("hide")},L)};a.removeNodeInit=function(b){a.data.currentDeleteItem=b;a.data.currentDeleteMessage="root"==b.type?a.data.currentTree.objectName||a.data.currentTree.id:b.objectName||b.id;P(!0);a.deleteHandler=function(b){if(c.checkUndefinedNull(b))return"Deleting item is undefined or null.";c.checkUndefinedNull(b.type)||"root"!=b.type?e.deleteTreeNode(a.data.currentTree.id,b.id).then(function(b){a.loadTree(a.data.currentTree)},
J):e.deleteTree(a.data.currentTree.id).then(function(a){U()},L);$("#deleteWindowModal").modal("hide")};$("#deleteWindowModal").modal()};a.moveToNodeInit=function(b){a.data.selectedNodeForMove=null;var d=[];c.checkUndefinedNull(b)?d=R():(a.selectedItem(b),d.push(b.id));a.data.treeForMove=angular.copy(a.data.currentTree);a.data.treeForMove.childObjectList.shift();a.data.treeForMove.movingObjects=d};a.moveToNode=function(){e.putObjectsToTreeNode(a.data.currentTree.id,a.data.selectedNodeForMove.id,a.data.treeForMove.movingObjects).then(function(b){a.loading=
!0;"root"==a.data.selectedNode.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(B):e.loadObjectsByTreeNode(a.data.currentTree.id,a.data.selectedNode.id).then(B);$("#viewTreeModal").modal("hide")},J)};a.releaseFromNode=function(b){var d=[];c.checkUndefinedNull(b)?d=R():(a.selectedItem(b),d.push(b.id));e.releaseObjectsFromTreeNode(a.data.currentTree.id,a.data.selectedNode.id,d).then(function(b){a.loading=!0;"root"==a.data.selectedNode.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(B):
e.loadObjectsByTreeNode(a.data.currentTree.id,a.data.selectedNode.id).then(B)},L)};a.toggleTreeView=function(){a.objectCtrlSettings.isTreeView=!a.objectCtrlSettings.isTreeView;0==a.objectCtrlSettings.isTreeView?O():U()};a.createTreeByTemplate=function(b){e.loadTreeTemplateItems(b.id).then(function(c){a.data.currentTreeTemplateItems=angular.copy(c.data);var d=null;a.data.currentTreeTemplateItems.some(function(a){if(0==a.itemLevel)return d=a,!0});if(null==d)return"Incorrect template. itemLevel == 0 is absent.";
a.data.newTree={};a.data.newTree.templateId=b.id;a.data.newTree.templateItemId=d.id;a.data.newTree.objectName=d.itemName;$("#showTreeOptionModal").modal()},L)};a.addNodeDisabled=function(b){if(c.checkUndefinedNull(b.templateItemId))return!1;if(!angular.isArray(a.data.currentTreeTemplateItems))return!0;b=M(b.templateItemId);return null==b||b.itemLevel<a.data.currentTreeTemplateItems.length-1?!1:!0};a.createNodeInit=function(b){a.data.parentLevel=b;a.data.currentLevel={childObjectList:[]};if(!c.checkUndefinedNull(b.templateItemId)){b=
M(b.templateItemId);b=N(b.itemLevel+1);if(null==b)return"Template item is no find.";a.data.currentLevel.objectName=b.itemName;a.data.currentLevel.templateId=b.templateId;a.data.currentLevel.templateItemId=b.id}};$("#viewTreeModal").on("shown.bs.modal",function(){a.objectCtrlSettings.isObjectMoving=!0;a.$apply()});$("#viewTreeModal").on("hidden.bs.modal",function(){a.objectCtrlSettings.isObjectMoving=!1;a.$apply()});a.printTenant=function(){$("body").addClass("printSelected");$("body").append("<div class='printSelection'></div>");
$("#showTenantOptionModal").clone().appendTo(".printSelection");window.print();window.setTimeout(x,0)};$("#showTreeOptionModal").on("shown.bs.modal",function(){$("#inputTreeName").focus()});$("#treeLevelModal").on("shown.bs.modal",function(){$("#inputLevelName").focus()});$("#showTenantOptionModal").on("shown.bs.modal",function(){$("#inputTenantName").focus()});$("#createPasswordModal").on("shown.bs.modal",function(){$("#inputTenantPassword").focus()});a.data.meterPeriods=[];a.data.currentObject=
{};var ia=!1,ha=!1;a.openMeterPeriods=function(b){a.data.resourceSystems=angular.copy(r);a.data.currentObjectData=b;ia=!0;ha=!1;u.getMeterPeriodByObject(b.contObjectInfo.contObjectId).then(y,J)};a.setMeterPeriodsInit=function(){ha=!0;a.data.resourceSystems=angular.copy(r);$("#nmcMeterPeriodsModal").modal()};a.saveMeterPeriodSettings=function(a){!1===ha?H(a):!0===ha&&C(a)};v.loadMeterPeriods().then(function(b){console.log(b);if(angular.isUndefined(b)||null===b||!angular.isArray(b.data))return console.log("Meter periods is empty."),
!1;a.data.meterPeriods=angular.copy(b.data)},J);0==a.objectCtrlSettings.isTreeView?O():U()}]);app=angular.module("portalNMC");
app.controller("SettingsUsersCtrl",["$rootScope","$scope","$http","notificationFactory","crudGridDataFactory","mainSvc",function(a,b,d,h,g,k){a.ctxId="settings_users_page";b.extraProps={idColumnName:"id",defaultOrderBy:"fullName",nameColumnName:"fullName"};b.ctrlSettings={};b.ctrlSettings.orgUrl="../api/rma/contObjects/cmOrganizations";b.ctrlSettings.clientsUrl="../api/rma/subscribers";b.ctrlSettings.subscrUrl="../api/subscr";b.ctrlSettings.userUrlSuffix="/subscrUsers";b.ctrlSettings.userColumns=
[{name:"userName",caption:"\u041b\u043e\u0433\u0438\u043d","class":"col-xs-2 col-md-2"},{name:"userNickname",caption:"\u0418\u043c\u044f","class":"col-xs-3 col-md-3"},{name:"userComment",caption:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439","class":"col-xs-7 col-md-7"}];b.data={};b.data.organizations=[];b.data.clients=[];b.data.users=[];b.data.currentUser={};b.data.currentClient={};var f=function(){d.get(b.ctrlSettings.subscrUrl+b.ctrlSettings.userUrlSuffix).then(function(a){a.data.forEach(function(a){if(!angular.isArray(a.subscrRoles))return a.userName+
" is have not the subscrRoles.";a.subscrRoles.some(function(b){"ROLE_SUBSCR_ADMIN"==b.roleName&&(a.isAdmin=!0);"ROLE_SUBSCR_READONLY"==b.roleName&&(a.isReadonly=!0)})});b.data.users=a.data},function(a){console.log(a)})};(function(){d.get(b.ctrlSettings.orgUrl).then(function(a){b.data.organizations=a.data;f()},function(a){console.log(a)})})();b.selectedItem=function(a){a=angular.copy(a);b.data.currentUser=a};b.addUser=function(){b.data.currentUser={};b.data.currentUser.id=null;b.data.currentUser.isAdmin=
!1;b.data.currentUser.isReadonly=!1;$("#showUserOptionModal").modal()};var n=function(a,b){h.success();$("#deleteUserModal").modal("hide");$("#showUserOptionModal").modal("hide");f()},l=function(a){a=k.errorCallbackHandler(a);h.errorInfo(a.caption,a.description)};b.sendUserToServer=function(a){if(0==b.checkForm(a))return!1;var d=b.ctrlSettings.subscrUrl+b.ctrlSettings.userUrlSuffix;angular.isDefined(a.id)&&null!=a.id?b.updateObject(d,a):b.addObject(d,a)};b.addObject=function(a,b){a+="/?isAdmin="+
b.isAdmin;angular.isDefined(b.password)&&null!=b.password&&""!=b.password&&(a+="&newPassword="+b.password);angular.isDefined(b.isReadonly)&&null!=b.isReadonly&&(a+="&isReadonly="+b.isReadonly);g(a).save(b,n,l)};b.deleteObject=function(a){g(b.ctrlSettings.subscrUrl+b.ctrlSettings.userUrlSuffix)["delete"]({id:a[b.extraProps.idColumnName]},n,l)};b.updateObject=function(a,d){var c={id:d[b.extraProps.idColumnName]};angular.isDefined(d.isAdmin)&&null!=d.isAdmin&&(c.isAdmin=d.isAdmin);angular.isDefined(d.password)&&
null!=d.password&&""!=d.password&&(c.oldPassword=d.curpassword,c.newPassword=d.password);angular.isDefined(d.isReadonly)&&null!=d.isReadonly&&(c.isReadonly=d.isReadonly);g(a).update(c,d,n,l)};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=k.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.changeClient=function(){f()};b.emptyString=function(a){return k.checkUndefinedEmptyNullValue(a)};b.checkPassword=function(){return!(null==b.data.currentUser.id&&b.emptyString(b.data.currentUser.password)||
b.data.currentUser.password!=b.data.currentUser.passwordConfirm)};b.checkForm=function(a){var d=!0;b.emptyString(a.userNickname)&&(h.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f!"),d=!1);b.emptyString(a.userName)&&(h.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043b\u043e\u0433\u0438\u043d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f!"),
d=!1);b.checkPassword()||(h.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043f\u0430\u0440\u043e\u043b\u044c!"),d=!1);return d};$(document).ready(function(){$("#inputUserName").inputmask({mask:"a[*{1,20}]",greedy:!1,definitions:{"*":{validator:"[0-9a-z!_-]",cardinality:1,casing:"lower"}}})});b.isAdmin=function(){return k.isAdmin()};b.isReadonly=function(){return k.isReadonly()};b.isROfield=function(){return b.isReadonly()||
!b.isAdmin()};b.isCabinetsEnabled=function(){return!0};b.isSystemViewInfo=function(){return k.getViewSystemInfo()};$("#showUserOptionModal").on("shown.bs.modal",function(){$("#inputFirstName").focus()})}]);app=angular.module("portalNMC");
app.controller("TariffsCtrl",["$scope","$rootScope","$resource","crudGridDataFactory","notificationFactory","objectSvc","mainSvc",function(a,b,d,h,g,k,f){b.ctxId="tariffs_page";a.ctrlSettings={};a.ctrlSettings.dateFormat="DD.MM.YYYY";a.ctrlSettings.selectedAll=!1;var n=36E5*f.getServerTimeZone();a.crudTableName="../api/subscr/tariff";a.groupUrl="../api/subscr/contGroup";a.columns=[{name:"tariffPlanName",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-xs-3"},
{name:"tariffTypeName",header:"\u0412\u0438\u0434 \u0443\u0441\u043b\u0443\u0433\u0438","class":"col-xs-1"},{name:"tariffRsoOrganizationName",header:"\u0420\u0421\u041e","class":"col-xs-3"},{name:"tariffIntervalCaption",header:"\u0421\u0440\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f","class":"col-xs-3"},{name:"tariffPlanValue",header:"\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c, \u0440\u0443\u0431","class":"col-xs-1"}];a.extraProps={idColumnName:"id",defaultOrderBy:"tariffPlanName",
deleteConfirmationProp:"tariffPlanName"};a.objects=[];a.rsos=[];a.tariffTypes=[];a.tariffOptions=[];a.startDateFormat=null;a.endDateFormat=null;a.object={};a.currentObject={};a.addMode=!1;a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.filter="";a.headers={};a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b";a.toggleAddMode=function(){a.addMode=!a.addMode;a.object={};a.addMode&&a.newIdProperty&&a.newIdValue&&(a.object[a.newIdProperty]=
a.newIdValue)};a.toggleEditMode=function(a){a.editMode=!a.editMode};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b;a.startDateFormat=null==a.currentObject.startDate?null:new Date(a.currentObject.startDate);a.endDateFormat=null==a.currentObject.endDate?null:new Date(a.currentObject.endDate);a.paramsetStartDateFormat=new Date(a.currentObject.startDate);a.psStartDateFormatted=null!==a.currentObject.startDate?moment.utc(a.currentObject.startDate+n).format(a.ctrlSettings.dateFormat):"";
a.paramsetEndDateFormat=new Date(a.currentObject.endDate);a.psEndDateFormatted=null!==a.currentObject.startDate?moment.utc(a.currentObject.endDate+n).format(a.ctrlSettings.dateFormat):""};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};var l=function(b,c){g.success();$("#deleteObjectModal").modal("hide");a.getTariffs(c)},m=function(a){l(a,function(){$("#editTariffModal").modal("hide")})};$("#editTariffModal").on("hide",function(b){a.currentObject={}});var e=
function(a){console.log(a);var b="-1";if(f.checkUndefinedNull(a)||f.checkUndefinedNull(a.data))b="ERR_CONNECTION";f.checkUndefinedNull(a)||f.checkUndefinedNull(a.resultCode)&&(f.checkUndefinedNull(a.data)||f.checkUndefinedNull(a.data.resultCode))||(b=a.resultCode||a.data.resultCode);a=f.getServerErrorByResultCode(b);g.errorInfo(a.caption,a.description)};a.addObject=function(){h(a.crudTableName).save(a.object,m,e)};a.deleteObject=function(b){h(a.crudTableName)["delete"]({id:b[a.extraProps.idColumnName]},
l,e)};a.getTariffs=function(b){h(a.crudTableName+"/default").query(function(c){a.objects=c;0<a.tariffOptions.length&&a.objects.forEach(function(b){a.tariffOptions.some(function(a){if(b.tariffOptionKeyname===a.keyname)return b.tariffOptionCaption=a.tariffOptionName,!0})});a.objects.forEach(function(b){b.tariffTypeName=b.tariffType.tariffTypeName;b.tariffRsoOrganizationName=b.rso.organizationName;b.tariffStartDateFormatted=null!==b.startDate?moment.utc(b.startDate+n).format(a.ctrlSettings.dateFormat):
"";b.tariffEndDateFormatted=null!==b.endDate?moment.utc(b.endDate+n).format(a.ctrlSettings.dateFormat):"";b.tariffIntervalCaption="\u0441 "+b.tariffStartDateFormatted+" \u043f\u043e "+b.tariffEndDateFormatted});b&&b()})};a.getRSOs=function(){h(a.crudTableName+"/rso").query(function(b){a.rsos=b})};a.getTariffTypes=function(){h(a.crudTableName+"/type").query(function(b){a.tariffTypes=b})};a.getTariffOptions=function(){h(a.crudTableName+"/option").query(function(b){a.tariffOptions=b;a.getTariffs()})};
a.getRSOs();a.getTariffTypes();a.getTariffOptions();a.saveObject=function(b){f.checkUndefinedNull(b.tariffOption)||(b.tariffOptionKey=b.tariffOption.keyname);var c=(new Date(moment(a.psStartDateFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD"))).getTime();b.startDate=isNaN(c)?null:c-n;c=(new Date(moment(a.psEndDateFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD"))).getTime();b.endDate=isNaN(c)?null:c-n;c=a.selectedObjects.map(function(a){return a.id});null!=b.id&&"undefined"!=typeof b.id?
h(a.crudTableName).update({rsoOrganizationId:b.rso.id,tariffTypeId:b.tariffType.id,contObjectIds:c},b,m,e):d(a.crudTableName,{},{save:{method:"POST",params:{rsoOrganizationId:b.rso.id,tariffTypeId:b.tariffType.id}}}).save({contObjectIds:c},b,m,e)};a.saveObjectAsNew=function(b){b=angular.copy(b);b.id=null;a.saveObject(b)};var c=function(){$("#main_properties_tab").addClass("active");$("#set_of_objects_tab").removeClass("active");$("#editTariffModal").modal()};a.prepareObjectsList=function(){a.availableObjectGroups.forEach(function(a){a.selected=
!1});a.ctrlSettings.selectedAll=!1};a.addTariff=function(){a.availableObjects=[];a.selectedObjects=[];a.currentObject={};a.currentObject.isDefault=!1;a.startDateFormat=null;a.endDateFormat=null;a.psStartDateFormatted=moment().format(a.ctrlSettings.dateFormat);a.psEndDateFormatted=moment().format(a.ctrlSettings.dateFormat);a.getAvailableObjects(0);a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;c()};a.editTariff=function(b){a.selectedItem(b);a.getAvailableObjects(b.id);a.getSelectedObjects();
a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;c()};a.checkRequiredFields=function(){return f.checkUndefinedNull(a.currentObject.rso)||f.checkUndefinedNull(a.currentObject.tariffType)?!1:!(null==a.psStartDateFormatted||""==a.psStartDateFormatted||null==a.currentObject.rso.id||null==a.currentObject.tariffType.id)&&a.checkPositiveNumberValue(a.currentObject.tariffPlanValue)&&a.checkDateIntervalWithRightNull(a.psStartDateFormatted,a.psEndDateFormatted)};a.availableObjects=[];a.availableObjectGroups=
[];a.selectedObjects=[];a.getAvailableObjects=function(b){h(a.crudTableName+"/"+b+"/contObject/available").query(function(b){a.availableObjects=b;k.sortObjectsByFullName(a.availableObjects)})};a.getSelectedObjects=function(){h(a.crudTableName+"/"+a.currentObject.id+"/contObject").query(function(b){a.selectedObjects=b;k.sortObjectsByFullName(a.selectedObjects)})};a.getGroupObjects=function(b){h(a.groupUrl+"/"+b.id+"/contObject").query(function(a){b.objects=a})};a.getAvailableObjectGroups=function(){h(a.groupUrl).query(function(b){b.forEach(function(b){a.getGroupObjects(b)});
a.availableObjectGroups=b})};a.getAvailableObjectGroups();a.viewAvailableObjects=function(b){a.showAvailableObjects_flag=!a.showAvailableObjects_flag;(a.showAvailableObjectGroups_flag=b)?(a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",a.availableEntities=a.availableObjectGroups):(a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b",
a.availableEntities=a.availableObjects)};var q=function(b,c){var d={},e=[],f=[],g=[],h;a.addObject_flag?(e=a.availableObjects,g=f=a.selectedObjects):(f=a.availableObjects,g=e=a.selectedObjects);for(h=0;h<e.length;h+=1)if(e[h].id==a.currentObjectId){d=angular.copy(e[h]);d.selected=!1;e.splice(h,1);break}f.push(d);return g.map(function(a){return a.id})};a.getResource=function(a,b){return d(a,{},{update:{method:"PUT",params:{reportParamsetId:b}},addObject:{method:"POST",params:{contObjectId:b}},removeObject:{method:"DELETE"}})};
a.addObject=function(b){a.addObject_flag=!0;a.currentObjectId=b.id;q(!0,b.id)};a.removeObject=function(b){a.addObject_flag=!1;a.currentObjectId=b.id;q(!1,b.id)};a.removeSelectedObject=function(b){a.availableObjects.push(b);a.selectedObjects.splice(a.selectedObjects.indexOf(b),1);k.sortObjectsByFullName(a.availableObjects)};a.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};a.deleteDoublesObjects=function(a){for(var b=
a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&a.splice(b,1)};a.addUniqueObjectsFromGroupsToSelectedObjects=function(a,b){var c,d;for(c=0;c<a.length;c+=1){var e=!0;for(d=0;d<b.length;d+=1)if(a[c].fullName===b[d].fullName){e=!1;break}e&&b.push(a[c])}};a.removeGroupObjectsFromAvailableObjects=function(a,b){var c,d;for(d=0;d<a.length;d+=1){var e=-1;for(c=0;c<b.length;c+=1)if(a[d].fullName===b[c].fullName){e=c;break}0<=e&&b.splice(e,1)}};a.selectAllAvailableEntities=function(){var b;for(b=0;b<a.availableEntities.length;b+=
1)a.availableEntities[b].selected=a.ctrlSettings.selectedAll};a.addSelectedEntities=function(){var b;a.showAvailableObjectGroups_flag&&(b=a.joinObjectsFromSelectedGroups(a.availableEntities),k.sortObjectsByFullName(b),a.deleteDoublesObjects(b),a.addUniqueObjectsFromGroupsToSelectedObjects(b,a.selectedObjects),a.removeGroupObjectsFromAvailableObjects(b,a.availableObjects));var c=angular.copy(a.availableObjects);for(b=0;b<a.availableObjects.length;b+=1){var d=a.availableObjects[b];if(d.selected){var e=
angular.copy(d);e.selected=null;var f=-1;c.some(function(a,b,c){return a.fullName===d.fullName?(f=b,!0):!1});c.splice(f,1);a.selectedObjects.push(e);d.selected=null}}a.availableObjects=c;k.sortObjectsByFullName(a.selectedObjects);a.showAvailableObjects_flag=!1};a.isSystemuser=function(){return f.isSystemuser()};a.isAdmin=function(){return f.isAdmin()};a.isSystemViewInfo=function(){return f.getViewSystemInfo()};a.showAddObjectButton=function(){return!a.showAvailableObjects_flag&&a.set_of_objects_flag};
a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:a.ctrlSettings.dateFormat};$(document).ready(function(){$("#inputSingleDateStart").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});
$("#inputSingleDateEnd").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputStartDate").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,
dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});a.checkEmptyNullValue=function(a){return""===a||null==a?!0:!1};a.checkNumericValue=function(b){return a.checkEmptyNullValue(b)?!0:isNaN(parseFloat(b))||!isFinite(b)?!1:!0};a.checkPositiveNumberValue=
function(b){var c;c=a.checkNumericValue(b);return c?c=0<=parseInt(b,10)?!0:!1:c};a.checkDateIntervalWithRightNull=function(b,c){if(null==b||""==b||!f.checkStrForDate(b))return!1;if(null==c||""==c)return!0;if(!f.checkStrForDate(c))return!1;var d=f.strDateToUTC(b,a.ctrlSettings.dateFormat),d=null!=d?new Date(d):null,e=f.strDateToUTC(c,a.ctrlSettings.dateFormat),e=null!=e?new Date(e):null;return null==d||null==e?!1:e>=d};a.isAdmin=function(){return f.isAdmin()};a.isReadonly=function(){return f.isReadonly()};
a.isROfield=function(){return a.isReadonly()}}]);angular.module("portalNMC").controller("testCtrl",function(a){a.shouldShow=!0;a.options={};a.addWidget=function(b,d){var h;for(h=0;h<d;h+=1)a.options.widgetNumber=h,a.widgets&&a.widgets.length?a.widgets.push({id:a.widgets[a.widgets.length-1].id+1,src:b}):a.widgets=[{id:0,src:"test"}],a.options.widgetCount=a.widgets.length}});angular.module("portalNMC").controller("UserinfoCtrl",function(a,b){});angular.module("portalNMC").controller("widgetContainer",["$scope",function(a){a.isLoading=!0;a.$on("exportPropertiesUpdated",function(b,d){angular.isDefined(d)&&angular.isDefined(d.title)&&(a.title=d.title);angular.isDefined(d)&&angular.isDefined(d.contObjectId)&&angular.isDefined(d.contZpointId)&&angular.isDefined(d.action)&&"openIndicators"===d.action&&angular.isDefined(a.getIndicators)&&a.getIndicators(Number(d.contObjectId),Number(d.contZpointId));angular.isDefined(d)&&angular.isDefined(d.contObjectId)&&
angular.isDefined(d.action)&&"openNotices"===d.action&&angular.isDefined(a.openNotices)&&a.openNotices(Number(d.contObjectId))});a.$on("requestToGetIndicators",function(b,d){angular.isDefined(a.getIndicators)&&a.getIndicators(d.contObjectId,d.contZpointId)});a.$on("widgetLoaded",function(){a.isLoading=!1;a.isError=!1});a.$on("widgetError",function(){a.isLoading=!1;a.isError=!0});a.reload=function(){a.isLoading=!0;a.isError=!1;a.$broadcast("reloadWidget")}}]);
