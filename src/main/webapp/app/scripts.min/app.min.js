var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,d){if(d.get||d.set)throw new TypeError("ES3 does not support getters and setters.");a!=Array.prototype&&a!=Object.prototype&&(a[b]=d.value)};$jscomp.getGlobal=function(a){return"undefined"!=typeof window&&window===a?a:"undefined"!=typeof global&&null!=global?global:a};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(a){return $jscomp.SYMBOL_PREFIX+(a||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var a=$jscomp.global.Symbol.iterator;a||(a=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[a]&&$jscomp.defineProperty(Array.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(a){var b=0;return $jscomp.iteratorPrototype(function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(a){$jscomp.initSymbolIterator();a={next:a};a[$jscomp.global.Symbol.iterator]=function(){return this};return a};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(a,b){$jscomp.initSymbolIterator();a instanceof String&&(a+="");var d=0,g={next:function(){if(d<a.length){var l=d++;return{value:b(l,a[l]),done:!1}}g.next=function(){return{done:!0,value:void 0}};return g.next()}};g[Symbol.iterator]=function(){return g};return g};
$jscomp.polyfill=function(a,b,d,g){if(b){d=$jscomp.global;a=a.split(".");for(g=0;g<a.length-1;g++){var l=a[g];l in d||(d[l]={});d=d[l]}a=a[a.length-1];g=d[a];b=b(g);b!=g&&null!=b&&$jscomp.defineProperty(d,a,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(a){return a})}},"es6-impl","es3");var app=angular.module("portalNMC","ngAnimate ngCookies ngResource ngRoute ngSanitize ngTouch ui.tree daterangepicker angularUtils.directives.dirPagination ngIdle infinite-scroll angularFileUpload leaflet-directive ui.select ui.mask angularWidget chart.js".split(" "));
app.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/objects_edit.html",controller:"ObjectsCtrl",resolve:{permissions:["mainSvc",function(a){return a.getLoadedServicePermission()}]}}).when("/objects/list",{templateUrl:"views/objects_edit.html",controller:"ObjectsCtrl",resolve:{permissions:["mainSvc",function(a){return a.getLoadedServicePermission()}]}}).when("/objects/demo-map",{templateUrl:"views/objects_map.html",controller:"ObjectsMapCtrl",resolve:{permissions:["mainSvc",function(a){return a.getLoadedServicePermission()}]}}).when("/notices/list",
{templateUrl:"views/notice.html",controller:"NoticeCtrl",reloadOnSearch:!1,resolve:{permissions:["mainSvc",function(a){return a.getLoadedServicePermission()}]}}).when("/notices/monitor",{templateUrl:"views/monitor.html",controller:"MonitorCtrl",reloadOnSearch:!1,resolve:{permissions:["mainSvc",function(a){return a.getLoadedServicePermission()}]}}).when("/notices/monitor_map",{templateUrl:"views/monitor_map.html",controller:"MonitorMapCtrl",resolve:{permissions:["mainSvc",function(a){return a.getLoadedServicePermission()}]}}).when("/private",
{templateUrl:"views/private_office.html",controller:"ObjectsCtrl"}).when("/objects_edit",{templateUrl:"views/objects_edit.html",controller:"ObjectsCtrl",resolve:{permissions:["mainSvc",function(a){return a.getLoadedServicePermission()}]}}).when("/private/objects_list",{templateUrl:"views/objects_list.html",controller:"ObjectsCtrl"}).when("/objects123/indicators",{templateUrl:"views/indicators.html",controller:"MainCtrl",resolve:{permissions:["mainSvc",function(a){return a.getLoadedServicePermission()}]}}).when("/private/directories",
{templateUrl:"views/directories.html",controller:"DirectoryCtrl"}).when("/reports",{templateUrl:"views/reports_with_cst.html",controller:"ReportsCtrl"}).when("/reports/commercial_report",{templateUrl:"views/commercial_report.html",controller:"MainCtrl"}).when("/objects/indicators",{templateUrl:"views/indicators.html",controller:"IndicatorsCtrl",reloadOnSearch:!1,resolve:{permissions:["mainSvc",function(a){return a.getLoadedServicePermission()}]}}).when("/objects/indicator-electricity",{templateUrl:"views/indicator-electricity.html",
controller:"ElectricityCtrl",reloadOnSearch:!1,resolve:{permissions:["mainSvc",function(a){return a.getLoadedServicePermission()}]}}).when("/objects/impulse-indicators",{templateUrl:"views/impulse-indicators.html",controller:"ImpulseIndicatorsCtrl",reloadOnSearch:!1,resolve:{permissions:["mainSvc",function(a){return a.getLoadedServicePermission()}]}}).when("/settings/tariffs",{templateUrl:"views/tariffs.html",controller:"TariffsCtrl"}).when("/settings/paramsets",{templateUrl:"views/param_sets.html",
controller:"ParamSetsCtrl"}).when("/settings/delivery",{templateUrl:"views/delivery.html",controller:"DlvrCtrl"}).when("/settings/contacts",{templateUrl:"views/contacts.html",controller:"ContactsCtrl"}).when("/settings/object_groups",{templateUrl:"views/object_groups.html",controller:"ObjectGroupsCtrl"}).when("/settings/users",{templateUrl:"views/settings-users.html",controller:"SettingsUsersCtrl"}).when("/settings/management_services",{templateUrl:"views/management-services.html",controller:"ManagementServicesCtrl"}).when("/settings/notices",
{templateUrl:"views/settings-notices.html",controller:"SettingsNoticesCtrl"}).when("/settings/tenants",{templateUrl:"views/settings-tenants.html",controller:"SettingsTenantsCtrl"}).when("/settings/object_trees",{templateUrl:"views/settings-object-trees.html",controller:"SettingsObjectTreesCtrl"}).when("/settings/program",{templateUrl:"views/settings-program.html",controller:"SettingsProgramCtrl"}).when("/settings/meter-period-setting",{templateUrl:"views/settings-meter-period-setting.html",controller:"SettingsMeterPeriodSettingCtrl"}).when("/settings/object-view",
{templateUrl:"views/settings-object-view.html",controller:"SettingsObjectViewCtrl"}).when("/settings/about-program",{templateUrl:"views/about-program.html",controller:"AboutProgramCtrl",resolve:{allow:["mainSvc","$q","$location",function(a,d,g){d=d.defer();!0===a.getViewSystemInfo()?d.resolve("System info is allow."):(g.path("/"),d.reject("Access denied!"));return d.promise}]}}).when("/management/objects",{templateUrl:"views/management-rma-objects.html",controller:"MngmtObjectsCtrl",resolve:{rsoOrgs:["objectSvc",
function(a){return a.getRsoOrganizations()}],servTypes:["objectSvc",function(a){return a.getServiceTypes()}]}}).when("/management/clients",{templateUrl:"views/management-rma-clients.html",controller:"MngmtClientsCtrl"}).when("/management/datasources",{templateUrl:"views/management-rma-data-sources.html",controller:"MngmtDatasourcesCtrl"}).when("/management/devices",{templateUrl:"views/management-rma-devices.html",controller:"MngmtDevicesCtrl"}).when("/management/users",{templateUrl:"views/management-rma-users.html",
controller:"MngmtUsersCtrl"}).when("/management/price",{templateUrl:"views/management-rma-price.html",controller:"MngmtPriceCtrl"}).when("/management/organizations",{templateUrl:"views/management-rma-organizations.html",controller:"MngmtOrganizationsCtrl"}).when("/management/temp-sch",{templateUrl:"views/management-rma-temp-sch.html",controller:"TempSchCtrl"}).when("/management/modems",{templateUrl:"views/management-rma-modems.html",controller:"MngmtModemsCtrl"}).when("/management/device-models",
{templateUrl:"views/management-rma-device-models.html",controller:"MngmtDeviceModelsCtrl"}).when("/log/session-log",{templateUrl:"views/log-view-resizable-paged.html",controller:"LogViewCtrl"}).when("/log/sms-log",{templateUrl:"views/log-sms.html",controller:"LogSmsCtrl"}).when("/test",{templateUrl:"views/test.html",controller:"testCtrl"}).otherwise({redirectTo:"/"})}]);app.config(["KeepaliveProvider","IdleProvider",function(a,b){}]);app.config(["$logProvider",function(a){a.debugEnabled(!0)}]);
app.config(["uiMask.ConfigProvider",function(a){a.maskDefinitions({a:/[a-z]/,A:/[A-Z]/,"*":/[a-zA-Z0-9]/,9:/\d/,M:/[A-F0-9]/})}]);app.config(["widgetsProvider",function(a){a.setManifestGenerator(function(){return function(a){return{module:a+"Widget",html:"widgets/"+a+"/"+a+".html",files:["widgets/"+a+"/"+a+".js","widgets/"+a+"/"+a+".css"]}}})}]);app.run(["objectSvc","monitorSvc","mainSvc","reportSvc",function(a,b,d,g){d.getUserServicesPermissions();b.getAllMonitorObjects()}]);
app.filter("columnFilter",function(){return function(a,b){b=[b];var d=[];angular.isArray(a)?a.forEach(function(a){var g=!1,k=Object.keys(b),h;for(h=0;h<k.length;h+=1){var p=b[Number(k[h])].toLowerCase();if(angular.isDefined(a[p])&&-1!==a[p].toString().toLowerCase().indexOf(p)){g=!0;break}}g&&d.push(a)}):d=a;return d}});
app.filter("propsFilter",function(){return function(a,b){var d=[];angular.isArray(a)?a.forEach(function(a){var g=!1,k=Object.keys(b),h;for(h=0;h<k.length;h+=1){var p=k[h],m=b[p].toLowerCase();if(-1!==a[p].toString().toLowerCase().indexOf(m)){g=!0;break}}g&&d.push(a)}):d=a;return d}});app.filter("isIntegrators",function(){return function(a,b){var d=[];angular.isArray(a)?a.forEach(function(a){(angular.isUndefined(a.isIntegrator)||null==a.isIntegrator||a.isIntegrator==b)&&d.push(a)}):d=a;return d}});
app.filter("notEmptyCategoriesByContServiceType",["$filter",function(a){return function(b,d){var g=[];angular.isArray(b)?b.forEach(function(b){var k=a("serviceTypesFilter")(b.reportTypes,d);if(0!=k.length){var h=!1;k.some(function(a){if(a.paramsetsCount&&a.paramsetsCount==a.checkedParamsetsCount)return h=!0});1==h&&g.push(b)}}):g=b;return g}}]);
app.filter("notEmptyContServiceTypesByCategory",["$filter",function(a){return function(b,d){var g=[];angular.isArray(b)?b.forEach(function(b){var k=[];angular.isDefined(d)&&(k=a("serviceTypesFilter")(d.reportTypes,b));if(0!==k.length){var h=!1;k.some(function(a){if(a.paramsetsCount&&a.paramsetsCount===a.checkedParamsetsCount)return h=!0});!0===h&&g.push(b)}}):g=b;return g}}]);
app.directive("focusMe",["$timeout","$parse",function(a,b){return{link:function(d,g,l){var k=b(l.focusMe);d.$watch(k,function(b){!0===b&&a(function(){g.focus()},100)});g.bind("blur",function(){console.log("blur");d.$apply(k.assign(d,!1))})}}}]);app.run(["$rootScope","$location","$q","securityCheck",function(a,b,d,g){a.$on("$routeChangeStart",function(a,b,h){a=g.isAuthenficated();d.all([a]).then(function(a){0==a&&window.location.replace("../login")},function(a){console.log(a);window.location.replace("../login")})})}]);angular.module("portalNMC").controller("AboutProgramCtrl",["mainSvc","$scope","$http",function(a,b,d){b.data={};b.data.columns=[{fieldName:"moduleName",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",headerClass:"col-xs-5 col-md-5 bg-info",dataClass:"col-xs-5 col-md-5"},{fieldName:"moduleVersion",header:"\u0412\u0435\u0440\u0441\u0438\u044f",headerClass:"col-xs-2 col-md-2 bg-info",dataClass:"col-xs-2 col-md-2"},{fieldName:"moduleReleaseDate",header:"\u0414\u0430\u0442\u0430 \u0432\u044b\u0445\u043e\u0434\u0430",
headerClass:"col-xs-2 col-md-2 bg-info",dataClass:"col-xs-2 col-md-2"}];b.data.modules=[];b.isTestMode=function(){return a.isTestMode()};(function(){d.get("../api/appStatus/appModulesVersions").then(function(a){b.data.modules=a.data},function(a){console.log(a)})})()}]);angular.module("portalNMC").factory("crudDataFactory",["$resource",function(a){return function(b){return a(b+"/:id",{id:"@id"},{update:{method:"PUT"},query:{method:"GET",isArray:!0},get:{method:"GET"},"delete":{method:"DELETE"}})}}]);app=angular.module("portalNMC");
app.service("indicatorSvc",["mainSvc",function(a){var b=null,d=null,g=null,l=null,k="24h",h="",p="24h",m=null,n=null,e=moment().subtract(6,"days").startOf("day").format("YYYY-MM-DD"),c=moment().endOf("day").format("YYYY-MM-DD"),f=[{header:"\u0413\u041a\u0430\u043b \u043d\u0430 \u0432\u0445\u043e\u0434\u0435","class":"col-xs-1 col-md-1",fieldName:"h_in",imgpath:"",imgclass:"",title:""},{header:"\u0413\u041a\u0430\u043b \u043d\u0430 \u0432\u044b\u0445\u043e\u0434\u0435","class":"col-xs-1 col-md-1",
fieldName:"h_out",imgpath:"",imgclass:"",title:""},{header:"\u041f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435 \u0442\u0435\u043f\u043b\u043e\u0432\u043e\u0439 \u044d\u043d\u0435\u0440\u0433\u0438\u0438, \u0413\u041a\u0430\u043b","class":"col-xs-1 col-md-1 nmc-distinguish",fieldName:"h_delta",imgpath:"",imgclass:"",title:""},{header:"\u041c\u0430\u0441\u0441\u0430 \u043f\u043e\u0434\u0430\u0447\u0438, \u0442","class":"col-xs-1 col-md-1",fieldName:"m_in",imgpath:"",imgclass:"",title:""},
{header:"\u041c\u0430\u0441\u0441\u0430 \u043e\u0431\u0440\u0430\u0442\u043a\u0438, \u0442","class":"col-xs-1 col-md-1",fieldName:"m_out",imgpath:"",imgclass:"",title:""},{header:"\u0420\u0430\u0437\u043d\u0438\u0446\u0430 \u043c\u0430\u0441\u0441 \u0432\u043e\u0434\u044b, \u0442","class":"col-xs-1 col-md-1 nmc-distinguish",fieldName:"m_delta",imgpath:"",imgclass:"",title:""},{header:"\u041e\u0431\u044a\u0435\u043c \u043f\u043e\u0434\u0430\u0447\u0438, \u043c3","class":"col-xs-1 col-md-1",fieldName:"v_in",
imgpath:"",imgclass:"",title:""},{header:"\u041e\u0431\u044a\u0435\u043c \u043e\u0431\u0440\u0430\u0442\u043a\u0438, \u043c3","class":"col-xs-1 col-md-1",fieldName:"v_out",imgpath:"",imgclass:"",title:""},{header:"\u0420\u0430\u0437\u043d\u0438\u0446\u0430 \u043e\u0431\u044a\u0435\u043c\u043e\u0432, \u043c3","class":"col-xs-1 col-md-1 nmc-distinguish",fieldName:"v_delta",imgpath:"",imgclass:"",title:""},{header:"\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0430 \u043f\u043e\u0434\u0430\u0447\u0435, \u041c\u043f\u0430",
"class":"col-xs-1 col-md-1",fieldName:"p_in",imgpath:"",imgclass:"",title:""},{header:"\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0430 \u043e\u0431\u0440\u0430\u0442\u043a\u0435, \u041c\u043f\u0430","class":"col-xs-1 col-md-1",fieldName:"p_out",imgpath:"",imgclass:"",title:""},{header:"\u0420\u0430\u0437\u043d\u043e\u0441\u0442\u044c \u0434\u0430\u0432\u043b\u0435\u043d\u0438\u0439, \u041c\u043f\u0430","class":"col-xs-1 col-md-1",fieldName:"p_delta",imgpath:"",imgclass:"",title:""},
{header:"\u0422\u0435\u043c\u043f. \u043f\u043e\u0434\u0430\u0447\u0438","class":"col-xs-1 col-md-1",fieldName:"t_in",imgpath:"",imgclass:"",title:"",dataType:"temperature"},{header:"\u0422\u0435\u043c\u043f. \u043e\u0431\u0440\u0430\u0442\u043a\u0438","class":"col-xs-1 col-md-1",fieldName:"t_out",imgpath:"",imgclass:"",title:"",dataType:"temperature"},{header:"\u0422\u0435\u043c\u043f. \u0425\u0412\u0421","class":"col-xs-1 col-md-1",fieldName:"t_cold",imgpath:"",imgclass:"",title:"",dataType:"temperature"},
{header:"\u0422\u0435\u043c\u043f. \u043e\u043a\u0440. \u0441\u0440\u0435\u0434\u044b","class":"col-xs-1 col-md-1",fieldName:"t_outdoor",imgpath:"",imgclass:"",title:"",dataType:"temperature"}],r=[{header:"\u0414\u0430\u0442\u0430",headerClass:"col-xs-2 col-md-2",dataClass:"col-xs-2 col-md-2",fieldName:"dataDate","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:!1,isvisible:"isvisible"},{header:"\u0412\u0440\u0435\u043c\u044f \u043d\u0430\u0440\u0430\u0431\u043e\u0442\u043a\u0438, \u0447\u0430\u0441",
headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"workTime","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:!1,isvisible:"isvisible"},{header:"\u0413\u041a\u0430\u043b \u043d\u0430 \u0432\u0445\u043e\u0434\u0435",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"h_in","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0413\u041a\u0430\u043b \u043d\u0430 \u0432\u044b\u0445\u043e\u0434\u0435",
headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"h_out","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u041f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435 \u0442\u0435\u043f\u043b\u043e\u0432\u043e\u0439 \u044d\u043d\u0435\u0440\u0433\u0438\u0438, \u0413\u041a\u0430\u043b",headerClass:"col-xs-1 col-md-1 nmc-distinguish",dataClass:"col-xs-1 col-md-1 nmc-distinguish",fieldName:"h_delta","1h":"1h","24h":"24h","1h_abs":"1h_abs",
"24h_abs":"24h_abs",istunable:"istunable"},{header:"\u041c\u0430\u0441\u0441\u0430 \u043f\u043e\u0434\u0430\u0447\u0438, \u0442",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"m_in","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u041c\u0430\u0441\u0441\u0430 \u043e\u0431\u0440\u0430\u0442\u043a\u0438, \u0442",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"m_out","1h":"1h","24h":"24h","1h_abs":"1h_abs",
"24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0420\u0430\u0437\u043d\u043e\u0441\u0442\u044c \u043c\u0430\u0441\u0441, \u0442",headerClass:"col-xs-1 col-md-1 nmc-distinguish",dataClass:"col-xs-1 col-md-1 nmc-distinguish",fieldName:"m_delta","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u041e\u0431\u044a\u0435\u043c \u043f\u043e\u0434\u0430\u0447\u0438, \u043c3",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"v_in","1h":"1h",
"24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u041e\u0431\u044a\u0435\u043c \u043e\u0431\u0440\u0430\u0442\u043a\u0438, \u043c3",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"v_out","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0420\u0430\u0437\u043d\u043e\u0441\u0442\u044c \u043e\u0431\u044a\u0435\u043c\u043e\u0432, \u043c3",headerClass:"col-xs-1 col-md-1 nmc-distinguish",dataClass:"col-xs-1 col-md-1 nmc-distinguish",
fieldName:"v_delta","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0430 \u043f\u043e\u0434\u0430\u0447\u0435, \u041c\u043f\u0430",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"p_in","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0414\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u043d\u0430 \u043e\u0431\u0440\u0430\u0442\u043a\u0435, \u041c\u043f\u0430",
headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"p_out","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0420\u0430\u0437\u043d\u043e\u0441\u0442\u044c \u0434\u0430\u0432\u043b\u0435\u043d\u0438\u0439, \u041c\u043f\u0430",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"p_delta","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0422\u0435\u043c\u043f. \u043f\u043e\u0434\u0430\u0447\u0438",
headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"t_in",dataType:"temperature","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0422\u0435\u043c\u043f. \u043e\u0431\u0440\u0430\u0442\u043a\u0438",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"t_out",dataType:"temperature","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0422\u0435\u043c\u043f. \u0425\u0412\u0421",
headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"t_cold",dataType:"temperature","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"},{header:"\u0422\u0435\u043c\u043f. \u043e\u043a\u0440. \u0441\u0440\u0435\u0434\u044b",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1",fieldName:"t_outdoor",dataType:"temperature","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable"}],q=[],v=[{header:"\u0414\u0430\u0442\u0430",
headerClass:"col-xs-2 nmc-text-align-center",dataClass:"col-xs-2",fieldName:"dataDate","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:!1,isvisible:"isvisible"},{header:"\u041f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f",headerClass:"col-xs-1 nmc-text-align-center",dataClass:"col-xs-1",fieldName:"dataValue","1h":"1h","24h":"24h","1h_abs":"1h_abs","24h_abs":"24h_abs",istunable:"istunable",isvisible:"isvisible"}];(function(){var a=[{name:"p_A",caption:"A"},{name:"q_R",caption:"R"}],
b=[{name:"p",caption:"+"},{name:"n",caption:"-"}],c=[1,2,3,4,5],e=[{header:"\u0414\u0430\u0442\u0430",headerClass:"col-xs-2 col-md-2 nmc-text-align-center",dataClass:"col-xs-2 col-md-2",fieldName:"dataDateString",type:"string",date:!0,istunable:!1,isvisible:"isvisible"}],d,r,f,A;for(d=0;d<a.length;d+=1){for(r=0;r<c.length;r+=1)for(f=0;f<b.length;f+=1)A={},A.header=a[d].caption+b[f].caption+" (T"+c[r]+")",A.headerClass="nmc-view-digital-data nmc-text-align-center",A.dataClass="nmc-view-digital-data",
A.fieldName=a[d].name+b[f].name+c[r],A.elKind=b[f].name,A.elType=a[d].name,A.istunable="istunable",e.push(A);for(f=0;f<b.length;f+=1)A={},A.header="\u03a3"+a[d].caption+b[f].caption,A.headerClass="nmc-view-digital-data nmc-text-align-center",A.dataClass="nmc-el-totals-indicator-highlight nmc-view-digital-data",A.fieldName=a[d].name+b[f].name,A.isSummary=!0,A.elKind=b[f].name,A.elType=a[d].name,A.istunable="istunable",e.push(A)}return q=e})();return{getContObjectId:function(){return b},getContObjectName:function(){return g},
getDetailType:function(){return h},getDeviceModel:function(){return m},getDeviceSN:function(){return n},getElectricityColumns:function(){return q},getFromDate:function(){return e},getIntotalColumns:function(){return f},getImpulseColumns:function(){return v},getWaterColumns:function(){return r},getTimeDetailType:function(){return k},getTimeType:function(){return p},getToDate:function(){return c},getZpointId:function(){return d},getZpointName:function(){return l},setColorHighlightsForManualAndCrc:function(b){if(a.checkUndefinedNull(b)||
!angular.isArray(b))return console.log("Can't set color highlights"),!1;b.forEach(function(a){switch(a.dataMstatus){case 3:a.dataClass="nmc-tr-indicator-manual"}!1===a.crc32Valid&&(a.dataClass="nmc-tr-indicator-crc-error")})},setContObjectId:function(a){b=a},setContObjectName:function(a){g=a},setDetailType:function(a){h=a},setDeviceModel:function(a){m=a},setDeviceSN:function(a){n=a},setFromDate:function(a){e=a},setTimeDetailType:function(a){k=a},setTimeType:function(a){p=a},setToDate:function(a){c=
a},setZpointId:function(a){d=a},setZpointName:function(a){l=a}}}]);angular.module("portalNMC").controller("LineCtrl",function(a){a.labels="\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c".split(" ");a.series=["\u0421\u0435\u0440\u0438\u044f A","\u0421\u0435\u0440\u0438\u044f B"];a.data=[[65,59,80,81,56,55,40],[28,48,40,19,86,27,90]];a.onClick=function(a,d){console.log(a,d)};a.datasetOverride=[{yAxisID:"y-axis-1"},
{yAxisID:"y-axis-2"}];a.options={scales:{yAxes:[{id:"y-axis-1",type:"linear",display:!0,position:"left"},{id:"y-axis-2",type:"linear",display:!0,position:"right"}]}}}).controller("googleChartCtrl",function(a){var b={type:"PieChart",data:[["Component","cost"],["Software",5E4],["Hardware",8E4]]};b.data.push(["Services",2E4]);b.options={displayExactValues:!0,width:360,height:200,is3D:!0,chartArea:{left:10,top:10,bottom:0,height:"100%"}};b.formatters={number:[{columnNum:1,pattern:"$ #,##0.00"}]};a.chart=
b});app=angular.module("portalNMC");
app.controller("ContactsCtrl",["$rootScope","$scope","$http","mainSvc","notificationFactory",function(a,b,d,g,l){a.ctxId="contacts_page";b.contacts=[];b.lists=[];b.currentItem={};b.cnt_lst=[];b.small_lists=[];b.small_contacts=[];b.url_users="../api/subscr/subscrAction/users";b.url_groups="../api/subscr/subscrAction/groups";var k=function(a){a=g.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)};b.getContacts=function(){$.ajax({type:"GET",url:b.url_users,dataType:"json",async:!1,success:function(a){b.contacts=
a}})};b.getLists=function(){$.ajax({type:"GET",url:b.url_groups,dataType:"json",async:!1,success:function(a){b.lists=a}})};b.addContact=function(){if(!b.currentItem.userName||""==b.currentItem.userName)return l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0438\u043c\u044f \u043a\u043e\u043d\u0442\u0430\u043a\u0442\u0430. \u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u043f\u043e\u043b\u0435 '\u0418\u043c\u044f'."),"Add / edit contact: no name";
var a,g=document.getElementById("table_lists_in_window");b.cnt_lst=[];for(a=0;a<g.rows.length;a+=1)g.rows[a].cells[0].childNodes[1].checked&&b.cnt_lst.push(g.rows[a].cells[0].childNodes[1].id);"undefined"!==typeof b.currentItem.id?(a=b.url_users+"/"+b.currentItem.id+"?subscrGroupIds="+b.cnt_lst,d.put(a,b.currentItem).success(function(){b.getContacts();$("#edit_contact").modal("hide")}).error(k)):(a=b.url_users+"?subscrGroupIds="+b.cnt_lst,d.post(a,b.currentItem).success(function(){b.getContacts();
$("#edit_contact").modal("hide")}).error(k))};b.addList=function(){var a,g=document.getElementById("table_contacts_in_window");b.cnt_lst=[];for(a=0;a<g.rows.length;a+=1)g.rows[a].cells[0].childNodes[1].checked&&b.cnt_lst.push(g.rows[a].cells[0].childNodes[1].id);"undefined"!==typeof b.currentItem.id?(a=b.url_groups+"/"+b.currentItem.id+"?subscrUserIds="+b.cnt_lst,d.put(a,b.currentItem).success(function(){b.getLists();$("#edit_list").modal("hide")}).error(k)):(a=b.url_groups+"?subscrUserIds="+b.cnt_lst,
d.post(a,b.currentItem).success(function(){b.getLists();$("#edit_list").modal("hide")}).error(k))};b.delContact=function(a){d["delete"](b.url_users+"/"+a.id).success(function(){$("#div_delete_contact").modal("hide");b.getContacts()}).error(k)};b.delList=function(a){d["delete"](b.url_groups+"/"+a.id).success(function(){$("#div_delete_contact_list").modal("hide");b.getLists()}).error(k)};b.getCntLst=function(a,g){var h,n,e;b.cnt_lst=[];if("new"!=g)e="contact"==a?b.url_users+"/"+g.id+"/groups":b.url_groups+
"/"+g.id+"/users",d.get(e).success(function(c){for(h=0;h<c.length;h+=1)b.cnt_lst.push(c[h].id);if("list"==a)for(b.small_contacts=b.contacts,h=0;h<b.contacts.length;h+=1)for(n=0;n<b.cnt_lst.length;n+=1)b.small_contacts[h].id==b.cnt_lst[n]&&(b.small_contacts[h].checked=!0);else for(b.small_lists=b.lists,h=0;h<b.lists.length;h+=1)for(b.small_lists[h].checked=!1,n=0;n<b.cnt_lst.length;n+=1)b.small_lists[h].id==b.cnt_lst[n]&&(b.small_lists[h].checked=!0)}).error(k);else if("contact"==a)for(b.small_lists=
b.lists,e=0;e<b.small_lists.length;e+=1)b.small_lists[e].checked=!1;else for(b.small_contacts=b.contacts,e=0;e<b.small_contacts.length;e+=1)b.small_contacts[e].checked=!1};b.addItem=function(a,d){b.editItem(a,d);"contact"==d?$("#edit_contact").modal():"list"==d&&$("#edit_list").modal()};b.editItem=function(a,d){b.currentItem="new"==a?{}:a;b.getCntLst(d,a)};b.getContacts();b.getLists();b.isAdmin=function(){return g.isAdmin()};b.isReadonly=function(){return g.isReadonly()};b.isROfield=function(){return b.isReadonly()};
b.isSystemViewInfo=function(){return g.getViewSystemInfo()}}]);app=angular.module("portalNMC");
app.controller("DataRangeSettings",["$scope","$interval","$rootScope","$location","$cookies",function(a,b,d,g,l){b=g.search();angular.isDefined(b.fromDate)&&"/notices/list"===g.path()?a.navPlayerDates={startDate:b.fromDate,endDate:b.toDate}:a.navPlayerDates={startDate:d.reportStart||moment().subtract(6,"days").startOf("day"),endDate:d.reportEnd||moment().endOf("day")};a.queryDateOptsRu={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",fromLabel:"\u0441",
toLabel:"\u043f\u043e",cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
ranges:{"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0434\u0435\u043d\u044c":[moment().startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 7 \u0434\u043d\u0435\u0439":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 30 \u0434\u043d\u0435\u0439":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},startDate:moment(a.navPlayerDates.startDate).startOf("day"),endDate:moment(a.navPlayerDates.endDate).endOf("day"),format:"DD.MM.YYYY",
separator:" \u043f\u043e "};a.queryDateOptsRuNoRanges={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",fromLabel:"\u0441",toLabel:"\u043f\u043e",cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
startDate:moment().startOf("day"),endDate:moment().endOf("day"),format:"DD.MM.YYYY",separator:" \u043f\u043e "};a.queryDateOptsEn={locale:{applyClass:"btn-green"},ranges:{Today:[moment().startOf("day"),moment().endOf("day")],"Last 7 days":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"Last 30 days":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},startDate:moment().startOf("day"),endDate:moment().endOf("day"),format:"DD.MM.YYYY"};a.$watch("navPlayerDates",
function(a,b){a!==b&&"/objects/indicators"!==g.path()&&(d.reportStart=moment(a.startDate).format("YYYY-MM-DD"),d.reportEnd=moment(a.endDate).format("YYYY-MM-DD"),"/notices/monitor"!=g.path()&&"/objects/indicators"!=g.path()&&(g.search("fromDate",d.reportStart),g.search("toDate",d.reportEnd)),d.$broadcast("navPlayerDatesChanged"))},!1);a.queryDateOptsIndicatorRu={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",fromLabel:"\u0441",toLabel:"\u043f\u043e",
cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
ranges:{"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0434\u0435\u043d\u044c":[moment().startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 7 \u0434\u043d\u0435\u0439":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 30 \u0434\u043d\u0435\u0439":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},format:"DD.MM.YYYY",separator:" \u043f\u043e "};a.$watch("indicatorDates",function(a){g.path()},!1);a.deleteIndicatorDates={startDate:moment().subtract(6,
"days").startOf("day"),endDate:moment().endOf("day")};a.$watch("deleteIndicatorDates",function(a){"/objects/indicators"===g.path()&&(d.startDateToDel=moment(a.startDate).format("YYYY-MM-DD"),d.endDateToDel=moment(a.endDate).format("YYYY-MM-DD"))},!1);angular.isDefined(l.fromDate)?a.monitorDates={startDate:l.fromDate,endDate:l.toDate}:a.monitorDates={startDate:moment().subtract(6,"days").startOf("day"),endDate:moment().endOf("day")};a.queryDateOptsMonitorRu={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",
fromLabel:"\u0441",toLabel:"\u043f\u043e",cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
ranges:{"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0434\u0435\u043d\u044c":[moment().startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 7 \u0434\u043d\u0435\u0439":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 30 \u0434\u043d\u0435\u0439":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},startDate:moment(l.fromDate)||moment().subtract(6,"days").startOf("day"),endDate:moment(l.toDate)||moment().endOf("day"),maxDate:moment().endOf("day"),
format:"DD.MM.YYYY",separator:" \u043f\u043e "};a.$watch("monitor123Dates",function(a){"/notices/monitor"===g.path()&&(d.monitorStart=moment(a.startDate).format("YYYY-MM-DD"),d.monitorEnd=moment(a.endDate).format("YYYY-MM-DD"))},!1)}]);app=angular.module("portalNMC");
app.controller("DlvrCtrl",["$rootScope","$scope","$http","notificationFactory","mainSvc",function(a,b,d,g,l){a.ctxId="delivery_page";b.rep_shdls=[];b.cur_rep_shdl={};b.rep_types=[];b.rep_act_types=[];b.rep_shdl_types=[];b.paramsets=[];b.dlvr_lists=[];b.url_rep_shdls="../api/reportShedule";b.url_rep_types="../api/reportSettings/reportType";b.url_rep_act_types="../api/reportSettings/reportActionType";b.url_rep_shdl_types="../api/reportSettings/reportSheduleType";b.url_paramsets="../api/reportParamset";
b.url_dlvr_lists="../api/subscr/subscrAction/groups";var k=function(a){a=l.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};b.getReportShedules=function(){d.get(b.url_rep_shdls).success(function(a){b.rep_shdls=a}).error(k)};b.addReportShedule=function(){var a,l;for(a=0;a<b.paramsets.length;a+=1)b.paramsets[a].id==b.cur_rep_shdl.reportParamset.id&&(l=b.paramsets[a].reportTemplate.id);"new"==b.cur_rep_shdl.id?(a=b.url_rep_shdls+"?reportTemplateId="+l+"&reportParamsetId="+b.cur_rep_shdl.reportParamset.id,
b.cur_rep_shdl.id=null,d.post(a,b.cur_rep_shdl).success(function(){g.success();b.getReportShedules()}).error(k)):(a=b.url_rep_shdls+"/"+b.cur_rep_shdl.id+"?reportTemplateId="+l+"&reportParamsetId="+b.cur_rep_shdl.reportParamset.id,d.put(a,b.cur_rep_shdl).success(function(){g.success();b.getReportShedules()}).error(k))};b.delReportShedule=function(a){d["delete"](b.url_rep_shdls+"/"+a.id).success(function(){$("#div_delete_delivery").modal("hide");g.success();b.getReportShedules()}).error(k)};b.getReportParameters=
function(){d.get(b.url_rep_types).success(function(a){b.rep_types=a}).error(k);d.get(b.url_rep_act_types).success(function(a){b.rep_act_types=a}).error(k);d.get(b.url_rep_shdl_types).success(function(a){b.rep_shdl_types=a}).error(k)};b.getParamsets=function(a){var g="",h;for(h=0;h<b.rep_types.length;h+=1)b.rep_types[h].keyname==b.cur_rep_shdl.reportTemplate.reportTypeKeyname&&(g=b.url_paramsets+b.rep_types[h].suffix);d.get(g).success(function(d){b.paramsets=d;a||(angular.isArray(b.paramsets)&&0<b.paramsets.length?
b.cur_rep_shdl.reportParamset=b.paramsets[0]:b.cur_rep_shdl.reportParamset=null)}).error(k)};b.getDeliveryLists=function(){d.get(b.url_dlvr_lists).success(function(a){b.dlvr_lists=a;for(a=0;a<b.dlvr_lists.length;a+=1)b.dlvr_lists[a].id=b.dlvr_lists[a].id.toString()}).error(k)};b.addNewReportShedule=function(a){b.editReportShedule(a);$("#div_edit_delivery").modal()};b.editReportShedule=function(a){"new"==a?(b.cur_rep_shdl={},b.cur_rep_shdl.id="new",b.time=[],b.start_date=new Date,b.end_date=null,document.getElementById("div_rcpt_slct").style.display=
"none",document.getElementById("div_rcpt_email").style.display="block",document.getElementById("div_day_of_month").style.display="block",document.getElementById("div_day_of_week").style.display="none",document.getElementById("div_day_date").style.display="none",document.getElementById("div_daily").style.display="none",document.getElementById("inp_day").disabled=!0,document.getElementById("inp_hour").disabled=!0,document.getElementById("inp_minute").disabled=!0,document.getElementById("inp_rcpt_email").disabled=
!0,document.getElementById("slct_rep_tmpl_var").disabled=!0,b.cur_rep_shdl.sheduleTimeTemplate="15 0 1 * 1"):(b.cur_rep_shdl=angular.copy(a),b.changeReportType(!0),b.changeSheduleAction(),b.activateStartEndDates(),b.activatePeriod())};b.changeReportType=function(a){document.getElementById("slct_rep_tmpl_var").disabled=!1;b.getParamsets(a)};b.changeSheduleAction=function(){switch(b.cur_rep_shdl.sheduleAction1Key){case "EMAIL_LIST_DELIVERY":b.getDeliveryLists();document.getElementById("div_rcpt_slct").style.display=
"block";document.getElementById("div_rcpt_email").style.display="none";document.getElementById("slct_rcpt").disabled=!1;break;case "EMAIL_RAW_DELIVERY":document.getElementById("div_rcpt_slct").style.display="none";document.getElementById("div_rcpt_email").style.display="block";document.getElementById("inp_rcpt_email").disabled=!1;break;default:g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u044b\u0431\u043e\u0440\u0430 \u0441\u043f\u043e\u0441\u043e\u0431\u0430 \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438",
"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u043f\u043e\u0441\u043e\u0431 \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438")}};b.activateStartEndDates=function(){null!=b.cur_rep_shdl.sheduleStartDate&&(b.start_date=new Date(b.cur_rep_shdl.sheduleStartDate));null!=b.cur_rep_shdl.sheduleEndDate&&(b.end_date=new Date(b.cur_rep_shdl.sheduleEndDate))};b.activatePeriod=function(){document.getElementById("inp_hour").disabled=!1;document.getElementById("inp_minute").disabled=
!1;b.time=b.cur_rep_shdl.sheduleTimeTemplate.split(" ");if("*"==b.time[3])b.time[3]=new Date;else{var a=new Date;--b.time[3];b.time[3]=new Date(a.getFullYear(),b.time[3],b.time[2])}switch(b.cur_rep_shdl.reportSheduleTypeKey){case "SINGLE":document.getElementById("div_day_of_month").style.display="none";document.getElementById("div_day_of_week").style.display="none";document.getElementById("div_day_date").style.display="block";document.getElementById("div_daily").style.display="none";document.getElementById("inp_day_date").disabled=
!1;break;case "DAILY":document.getElementById("div_day_of_month").style.display="none";document.getElementById("div_day_of_week").style.display="none";document.getElementById("div_day_date").style.display="none";document.getElementById("div_daily").style.display="block";break;case "WEEKLY":document.getElementById("div_day_of_month").style.display="none";document.getElementById("div_day_of_week").style.display="block";document.getElementById("div_day_date").style.display="none";document.getElementById("div_daily").style.display=
"none";document.getElementById("slct_day_of_week").disabled=!1;break;case "MONTHLY":document.getElementById("div_day_of_month").style.display="block";document.getElementById("div_day_of_week").style.display="none";document.getElementById("div_day_date").style.display="none";document.getElementById("div_daily").style.display="none";document.getElementById("inp_day").disabled=!1;break;default:g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u044b\u0431\u043e\u0440\u0430 \u043f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u043d\u043e\u0441\u0442\u0438 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438",
"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u043f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u043d\u043e\u0441\u0442\u044c \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438")}};b.dlvrSave=function(){var a=!1;b.cur_rep_shdl.sheduleStartDate=b.start_date.getTime();if(null!=b.end_date){var d=b.end_date.getTime();d<b.cur_rep_shdl.sheduleStartDate?(g.errorInfo("\u0412\u0432\u0435\u0434\u0435\u043d\u043e \u043d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f",
"\u0423\u043a\u0430\u0437\u0430\u043d\u043d\u043e\u0435 \u0432\u0440\u0435\u043c\u044f \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438 \u043c\u0435\u043d\u044c\u0448\u0435, \u0447\u0435\u043c \u0432\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u0430"),a=!0):b.cur_rep_shdl.sheduleEndDate=d}else b.cur_rep_shdl.sheduleEndDate=null;null==b.cur_rep_shdl.name&&(g.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438",
"\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438"),a=!0);if("undefined"==typeof b.cur_rep_shdl.reportTemplate)g.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0442\u0438\u043f \u043e\u0442\u0447\u0451\u0442\u0430","\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0442\u0438\u043f \u043e\u0442\u0447\u0451\u0442\u0430"),
a=!0;else if("undefined"==typeof b.cur_rep_shdl.reportParamset||null==b.cur_rep_shdl.reportParamset)g.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u0448\u0430\u0431\u043b\u043e\u043d\u0430","\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u0448\u0430\u0431\u043b\u043e\u043d\u0430"),a=!0;null==b.cur_rep_shdl.sheduleAction1Key?(g.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0441\u043f\u043e\u0441\u043e\u0431 \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438",
"\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0441\u043f\u043e\u0441\u043e\u0431 \u0434\u043e\u0441\u0442\u0430\u0432\u043a\u0438"),a=!0):null==b.cur_rep_shdl.sheduleAction1Param&&(g.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u044b \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u0438","\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u043b\u0443\u0447\u0430\u0442\u0435\u043b\u0435\u0439"),
a=!0);0<=b.time[0]&&60>b.time[0]?b.cur_rep_shdl.sheduleTimeTemplate=b.time[0]+" ":(g.errorInfo("\u0412\u0440\u0435\u043c\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u043d\u0435\u0432\u0435\u0440\u043d\u043e","\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043c\u0438\u043d\u0443\u0442\u044b \u043e\u0442 0 \u0434\u043e 60"),a=!0);0<=b.time[1]&&24>b.time[1]?b.cur_rep_shdl.sheduleTimeTemplate=b.cur_rep_shdl.sheduleTimeTemplate+b.time[1]+
" ":(g.errorInfo("\u0412\u0440\u0435\u043c\u044f \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u043d\u0435\u0432\u0435\u0440\u043d\u043e","\u0423\u043a\u0430\u0436\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0447\u0430\u0441\u044b \u043e\u0442 0 \u0434\u043e 24"),a=!0);switch(b.cur_rep_shdl.reportSheduleTypeKey){case "SINGLE":b.cur_rep_shdl.sheduleTimeTemplate=b.cur_rep_shdl.sheduleTimeTemplate+b.time[3].getDate()+" "+(b.time[3].getMonth()+1)+" *";break;case "DAILY":b.cur_rep_shdl.sheduleTimeTemplate+=
"* * *";break;case "WEEKLY":1>b.time[4]||7<b.time[4]?(g.errorInfo("\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d \u0434\u0435\u043d\u044c \u043d\u0435\u0434\u0435\u043b\u0438","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u0434\u0435\u043d\u044c \u043d\u0435\u0434\u0435\u043b\u0438"),a=!0):b.cur_rep_shdl.sheduleTimeTemplate=b.cur_rep_shdl.sheduleTimeTemplate+"* * "+b.time[4];break;case "MONTHLY":0<b.time[2]&&31>=b.time[2]&&(b.cur_rep_shdl.sheduleTimeTemplate=
b.cur_rep_shdl.sheduleTimeTemplate+b.time[2]+" * *");break;default:g.errorInfo("\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0430 \u043f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u043d\u043e\u0441\u0442\u044c \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438","\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435, \u043f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u0435\u0440\u0438\u043e\u0434\u0438\u0447\u043d\u043e\u0441\u0442\u044c \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0438"),
a=!0}a||(b.addReportShedule(),$("#div_edit_delivery").modal("hide"))};b.getReportShedules();b.getReportParameters();b.isAdmin=function(){return l.isAdmin()};b.isReadonly=function(){return l.isReadonly()};b.isROfield=function(){return b.isReadonly()};b.isTestMode=function(){return l.isTestMode()};b.isSystemViewInfo=function(){return l.getViewSystemInfo()}}]);app=angular.module("portalNMC");app.controller("DirectoryCtrl",["$scope","$resource",function(a,b){a.clk=function(){alert("Hi")}}]);app=angular.module("portalNMC");app.controller("IdleCtrl",["$scope",function(a){a.$on("IdleEnd",function(){$("#warnDialogModal").modal("hide")});a.$on("IdleStart",function(){$("#warnDialogModal").modal()});a.$on("IdleTimeout",function(){window.location.assign("../logout")});a.progressbar=function(a){return Math.round(a)}}]);angular.module("portalNMC").controller("ImpulseIndicatorsCtrl",["$scope","$rootScope","$cookies","$window","$http","$location","crudGridDataFactory","FileUploader","notificationFactory","indicatorSvc","mainSvc","$timeout",function(a,b,d,g,l,k,h,p,m,n,e,c){b.ctxId="indicators_page";a.date={};angular.isDefined(k.search().fromDate)&&null!=k.search().fromDate?a.impulseIndicatorDates={startDate:k.search().fromDate,endDate:k.search().toDate}:angular.isDefined(d.fromDate)&&null!=d.toDate?a.impulseIndicatorDates=
{startDate:d.fromDate,endDate:d.toDate}:a.impulseIndicatorDates={startDate:n.getFromDate(),endDate:n.getToDate()};a.date.deleteIndicatorDates={startDate:angular.copy(a.impulseIndicatorDates.startDate),endDate:angular.copy(a.impulseIndicatorDates.endDate)};a.$watch("date.deleteIndicatorDates",function(a,c,e){"/objects/impulse-indicators"===k.path()&&a!==c&&(b.startDateToDel=moment(a.startDate).format("YYYY-MM-DD"),b.endDateToDel=moment(a.endDate).format("YYYY-MM-DD"))},!1);a.ctrlSettings={};a.ctrlSettings.ctxId=
"zpoint_indicator_page";a.ctrlSettings.loadedWaterColumnsPref=[];a.ctrlSettings.orderBy={};if(angular.isDefined(d.indicatorsortorder)&&null!=d.indicatorsortorder)switch(d.indicatorsortorder){case "asc":a.ctrlSettings.orderBy={field:"dataDate",asc:!0,desc:!1,order:"asc"};break;case "desc":a.ctrlSettings.orderBy={field:"dataDate",asc:!1,desc:!0,order:"desc"}}else a.ctrlSettings.orderBy={field:"dataDate",asc:!1,desc:!0,order:"desc"};a.intotalColumns=n.getIntotalColumns();a.indicatorColumns=n.getImpulseColumns();
a.tableDef={tableClass:"crud-grid table table-lighter table-bordered table-condensed table-hover",hideHeader:!1,headerClassTR:"nmc-main-table-header",columns:a.indicatorColumns};a.summary={};a.totalIndicators=0;a.indicatorsPerPage=100;a.timeDetailType="24h";a.data=[];a.pagination={current:1};a.indicatorModes=[];a.showLinkToFileFlag=!1;a.isManualLoading="true"===d.isManualLoading?!0:!1;var f=function(b){a.ctrlSettings.loading=!1;console.log(b);var c="-1";if(e.checkUndefinedNull(b)||e.checkUndefinedNull(b.data))c=
"ERR_CONNECTION";e.checkUndefinedNull(b)||e.checkUndefinedNull(b.resultCode)&&(e.checkUndefinedNull(b.data)||e.checkUndefinedNull(b.data.resultCode))||(c=b.resultCode||b.data.resultCode);b=e.getServerErrorByResultCode(c);m.errorInfo(b.caption,b.description)};(function(){a.uploader=new p({url:"../api/subscr/contObjects/"+d.contObject+"/contZPoints/"+d.contZPoint+"/service/24h/csv"});a.uploader.onErrorItem=function(a,b,c,e){console.info("onErrorItem",c,b);f(b)};a.uploader.onSuccessItem=function(a,b,
c,e){}})();a.isSystemuser=function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};a.columns=[];a.getData=function(r){a.ctrlSettings.loading=!0;a.pagination.current=r;a.zpointTable="../api/subscr/"+a.contObject+"/serviceImpulse/"+(a.timeDetailType||d.timeDetailType)+"/"+a.contZPoint+"/paged?beginDate="+b.reportStart+"&endDate="+b.reportEnd+"&page="+(r-1)+"&size="+a.indicatorsPerPage+"&dataDateSort="+a.ctrlSettings.orderBy.order;l.get(a.zpointTable).success(function(b){a.totalIndicators=
b.totalElements;a.columns=a.tableDef.columns;!0===e.getUseColorHighlightIndicatorData()&&n.setColorHighlightsForManualAndCrc(b.objects);b.objects.map(function(b,c){for(var e in a.columns)"dataDate"===a.columns[e].fieldName?b.dataDate=b.dataDateString:null!=b[a.columns[e].fieldName]&&"dataDateString"!==a.columns[e].fieldName&&(b[a.columns[e].fieldName]=b[a.columns[e].fieldName].toFixed(3))});a.data=b.objects;a.ctrlSettings.loading=!1;c(function(){a.setScoreStyles()},100)}).error(f)};a.setScoreStyles=
function(){var b=document.getElementById("indicatorTableHeader"),c=document.getElementById("divCFIndicatorTable");if(!e.checkUndefinedNull(c)&&!e.checkUndefinedNull(b)){if(0==b.offsetWidth)return"Indicators. tableHeader.offsetWidth == 0";c.style.width=c.offsetWidth>c.clientWidth?b.offsetWidth+17+"px":b.offsetWidth+"px"}a.tableDef.columns.some(function(b){var c=document.getElementById("indicators_th_"+b.fieldName),d=document.getElementById("indicators_head_"+b.fieldName),w=null;e.checkUndefinedNull(a.deviceMu)||
(w=document.getElementById("indicators_head1_"+b.fieldName));angular.isDefined(c)&&null!=c&&angular.isDefined(d)&&null!=d&&(b=Math.max(c.offsetWidth,c.clientWidth),d.style.width=b+"px",e.checkUndefinedNull(a.deviceMu)||(w.style.width=b+"px"))})};a.onTableLoad=function(){a.setScoreStyles()};(function(){var c=k.search();angular.isUndefined(null);angular.isDefined(c.zpointId)&&"null"!==c.zpointId&&n.setZpointId(c.zpointId);angular.isUndefined(null);angular.isDefined(c.objectId)&&"null"!==c.objectId&&
n.setContObjectId(c.objectId);angular.isUndefined(null);angular.isDefined(c.zpointName)&&"null"!==c.zpointName&&n.setZpointName(c.zpointName);angular.isUndefined(null);angular.isDefined(c.objectName)&&"null"!==c.objectName&&n.setContObjectName(c.objectName);angular.isUndefined(null);angular.isDefined(c.deviceModel)&&"null"!==c.deviceModel&&n.setDeviceModel(c.deviceModel);angular.isUndefined(null);angular.isDefined(c.deviceSN)&&"null"!==c.deviceSN&&n.setDeviceSN(c.deviceSN);angular.isDefined(c.mu)&&
(a.deviceMu=c.mu);angular.isUndefined(null);angular.isDefined(c.timeDetailType)&&"null"!==c.timeDetailType?a.timeDetailType=c.timeDetailType:angular.isDefined(d.timeDetailType)&&"undefined"!=d.timeDetailType&&"null"!=d.timeDetailType?a.timeDetailType=d.timeDetailType:a.timeDetailType=n.getTimeDetailType();var r=a.timeDetailType.split("_");1<r.length?(a.timeType=r[0],a.detailType="_"+r[1]):1==r.length?(a.timeType=r[0],a.detailType=""):(a.timeType=n.getTimeType(),a.detailType=n.getDetailType());a.contZPoint=
n.getZpointId();a.contZPointName="undefined"!=n.getZpointName()?n.getZpointName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";a.contObject=n.getContObjectId();a.contObjectName="undefined"!=n.getContObjectName()?n.getContObjectName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";a.deviceModel=n.getDeviceModel();a.deviceSN=n.getDeviceSN();angular.isDefined(c.fromDate)&&"null"!==c.fromDate?b.reportStart=c.fromDate:angular.isDefined(d.fromDate)&&"null"!==
d.fromDate?b.reportStart=d.fromDate:b.reportStart=n.getFromDate();angular.isDefined(c.toDate)&&"null"!==c.toDate?b.reportEnd=c.toDate:angular.isDefined(d.toDate)&&"null"!==d.toDate?b.reportEnd=d.toDate:b.reportEnd=n.getToDate();a.dateRangeOptsRu=e.getDateRangeOptions("indicator-ru");a.date.forDeleteDateRangeOptsRu=e.getDateRangeOptions("indicator-ru");a.getData(1)})();a.$on("indicators:loadedModePrefs",function(){a.getData(1)});a.pageChanged=function(b){a.getData(b)};a.changeTimeDetailType=function(){a.timeDetailType=
a.timeType+a.detailType;d.timeDetailType=a.timeDetailType;a.getData(1)};a.$watch("impulseIndicatorDates",function(c,e,w){"/objects/impulse-indicators"===k.path()&&c!==e&&(d.fromDate=moment(c.startDate).format("YYYY-MM-DD"),d.toDate=moment(c.endDate).format("YYYY-MM-DD"),n.setFromDate(moment(c.startDate).format("YYYY-MM-DD")),n.setToDate(moment(c.endDate).format("YYYY-MM-DD")),b.reportStart=moment(c.startDate).format("YYYY-MM-DD"),b.reportEnd=moment(c.endDate).format("YYYY-MM-DD"),a.getData(1),a.date.deleteIndicatorDates=
{startDate:moment(c.startDate),endDate:moment(c.endDate)},b.startDateToDel=moment(c.startDate).format("YYYY-MM-DD"),b.endDateToDel=moment(c.endDate).format("YYYY-MM-DD"))},!1);var r=angular.element(g),q=function(){angular.isDefined(a.setScoreStyles)&&a.setScoreStyles();a.$apply()};r.bind("resize",q);a.$on("$destroy",function(){r.unbind("resize",q)});a.saveIndicatorsToFile=function(c){window.open("../api/subscr/"+(a.contObject||d.contObject)+"/service/"+(a.timeDetailType||d.timeDetailType)+"/"+(a.contZPoint||
d.contZPoint)+"/csv"+c+"?beginDate="+b.reportStart+"&endDate="+b.reportEnd)};a.uploadFile=function(){a.uploader.queue[a.uploader.queue.length-1].upload()};a.deleteData=function(){l["delete"]("../api/subscr/contObjects/"+(a.contObject||d.contObject)+"/contZPoints/"+(a.contZPoint||d.contZpoint)+"/service/24h/csv?beginDate="+b.startDateToDel+"&endDate="+b.endDateToDel).success(function(b){m.success();a.linkToFileWithDeleteData="../api/subscr/service/out/csv/"+b.filename;a.fileWithDeleteData=b.filename;
a.showLinkToFileFlag=!0;a.getData(1)}).error(f)};a.setOrderBy=function(b){var c=a.ctrlSettings.orderBy.field===b?!a.ctrlSettings.orderBy.asc:!0;d.indicatorsortorder=1==c?"asc":"desc";a.ctrlSettings.orderBy={field:b,asc:c,order:d.indicatorsortorder};a.getData(1)};a.isHaveData=function(){return angular.isUndefined(a.data)||0==a.data.length?!1:!0};a.isTDTabs=function(a){return"1h_abs"==a};a.changeIndicatorMode=function(){a.ctrlSettings.loadedWaterColumnsPref=a.currentIndicatorMode.vv.waterColumns;a.timeDetailType=
a.currentIndicatorMode.vv.indicatorHwKind;a.indicatorsPerPage=a.currentIndicatorMode.vv.indicatorHwPerPage;a.$broadcast("indicators:loadedModePrefs")};var v=function(a){e.getContextIds().forEach(function(b){b.permissionTagId.localeCompare(a);var c=document.getElementById(b.permissionTagId);angular.isUndefined(c)||null==c||$("#"+b.permissionTagId).removeClass("nmc-hide")})};v(a.ctrlSettings.ctxId);b.$on("servicePermissions:loaded",function(){v(a.ctrlSettings.ctxId)});window.setTimeout(function(){v(a.ctrlSettings.ctxId)},
500)}]);app=angular.module("portalNMC");
app.controller("ElectricityConsumptionCtrl",["$scope","$http","indicatorSvc","mainSvc","$location","$cookies","$rootScope","$window","$timeout","notificationFactory",function(a,b,d,g,l,k,h,p,m,n){function e(b){a.$broadcast("indicators:loadedModePrefs");a.ctrlSettings.loading=!1;b=g.errorCallbackHandler(b);n.errorInfo(b.caption,b.description)}function c(c){if(g.checkUndefinedNull("../api/subscr/vcookie")||g.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||g.checkUndefinedNull(c))return console.log("Request required params is null!"),!1;
b.get("../api/subscr/vcookie?vcMode=OBJECT_INDICATOR_PREFERENCES&vcKey="+c).then(function(b){if(g.checkUndefinedNull(b)||g.checkUndefinedNull(b.data)||!angular.isArray(b.data)||0===b.data.length)return a.$broadcast("indicators:loadedModePrefs"),console.log("Indicators: incorrect mode preferences!"),!1;b=JSON.parse(b.data[0].vcValue);a.ctrlSettings.loadedElectricityColumnsPref=b.electricityColumns;a.ctrlSettings.viewMode=b.indicatorElMode;a.timeDetailType=b.indicatorElKind;a.$broadcast("indicators:loadedModePrefs")},
e)}function f(d){if(g.checkUndefinedNull("../api/subscr/vcookie/user")||g.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||g.checkUndefinedNull(d))return console.log("Request required params is null!"),a.$broadcast("indicators:loadedModePrefs"),!1;b.get("../api/subscr/vcookie/user?vcMode=OBJECT_INDICATOR_PREFERENCES&vcKey=OIP_"+d).then(function(b){if(g.checkUndefinedNull(b)||g.checkUndefinedNull(b.data)||0===b.data.length)return a.$broadcast("indicators:loadedModePrefs"),!1;b=JSON.parse(b.data[0].vcValue);
c(b)},e)}function r(b){var c;if(g.checkUndefinedNull(b)||0===b.length)for(a.ctrlSettings.activeEnergyColCount=E,a.ctrlSettings.reactiveEnergyColCount=E,c=1;c<a.columns.length;c+=1)a.columns[c].isvisible="isvisible";else{var B={p_A:0,q_R:0};for(c=1;c<a.columns.length;c+=1)b.forEach(function(b){b.fieldName===a.columns[c].fieldName&&!0===b.isVisible&&(a.columns[c].isvisible="isvisible",B[a.columns[c].elType]+=1)});a.ctrlSettings.activeEnergyColCount=B.p_A;a.ctrlSettings.reactiveEnergyColCount=B.q_R}}
function q(a){var b,c;a.forEach(function(a){for(b=0;b<w.length;b+=1)for(c=0;c<x.length;c+=1)a[""+w[b].name+x[c].name+"_sum"]=-a[""+w[b].name+x[c].name]});return a}function v(b){var c;b.forEach(function(b){for(c in a.columns)null!=b[a.columns[c].fieldName]&&"string"!==a.columns[c].type&&(b[a.columns[c].fieldName]=b[a.columns[c].fieldName].toFixed(a.ctrlSettings.precision),b[""+a.columns[c].elType+a.columns[c].elKind+"_sum"]+=Number(b[a.columns[c].fieldName]))});return b}function t(b){var c,e;b.forEach(function(b){for(c=
0;c<w.length;c+=1)for(e=0;e<x.length;e+=1)b[""+w[c].name+x[e].name+"_sum"]=b[""+w[c].name+x[e].name+"_sum"].toFixed(a.ctrlSettings.precision)})}function u(b){var c,e;b.forEach(function(b,B){for(c=0;c<w.length;c+=1)for(e=0;e<x.length;e+=1){b[""+w[c].name+x[e].name+"_style"]={};b[""+w[c].name+x[e].name+"_style"].bgcolor="aquamarine";b[""+w[c].name+x[e].name+"_style"].cursor="default";if(g.checkUndefinedNull(b[""+w[c].name+x[e].name+"_sum"])||g.checkUndefinedNull(b[""+w[c].name+x[e].name]))return"Sum is undefined or null.";
var d=Math.abs(b[""+w[c].name+x[e].name+"_sum"]-b[""+w[c].name+x[e].name]).toFixed(a.ctrlSettings.precision),r=Number("0.00000000000000000000".substring(0,a.ctrlSettings.precision+1)+"1");d>r&&1>=d?(b[""+w[c].name+x[e].name+"_style"].bgcolor="#FFFFA4",b[""+w[c].name+x[e].name+"_style"].cursor="pointer"):1<d&&(b[""+w[c].name+x[e].name+"_style"].bgcolor="#FF7171",b[""+w[c].name+x[e].name+"_style"].cursor="pointer");d="#indicators_td_"+b.id+w[c].name+x[e].name;r="";r+="\u0421\u0443\u043c\u043c\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u043d\u0430\u044f \u043e\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430: "+
b[""+w[c].name+x[e].name];r+="<br><br>";r+="\u0420\u0430\u0441\u0441\u0447\u0438\u0442\u0430\u043d\u043d\u0430\u044f \u0441\u0443\u043c\u043c\u0430: "+b[""+w[c].name+x[e].name+"_sum"];C("\u0414\u0435\u0442\u0430\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f",r,d,d)}})}a.data=[];a.totals=[];a.indicatorsPerPage=a.data.length;a.totalIndicators=a.data.length;a.pagination={current:1};angular.isDefined(l.search().fromDate)&&null!=l.search().fromDate?a.indicatorDates=
{startDate:l.search().fromDate,endDate:l.search().toDate}:angular.isDefined(k.fromDate)&&null!=k.toDate?a.indicatorDates={startDate:k.fromDate,endDate:k.toDate}:a.indicatorDates={startDate:d.getFromDate(),endDate:d.getToDate()};a.ctrlSettings={};a.ctrlSettings.dataUrl="";a.ctrlSettings.userFormat="DD.MM.YYYY";a.ctrlSettings.requestFormat="YYYY-MM-DD";a.ctrlSettings.viewMode="";a.ctrlSettings.dataDate=moment().endOf("day").format(a.ctrlSettings.userFormat);a.ctrlSettings.loading=!0;a.ctrlSettings.precision=
3;a.ctrlSettings.ctxId="electricity_consumption_page";a.ctrlSettings.loadedElectricityColumnsPref=[];a.tableDef={tableClass:"crud-grid table table-lighter table-bordered table-condensed table-hover",hideHeader:!1,headerClassTR:"nmc-main-table-header",columns:[]};var w=[{name:"p_A",caption:"A"},{name:"q_R",caption:"R"}],x=[{name:"p",caption:"+"},{name:"n",caption:"-"}];a.tableDef.columns=d.getElectricityColumns();a.columns=a.tableDef.columns;var E=Math.floor(a.columns.length/2);a.ctrlSettings.activeEnergyColCount=
E;a.ctrlSettings.reactiveEnergyColCount=E;a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:a.ctrlSettings.dateFormat};var G=function(c,e){b.get(c+e).then(function(b){b=angular.copy(b.data);if(g.checkUndefinedNull(b))return"Electricity indicators undefined or null.";m(function(){a.setScoreStyles()});!0===g.getUseColorHighlightIndicatorData()&&d.setColorHighlightsForManualAndCrc(b);q(b);v(b);t(b);u(b);a.data=b;a.indicatorsPerPage=a.data.length;a.ctrlSettings.loading=!1;""==a.ctrlSettings.viewMode&&0<a.data.length&&A(c+"/summary"+e)},function(b){a.ctrlSettings.loading=
!1;console.log(b)})},C=function(a,b,c,e){m(function(){$(c).qtip({suppress:!1,content:{text:b,title:a,button:!0},show:{event:"click"},style:{classes:"qtip-nmc-indicator-tooltip",width:1E3},hide:{event:"unfocus"},position:{my:"top right",at:"bottom right",target:$(e)}})},1)},A=function(c){a.totals=[];var e={},B,d;b.get(c).then(function(b){m(function(){a.setScoreStyles()});e=angular.copy(b.data);b=[{name:"totals",caption:"\u0418\u0442\u043e\u0433\u043e:",type:"Cons"},{name:"diffsAbs",caption:"\u0418\u0442\u043e\u0433\u043e \u043f\u043e \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u0430\u043c:",
type:"Abs"}];for(B in b){var c=angular.copy(e[b[B].name]);if(!g.checkUndefinedNull(c)){for(d in a.columns)null!=c[a.columns[d].fieldName]&&"string"!==a.columns[d].type&&(c[a.columns[d].fieldName]=c[a.columns[d].fieldName].toFixed(a.ctrlSettings.precision));c.onlyCons=!0;c.type=b[B].type;c.dataDateString=b[B].caption;c["class"]="nmc-el-totals-indicator-highlight nmc-view-digital-data";a.totals.push(angular.copy(c));a.indicatorsPerPage+=1}}e.hasOwnProperty("diffsAbs")&&e.hasOwnProperty("totals")&&a.tableDef.columns.forEach(function(a,
b,c){a.diffBgColor="aquamarine";a.title="";b=a.fieldName;if(!angular.isUndefined(e.firstDataAbs)&&!angular.isUndefined(e.lastDataAbs)&&null!==e.firstDataAbs&&null!==e.lastDataAbs&&e.firstDataAbs.hasOwnProperty(b)&&e.lastDataAbs.hasOwnProperty(b)){c="\u041d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 = "+e.firstDataAbs[b]+" ";var B="";10==e.firstDataAbs.dataDateString.length&&(B=" 00:00");c+="(\u0414\u0430\u0442\u0430 = "+e.firstDataAbs.dataDateString+
B+");<br><br>";c+="\u041a\u043e\u043d\u0435\u0447\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 = "+e.lastDataAbs[b]+" ";B="";10==e.lastDataAbs.dataDateString.length&&(B=" 00:00");c+="(\u0414\u0430\u0442\u0430 = "+e.lastDataAbs.dataDateString+B+");";C("\u0414\u0435\u0442\u0430\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f",c,"#diffElBtn"+b,"#totalAbs"+b);e.diffsAbs.hasOwnProperty(b)&&!isNaN(e.diffsAbs[b])&&null!=e.diffsAbs[b]&&(e.diffsAbs[b]=
Number(e.diffsAbs[b]).toFixed(3));e.totals.hasOwnProperty(b)&&!isNaN(e.totals[b])&&null!=e.totals[b]&&(e.totals[b]=Number(e.totals[b]).toFixed(3));e.diffsAbs.hasOwnProperty(b)&&e.totals.hasOwnProperty(b)&&(c=e.diffsAbs[b],B=e.totals[b],null!=c&&null!=B&&"-"!=c&&"-"!=B&&(c.toString().split("."),B.toString().split("."),c=Number("0.001"),b=Math.abs(e.diffsAbs[b]-e.totals[b]).toFixed(3),b>c&&1>=b?(a.diffBgColor="#FFFFA4",a.title="\u0418\u0442\u043e\u0433\u043e \u0438 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0440\u0430\u0441\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u041d\u0415 \u0431\u043e\u043b\u0435\u0435 \u0447\u0435\u043c \u043d\u0430 1"):
1<b&&(a.diffBgColor="#FF7171",a.title="\u0418\u0442\u043e\u0433\u043e \u0438 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0440\u0430\u0441\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0411\u041e\u041b\u0415\u0415 \u0447\u0435\u043c \u043d\u0430 1")))}})},function(a){console.log(a)})};a.getData=function(){a.ctrlSettings.loading=!0;0<=a.ctrlSettings.viewMode.indexOf("_abs")?a.ctrlSettings.precision=2:a.ctrlSettings.precision=
3;a.data=[];var b;b=a.timeDetailType||k.timeDetailType;0<=b.indexOf("_abs")&&(b="24h",a.timeDetailType="24h");b+=a.ctrlSettings.viewMode;a.zpointTable="../api/subscr/"+a.contObject+"/serviceElCons/"+b+"/"+a.contZPoint;if("1h"==a.timeDetailType){b=moment(a.ctrlSettings.dataDate,a.ctrlSettings.userFormat).format(a.ctrlSettings.requestFormat);if(0==b.localeCompare("Invalid date")||"2000-01-01">b)return"requestDate is Invalid date.";b="/?beginDate="+b+"&endDate="+b}else b="/?beginDate="+h.reportStart+
"&endDate="+h.reportEnd;G(a.zpointTable,b)};a.$on("indicators:loadedModePrefs",function(){r(a.ctrlSettings.loadedElectricityColumnsPref);a.getData()});a.changeViewMode=function(){a.getData()};a.changeTimeDetailType=function(){a.getData()};a.refreshData=function(){a.getData()};a.$watch("indicatorDates",function(b,c){"/objects/indicator-electricity"===l.path()&&b!==c&&(k.fromDate=moment(b.startDate).format(a.ctrlSettings.requestFormat),k.toDate=moment(b.endDate).format(a.ctrlSettings.requestFormat),
d.setFromDate(moment(b.startDate).format(a.ctrlSettings.requestFormat)),d.setToDate(moment(b.endDate).format(a.ctrlSettings.requestFormat)),h.reportStart=moment(b.startDate).format(a.ctrlSettings.requestFormat),h.reportEnd=moment(b.endDate).format(a.ctrlSettings.requestFormat),a.getData())},!1);var z=angular.element(p),H=function(){angular.isDefined(a.setScoreStyles)&&a.setScoreStyles();a.$apply()};z.bind("resize",H);a.$on("$destroy",function(){z.unbind("resize",H)});a.setScoreStyles=function(){var a=
document.getElementById("indicatorConsTableHeader"),b=document.getElementById("divIndicatorConsTable");g.checkUndefinedNull(b)||(b.style.width=b.offsetWidth>b.clientWidth?a.offsetWidth+17+"px":a.offsetWidth+"px")};$(document).ready(function(){$("#inputElConsDate").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display",
"table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});g.checkUndefinedNull(a.contObject)||f(a.contObject)}]);app=angular.module("portalNMC");
app.controller("ElectricityEnergyCtrl",["$scope","$http","indicatorSvc","mainSvc","$location","$cookies","$rootScope","notificationFactory",function(a,b,d,g,l,k,h,p){a.electroKind="Energy";a.dataUrl="../api/subscr/"+a.contObject+"/serviceElProfile/30min/"+a.contZPoint;a.columns=[{header:"\u0414\u0430\u0442\u0430",headerClass:"col-xs-2 col-md-2 nmc-text-align-center",dataClass:"col-xs-2 col-md-2 nmc-text-align-right",fieldName:"dataDateString",type:"string",date:!0},{header:"\u0418\u043d\u0442\u0435\u0440\u0432\u0430\u043b, \u043c\u0438\u043d",
headerClass:"col-xs-1 col-md-1 nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-text-align-right",fieldName:"profileInterval",type:"string"},{header:"A+, \u043a\u0412\u0442/\u0447",headerClass:"col-xs-1 col-md-1 nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-text-align-right",fieldName:"p_Ap",graph:!0},{header:"A-, \u043a\u0412\u0442/\u0447",headerClass:"col-xs-1 col-md-1 nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-text-align-right",fieldName:"p_An",graph:!0},{header:"R+, \u043a\u0412\u0410\u0440/\u0447",
headerClass:"col-xs-1 col-md-1 nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-text-align-right",fieldName:"q_Rp",graph:!0},{header:"R-, \u043a\u0412\u0410\u0440/\u0447",headerClass:"col-xs-1 col-md-1 nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-text-align-right",fieldName:"q_Rn",graph:!0}]}]);app=angular.module("portalNMC");
app.controller("ElectricityPkeCtrl",["$scope","$http","indicatorSvc","mainSvc","$location","$cookies","$rootScope","$filter","notificationFactory","$window","$timeout","objectSvc",function(a,b,d,g,l,k,h,p,m,n,e,c){a.electroKind="Pke";a.pkeTypes=[];a.pkeData=[];a.states={};a.states.isSelectedAllPkeTypes=!0;a.states.isSelectedAllPkeTypesInWindow=!0;a.defaultFilterCaption="\u0412\u0441\u0435";a.selectedPkeTypes_list={caption:a.defaultFilterCaption};a.ctrlSettings={};a.ctrlSettings.loading=!0;a.ctrlSettings.systemDateFormat=
"YYYY-MM-DD";a.columns=[{header:"\u0414\u0430\u0442\u0430 \u043d\u0430\u0447\u0430\u043b\u0430",headerClass:"col-xs-3 col-md-3 nmc-text-align-center",dataClass:"col-xs-3 col-md-3 nmc-text-align-right",fieldName:"warnStartDateStr",type:"string",date:!0},{header:"\u0414\u0430\u0442\u0430 \u043e\u043a\u043e\u043d\u0447\u0430\u043d\u0438\u044f",headerClass:"col-xs-3 col-md-3 nmc-text-align-center",dataClass:"col-xs-3 col-md-3 nmc-text-align-right",fieldName:"warnEndDateStr",type:"string",date:!0},{header:"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043f\u0440\u0435\u0434\u0435\u043b\u0430",
headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"warnValue"},{header:"\u0415\u0434. \u0438\u0437\u043c.",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-left",fieldName:"pkeMeasureUnit"},{header:"\u0422\u0438\u043f",headerClass:"col-xs-4 col-md-4 nmc-text-align-center",dataClass:"col-xs-4 col-md-4 nmc-text-align-right",
fieldName:"pkeTypeCaption"}];a.ctrlSettings.orderBy={field:a.columns[0].fieldName,asc:!0};a.setOrderBy=function(b){a.ctrlSettings.orderBy={field:b,asc:a.ctrlSettings.orderBy.field===b?!a.ctrlSettings.orderBy.asc:!0}};a.indicatorPkeDates={startDate:moment().subtract(6,"days").startOf("day"),endDate:moment().endOf("day")};a.dateRangeOptsPkeRu=g.getDateRangeOptions("indicator-ru",{});a.dateRangeOptsPkeRu.startDate=moment().subtract(6,"days").startOf("day");a.dateRangeOptsPkeRu.endDate=moment().endOf("day");
a.dateRangeOptsPkeRu.dateLimit={months:1};var f="../api/subscr/deviceObjects/pke/byContZPoint/"+a.contZPoint+"/warn",r=function(a){a=g.errorCallbackHandler(a);m.errorInfo(a.caption,a.description)},q=function(c){a.ctrlSettings.loading=!0;var d=f,w={},d=d+("/?beginDate="+moment(a.indicatorPkeDates.startDate).format(a.ctrlSettings.systemDateFormat)+"&endDate="+moment(a.indicatorPkeDates.endDate).format(a.ctrlSettings.systemDateFormat));!g.checkUndefinedNull(c)&&angular.isArray(c)&&(w={pkeTypeKeynames:c.map(function(a){return a.keyname})});
b({method:"GET",url:d,params:w}).then(function(b){a.pkeData=angular.copy(b.data);a.pkeData.forEach(function(b){a.pkeTypes.some(function(c){if(b.deviceObjectPkeTypeKeyname==c.keyname)return b.pkeTypeCaption=c.caption,a.measureUnits.all.some(function(a){if(a.keyname===c.pkeMeasureUnit)return b.pkeMeasureUnit=a.caption,!0}),!0})});a.ctrlSettings.loading=!1;e(function(){a.setScoreStyles()},10)},r)};(function(){b.get("../api/subscr/deviceObjects/pke/types").then(function(b){a.pkeTypes=angular.copy(b.data);
a.pkeTypesInWindow=angular.copy(b.data);q()},r)})();var v=function(){var b=document.getElementsByClassName("btn-group open");g.checkUndefinedNull(b)||0==b.length||b[0].classList.remove("open");a.states.isSelectElement=!1};a.getDataWithSelectedTypes=function(){v();angular.isArray(a.pkeTypesInWindow)||q();a.pkeTypes=angular.copy(a.pkeTypesInWindow);a.states.isSelectedAllPkeTypes=angular.copy(a.states.isSelectedAllPkeTypesInWindow);var b=[];a.pkeTypes.forEach(function(a){1==a.selected&&b.push(a)});a.selectedPkeTypes_list.caption=
0==b.length?a.defaultFilterCaption:b.length;q(b)};a.selectPkeTypesClick=function(){a.states.isSelectElement=!1;a.pkeTypesInWindow=angular.copy(a.pkeTypes);a.states.isSelectedAllPkeTypesInWindow=angular.copy(a.states.isSelectedAllPkeTypes)};a.selectAllTypes=function(){p("filter")(a.pkeTypes,a.pkeTypesFilter).forEach(function(b){b.selected=a.isSelectedAllTypes});a.getDataWithSelectedTypes()};a.selectAllElements=function(b){a.states.isSelectElement=!0;b.forEach(function(a){a.selected=!1})};a.selectElement=
function(b){a.states.isSelectElement=!0;return a.states[b]=!1};a.isFilterApplyDisabled=function(a,b){return!angular.isArray(a)||g.checkUndefinedNull(b)||1==b?!1:!a.some(function(a){if(1==a.selected)return!0})};a.clearPkeTypeFilter=function(){a.pkeTypesFilter="";a.isSelectedAllTypes=!1;a.pkeTypesInWindow.forEach(function(a){a.selected=!1});a.states.isSelectedAllPkeTypesInWindow=!0;a.getDataWithSelectedTypes()};a.$watch("indicatorPkeDates",function(b,c){a.getDataWithSelectedTypes()});a.setScoreStyles=
function(){var a=document.getElementById("pkeTableHeader"),b=document.getElementById("divPkeTable");if(!g.checkUndefinedNull(b)&&!g.checkUndefinedNull(a)){if(0==a.offsetWidth)return"Pke. tableHeader.offsetWidth == 0";b.style.width=b.offsetWidth>b.clientWidth?a.offsetWidth+17+"px":a.offsetWidth+"px"}};var t=angular.element(n),u=function(){angular.isDefined(a.setScoreStyles)&&a.setScoreStyles();a.$apply()};t.bind("resize",u);a.$on("$destroy",function(){t.unbind("resize",u)});a.onTableLoad=function(){a.setScoreStyles()};
e(function(){a.setScoreStyles()},500);a.initCtrl=function(){a.pkeTypesInWindow=angular.copy(a.pkeTypes);a.measureUnits=c.getDeviceMetadataMeasures()};a.initCtrl()}]);app=angular.module("portalNMC");
app.controller("ElectricitySpecCtrl",["$scope","$http","indicatorSvc","mainSvc","$location","$cookies","$rootScope",function(a,b,d,g,l,k,h){a.electroKind="Spec";a.dataUrl="../api/subscr/"+a.contObject+"/serviceElTech/abs/"+a.contZPoint;a.columns=[{header:"\u0414\u0430\u0442\u0430",headerClass:"col-xs-2 col-md-2 nmc-text-align-center",dataClass:"col-xs-2 col-md-2 nmc-text-align-right",fieldName:"dataDateString",type:"string",date:!0},{header:"Ua, V",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",
fieldName:"u1"},{header:"Ub, V",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"u2"},{header:"Uc, V",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"u3"},{header:"Ia, A",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",
fieldName:"i1"},{header:"Ib, A",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"i2"},{header:"Ic, A",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"i3"},{header:"cos \u03c6a",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",
fieldName:"k1"},{header:"cos \u03c6b",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"k2"},{header:"cos \u03c6c",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"k3"},{header:"f, Hz",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",
fieldName:"frequency"},{header:"T, \u2103",headerClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-center",dataClass:"col-xs-1 col-md-1 nmc-view-digital-data nmc-text-align-right",fieldName:"deviceTemp"}]}]);app=angular.module("portalNMC");
app.controller("ElectricityCtrl",["$scope","mainSvc","indicatorSvc","$location","$cookies","$rootScope","$timeout",function(a,b,d,g,l,k,h){k.ctxId="indicators_page";a.oldMinWidth=null;a.curMinWidth="1920px";a.isSystemuser=function(){return b.isSystemuser()};(function(){var h=g.search();angular.isUndefined(null);angular.isDefined(h.zpointId)&&"null"!==h.zpointId&&d.setZpointId(h.zpointId);angular.isUndefined(null);angular.isDefined(h.objectId)&&"null"!==h.objectId&&d.setContObjectId(h.objectId);angular.isUndefined(null);
angular.isDefined(h.zpointName)&&"null"!==h.zpointName&&d.setZpointName(h.zpointName);angular.isUndefined(null);angular.isDefined(h.objectName)&&"null"!==h.objectName&&d.setContObjectName(h.objectName);angular.isUndefined(null);angular.isDefined(h.deviceModel)&&"null"!==h.deviceModel&&d.setDeviceModel(h.deviceModel);angular.isUndefined(null);angular.isDefined(h.deviceSN)&&"null"!==h.deviceSN&&d.setDeviceSN(h.deviceSN);angular.isUndefined(null);angular.isDefined(h.timeDetailType)&&"null"!==h.timeDetailType?
a.timeDetailType=h.timeDetailType:angular.isDefined(l.timeDetailType)&&"undefined"!=l.timeDetailType&&"null"!=l.timeDetailType?a.timeDetailType=l.timeDetailType:a.timeDetailType=d.getTimeDetailType();a.contZPoint=d.getZpointId();a.contZPointName="undefined"!=d.getZpointName()?d.getZpointName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";a.contObject=d.getContObjectId();a.contObjectName="undefined"!=d.getContObjectName()?d.getContObjectName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";
a.deviceModel=d.getDeviceModel();a.deviceSN=d.getDeviceSN();angular.isDefined(h.fromDate)&&"null"!==h.fromDate?k.reportStart=h.fromDate:angular.isDefined(l.fromDate)&&"null"!==l.fromDate?k.reportStart=l.fromDate:k.reportStart=d.getFromDate();angular.isDefined(h.toDate)&&"null"!==h.toDate?k.reportEnd=h.toDate:angular.isDefined(l.toDate)&&"null"!==l.toDate?k.reportEnd=l.toDate:k.reportEnd=d.getToDate();a.dateRangeOptsRu=b.getDateRangeOptions("indicator-ru")})();$(document).ready(function(){a.oldMinWidth=
$(".wrap > .container-fluid >.row").css("min-width");$(".wrap > .container-fluid >.row").css("min-width",a.curMinWidth)});a.$on("$destroy",function(){$(".wrap > .container-fluid >.row").css("min-width",a.oldMinWidth)});a.initCons=function(){$(".wrap > .container-fluid >.row").css("min-width",a.curMinWidth)};a.initProfile=function(){$(".wrap > .container-fluid >.row").css("min-width",a.oldMinWidth)};a.initTech=function(){$(".wrap > .container-fluid >.row").css("min-width",a.oldMinWidth)};$("#consumptionTab").on("shown.bs.tab",
function(){var a=document.getElementById("indicatorConsTableHeader"),d=document.getElementById("divIndicatorConsTable");b.checkUndefinedNull(d)||(d.style.width=d.offsetWidth>d.clientWidth?a.offsetWidth+17+"px":a.offsetWidth+"px")})}]);angular.module("portalNMC").controller("IndicatorsCtrl",["$scope","$rootScope","$cookies","$window","$http","$location","crudGridDataFactory","FileUploader","notificationFactory","indicatorSvc","mainSvc",function(a,b,d,g,l,k,h,p,m,n,e){function c(b){if(e.checkUndefinedNull("../api/subscr/vcookie")||e.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES"))return console.log("Request required params is null!"),a.$broadcast("indicators:loadedModePrefs"),!1;l.get("../api/subscr/vcookie?vcMode=OBJECT_INDICATOR_PREFERENCES").then(function(c){var d;
if(e.checkUndefinedNull(c)||e.checkUndefinedNull(c.data)||!angular.isArray(c.data)||0===c.data.length)return console.log("Indicators: incorrect mode preferences!"),a.$broadcast("indicators:loadedModePrefs"),!1;angular.copy(c.data).forEach(function(b){if(null===b.vcValue)return!1;d=JSON.parse(b.vcValue);b.caption=d.caption;b.vv=d;a.indicatorModes.push(b)});a.currentIndicatorMode=null;e.checkUndefinedNull(b)||a.indicatorModes.some(function(c){if(c.vcKey===b)return a.currentIndicatorMode=c,!0});if(e.checkUndefinedNull(a.currentIndicatorMode))return console.log("Current indicator mode is undefined or null!"),
a.$broadcast("indicators:loadedModePrefs"),!1;a.ctrlSettings.loadedWaterColumnsPref=a.currentIndicatorMode.vv.waterColumns;a.timeDetailType=a.currentIndicatorMode.vv.indicatorHwKind;a.indicatorsPerPage=a.currentIndicatorMode.vv.indicatorHwPerPage;a.$broadcast("indicators:loadedModePrefs")},q)}function f(b){if(e.checkUndefinedNull("../api/subscr/vcookie/user")||e.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||e.checkUndefinedNull(b))return console.log("Request required params is null!"),a.$broadcast("indicators:loadedModePrefs"),
!1;l.get("../api/subscr/vcookie/user?vcMode=OBJECT_INDICATOR_PREFERENCES&vcKey=OIP_"+b).then(function(a){var b;e.checkUndefinedNull(a)||e.checkUndefinedNull(a.data)||0===a.data.length||(b=JSON.parse(a.data[0].vcValue));c(b)},q)}function r(b){var c;for(c=2;c<a.indicatorColumns.length;c+=1)a.indicatorColumns[c].isvisible="false";a.intotalColumns.forEach(function(a){a.isvisible="false"});for(c=2;c<a.indicatorColumns.length;c+=1)b.forEach(function(b){b.fieldName===a.indicatorColumns[c].fieldName&&!0===
b.isVisible&&(a.indicatorColumns[c].isvisible="isvisible")});for(c=0;c<a.intotalColumns.length;c+=1)b.forEach(function(b){b.fieldName===a.intotalColumns[c].fieldName&&!0===b.isVisible&&(a.intotalColumns[c].isvisible="isvisible")});if(e.checkUndefinedNull(b)||0===b.length){for(c=2;c<a.indicatorColumns.length;c+=1)a.indicatorColumns[c].isvisible="isvisible";for(c=0;c<a.intotalColumns.length;c+=1)a.intotalColumns[c].isvisible="isvisible"}else{for(c=2;c<a.indicatorColumns.length;c+=1)b.forEach(function(b){b.fieldName===
a.indicatorColumns[c].fieldName&&!0===b.isVisible&&(a.indicatorColumns[c].isvisible="isvisible")});for(c=0;c<a.intotalColumns.length;c+=1)b.forEach(function(b){b.fieldName===a.intotalColumns[c].fieldName&&!0===b.isVisible&&(a.intotalColumns[c].isvisible="isvisible")})}}b.ctxId="indicators_page";a.date={};angular.isDefined(k.search().fromDate)&&null!=k.search().fromDate?a.indicatorDates={startDate:k.search().fromDate,endDate:k.search().toDate}:angular.isDefined(d.fromDate)&&null!=d.toDate?a.indicatorDates=
{startDate:d.fromDate,endDate:d.toDate}:a.indicatorDates={startDate:n.getFromDate(),endDate:n.getToDate()};a.date.deleteIndicatorDates={startDate:angular.copy(a.indicatorDates.startDate),endDate:angular.copy(a.indicatorDates.endDate)};b.startDateToDel=moment(a.date.deleteIndicatorDates.startDate).format("YYYY-MM-DD");b.endDateToDel=moment(a.date.deleteIndicatorDates.endDate).format("YYYY-MM-DD");a.$watch("date.deleteIndicatorDates",function(a,c,e){"/objects/indicators"===k.path()&&a!==c&&(b.startDateToDel=
moment(a.startDate).format("YYYY-MM-DD"),b.endDateToDel=moment(a.endDate).format("YYYY-MM-DD"))},!1);a.ctrlSettings={};a.ctrlSettings.ctxId="zpoint_indicator_page";a.ctrlSettings.loadedWaterColumnsPref=[];a.ctrlSettings.orderBy={};if(angular.isDefined(d.indicatorsortorder)&&null!=d.indicatorsortorder)switch(d.indicatorsortorder){case "asc":a.ctrlSettings.orderBy={field:"dataDate",asc:!0,desc:!1,order:"asc"};break;case "desc":a.ctrlSettings.orderBy={field:"dataDate",asc:!1,desc:!0,order:"desc"}}else a.ctrlSettings.orderBy=
{field:"dataDate",asc:!1,desc:!0,order:"desc"};a.intotalColumns=n.getIntotalColumns();a.indicatorColumns=n.getWaterColumns();a.tableDef={tableClass:"crud-grid table table-lighter table-bordered table-condensed table-hover",hideHeader:!1,headerClassTR:"nmc-main-table-header-indicator",columns:a.indicatorColumns};a.summary={};a.totalIndicators=0;a.indicatorsPerPage=100;a.indicatorsPerPageList=[15,25,50,75,100];a.timeDetailType="24h";a.data=[];a.pagination={current:1};a.indicatorModes=[];a.showLinkToFileFlag=
!1;a.isManualLoading="true"===d.isManualLoading?!0:!1;var q=function(b){a.ctrlSettings.loading=!1;console.log(b);var c="-1";if(e.checkUndefinedNull(b)||e.checkUndefinedNull(b.data))c="ERR_CONNECTION";e.checkUndefinedNull(b)||e.checkUndefinedNull(b.resultCode)&&(e.checkUndefinedNull(b.data)||e.checkUndefinedNull(b.data.resultCode))||(c=b.resultCode||b.data.resultCode);b=e.getServerErrorByResultCode(c);m.errorInfo(b.caption,b.description)};a.initFileUploader=function(){a.uploader=new p({url:"../api/subscr/contObjects/"+
(a.contObject||d.contObject)+"/contZPoints/"+(a.contZPoint||d.contZPoint)+"/service/"+(a.timeDetailType||d.timeDetailType)+"/csv"});a.uploader.onErrorItem=function(b,c,e,d){console.info("onErrorItem",e,c);q(c);a.successOnUpload=!1;a.errorOnUpload=!0;a.uploadFlag=!1};a.uploader.onSuccessItem=function(a,b,c,e){};a.uploader.onCompleteAll=function(){a.getData(1);a.successOnUpload=!0;a.errorOnUpload=!1};window.setTimeout(function(){$("#upLoadFileModal").on("shown.bs.modal",function(){});$("#upLoadFileModal").on("hidden.bs.modal",
function(){a.uploader=null;a.uploadFlag=!1;a.successOnUpload=!1;a.errorOnUpload=!1;a.$apply()})},10)};a.isSystemuser=function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};(function(){var c=k.search();angular.isUndefined(null);angular.isDefined(c.zpointId)&&"null"!==c.zpointId&&n.setZpointId(c.zpointId);angular.isUndefined(null);angular.isDefined(c.objectId)&&"null"!==c.objectId&&n.setContObjectId(c.objectId);angular.isUndefined(null);angular.isDefined(c.zpointName)&&
"null"!==c.zpointName&&n.setZpointName(c.zpointName);angular.isUndefined(null);angular.isDefined(c.objectName)&&"null"!==c.objectName&&n.setContObjectName(c.objectName);angular.isUndefined(null);angular.isDefined(c.deviceModel)&&"null"!==c.deviceModel&&n.setDeviceModel(c.deviceModel);angular.isUndefined(null);angular.isDefined(c.deviceSN)&&"null"!==c.deviceSN&&n.setDeviceSN(c.deviceSN);angular.isUndefined(null);angular.isDefined(c.timeDetailType)&&"null"!==c.timeDetailType?a.timeDetailType=c.timeDetailType:
angular.isDefined(d.timeDetailType)&&"undefined"!=d.timeDetailType&&"null"!=d.timeDetailType?a.timeDetailType=d.timeDetailType:a.timeDetailType=n.getTimeDetailType();a.contZPoint=n.getZpointId();a.contZPointName="undefined"!=n.getZpointName()?n.getZpointName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";a.contObject=n.getContObjectId();a.contObjectName="undefined"!=n.getContObjectName()?n.getContObjectName():"\u0411\u0435\u0437 \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u044f";
a.deviceModel=n.getDeviceModel();a.deviceSN=n.getDeviceSN();angular.isDefined(c.isManualLoading)&&"null"!==c.isManualLoading&&(a.isManualLoading="true"===c.isManualLoading?!0:!1);angular.isDefined(c.fromDate)&&"null"!==c.fromDate?b.reportStart=c.fromDate:angular.isDefined(d.fromDate)&&"null"!==d.fromDate?b.reportStart=d.fromDate:b.reportStart=n.getFromDate();angular.isDefined(c.toDate)&&"null"!==c.toDate?b.reportEnd=c.toDate:angular.isDefined(d.toDate)&&"null"!==d.toDate?b.reportEnd=d.toDate:b.reportEnd=
n.getToDate();a.dateRangeOptsRu=e.getDateRangeOptions("indicator-ru");a.date.forDeleteDateRangeOptsRu=e.getDateRangeOptions("indicator-ru");e.checkUndefinedNull(a.contObject)||f(a.contObject)})();a.columns=[];a.getData=function(c){a.ctrlSettings.loading=!0;a.pagination.current=c;a.zpointTable="../api/subscr/"+a.contObject+"/service/"+(a.timeDetailType||d.timeDetailType)+"/"+a.contZPoint+"/paged?beginDate="+b.reportStart+"&endDate="+b.reportEnd+"&page="+(c-1)+"&size="+a.indicatorsPerPage+"&dataDateSort="+
a.ctrlSettings.orderBy.order;c=a.zpointTable;l.get(c).success(function(b){a.totalIndicators=b.totalElements;a.columns=a.tableDef.columns;!0===e.getUseColorHighlightIndicatorData()&&n.setColorHighlightsForManualAndCrc(b.objects);b.objects.map(function(b,c){for(var e in a.columns)"dataDate"===a.columns[e].fieldName?b.dataDate=b.dataDateString:(null!=b[a.columns[e].fieldName]&&"dataDateString"!==a.columns[e].fieldName&&(b[a.columns[e].fieldName]=b[a.columns[e].fieldName].toFixed(3)),null===b[a.columns[e].fieldName]&&
"m_delta"===a.columns[e].fieldName&&null!==b.m_out&&null!==b.m_in&&(b[a.columns[e].fieldName]=(b.m_in-b.m_out).toFixed(3)),null===b[a.columns[e].fieldName]&&"v_delta"===a.columns[e].fieldName&&null!==b.v_out&&null!==b.v_in&&(b[a.columns[e].fieldName]=(b.v_in-b.v_out).toFixed(3)),null===b[a.columns[e].fieldName]&&"p_delta"===a.columns[e].fieldName&&null!==b.p_out&&null!==b.p_in&&(b[a.columns[e].fieldName]=(b.p_in-b.p_out).toFixed(3)))});a.data=b.objects;a.ctrlSettings.loading=!1}).error(q);a.setScoreStyles=
function(){var b=document.getElementById("indicatorTableHeader"),c=document.getElementById("divIndicatorTable");if(!e.checkUndefinedNull(c)&&!e.checkUndefinedNull(b)){if(0==b.offsetWidth)return"Indicators. tableHeader.offsetWidth == 0";c.style.width=c.offsetWidth>c.clientWidth?b.offsetWidth+17+"px":b.offsetWidth+"px"}a.tableDef.columns.some(function(a){var b=document.getElementById("indicators_th_"+a.fieldName),c=document.getElementById("indicators_head_"+a.fieldName);a=document.getElementById("indicators_tdh_"+
a.fieldName);angular.isDefined(b)&&null!=b&&angular.isDefined(c)&&null!=c&&(b=Math.max(b.offsetWidth,b.clientWidth),c.style.width=b+"px",a.style.width=b+"px")});b=document.getElementById("indicators_th_dataDate");c=document.getElementById("indicators_th_workTime");document.getElementById("totals_th_head");angular.isDefined(b)&&null!=b&&angular.isDefined(c)&&null!=c&&(a.totals_th_head_style=b.offsetWidth+c.offsetWidth+4);a.intotalColumns.some(function(a){var b=document.getElementById("indicators_th_"+
a.fieldName);document.getElementById("indicators_head_"+a.fieldName);angular.isDefined(b)&&null!=b&&(a.ngstyle=b.offsetWidth)})};a.onTableLoad=function(){a.setScoreStyles()};var r=function(b){a.intotalColumns.forEach(function(a){a=a.fieldName;b.hasOwnProperty(a)&&!isNaN(b[a])&&null!=b[a]?b[a]=b[a].toFixed(3):b[a]="m_delta"==a&&"-"!=b.m_out&&"-"!=b.m_in?(b.m_in-b.m_out).toFixed(3):"v_delta"==a&&"-"!=b.v_out&&"-"!=b.v_in?(b.v_in-b.v_out).toFixed(3):"p_delta"==a&&"-"!=b.p_out&&"-"!=b.p_in?(b.p_in-b.p_out).toFixed(3):
"-"})};c=c.replace("paged","summary");h(c).get(function(b){a.setScoreStyles();a.intotalColumns.forEach(function(a,b,c){a.imgpath="images/plug.png";a.imgclass="";a.title=""});a.summary=angular.copy(b);a.summary.hasOwnProperty("diffs")&&r(a.summary.diffs);a.summary.hasOwnProperty("totals")&&r(a.summary.totals);a.summary.hasOwnProperty("average")&&r(a.summary.average);a.summary.hasOwnProperty("diffs")&&a.summary.hasOwnProperty("totals")&&a.intotalColumns.forEach(function(b,c,e){c=b.fieldName;if(!angular.isUndefined(a.summary.firstData)&&
!angular.isUndefined(a.summary.lastData)&&null!==a.summary.firstData&&null!==a.summary.lastData&&a.summary.firstData.hasOwnProperty(c)&&a.summary.lastData.hasOwnProperty(c)){e="\u041d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 = "+a.summary.firstData[c]+" ";var d="";10==a.summary.firstData.dataDateString.length&&(d=" 00:00");e+="(\u0414\u0430\u0442\u0430 = "+a.summary.firstData.dataDateString+d+");<br><br>";e+="\u041a\u043e\u043d\u0435\u0447\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 = "+
a.summary.lastData[c]+" ";d="";10==a.summary.lastData.dataDateString.length&&(d=" 00:00");e+="(\u0414\u0430\u0442\u0430 = "+a.summary.lastData.dataDateString+d+");";d="#total"+c;$("#diffBtn"+c).qtip({suppress:!1,content:{text:e,title:"\u0414\u0435\u0442\u0430\u043b\u044c\u043d\u0430\u044f \u0438\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f",button:!0},show:{event:"click"},style:{classes:"qtip-nmc-indicator-tooltip",width:1E3},hide:{event:"unfocus"},position:{my:"top right",at:"bottom right",
target:$(d)}});a.summary.diffs.hasOwnProperty(c)&&!isNaN(a.summary.diffs[c])&&null!=a.summary.diffs[c]&&(a.summary.diffs[c]=Number(a.summary.diffs[c]).toFixed(3));a.summary.totals.hasOwnProperty(c)&&!isNaN(a.summary.totals[c])&&null!=a.summary.totals[c]&&(a.summary.totals[c]=Number(a.summary.totals[c]).toFixed(3));a.summary.diffs.hasOwnProperty(c)&&a.summary.totals.hasOwnProperty(c)&&(e=a.summary.diffs[c],d=a.summary.totals[c],null!=e&&null!=d&&"-"!=e&&"-"!=d&&(e.toString().split("."),d.toString().split("."),
e=Number("0.001"),c=Math.abs(a.summary.diffs[c]-a.summary.totals[c]).toFixed(3),c>e&&1>=c?(b.imgpath="images/divergenceIndicatorAlert.png",b.imgclass="nmc-img-divergence-indicator",b.title="\u0418\u0442\u043e\u0433\u043e \u0438 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0440\u0430\u0441\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u041d\u0415 \u0431\u043e\u043b\u0435\u0435 \u0447\u0435\u043c \u043d\u0430 1"):1<c?
(b.imgpath="images/divergenceIndicatorCrit.png",b.imgclass="nmc-img-divergence-indicator",b.title="\u0418\u0442\u043e\u0433\u043e \u0438 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u043e\u0432 \u0440\u0430\u0441\u0445\u043e\u0434\u044f\u0442\u0441\u044f \u0411\u041e\u041b\u0415\u0415 \u0447\u0435\u043c \u043d\u0430 1"):(b.imgpath="images/plug.png",b.imgclass="",b.title="")))}})})};a.$on("indicators:loadedModePrefs",function(){r(a.ctrlSettings.loadedWaterColumnsPref);
a.getData(1)});a.pageChanged=function(b){a.getData(b)};a.changeTimeDetailType=function(){d.timeDetailType=a.timeDetailType;a.getData(1)};a.$watch("indicatorDates",function(c,e,r){"/objects/indicators"===k.path()&&c!==e&&(d.fromDate=moment(c.startDate).format("YYYY-MM-DD"),d.toDate=moment(c.endDate).format("YYYY-MM-DD"),n.setFromDate(moment(c.startDate).format("YYYY-MM-DD")),n.setToDate(moment(c.endDate).format("YYYY-MM-DD")),b.reportStart=moment(c.startDate).format("YYYY-MM-DD"),b.reportEnd=moment(c.endDate).format("YYYY-MM-DD"),
a.getData(1),a.date.deleteIndicatorDates={startDate:moment(c.startDate),endDate:moment(c.endDate)},b.startDateToDel=moment(c.startDate).format("YYYY-MM-DD"),b.endDateToDel=moment(c.endDate).format("YYYY-MM-DD"))},!1);var v=angular.element(g),t=function(){angular.isDefined(a.setScoreStyles)&&a.setScoreStyles();a.$apply()};v.bind("resize",t);a.$on("$destroy",function(){v.unbind("resize",t)});a.saveIndicatorsToFile=function(c){window.open("../api/subscr/"+(a.contObject||d.contObject)+"/service/"+(a.timeDetailType||
d.timeDetailType)+"/"+(a.contZPoint||d.contZPoint)+"/csv"+c+"?beginDate="+b.reportStart+"&endDate="+b.reportEnd)};a.uploadFile=function(){a.uploadFlag=!0;a.uploader.queue[a.uploader.queue.length-1].upload()};a.deleteData=function(){l["delete"]("../api/subscr/contObjects/"+(a.contObject||d.contObject)+"/contZPoints/"+(a.contZPoint||d.contZpoint)+"/service/"+(a.timeDetailType||d.timeDetailType)+"/csv?beginDate="+b.startDateToDel+"&endDate="+b.endDateToDel).success(function(b){m.success();a.linkToFileWithDeleteData=
"../api/subscr/service/out/csv/"+b.filename;a.fileWithDeleteData=b.filename;a.showLinkToFileFlag=!0;a.getData(1)}).error(q)};a.setOrderBy=function(b){var c=a.ctrlSettings.orderBy.field===b?!a.ctrlSettings.orderBy.asc:!0;d.indicatorsortorder=1==c?"asc":"desc";a.ctrlSettings.orderBy={field:b,asc:c,order:d.indicatorsortorder};a.getData(1)};a.isHaveData=function(){return angular.isUndefined(a.data)||0==a.data.length?!1:!0};a.isTDTabs=function(a){return"1h_abs"==a};a.changeIndicatorMode=function(){a.ctrlSettings.loadedWaterColumnsPref=
a.currentIndicatorMode.vv.waterColumns;a.timeDetailType=a.currentIndicatorMode.vv.indicatorHwKind;a.indicatorsPerPage=a.currentIndicatorMode.vv.indicatorHwPerPage;a.$broadcast("indicators:loadedModePrefs")};var u=function(a){e.getContextIds().forEach(function(b){b.permissionTagId.localeCompare(a);var c=document.getElementById(b.permissionTagId);angular.isUndefined(c)||null==c||$("#"+b.permissionTagId).removeClass("nmc-hide")})};u(a.ctrlSettings.ctxId);b.$on("servicePermissions:loaded",function(){u(a.ctrlSettings.ctxId)});
window.setTimeout(function(){u(a.ctrlSettings.ctxId)},500)}]);app=angular.module("portalNMC");
app.controller("LogSmsCtrl",["$scope","$cookies","$timeout","mainSvc","objectSvc","$http","notificationFactory",function(a,b,d,g,l,k,h){function p(b){a.ctrlSettings.loading=!1;b=g.errorCallbackHandler(b);h.errorInfo(b.caption,b.description)}function m(b){var c;b.forEach(function(b){b.smsDateStr=moment(b.smsDate).format(a.ctrlSettings.userDateFormat);for(c=0;c<a.ctrlSettings.logColumns.length;c+=1)b[a.ctrlSettings.logColumns[c].name+"view"]=20<=b[a.ctrlSettings.logColumns[c].name].toString().length?b[a.ctrlSettings.logColumns[c].name].toString().substr(0,
20)+"...":b[a.ctrlSettings.logColumns[c].name].toString()})}function n(){a.ctrlSettings.loading=!0;var b=a.ctrlSettings.smsLogUrl,c;g.checkUndefinedNull(a.ctrlSettings.smsLogDaterange.startDate)||(c=moment(a.ctrlSettings.smsLogDaterange.startDate).format(a.ctrlSettings.systemDateFormat),b+="?fromDate="+c);g.checkUndefinedNull(a.ctrlSettings.smsLogDaterange.endDate)||(c=moment(a.ctrlSettings.smsLogDaterange.endDate).format(a.ctrlSettings.systemDateFormat),b+="&toDate="+c);k.get(b).then(function(b){b=
angular.copy(b.data);m(b);a.data.log=b;a.ctrlSettings.loading=!1},p)}a.messages={};a.ctrlSettings={};a.ctrlSettings.smsLogUrl="../api/subscr/smsLog";a.ctrlSettings.groupUrl="../api/subscr/contGroup";a.ctrlSettings.showObjectsFlag=!0;a.ctrlSettings.smsLogDaterange={startDate:moment().startOf("day"),endDate:moment().endOf("day")};a.ctrlSettings.systemDateFormat="YYYY-MM-DD";a.ctrlSettings.userDateFormat="DD-MM-YYYY HH:mm:ss";a.ctrlSettings.daterangeOpts=g.getDateRangeOptions("ru");a.ctrlSettings.daterangeOpts.startDate=
moment().startOf("day");a.ctrlSettings.daterangeOpts.endDate=moment().endOf("day");a.ctrlSettings.daterangeOpts.dateLimit={months:1};a.ctrlSettings.logColumns=[{name:"smsDateStr",caption:"\u0414\u0430\u0442\u0430 \u043e\u0442\u043f\u0440\u0430\u0432\u043b\u0435\u043d\u0438\u044f",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding",type:"datetime"},{name:"smsRecieverName",caption:"\u041a\u043e\u043c\u0443",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding"},
{name:"smsRecieverTel",caption:"\u041d\u043e\u043c\u0435\u0440",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding"},{name:"smsMessage",caption:"\u0422\u0435\u043a\u0441\u0442",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding",type:"textarea"},{name:"smsProviderUrl",caption:"\u041f\u043e\u043b\u043d\u044b\u0439 url \u0430\u0434\u0440\u0435\u0441 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438",headerClass:"col-xs-1 col-md-1 paddingLeftRight5I",dataClass:"col-xs-1 col-md-1 noPadding",
isTableView:!1,type:"textarea"},{name:"smsProviderResponseCode",caption:"\u041a\u043e\u0434 \u043e\u0442\u0432\u0435\u0442\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 text-center noPadding"},{name:"smsProviderResponseBody",caption:"\u0422\u0435\u043a\u0441\u0442 \u043e\u0442\u0432\u0435\u0442\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding",type:"textarea",viewInNewWindow:!0},
{name:"smsStatus",caption:"\u0421\u0442\u0430\u0442\u0443\u0441",headerClass:"col-xs-1 col-md-1",dataClass:"col-xs-1 col-md-1 noPadding"}];b=[];for(d=0;d<a.ctrlSettings.logColumns.length;d+=1)if(l=angular.copy(a.ctrlSettings.logColumns[d]),g.checkUndefinedNull(l.isTableView)||0!=l.isTableView)l.name+="view",b.push(l);a.ctrlSettings.logColumnsForTable=b;a.data={};a.data.log=[];a.data.logDaterange={startDate:moment().subtract(6,"days").startOf("day"),endDate:moment().endOf("day")};a.states={};a.states.isSelectedAllObjects=
!0;a.states.isSelectedAllObjectsInWindow=!0;a.messages.defaultFilterCaption="\u0412\u0441\u0435";a.selectedObjects_list={};a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.loadSmsLogData=function(){n()};a.viewDetail=function(b,c){if(!g.checkUndefinedNull(c.viewInNewWindow)&&1==c.viewInNewWindow){var e=window.open("about:blank","Server respond"),d=c.name.substr(0,c.name.indexOf("view"));e.document.write(b[d]);return!0}a.data.currentLog=angular.copy(b);$("#showLogModal").modal()};a.$watch("ctrlSettings.smsLogDaterange",
function(a,b){a.startDate==b.startDate&&a.endDate==b.endDate||n()});n()}]);app=angular.module("portalNMC");
app.controller("LogViewCtrl",["$scope","$cookies","$timeout","mainSvc","objectSvc","$http","notificationFactory","logSvc","$rootScope",function(a,b,d,g,l,k,h,p,m){var n;function e(){a.ctrlSettings.sessionsLoading=!0;a.data.sessionLog=[];a.data.currentSession={};var b={};g.checkUndefinedNull(a.ctrlSettings.sessionsLogDaterange.startDate)||(b.fromDate=moment(a.ctrlSettings.sessionsLogDaterange.startDate).format(t.systemDateFormat));g.checkUndefinedNull(a.ctrlSettings.sessionsLogDaterange.endDate)||(b.toDate=
moment(a.ctrlSettings.sessionsLogDaterange.endDate).format(t.systemDateFormat));!g.checkUndefinedNull(a.selectedObjects)&&angular.isArray(a.selectedObjects)&&0<a.selectedObjects.length&&(b.contObjectIds=a.selectedObjects);m.$broadcast("logSvc:requestSessionsLoading",{params:b})}function c(b){k.get(a.ctrlSettings.groupUrl+"/"+b.id+"/contObject").then(function(a){b.objects=a.data})}function f(){a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.selectedObjects=[];a.objects=angular.copy(a.objectsInWindow);
a.objects.map(function(b){b.selected&&a.selectedObjects.push(b.id)});0==a.selectedObjects.length?(a.selectedObjects_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllObjects=!0):(a.selectedObjects_list.caption=a.selectedObjects.length,a.states.isSelectedAllObjects=!1)}function r(){a.selectedObjects_list.caption="";a.selectedGroups=[];a.selectedObjects=[];a.groups=angular.copy(a.objectsInWindow);var b=a.joinObjectsFromSelectedGroups(a.groups);l.sortObjectsByFullName(b);a.deleteDoublesObjects(b);
a.addUniqueObjectsFromGroupsToSelectedObjects(b,a.selectedObjects);b=a.selectedObjects.map(function(a){return a.id});a.selectedObjects=b;a.groups.map(function(b){b.selected&&a.selectedGroups.push(b.id)});0==a.selectedGroups.length?(a.selectedObjects_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllObjects=!0):(a.selectedObjects_list.caption=a.selectedGroups.length,a.states.isSelectedAllObjects=!1)}function q(b){a.ctrlSettings.sessionsLoading=!1;a.ctrlSettings.logLoading=!1;console.log(b);
var c="-1";if(g.checkUndefinedNull(b)||g.checkUndefinedNull(b.data))c="ERR_CONNECTION";g.checkUndefinedNull(b)||g.checkUndefinedNull(b.resultCode)&&(g.checkUndefinedNull(b.data)||g.checkUndefinedNull(b.data.resultCode))||(c=b.resultCode||b.data.resultCode);b=g.getServerErrorByResultCode(c);h.errorInfo(b.caption,b.description)}function v(){var b;n=p.getSessions();a.ctrlSettings.sessionsLoading=!1;if(g.checkUndefinedNull(n)||0==n.length)return a.data.totalSessions=0,a.data.sessionsOnView=[],d(e,3E5),
"Session array is empty";a.data.totalSessions=n.length;g.checkUndefinedNull(a.ctrlSettings.pagination.current)&&(a.ctrlSettings.pagination.current=1);var c=null;g.checkUndefinedNull(a.data.currentSession)||(c=angular.copy(a.data.currentSession));var r=null;if(g.checkUndefinedNull(a.data.sessionsOnView)||0<a.data.sessionsOnView.length)r=angular.copy(a.data.sessionsOnView);a.data.sessionsOnView=n.slice((a.ctrlSettings.pagination.current-1)*a.ctrlSettings.itemPerPage,a.ctrlSettings.pagination.current*
a.ctrlSettings.itemPerPage);!g.checkUndefinedNull(r)&&0<r.length&&r.forEach(function(c){for(b=0;b<a.data.sessionsOnView.length;b+=1)c.id==a.data.sessionsOnView[b].id&&(a.data.sessionsOnView[b].isChildView=c.isChildView)});g.checkUndefinedNull(c)||a.data.sessionsOnView.some(function(b){if(b.id==c.id)return a.loadLogData(b),!0;if(g.checkUndefinedNull(b.childs)||0==b.childs.length)return!1;var e=!1;b.childs.some(function(b){if(b.id==c.id)return a.loadLogData(b),e=!0});return e})}a.messages={};a.ctrlSettings=
{};a.ctrlSettings.itemPerPage=20;a.ctrlSettings.pagination={current:1};a.ctrlSettings.sessionsUrl="../api/rma/logSessions";a.ctrlSettings.groupUrl="../api/subscr/contGroup";a.ctrlSettings.showObjectsFlag=!0;a.ctrlSettings.daterangeOpts=g.getDateRangeOptions("ru");a.ctrlSettings.daterangeOpts.startDate=moment().startOf("day");a.ctrlSettings.daterangeOpts.endDate=moment().endOf("day");a.ctrlSettings.daterangeOpts.dateLimit={months:1};a.ctrlSettings.sessionsLogDaterange=p.getSessionsLogDaterange();var t=
{systemDateFormat:"YYYY-MM-DD"};a.ctrlSettings.sessionColumns=[{name:"currentStatusColor",caption:"",type:"color",headerClass:"col-xs-1 nmc-td-for-button noPadding"},{name:"dataSource",caption:"\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a",headerClass:"col-xs-2 noPadding",type:"id"},{name:"deviceModel",caption:"\u041c\u043e\u0434\u0435\u043b\u044c",headerClass:"col-xs-1"},{name:"deviceNumber",caption:"\u041d\u043e\u043c\u0435\u0440 \u043f\u0440\u0438\u0431\u043e\u0440\u0430",headerClass:"col-xs-1"},
{name:"startDate",caption:"\u0412\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u0430",headerClass:"col-xs-1 noPadding"},{name:"author",caption:"\u0418\u043d\u0438\u0446\u0438\u0430\u0442\u043e\u0440",headerClass:"col-xs-1"},{name:"currentStatus",caption:"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441",headerClass:"col-xs-1"},{name:"statusMessage",caption:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",headerClass:"col-xs-4"}];a.ctrlSettings.logColumns=
[{name:"stepDateStr",caption:"\u0414\u0430\u0442\u0430-\u0432\u0440\u0435\u043c\u044f",headerClass:"col-xs-2",type:"id"},{name:"stepType",caption:"\u0422\u0438\u043f",headerClass:"col-xs-1"},{name:"stepMessage",caption:"\u0422\u0435\u043a\u0441\u0442",headerClass:"col-xs-7"},{name:"isIncremental",caption:"\u0421\u0447\u0435\u0442\u0447\u0438\u043a",headerClass:"col-xs-1",type:"checkbox"},{name:"sumRows",caption:"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435",headerClass:"col-xs-1"}];a.selectedObjects=
[];a.data={};n=void 0;n=[];a.data.sessionLog=[];a.data.currentSession={};a.states={};a.states.isSelectedAllObjects=!0;a.states.isSelectedAllObjectsInWindow=!0;a.messages.defaultFilterCaption="\u0412\u0441\u0435";a.selectedObjects_list={};a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.toggleChildSessionsView=function(a){a.isChildView=!a.isChildView};a.isSystemuser=function(){return g.isSystemuser()};a.clearObjectFilter=function(){a.objects.forEach(function(a){a.selected=!1});a.groups.forEach(function(a){a.selected=
!1});a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.selectedObjects=[];a.selectedGroups=[];a.states.isSelectedAllObjects=!0;e()};a.selectObjectsClick=function(){a.states.isSelectElement=!1;a.states.isSelectedAllObjectsInWindow=angular.copy(a.states.isSelectedAllObjects);a.objectsInWindow=1==a.ctrlSettings.showObjectsFlag?angular.copy(a.objects):angular.copy(a.groups)};var u=function(b){a.objects=b.data;l.sortObjectsByFullName(a.objects)};a.getObjects=function(){g.isRma()?l.rmaPromise.then(u):
l.promise.then(u)};a.getObjects();a.getGroups=function(){k.get(a.ctrlSettings.groupUrl).then(function(b){b=b.data;b.forEach(function(a){c(a)});g.sortItemsBy(b,"contGroupName");a.groups=b},function(a){console.log(a)})};a.getGroups();a.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};a.deleteDoublesObjects=function(a){for(var b=a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&a.splice(b,1)};a.addUniqueObjectsFromGroupsToSelectedObjects=
function(a,b){var c,e;for(c=0;c<a.length;c+=1){var d=!0;for(e=0;e<b.length;e+=1)if(a[c].fullName===b[e].fullName){d=!1;break}d&&b.push(a[c])}};a.selectObjects=function(){var b=document.getElementsByClassName("btn-group open");g.checkUndefinedNull(b)||0==b.length||b[0].classList.remove("open");a.states.isSelectElement=!1;1==a.ctrlSettings.showObjectsFlag?f():r();e()};a.pageChanged=function(b){a.ctrlSettings.pagination.current=b;a.data.sessionsOnView=n.slice((a.ctrlSettings.pagination.current-1)*a.ctrlSettings.itemPerPage,
a.ctrlSettings.pagination.current*a.ctrlSettings.itemPerPage)};a.isDisabledFilters=function(){return a.ctrlSettings.sessionsLoading||a.ctrlSettings.logLoading};a.$on("$destroy",function(){b.heightLogUpperPart=$("#log-upper-part > .rui-resizable-content").height();b.heightLogFooterPart=$("#log-footer-part > .rui-resizable-content").height();m.$broadcast("logSvc:cancelInterval")});$(document).ready(function(){$("#log-upper-part > .rui-resizable-handle").on("click",function(){document.cookie="heightLogUpperPart="+
$("#log-upper-part > .rui-resizable-content").height()});$("#log-footer-part > .rui-resizable-handle").on("click",function(){document.cookie="heightLogFooterPart="+$("#log-footer-part > .rui-resizable-content").height()});$("#object-toggle-view").bootstrapToggle();$("#object-toggle-view").change(function(){a.ctrlSettings.showObjectsFlag=!!$(this).prop("checked");a.$apply();a.selectObjectsClick();if(a.selectedObjects_list.caption==a.messages.defaultFilterCaption)return"Object / group filter. No changes";
a.clearObjectFilter()})});a.selectAllElements=function(b){a.states.isSelectElement=!0;b.forEach(function(a){a.selected=!1})};a.selectElement=function(b){a.states.isSelectElement=!0;return a.states[b]=!1};a.isFilterApplyDisabled=function(a,b){return g.checkUndefinedNull(a)||!angular.isArray(a)||1==b?!1:!a.some(function(a){if(1==a.selected)return!0})};a.loadSessionsData=function(){e()};a.$on("logSvc:sessionsLoaded",function(){v()});a.loadLogData=function(b){a.data.currentSession.selected=!1;b.selected=
!0;a.ctrlSettings.logLoading=!0;a.data.currentSession=b;k.get(a.ctrlSettings.sessionsUrl+"/"+b.id+"/steps").then(function(b){a.data.sessionLog=b.data;a.ctrlSettings.logLoading=!1},q)};a.$watch("ctrlSettings.sessionsLogDaterange",function(a,b){b!=a&&e()});a.$watch("ctrlSettings.itemPerPage",function(b,c){b!=c&&a.pageChanged(1)});a.checkEmptyObject=function(a){return g.checkEmptyObject(a)};(function(){e();d(function(){$("#log-upper-part > .rui-resizable-content").height(Number(b.heightLogUpperPart));
$("#log-footer-part > .rui-resizable-content").height(Number(b.heightLogFooterPart))})})()}]);app=angular.module("portalNMC");
app.controller("MainCtrl",["$scope","$rootScope","$cookies","$location","mainSvc","notificationFactory","$http","objectSvc","reportSvc","monitorSvc","logSvc",function(a,b,d,g,l,k,h,p,m,n,e){function c(a){console.log(a);k.errorInfo("\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c!","\u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u0442\u0435\u043a\u0443\u0449\u0435\u0433\u043e \u043f\u0430\u0440\u043e\u043b\u044f.")}function f(b){if(l.checkUndefinedNull(b))return!1;
var c=!0;a.emptyString(b.oldPassword)&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u0435 "\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u043f\u0430\u0440\u043e\u043b\u044c" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),c=!1);a.emptyString(b.newPassword)&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c!"),
c=!1);b.newPassword!==b.newPasswordConfirm&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u044f "\u041f\u0430\u0440\u043e\u043b\u044c" \u0438 "\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f" \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442!'),c=!1);return c}a.mainCtrlSettings={};a.mainCtrlSettings.showFullMenuFlag=!0;a.mainCtrlSettings.loadingServicePermissionFlag=l.getLoadingServicePermissionFlag();
a.mainCtrlSettings.ctxId="nmc_main";a.data={};a.showPrivateOfficeMenu=!1;b.showIndicatorsParam=!1;a.setMenuVisibles=function(c,e){a.showPrivateOfficeMenu=c;b.showIndicatorsParam=e};b.timeDetailType="1h";a.menuMassive={};a.clickMenu=function(b){Object.keys(a.menuMassive).forEach(function(b){a.menuMassive[b]=!1});a.menuMassive[b]=!0};a.setDefaultMenuState=function(){Object.keys(a.menuMassive).forEach(function(b){a.menuMassive[b]=!1});a.menuMassive.object_menu_item=!0};$(window).bind("beforeunload",
function(){a.setDefaultMenuState()});a.logOut=function(){p.getRequestCanceler().resolve();l.getRequestCanceler().resolve();m.getRequestCanceler().resolve();n.getRequestCanceler().resolve();e.getRequestCanceler().resolve();a.setDefaultMenuState()};(function(){var b=g.path(),c=!1,e=null;a.menuMassive.object_menu_item=-1!==b.indexOf("/objects/list")?!0:!1;a.menuMassive.report_menu_item="/reports"===b?!0:!1;a.menuMassive.object_menu_item=-1!==b.indexOf("/notices/")?!0:!1;a.menuMassive.setting_menu_item=
-1!==b.indexOf("/settings/")?!0:!1;a.menuMassive.admin_menu_item=-1!==b.indexOf("/management/")?!0:!1;a.menuMassive.log_menu_item=-1!==b.indexOf("/log")?!0:!1;a.menuMassive.test_menu_item=-1!==b.indexOf("/test")?!0:!1;e=Object.keys(a.menuMassive);e.some(function(b){return!1===a.menuMassive[b]?!1:c=!0});c||a.setDefaultMenuState();""===g.path()&&(a.menuMassive.object_menu_item&&window.location.assign("#/"),a.menuMassive.report_menu_item&&window.location.assign("#/reports/"),a.menuMassive.setting_menu_item&&
window.location.assign("#/settings/tariffs/"),a.menuMassive.admin_menu_item&&window.location.assign("#/management/objects/"),a.menuMassive.log_menu_item&&window.location.assign("#/log/"),a.menuMassive.test_menu_item&&window.location.assign("#/test/"))})();var r=function(a){l.getContextIds().forEach(function(a){var b=document.getElementById(a.permissionTagId);angular.isUndefined(b)||null===b||$("#"+a.permissionTagId).removeClass("nmc-hide")})};r(a.mainCtrlSettings.ctxId);b.$on("servicePermissions:loaded",
function(){r(a.mainCtrlSettings.ctxId)});a.isRma=function(){return l.isRma()};a.isCabinet=function(){return l.isCabinet()};a.getCtx=function(){return b.ctxId};a.emptyString=function(a){return l.checkUndefinedEmptyNullValue(a)};a.isTestMode=function(){return l.isTestMode()};a.changePasswordInit=function(){a.data.userInfo=angular.copy(b.userInfo)};a.checkPasswordFields=function(b){if(l.checkUndefinedNull(b))return!1;var c=!0;a.emptyString(b.oldPassword)&&(c=!1);a.emptyString(b.newPassword)&&(c=!1);
b.newPassword!==b.newPasswordConfirm&&(c=!1);return c};a.changeUserPassword=function(a){if(!1===f(a))return"Password is incorrect!";h({method:"PUT",url:"../api/systemInfo/passwordChange",params:{oldPassword:a.oldPassword,newPassword:a.newPassword}}).then(function(){k.success();$("#changePasswordModal").modal("hide")},c)}}]);app=angular.module("portalNMC");
app.controller("MngmtClientsCtrl",["$rootScope","$scope","$http","objectSvc","notificationFactory","crudGridDataFactory","mainSvc",function(a,b,d,g,l,k,h){a.ctxId="management_rma_clients_page";b.extraProps={idColumnName:"id",defaultOrderBy:"subscriberName",nameColumnName:"subscriberName"};b.orderBy={field:b.extraProps.defaultOrderBy,asc:!0};b.ctrlSettings={};b.ctrlSettings.rmaUrl="../api/rma";b.ctrlSettings.clientsUrl="../api/rma/subscribers";b.ctrlSettings.orgUrl=b.ctrlSettings.clientsUrl+"/organizations";
b.ctrlSettings.availableObjectsSuffix="/availableContObjects";b.ctrlSettings.subscrObjectsSuffix="/subscrContObjects";b.ctrlSettings.groupUrl="../api/subscr/contGroup";b.headers={};b.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b";b.ctrlSettings.clientColumns=[{name:"subscriberName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-md-3"},{name:"info",caption:"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f",
"class":"col-md-3"},{name:"comment",caption:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439","class":"col-md-2"},{name:"organizationName",caption:"\u041e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f","class":"col-md-2"}];b.data={};b.data.organizations=[];b.data.clients=[];b.data.currentClient={};var p=function(){d.get(b.ctrlSettings.clientsUrl).then(function(a){if(h.checkUndefinedNull(a)||h.checkUndefinedNull(a.data)||!angular.isArray(a.data))return!1;a.data.forEach(function(a){if(h.checkUndefinedNull(a.organization))return!1;
a.organizationName=a.organization.organizationFullName||a.organization.organizationName});b.data.clients=a.data},function(a){console.log(a)})},m=function(){d.get(b.ctrlSettings.orgUrl).then(function(a){b.data.organizations=a.data;h.sortOrganizationsByName(b.data.organizations);p()},function(a){console.log(a)})};b.selectClient=function(a){b.data.currentClient=a};b.selectedItem=function(a){a=angular.copy(a);b.data.currentClient=a};b.editObjectList=function(a){b.selectedItem(a);b.getAvailableObjects(b.data.currentClient.id);
b.getSelectedObjects(b.data.currentClient.id);b.showAvailableObjects_flag=!1};b.addClient=function(){b.data.currentClient={};$("#showClientOptionModal").modal()};b.setOrderBy=function(a){b.orderBy={field:a,asc:b.orderBy.field===a?!b.orderBy.asc:!0}};(function(){g.getTimezones().then(function(a){b.data.timezones=a.data;m()})})();var n=function(a,b){l.success();$("#deleteClientModal").modal("hide");$("#showClientOptionModal").modal("hide");$("#showObjectListModal").modal("hide");p()},e=function(b){l.success();
$("#showObjectListModal").modal("hide");a.$broadcast("objectSvc:requestReloadData")},c=function(a){a=h.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)};b.sendClientToServer=function(a){var c=!0;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.subscriberName)||null==a.subscriberName||""==a.subscriberName)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u0430!"),
c=!1;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.organizationId)||null==a.organizationId)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u0430!"),c=!1;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.timezoneDefKeyname)||null==a.timezoneDefKeyname)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0447\u0430\u0441\u043e\u0432\u043e\u0439 \u043f\u043e\u044f\u0441 \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u0430!"),
c=!1;0!=c&&(c=b.ctrlSettings.clientsUrl,angular.isDefined(a.id)&&null!=a.id?b.updateObject(c,a):b.saveNewClient(c,a))};b.saveNewClient=function(a,b){k(a).save(b,n,c)};b.deleteObject=function(a){k(b.ctrlSettings.clientsUrl)["delete"]({id:a[b.extraProps.idColumnName]},n,c)};b.updateObject=function(a,e){var d={id:e[b.extraProps.idColumnName]};k(a).update(d,e,n,c)};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=h.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.availableObjects=
[];b.availableObjectGroups=[];b.selectedObjects=[];b.getAvailableObjects=function(a){k(b.ctrlSettings.rmaUrl+"/"+a+b.ctrlSettings.availableObjectsSuffix).query(function(a){b.availableObjects=a;g.sortObjectsByFullName(b.availableObjects)})};b.getSelectedObjects=function(){k(b.ctrlSettings.rmaUrl+"/"+b.data.currentClient.id+b.ctrlSettings.subscrObjectsSuffix).query(function(a){b.selectedObjects=a;g.sortObjectsByFullName(b.selectedObjects)})};b.getGroupObjects=function(a){k(b.ctrlSettings.groupUrl+"/"+
a.id+"/contObject").query(function(b){a.objects=b})};b.getAvailableObjectGroups=function(){k(b.ctrlSettings.groupUrl).query(function(a){a.forEach(function(a){b.getGroupObjects(a)});b.availableObjectGroups=a})};b.getAvailableObjectGroups();b.viewAvailableObjects=function(a){b.showAvailableObjects_flag=!b.showAvailableObjects_flag;(b.showAvailableObjectGroups_flag=a)?(b.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",
b.availableEntities=b.availableObjectGroups):(b.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b",b.availableEntities=b.availableObjects)};var f=function(a,c){var e={},d=[],f=[],r=[],n;b.addObject_flag?(d=b.availableObjects,r=f=b.selectedObjects):(f=b.availableObjects,r=d=b.selectedObjects);for(n=0;n<d.length;n+=1)if(d[n].id==b.currentObjectId){e=angular.copy(d[n]);e.selected=!1;d.splice(n,1);break}f.push(e);return r.map(function(a){return a.id})};
b.addObject=function(a){b.addObject_flag=!0;b.currentObjectId=a.id;f(!0,a.id)};b.removeObject=function(a){b.addObject_flag=!1;b.currentObjectId=a.id;f(!1,a.id)};b.removeSelectedObject=function(a){b.availableObjects.push(a);b.selectedObjects.splice(b.selectedObjects.indexOf(a),1);g.sortObjectsByFullName(b.availableObjects)};b.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};b.deleteDoublesObjects=function(a){for(var b=
a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&a.splice(b,1)};b.addUniqueObjectsFromGroupsToSelectedObjects=function(a,b){var c,e;for(c=0;c<a.length;c+=1){var d=!0;for(e=0;e<b.length;e+=1)if(a[c].fullName===b[e].fullName){d=!1;break}d&&b.push(a[c])}};b.removeGroupObjectsFromAvailableObjects=function(a,b){var c,e;for(c=0;c<a.length;c+=1){var d=-1;for(e=0;e<b.length;e+=1)if(a[c].fullName===b[e].fullName){d=e;break}0<=d&&b.splice(d,1)}};b.selectAllAvailableEntities=function(){var a;for(a=0;a<b.availableEntities.length;a+=
1)b.availableEntities[a].selected=b.ctrlSettings.selectedAll;b.ctrlSettings.selectedAll=!1};b.addSelectedEntities=function(){if(b.showAvailableObjectGroups_flag){var a=b.joinObjectsFromSelectedGroups(b.availableEntities);g.sortObjectsByFullName(a);b.deleteDoublesObjects(a);b.addUniqueObjectsFromGroupsToSelectedObjects(a,b.selectedObjects);b.removeGroupObjectsFromAvailableObjects(a,b.availableObjects)}var a=angular.copy(b.availableObjects),c;for(c=0;c<b.availableObjects.length;c+=1){var e=b.availableObjects[c];
if(e.selected){var d=angular.copy(e);d.selected=null;var f=-1;a.some(function(a,b,c){if(a.fullName===e.fullName)return f=b,!0});a.splice(f,1);b.selectedObjects.push(d);e.selected=null}}b.availableObjects=a;g.sortObjectsByFullName(b.selectedObjects);b.availableEntities=b.showAvailableObjectGroups_flag?b.availableObjectGroups:b.availableObjects};b.showAddObjectButton=function(){return!b.showAvailableObjects_flag};b.saveObject=function(){var a=b.selectedObjects.map(function(a){return a.id});null!=b.data.currentClient.id&&
"undefined"!=typeof b.data.currentClient.id&&d.put(b.ctrlSettings.rmaUrl+"/"+b.data.currentClient.id+b.ctrlSettings.subscrObjectsSuffix,a).then(e,c)};b.isSystemuser=function(){return h.isSystemuser()};b.isTestMode=function(){return h.isTestMode()}}]);app=angular.module("portalNMC");
app.controller("MngmtDatasourcesCtrl",["$rootScope","$scope","$http","mainSvc","notificationFactory",function(a,b,d,g,l){function k(a){if(0==b.data.rawModemModels.length)return null;var e=null;b.data.rawModemModels.some(function(b){if(b.id==a)return e=b,!0});return e}a.ctxId="management_rma_data_sources_page";b.ctrlSettings={};b.ctrlSettings.subscrUrl="../api/rma";b.ctrlSettings.datasourcesUrl=b.ctrlSettings.subscrUrl+"/dataSources";b.ctrlSettings.datasourceTypesUrl=b.ctrlSettings.subscrUrl+"/dataSourceTypes";
b.ctrlSettings.rawModemModelsUrl=b.ctrlSettings.subscrUrl+"/dataSources/rawModemModels";b.ctrlSettings.DEVICE_MODES=[{caption:"\u0421\u0435\u0440\u0432\u0435\u0440",keyname:"SERVER"},{caption:"\u041a\u043b\u0438\u0435\u043d\u0442",keyname:"CLIENT"}];b.data={};b.data.dataSources=[];b.data.dataSourcesTypes=[];b.data.rawModemModels=[];b.data.currentObject={};(function(a){d.get(a).then(function(a){b.data.dataSourcesTypes=a.data},function(a){console.log(a)})})(b.ctrlSettings.datasourceTypesUrl);var h=
function(a){d.get(a).then(function(a){b.data.dataSources=a.data;g.sortItemsBy(b.data.dataSources,"dataSourceName")},function(a){console.log(a)})};h(b.ctrlSettings.datasourcesUrl);b.changeModemModel=function(){var a=k(b.data.currentObject.rawModemModelId);b.data.currentObject.rawModemIdentity=a.rawModemModelIdentity;b.data.currentObject.rawModemDialupAvailable=a.isDialup};b.selectedItem=function(a){b.data.currentObject=angular.copy(a);g.checkUndefinedNull(b.data.currentObject.rawTimeout)&&(b.data.currentObject.rawTimeout=
25);g.checkUndefinedNull(b.data.currentObject.rawSleepTime)&&(b.data.currentObject.rawSleepTime=250);g.checkUndefinedNull(b.data.currentObject.rawResendAttempts)&&(b.data.currentObject.rawResendAttempts=3);g.checkUndefinedNull(b.data.currentObject.rawReconnectAttempts)&&(b.data.currentObject.rawReconnectAttempts=1);g.checkUndefinedNull(b.data.currentObject.rawReconnectTimeout)&&(b.data.currentObject.rawReconnectTimeout=60);g.checkUndefinedNull(b.data.currentObject.rawModemIdentity)&&!g.checkUndefinedNull(b.data.currentObject.rawModemModelId)&&
(a=k(b.data.currentObject.rawModemModelId),b.data.currentObject.rawModemIdentity=a.rawModemModelIdentity,b.data.currentObject.rawModemDialupAvailable=a.isDialup)};var p=function(a){a=g.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)};(function(){d.get(b.ctrlSettings.rawModemModelsUrl).then(function(a){b.data.rawModemModels=a.data},p)})();b.addDatasource=function(){b.data.currentObject={};b.data.currentObject.dataSourceTypeKey="DEVICE";b.data.currentObject.rawConnectionType="SERVER";b.data.currentObject.rawTimeout=
25;b.data.currentObject.rawSleepTime=250;b.data.currentObject.rawResendAttempts=3;b.data.currentObject.rawReconnectAttempts=1;b.data.currentObject.rawReconnectTimeout=60;$("#showDatasourceModal").modal()};b.editDatasource=function(a){b.selectedItem(a);$("#showDatasourceModal").modal()};var m=function(a){l.success();h(b.ctrlSettings.datasourcesUrl);$("#showDatasourceModal").modal("hide");$("#deleteObjectModal").modal("hide");b.data.currentObject={};b.data.currentObject.dataSourceTypeKey="DEVICE";b.data.currentObject.rawConnectionType=
"SERVER"};b.saveDatasource=function(a){var e=!0;if(angular.isUndefined(a.dataSourceName)||null===a.dataSourceName||""===a.dataSourceName)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0438\u043c\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445."),e=!1;"MANUAL"!==a.dataSourceTypeKey&&("CLIENT"==a.rawConnectionType||b.checkPositiveNumberValue(a.dataSourcePort)||(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043f\u043e\u0440\u0442 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445."),e=!1),"CLIENT"==a.rawConnectionType||!angular.isUndefined(a.dataSourceIp)&&null!==a.dataSourceIp&&""!==a.dataSourceIp||(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d ip \\ hostname \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430 \u0434\u0430\u043d\u043d\u044b\u0445."),
e=!1),"DEVICE"==a.dataSourceTypeKey&&(""==a.rawTimeout?(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430."),e=!1):(a.rawTimeout=Number(a.rawTimeout),b.checkPositiveNumberValue(a.rawTimeout)||(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u0432\u0440\u0435\u043c\u044f \u043e\u0436\u0438\u0434\u0430\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430."),
e=!1)),""==a.rawSleepTime?(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430."),e=!1):(a.rawSleepTime=Number(a.rawSleepTime),b.checkPositiveNumberValue(a.rawSleepTime)||(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b \u043f\u0440\u043e\u0432\u0435\u0440\u043a\u0438 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u043e\u0442\u0432\u0435\u0442\u0430."),e=!1)),""==a.rawResendAttempts?(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u043f\u044b\u0442\u043e\u043a \u043f\u0435\u0440\u0435\u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u0430\u043a\u0435\u0442\u0430."),
e=!1):(a.rawResendAttempts=Number(a.rawResendAttempts),b.checkPositiveNumberValue(a.rawResendAttempts)||(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u043f\u044b\u0442\u043e\u043a \u043f\u0435\u0440\u0435\u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u043f\u0430\u043a\u0435\u0442\u0430."),e=!1)),""==a.rawReconnectAttempts?
(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u043e\u0448\u0438\u0431\u043a\u0438."),e=!1):(a.rawReconnectAttempts=Number(a.rawReconnectAttempts),b.checkPositiveNumberValue(a.rawReconnectAttempts)||
(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u0439 \u0432 \u0441\u043b\u0443\u0447\u0430\u0435 \u043e\u0448\u0438\u0431\u043a\u0438."),e=!1)),""==a.rawReconnectTimeout?(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u0430\u0443\u0437\u0430 \u043c\u0435\u0436\u0434\u0443 \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f\u043c\u0438."),
e=!1):(a.rawReconnectTimeout=Number(a.rawReconnectTimeout),b.checkPositiveNumberValue(a.rawReconnectTimeout)||(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u0430\u0443\u0437\u0430 \u043c\u0435\u0436\u0434\u0443 \u043f\u0435\u0440\u0435\u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f\u043c\u0438."),e=!1))),"DEVICE"==a.dataSourceTypeKey&&"CLIENT"==a.rawConnectionType&&
g.checkUndefinedNull(a.rawModemModelId)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043c\u043e\u0434\u0435\u043b\u044c \u043c\u043e\u0434\u0435\u043c\u0430"),e=!1),"DEVICE"==a.dataSourceTypeKey&&"CLIENT"==a.rawConnectionType&&1==a.rawModemDialEnable&&(g.checkUndefinedNull(a.rawModemDialTel)||10>a.rawModemDialTel.length)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u043c\u043e\u0434\u0435\u043c\u0430"),
e=!1),"DEVICE"!=a.dataSourceTypeKey||"CLIENT"!=a.rawConnectionType||"SERIAL_NR"!=a.rawModemIdentity||!g.checkUndefinedNull(a.rawModemSerial)&&0!=a.rawModemSerial.length||(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u0441\u0435\u0440\u0438\u0439\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u043c\u043e\u0434\u0435\u043c\u0430"),e=!1),"DEVICE"!=a.dataSourceTypeKey||"CLIENT"!=a.rawConnectionType||
"MAC_ADDR"!=a.rawModemIdentity||!g.checkUndefinedNull(a.rawModemMacAddr)&&0!=a.rawModemMacAddr.length||(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d MAC-\u0430\u0434\u0440\u0435\u0441 \u043c\u043e\u0434\u0435\u043c\u0430"),e=!1),"DEVICE"!=a.dataSourceTypeKey||"CLIENT"!=a.rawConnectionType||"IMEI"!=a.rawModemIdentity||!g.checkUndefinedNull(a.rawModemImei)&&0!=a.rawModemImei.length||(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d IMEI \u043c\u043e\u0434\u0435\u043c\u0430"),e=!1));!1!==e&&(e=b.ctrlSettings.datasourcesUrl,angular.isDefined(a.id)&&null!=a.id?(e=e+"/"+a.id,d.put(e,a).then(m,p)):d.post(e,a).then(m,p))};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=g.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.deleteObject=function(a){d["delete"](b.ctrlSettings.datasourcesUrl+"/"+a.id).then(m,
p)};b.isSystemuser=function(){return g.isSystemuser()};b.isTestMode=function(){return g.isTestMode()};b.checkNumericValue=function(a){return g.checkNumericValue(a)};b.checkPositiveNumberValue=function(a){return g.checkPositiveNumberValue(a)};$("#showDatasourceModal").on("shown.bs.modal",function(){$("#inputDataSourceMode").focus();$("#inputDSTimeout").inputmask();$("#inputDSCheckInterval").inputmask();$("#inputDSRepeatCount").inputmask();$("#inputDSReconnectionCount").inputmask();$("#inputDSReconnectionInterval").inputmask()});
$("#showDatasourceModal").on("hidden.bs.modal",function(){var a;a=document.getElementById("con_properties_tab");g.checkUndefinedNull(a)||a.classList.remove("active");a=document.getElementById("con_properties");g.checkUndefinedNull(a)||a.classList.remove("active");a=document.getElementById("ex_properties_tab");g.checkUndefinedNull(a)||a.classList.remove("active");a=document.getElementById("ex_properties");g.checkUndefinedNull(a)||a.classList.remove("active");a=document.getElementById("main_properties_tab");
g.checkUndefinedNull(a)||a.classList.add("active");a=document.getElementById("main_properties");g.checkUndefinedNull(a)||(a.classList.add("in"),a.classList.add("active"))})}]);app=angular.module("portalNMC");
app.controller("MngmtDeviceModelsCtrl",["$rootScope","$scope","$http","objectSvc","notificationFactory","crudGridDataFactory","mainSvc",function(a,b,d,g,l,k,h){a.ctxId="management_rma_device_models_page";b.extraProps={idColumnName:"id",defaultOrderBy:"modelName",nameColumnName:"modelName"};b.orderBy={field:b.extraProps.defaultOrderBy,asc:!0};b.ctrlSettings={};b.ctrlSettings.rmaUrl="../api/rma";b.ctrlSettings.modelsUrl=b.ctrlSettings.rmaUrl+"/deviceObjects/deviceModels";b.headers={};b.ctrlSettings.modelColumns=
[{name:"modelName",caption:"modelName","class":"col-xs-3",type:"name"},{name:"caption",caption:"Caption","class":"col-xs-3"},{name:"keyname",caption:"Keyname","class":"col-xs-1"},{name:"exCode",caption:"exCode","class":"col-xs-1"},{name:"exLabel",caption:"exLabel","class":"col-xs-1"},{name:"exSystem",caption:"exSystem","class":"col-xs-1"},{name:"isImpulse",caption:"isImpulse","class":"col-xs-1",type:"checkbox"}];b.data={};b.data.models=[];b.data.currentModel={};b.data.modemTypes=[{keyname:"GPRS-MODEM",
caption:"GPRS-\u043c\u043e\u0434\u0435\u043c"},{keyname:"ETHERNET-CONVERTER",caption:"Ethernet-\u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0435\u0440"}];var p=function(){d.get(b.ctrlSettings.modelsUrl).then(function(a){!h.checkUndefinedNull(a.data)&&angular.isArray(a.data)&&0<a.data.length&&(b.data.models=a.data)},function(a){console.log(a)})};b.selectModel=function(a){b.data.currentModel=a};b.selectedItem=function(a){a=angular.copy(a);b.data.currentModel=a};b.addModel=function(){b.data.currentModel=
{};$("#showModelOptionModal").modal()};b.setOrderBy=function(a){b.orderBy={field:a,asc:b.orderBy.field===a?!b.orderBy.asc:!0}};var m=function(a,b){l.success();$("#deleteModelModal").modal("hide");$("#showModelOptionModal").modal("hide");p()},n=function(a){a=h.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)};b.sendModelToServer=function(a){var c=!0;if(angular.isUndefined(a)||null===a||angular.isUndefined(a.modelName)||null===a.modelName||""===a.modelName)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043c\u043e\u0434\u0435\u043b\u0438!"),c=!1;!1!==c&&(c=b.ctrlSettings.modelsUrl,angular.isDefined(a.id)&&null!=a.id?b.updateObject(c,a):b.saveNewModel(c,a))};b.saveNewModel=function(a,b){k(a).save(b,m,n)};b.deleteObject=function(a){k(b.ctrlSettings.modelsUrl)["delete"]({id:a[b.extraProps.idColumnName]},m,n)};b.updateObject=function(a,c){var e={id:c[b.extraProps.idColumnName]};k(a).update(e,c,m,n)};
b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=h.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.isSystemuser=function(){return h.isSystemuser()};b.data.measures=g.getDeviceMetadataMeasures();b.$on("objectSvc:deviceMetadataMeasuresLoaded",function(){b.data.measures=g.getDeviceMetadataMeasures()});b.initCtrl=function(){p()};b.initCtrl()}]);app=angular.module("portalNMC");
app.controller("MngmtDevicesCtrl",["$rootScope","$scope","$http","$timeout","objectSvc","notificationFactory","mainSvc","$interval","logSvc","$cookies",function(a,b,d,g,l,k,h,p,m,n){function e(a){b.data.deviceModalWindowTabs.forEach(function(b){var c,e;c=document.getElementById(b.name)||null;e=document.getElementById(b.tabpanel)||null;0!==b.name.localeCompare(a)?(c.classList.remove("active"),e.classList.remove("active")):(c.classList.add("active"),e.classList.add("in"),e.classList.add("active"))})}
function c(a){if(angular.isUndefined(a)||null===a||!angular.isArray(a))return!1;a.sort(function(a,b){return a.contObjectInfo.fullName.toUpperCase()>b.contObjectInfo.fullName.toUpperCase()?1:a.contObjectInfo.fullName.toUpperCase()<b.contObjectInfo.fullName.toUpperCase()?-1:0})}function f(a){var c=null;if(h.checkUndefinedNull(b.data.deviceModels)||!angular.isArray(b.data.deviceModels))return c;b.data.deviceModels.some(function(b){if(b.id===a)return c=b,!0});return c}function r(a,b){return h.checkUndefinedNull(a)||
!0!==a.isImpulse||!0===b.dataSourceType.isRaw?!0:(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u0412\u044b\u0431\u0440\u0430\u043d\u043d\u044b\u0439 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0435 \u043f\u043e\u0434\u0434\u0435\u0440\u0436\u0438\u0432\u0430\u0435\u0442 \u0440\u0430\u0431\u043e\u0442\u0443 \u0441 \u0438\u043c\u043f\u0443\u043b\u044c\u0441\u043d\u044b\u043c\u0438 \u043f\u0440\u0438\u0431\u043e\u0440\u0430\u043c\u0438"),!1)}
function q(){var a=!0;if(h.checkUndefinedNull(b.data.currentObject)||h.checkUndefinedNull(b.data.currentObject.id))a=!1,k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043f\u0440\u0438\u0431\u043e\u0440.");h.checkUndefinedNull(b.ctrlSettings.dataLoadDaterange.startDate)&&(a=!1,k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0447\u0430\u043b\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430."));
h.checkUndefinedNull(b.ctrlSettings.dataLoadDaterange.endDate)&&(a=!1,k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043a\u043e\u043d\u0435\u0446 \u043f\u0435\u0440\u0438\u043e\u0434\u0430."));b.ctrlSettings.dataLoadDaterange.endDate<b.ctrlSettings.dataLoadDaterange.startDate&&(a=!1,k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u044b \u0433\u0440\u0430\u043d\u0438\u0446\u044b \u043f\u0435\u0440\u0438\u043e\u0434\u0430."));
var c=!1;b.data.detailTypes.some(function(a){if(!0===a.selected)return c=!0});!1===c&&(a=!1,k.warning("\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430 \u0437\u0430\u0433\u0440\u0443\u0436\u0430\u0435\u043c\u044b\u0445 \u0434\u0430\u043d\u043d\u044b\u0445. \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0437\u0430\u043f\u0443\u0449\u0435\u043d\u0430."));return a}function v(a){b.ctrlSettings.dataIsLoaded=
!1;if(h.checkUndefinedNull(a)||0===a.length)return!1;var c=0;a.forEach(function(a){-1!==C.indexOf(a.currentStatus)&&(c+=1)});c===a.length&&(b.ctrlSettings.dataIsLoaded=!0)}function t(){b.ctrlSettings.sessionsLoading=!0;d.get("../api/rma/subscrSessionTask/"+b.data.currentSessionTask.id+"/logSessions").then(function(a){b.ctrlSettings.sessionsLoading=!1;if(h.checkUndefinedNull(a.data)||0===a.data.length)return"Session array is empty";var c=null;h.checkUndefinedNull(b.data.currentSession)||h.checkEmptyObject(b.data.currentSession)||
(c=angular.copy(b.data.currentSession));b.data.sessionsOnView=m.serverDataParser(angular.copy(a.data));v(b.data.sessionsOnView);if(h.checkUndefinedNull(c)||h.checkEmptyObject(c))b.data.currentSession=b.data.sessionsOnView[0],c=angular.copy(b.data.currentSession);h.checkUndefinedNull(c)||h.checkEmptyObject(c)||b.data.sessionsOnView.some(function(a){a.id===c.id&&b.loadLogData(a)})},D)}function u(){d.get("../api/rma/subscrSessionTask/"+b.data.currentSessionTask.id).then(function(a){b.data.currentSessionTask=
a.data},z)}function w(){u();t()}function x(a){d.get("../api/rma/subscrSessionTask/contZPointSessionDetailType/byDeviceObject/"+a.id).then(function(a){if(h.checkUndefinedNull(a)||h.checkUndefinedNull(a.data))return console.log("Session detail type is empty."),"Session detail type is empty.";b.data.sessionDetailType=a.data},z)}function E(a){d.get("../api/rma/subscrSessionTask/sessionDetailTypes/byDeviceObject/"+a.id).then(function(a){if(h.checkUndefinedNull(a)||h.checkUndefinedNull(a.data))return console.log("Session detail type is empty."),
"Session detail type is empty.";b.data.detailTypes=angular.copy(a.data)},z)}a.ctxId="management_rma_devices_page";var G=null;b.ctrlSettings={};b.ctrlSettings.datasourcesUrl=l.getDatasourcesUrl();b.ctrlSettings.loading=!0;b.ctrlSettings.userDateFormat="DD.MM.YYYY";b.ctrlSettings.sessionsUrl="../api/rma/logSessions";b.ctrlSettings.sessionColumns=[{name:"currentStatusColor",caption:"",type:"color",headerClass:"col-xs-1 col-md-1 nmc-td-for-button noPadding"},{name:"startDate",caption:"\u0412\u0440\u0435\u043c\u044f \u043d\u0430\u0447\u0430\u043b\u0430",
headerClass:"col-xs-2 col-md-2 noPadding"},{name:"endDate",caption:"\u0412\u0440\u0435\u043c\u044f \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f",headerClass:"col-xs-2 col-md-2 noPadding"},{name:"currentStatus",caption:"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0441\u0442\u0430\u0442\u0443\u0441",headerClass:"col-xs-1 col-md-1"},{name:"statusMessage",caption:"\u0421\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435",headerClass:"col-xs-5 col-md-5"}];var C=["COMPLETE","COMPLETE WITH ERROR",
"FAILURE"];b.ctrlSettings.logColumns=[{name:"stepDateStr",caption:"\u0414\u0430\u0442\u0430-\u0432\u0440\u0435\u043c\u044f",headerClass:"col-xs-2 col-md-2",type:"id"},{name:"stepType",caption:"\u0422\u0438\u043f",headerClass:"col-xs-1 col-md-1"},{name:"stepMessage",caption:"\u0422\u0435\u043a\u0441\u0442",headerClass:"col-xs-7 col-md-7"},{name:"isIncremental",caption:"\u0421\u0447\u0435\u0442\u0447\u0438\u043a",headerClass:"col-xs-1 col-md-1",type:"checkbox"},{name:"sumRows",caption:"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435",
headerClass:"col-xs-1 col-md-1"}];b.ctrlSettings.deviceColumns=[{name:"deviceContObjectCaption",caption:"\u041e\u0431\u044a\u0435\u043a\u0442",headerClass:"col-xs-4 col-md-4"},{name:"deviceModelCaption",caption:"\u041c\u043e\u0434\u0435\u043b\u044c",headerClass:"col-xs-1 col-md-1"},{name:"number",caption:"s/n",headerClass:"col-xs-2 col-md-2"},{name:"deviceDatasourceCaption",caption:"\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445",headerClass:"col-xs-3 col-md-3"},
{name:"deviceTimeOffsetString",caption:"\u0420\u0430\u0441\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u0438",headerClass:"col-xs-2 col-md-2"}];b.ctrlSettings.daterangeOpts=h.getDateRangeOptions("ru");b.ctrlSettings.daterangeOpts.startDate=moment().startOf("day");b.ctrlSettings.daterangeOpts.endDate=moment().endOf("day");b.ctrlSettings.dataLoadDaterange={startDate:moment().startOf("day"),endDate:moment().endOf("day")};b.data={};b.data.dataSources=[];b.data.objects=
[];b.data.devices=[];b.data.deviceModels=[];b.data.deviceModelTypes=[];b.data.impulseCounterTypes=[];b.data.currentObject={};b.data.currentScheduler={};b.data.currentSession={};b.data.metadataSchema=[{header:"\u041f\u043e\u043b\u0435 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a",headClass:"col-xs-2 col-md-2",name:"srcProp",type:"input/text"},{header:"\u041f\u043e\u043b\u0435 \u043f\u0440\u0438\u0435\u043c\u043d\u0438\u043a",headClass:"col-xs-2 col-md-2",name:"destProp",type:"input/text"},{header:"\u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f",
headClass:"col-xs-1 col-md-1",name:"srcMeasureUnit",type:"select",disabled:!1}];b.data.deviceModalWindowTabs=[{name:"main_properties_tab",tabpanel:"main_properties"},{name:"con_properties_tab",tabpanel:"con_properties"},{name:"time_properties_tab",tabpanel:"time_properties"}];var A=function(){e("main_properties_tab")},z=function(a){a=h.errorCallbackHandler(a);k.errorInfo(a.caption,a.description)},H=function(a){k.success();b.getDevices();$("#showDeviceModal").modal("hide");$("#deleteObjectModal").modal("hide");
$("#scheduleEditorModal").modal("hide");b.data.currentObject={};b.data.currentScheduler={}},D=function(a){z(a);b.data.currentObject.isSaving=!1;b.data.currentScheduler.isSaving=!1;b.ctrlSettings.sessionsLoading=!1};b.getDevices=function(){l.getAllDevices().then(function(a){a=a.data;a.forEach(function(a){angular.isDefined(a.contObjectInfo)&&null!==a.contObjectInfo&&(a.contObjectId=a.contObjectInfo.contObjectId);angular.isDefined(a.activeDataSource)&&null!==a.activeDataSource&&(a.subscrDataSourceId=
Number(a.activeDataSource.subscrDataSource.id),a.curDatasource=a.activeDataSource.subscrDataSource,a.subscrDataSourceAddr=a.activeDataSource.subscrDataSourceAddr,a.dataSourceTable1h=a.activeDataSource.dataSourceTable1h,a.dataSourceTable24h=a.activeDataSource.dataSourceTable24h);h.checkUndefinedNull(a.verificationDate)||(a.verificationDateString=h.dateFormating(a.verificationDate,b.ctrlSettings.userDateFormat));a.deviceContObjectCaption=a.contObjectInfo.fullName;a.deviceModelCaption=a.deviceModel.caption||
a.deviceModel.modelName;if(!0===b.isDeviceDisabled(a))switch(a.exSystemKeyname){case "LERS":a.deviceDatasourceCaption="\u041b\u042d\u0420\u0421";break;case "VZLET":a.deviceDatasourceCaption="\u0412\u0417\u041b\u0415\u0422"}else h.checkUndefinedNull(a.activeDataSource)||(a.deviceDatasourceCaption=a.activeDataSource.subscrDataSource.dataSourceName);a.deviceTimeOffsetString=h.prepareTimeOffset(a.deviceObjectTimeOffset);h.checkUndefinedNull(a.deviceTimeOffsetString)||(0===a.deviceTimeOffsetString.indexOf("+")&&
(a.deviceTimeOffsetStringTitle="\u0427\u0430\u0441\u044b \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0441\u043f\u0435\u0448\u0430\u0442"),0===a.deviceTimeOffsetString.indexOf("-")&&(a.deviceTimeOffsetStringTitle="\u0427\u0430\u0441\u044b \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u043e\u0442\u0441\u0442\u0430\u044e\u0442"))});c(a);b.data.devices=a;b.ctrlSettings.loading=!1},z)};(function(){l.getImpulseCounterTypes().then(function(a){b.data.impulseCounterTypes=a.data;b.getDevices()},z)})();b.getDeviceSchedulerSettings=
function(a,c){l.getDeviceSchedulerSettings(a,c.id).then(function(a){b.data.currentScheduler=a.data;b.selectedItem(c);$("#scheduleEditorModal").modal()},z)};b.saveScheduler=function(a,b,c){if(h.checkUndefinedNull(a))return"ObjId of scheduler is undefined or null.";if(h.checkUndefinedNull(b)||h.checkUndefinedNull(b.id))return"Device of scheduler is empty.";if(h.checkUndefinedNull(c))return"Scheduler is empty.";c.isSaving=!0;l.putDeviceSchedulerSettings(a,b.id,c).then(H,D)};b.checkDatasource=function(){var a=
!0;null===b.data.currentObject.id&&h.checkUndefinedNull(b.data.currentObject.subscrDataSourceId)&&b.data.currentObject.isManual&&(a=!1);if(h.checkUndefinedNull(b.data.currentObject.deviceModelId))return a;var c=f(b.data.currentObject.deviceModelId);h.checkUndefinedNull(b.data.currentObject)||h.checkUndefinedNull(b.data.currentObject.curDatasource)||!0!==c.isImpulse||!0===b.data.currentObject.curDatasource.dataSourceType.isRaw||(a=!1);return a};b.checkModel=function(){var a=!0;null===b.data.currentObject.id&&
h.checkUndefinedNull(b.data.currentObject.deviceModelId)&&b.data.currentObject.isManual&&(a=!1);if(h.checkUndefinedNull(b.data.currentObject.deviceModelId))return a;var c=f(b.data.currentObject.deviceModelId);h.checkUndefinedNull(b.data.currentObject)||h.checkUndefinedNull(b.data.currentObject.curDatasource)||!0!==c.isImpulse||!0===b.data.currentObject.curDatasource.dataSourceType.isRaw||(a=!1);return a};b.deviceModelChange=function(){if(!h.checkUndefinedNull(b.data.currentObject.deviceModelId)){var a=
f(b.data.currentObject.deviceModelId);h.checkUndefinedNull(b.data.currentObject)||h.checkUndefinedNull(b.data.currentObject.curDatasource)||r(a,b.data.currentObject.curDatasource);n.recentDeviceModelId=b.data.currentObject.deviceModelId;b.data.currentModel=a;b.data.currentObject.curModel=a;if(!0===b.data.currentModel.isImpulse){var a=b.data.currentObject,c=b.data.currentModel.defaultImpulseK,e=b.data.currentModel.defaultImpulseMu,d=b.data.impulseCounterTypes[0].keyname||null;a.isImpulse=b.data.currentModel.isImpulse;
a.impulseK=c;a.impulseMu=e;a.impulseCounterType=d||null}else a=b.data.currentObject,a.isImpulse=!1,a.impulseK=null,a.impulseMu=null,a.impulseCounterType=null}};b.getDeviceModels=function(){l.getDeviceModels().then(function(a){var c=null,e=-1;a.data.some(function(a,b){if("NOT_ASSIGNED"===a.modelName)return c=a,e=b,!0});-1!==e&&(a.data.splice(e,1),a.data.splice(0,0,c));b.data.deviceModels=a.data},z)};b.getDeviceModels();var I=function(a){d.get(a).then(function(a){b.data.dataSources=a.data;h.sortItemsBy(b.data.dataSources,
"dataSourceName")},function(a){console.log(a)})};I(b.ctrlSettings.datasourcesUrl);b.getObjects=function(){l.getRmaPromise().then(function(a){l.sortObjectsByFullName(a.data);b.data.objects=a.data})};b.getObjects();b.selectedItem=function(a){b.data.currentObject=angular.copy(a);b.data.currentObject.beginDeviceModelId=b.data.currentObject.deviceModelId};b.addDevice=function(){b.data.currentObject={};b.data.currentObject.id=null;b.data.currentObject.isManual=!0;b.data.currentObject.deviceLoginInfo={};
if(!h.checkUndefinedNull(n.recentDeviceModelId)&&(b.data.currentObject.deviceModelId=Number(n.recentDeviceModelId),b.data.currentModel=f(b.data.currentObject.deviceModelId),b.data.currentObject.curModel=f(b.data.currentObject.deviceModelId),!0===b.data.currentModel.isImpulse)){var a=b.data.currentObject,c=b.data.currentModel.defaultImpulseK,e=b.data.currentModel.defaultImpulseMu,d=b.data.impulseCounterTypes[0].keyname||null;a.isImpulse=b.data.currentModel.isImpulse;a.impulseK=c;a.impulseMu=e;a.impulseCounterType=
d||null}h.checkUndefinedNull(n.recentDataSourceId)||(b.data.currentObject.subscrDataSourceId=Number(n.recentDataSourceId),b.deviceDatasourceChange());I(b.ctrlSettings.datasourcesUrl);$("#showDeviceModal").modal()};b.editDevice=function(a){b.selectedItem(a);h.checkUndefinedNull(a.deviceModelId)||(b.data.currentModel=f(a.deviceModelId),b.data.currentObject.curModel=f(a.deviceModelId));l.getDeviceDatasources(a.contObjectId,a.id).then(function(a){b.data.dataSources=angular.copy(a.data);b.getDeviceMetaDataVzlet(b.data.currentObject);
$("#showDeviceModal").modal()},D)};b.deviceDatasourceChange=function(){var a=null;b.data.dataSources.some(function(c){if(c.id===b.data.currentObject.subscrDataSourceId)return a=c,!0});r(b.data.currentModel,a);b.data.currentObject.dataSourceTable1h=null;b.data.currentObject.dataSourceTable24h=null;b.data.currentObject.subscrDataSourceAddr=null;b.data.currentObject.curDatasource=a;h.checkUndefinedNull(b.data.currentObject.subscrDataSourceId)||(n.recentDataSourceId=b.data.currentObject.subscrDataSourceId)};
b.saveDevice=function(a){var c;a:{c=a.isSaving=!0;h.checkUndefinedNull(a.contObjectId)&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043e\u0431\u044a\u0435\u043a\u0442 \u0443\u0447\u0435\u0442\u0430"),c=!1);null===a.id&&h.checkUndefinedNull(a.subscrDataSourceId)&&a.isManual&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445"),
c=!1);null===a.id&&h.checkUndefinedNull(a.deviceModelId)&&a.isManual&&(k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043c\u043e\u0434\u0435\u043b\u044c \u043f\u0440\u0438\u0431\u043e\u0440\u0430"),c=!1);!1===r(a.curModel,a.curDatasource)&&(c=!1);if(!h.checkUndefinedNull(a.curModel)&&!0===a.curModel.isImpulse&&!0===a.curDatasource.dataSourceType.isRaw){var d=c,B=!0;if(h.checkUndefinedNull(a.impulseK)||0==a.impulseK)k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0447\u0438\u0441\u043b\u043e \u0438\u043c\u043f\u0443\u043b\u044c\u0441\u043e\u0432 \u0432 \u0435\u0434\u0438\u043d\u0438\u0446\u0435 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f"),B=!1;if(h.checkUndefinedNull(a.impulseMu)||""===a.impulseMu)k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u0435\u0434\u0438\u043d\u0438\u0446\u0430 \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f"),
B=!1;if(h.checkUndefinedNull(a.impulseCounterAddr)||""===a.impulseCounterAddr)k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0430\u0434\u0440\u0435\u0441 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0430 \u0438\u043c\u043f\u0443\u043b\u044c\u0441\u043e\u0432"),B=!1;if(h.checkUndefinedNull(a.impulseCounterSlotAddr)||""===a.impulseCounterSlotAddr)k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0430\u0434\u0440\u0435\u0441 \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0432 \u0441\u0447\u0435\u0442\u0447\u0438\u043a\u0435 \u0438\u043c\u043f\u0443\u043b\u044c\u0441\u043e\u0432"),
B=!1;!1===B&&(c=!1);!0===d&&!1===c&&(e("con_properties_tab"),$("#divInputNetDevAddr").hasClass("has-error")?$("#inputNetDevAddr").focus():$("#divInputNetAddrImpDev").hasClass("has-error")?$("#inputNetAddrImpDev").focus():$("#divInputTikCost").hasClass("has-error")?$("#inputTikCost").focus():$("#divInputDevMeasure").hasClass("has-error")&&$("#inputDevMeasure").focus());!1===d&&A()}if(!1===c)c=a.isSaving=!1;else{h.checkUndefinedNull(a.verificationDateString)&&""===a.verificationDateString||(a.verificationDate=
h.strDateToUTC(a.verificationDateString,b.ctrlSettings.userDateFormat));if(!h.checkUndefinedNull(a.id)&&b.isDirectDevice(a)&&a.beginDeviceModelId!==a.deviceModelId&&(c=confirm("\u041c\u043e\u0434\u0435\u043b\u044c \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0431\u044b\u043b\u0430 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u0430. \u041c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0431\u0443\u0434\u0443\u0442 \u043f\u0435\u0440\u0435\u0437\u0430\u043f\u0438\u0441\u0430\u043d\u044b \u043c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u043c\u0438 \u0442\u0435\u043a\u0443\u0449\u0435\u0439 \u043c\u043e\u0434\u0435\u043b\u0438. \u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c?"),
!c)){c=a.isSaving=!1;break a}c=!0}}if(!1===c)return!1;l.sendDeviceToServer(a).then(H,D)};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=h.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.deleteObject=function(a){var b=l.getRmaObjectsUrl(),b=b+"/"+a.contObjectInfo.contObjectId+"/deviceObjects/"+a.id;d["delete"](b).then(H,D)};b.data.deviceMetadataMeasures=l.getDeviceMetadataMeasures();b.$on("objectSvc:deviceMetadataMeasuresLoaded",function(){b.data.deviceMetadataMeasures=
l.getDeviceMetadataMeasures()});b.updateDeviceMetaData=function(a){a.isSaving=!0;var c=l.getRmaObjectsUrl()+"/"+a.contObjectId+"/deviceObjects/"+a.id+"/metadata";d({url:c,method:"PUT",data:a.metadata}).then(function(a){b.currentObject={};$("#metaDataEditorModal").modal("hide");k.success()},D)};b.vzletDevice=function(a){var b=!1;angular.isDefined(a.activeDataSource)&&null!==a.activeDataSource&&angular.isDefined(a.activeDataSource.subscrDataSource)&&null!==a.activeDataSource.subscrDataSource&&"VZLET"===
a.activeDataSource.subscrDataSource.dataSourceTypeKey&&(b=!0);return b};b.isDirectDevice=function(a){return l.isDirectDevice(a)};b.getDeviceMetaDataVzlet=function(a){if(h.checkUndefinedNull(a))return console.log("getDeviceMetaDataVzlet: Device undefined or null."),"getDeviceMetaDataVzlet: Device undefined or null.";l.getRmaDeviceMetaDataVzlet(a.contObjectInfo.contObjectId,a).then(function(b){a.metaData=b.data},D)};b.getVzletSystemList=function(){var a=l.getVzletSystemList();0===a.length?l.getDeviceMetaDataVzletSystemList().then(function(a){b.data.vzletSystemList=
a.data},D):b.data.vzletSystemList=a};b.getVzletSystemList();b.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0};b.startLoadData=function(){b.data.sessionsOnView=[];b.data.sessionLog=[];if(!1!==q()){var a={};a.deviceObjectId=b.data.currentObject.id;a.periodBeginDate=b.ctrlSettings.dataLoadDaterange.startDate;a.periodEndDate=b.ctrlSettings.dataLoadDaterange.endDate;a.sessionDetailTypes=[];angular.isArray(b.data.detailTypes)&&0<b.data.detailTypes.length&&b.data.detailTypes.forEach(function(b){!0===b.selected&&a.sessionDetailTypes.push(b.keyname)});d.post("../api/rma/subscrSessionTask",a).then(function(a){h.checkUndefinedNull(a)||
h.checkUndefinedNull(a.data)||(b.data.currentSessionTask=a.data,G=p(w,1E4))},D)}};b.initManualLoading=function(a){b.ctrlSettings.dataIsLoaded=!1;b.data.sessionsOnView=[];b.data.currentSession={};b.data.currentSessionTask={};b.data.sessionLog=[];b.data.currentContZpoint=null;b.data.sessionDetailType=[];b.data.detailTypes=[];b.selectedItem(a);x(a);E(a)};b.changeSessionDetailType=function(){b.data.detailTypes=angular.copy(b.data.currentContZpoint.sessionDetailTypes)};b.loadLogData=function(a){b.data.currentSession.selected=
!1;a.selected=!0;b.ctrlSettings.logLoading=!0;b.data.currentSession=a;d.get(b.ctrlSettings.sessionsUrl+"/"+a.id+"/steps").then(function(a){b.data.sessionLog=a.data;b.ctrlSettings.logLoading=!1},D)};$("#deviceSessionModal").on("hidden.bs.modal",function(){h.checkUndefinedNull(G)||p.cancel(G)});b.isDisabledStartButton=function(){return!h.checkUndefinedNull(b.data.currentSessionTask)&&!h.checkUndefinedNull(b.data.currentSessionTask.id)};b.$on("$destroy",function(){window.onkeydown=void 0});window.onkeydown=
function(a){"ArrowUp"===a.code?(a=document.getElementById("divWithDeviceTable"),a.scrollTop-=20):"ArrowDown"===a.code?(a=document.getElementById("divWithDeviceTable"),a.scrollTop+=20):"PageDown"===a.code?(a=document.getElementById("divWithDeviceTable"),a.scrollTop+=340):"PageUp"===a.code?(a=document.getElementById("divWithDeviceTable"),a.scrollTop-=340):a.ctrlKey&&"Home"===a.code?(a=document.getElementById("divWithDeviceTable"),a.scrollTop=0):a.ctrlKey&&"End"===a.code&&(a=document.getElementById("divWithDeviceTable"),
a.scrollTop=a.scrollHeight)};b.isSystemuser=function(){return h.isSystemuser()};b.isTestMode=function(){return h.isTestMode()};b.isDeviceDisabled=function(a){return"VZLET"===a.exSystemKeyname||"LERS"===a.exSystemKeyname||!0===a.isSaving};b.isDeviceProtoLoaded=function(a){return"VZLET"===a.exSystemKeyname||"LERS"===a.exSystemKeyname};b.checkHHmm=function(a){return h.checkHHmm(a)};b.checkPositiveNumberValue=function(a){return h.checkPositiveNumberValue(a)};b.checkScheduler=function(a){return b.checkHHmm(a.loadingInterval)&&
b.checkHHmm(a.loadingRetryInterval)&&b.checkPositiveNumberValue(a.loadingAttempts)};b.isAvailableConPropertiesTab=function(){return h.checkUndefinedNull(b.data.currentObject.curDatasource)?!1:!0===b.data.currentObject.curDatasource.dataSourceType.isRaw||!0===b.data.currentObject.curDatasource.dataSourceType.isDbTablePair||"VZLET"===b.data.currentObject.exSystemKeyname};b.checkAutoLoadingDisabled=function(){return h.checkUndefinedNull(b.data.currentObject)||h.checkUndefinedNull(b.data.currentObject.activeDataSource)||
h.checkUndefinedNull(b.data.currentObject.activeDataSource.subscrDataSource)?!1:"CLIENT"===b.data.currentObject.activeDataSource.subscrDataSource.rawConnectionType&&!0!==b.data.currentObject.activeDataSource.subscrDataSource.rawModemDialEnable};b.checkNodataIdleTimeEnabled=function(){return h.checkUndefinedNull(b.data.currentObject)||h.checkUndefinedNull(b.data.currentObject.activeDataSource)||h.checkUndefinedNull(b.data.currentObject.activeDataSource.subscrDataSource)?!1:"CLIENT"===b.data.currentObject.activeDataSource.subscrDataSource.rawConnectionType&&
!0===b.data.currentObject.activeDataSource.subscrDataSource.rawModemDialEnable};$(document).ready(function(){$("#inputVerificationInterval").inputmask();$("#inputVerificationDate").datepicker({dateFormat:"dd.mm.yy",firstDay:b.dateOptsParamsetRu.locale.firstDay,dayNamesMin:b.dateOptsParamsetRu.locale.daysOfWeek,monthNames:b.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display",
"table")},1)}});$("#inputAttemptsNumberShd").inputmask()});b.setInputTikCostMask=function(){$("#inputTikCost").inputmask()};$("#showDeviceModal").on("shown.bs.modal",function(){$("#inputDeviceModel").focus()});$("#showDeviceModal").on("hidden.bs.modal",function(){A()})}]);app=angular.module("portalNMC");
app.controller("MngmtModemsCtrl",["$rootScope","$scope","$http","objectSvc","notificationFactory","crudGridDataFactory","mainSvc",function(a,b,d,g,l,k,h){function p(){d.get(b.ctrlSettings.modemsIdentityUrl).then(function(a){b.data.modemIdentities=a.data},function(a){console.log(a)})}a.ctxId="management_rma_modems_page";b.extraProps={idColumnName:"id",defaultOrderBy:"rawModemModelName",nameColumnName:"rawModemModelName"};b.orderBy={field:b.extraProps.defaultOrderBy,asc:!0};b.ctrlSettings={};b.ctrlSettings.rmaUrl=
"../api/rma";b.ctrlSettings.modemsUrl=b.ctrlSettings.rmaUrl+"/dataSources/rawModemModels";b.ctrlSettings.modemsIdentityUrl=b.ctrlSettings.modemsUrl+"/rawModemModelIdentity";b.headers={};b.ctrlSettings.modemColumns=[{name:"rawModemModelName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-xs-3 col-md-3",type:"name"},{name:"rawModemTypeCaption",caption:"\u0422\u0438\u043f","class":"col-xs-3 col-md-3"},{name:"rawModemModelDescription",caption:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435",
"class":"col-xs-2 col-md-2"},{name:"isDialup",caption:"\u041f\u043e\u0434\u0434\u0435\u0440\u0436\u043a\u0430 \u0430\u0432\u0442\u043e\u0434\u043e\u0437\u0432\u043e\u043d\u0430","class":"col-xs-1 col-md-1",type:"checkbox"}];b.data={};b.data.modems=[];b.data.currentModem={};b.data.modemTypes=[{keyname:"GPRS-MODEM",caption:"GPRS-\u043c\u043e\u0434\u0435\u043c"},{keyname:"ETHERNET-CONVERTER",caption:"Ethernet-\u043a\u043e\u043d\u0432\u0435\u0440\u0442\u0435\u0440"}];b.data.modemIdentities=[];var m=function(){d.get(b.ctrlSettings.modemsUrl).then(function(a){!h.checkUndefinedNull(a.data)&&
angular.isArray(a.data)&&0<a.data.length&&(a.data.forEach(function(a){h.checkUndefinedNull(a.rawModemType)||b.data.modemTypes.some(function(b){if(b.keyname==a.rawModemType)return a.rawModemTypeCaption=b.caption,!0})}),b.data.modems=a.data)},function(a){console.log(a)})};b.selectModem=function(a){b.data.currentModem=a};b.selectedItem=function(a){a=angular.copy(a);b.data.currentModem=a};b.addModem=function(){b.data.currentModem={};b.data.currentModem.rawModemType=b.data.modemTypes[0].keyname;b.data.currentModem.rawModemModelIdentity=
b.data.modemIdentities[0].keyname;$("#showModemOptionModal").modal()};b.setOrderBy=function(a){b.orderBy={field:a,asc:b.orderBy.field===a?!b.orderBy.asc:!0}};var n=function(a,b){l.success();$("#deleteModemModal").modal("hide");$("#showModemOptionModal").modal("hide");m()},e=function(a){a=h.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)};b.sendModemToServer=function(a){var c=!0;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.rawModemModelName)||null==a.rawModemModelName||""==
a.rawModemModelName)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043c\u043e\u0434\u0435\u043b\u0438 \u043c\u043e\u0434\u0435\u043c\u0430!"),c=!1;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.rawModemModelIdentity)||null==a.rawModemModelIdentity||""==a.rawModemModelIdentity)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0432\u0438\u0434 \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438!"),
c=!1;0!=c&&(c=b.ctrlSettings.modemsUrl,angular.isDefined(a.id)&&null!=a.id?b.updateObject(c,a):b.saveNewModem(c,a))};b.saveNewModem=function(a,b){k(a).save(b,n,e)};b.deleteObject=function(a){k(b.ctrlSettings.modemsUrl)["delete"]({id:a[b.extraProps.idColumnName]},n,e)};b.updateObject=function(a,d){var c={id:d[b.extraProps.idColumnName]};k(a).update(c,d,n,e)};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=h.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.isSystemuser=
function(){return h.isSystemuser()};b.initCtrl=function(){p();m()};b.initCtrl()}]);app=angular.module("portalNMC");
app.controller("MngmtObjectsCtrl",["$scope","$rootScope","$routeParams","$resource","$cookies","$compile","$parse","crudGridDataFactory","notificationFactory","$http","objectSvc","mainSvc","$timeout","$window",function(a,b,d,g,l,k,h,p,m,n,e,c,f,r){function q(){H()}function v(){var b=a.currentObject.contManagementId,d=!1;a.data.cmOrganizations.some(function(a){if(a.id==b)return d=!0});0==d&&e.getCmOrganizationsWithId(b).then(function(b){a.data.cmOrganizations=b.data;c.sortOrganizationsByName(a.data.cmOrganizations)},
function(a){console.log(a)})}function t(b){var e=document.getElementById("obj"+b.id);if(!angular.isUndefined(e)&&null!==e){var e=e.getElementsByClassName("nmc-tr-zpoint")[0],d="",d=d+('<td class="nmc-td-for-button-object-control" ng-hide="!objectCtrlSettings.extendedInterfaceFlag"></td><td></td><td style="padding-top: 2px !important;"><table id="zpointTable'+b.id+'" class="crud-grid table table-lighter table-bordered table-condensed table-hover nmc-child-object-table">'),d=d+'<thead><tr class="nmc-child-table-header">',
d=d+'<th ng-show="bObject || bList" class="nmc-td-for-button"></th>';a.oldColumns.forEach(function(a){d+='<th class="'+a["class"]+'">';d+=a.header||a.name;d+="</th>"});d+="<th></th>";d+="</tr></thead>";b.zpoints.forEach(function(e){d+='<tr id="trZpoint'+e.id+'" >';d+='<td class="nmc-td-for-button"><div class="btn-group"><i title="\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043d\u0430\u0434 \u0442\u043e\u0447\u043a\u043e\u0439 \u0443\u0447\u0435\u0442\u0430" type="button" class="btn btn-xs glyphicon glyphicon-menu-hamburger nmc-button-in-table dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-size: .9em;"></i><ul class="dropdown-menu"><li><a ng-click="getZpointSettingsEx('+
b.id+","+e.id+')"data-target="#showZpointOptionModal"data-toggle="modal"data-placement="bottom"title="\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0451\u0442\u0430">\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430</a></li><li><a ng-click="getZpointSettingsExpl('+b.id+","+e.id+')"data-target="#showZpointExplParameters"data-toggle="modal"data-placement="bottom"title="\u042d\u043a\u0441\u043f\u043b\u0443\u0430\u0442\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0451\u0442\u0430">\u042d\u043a\u0441\u043f\u043b\u0443\u0430\u0442\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b</a></li><li><a ng-click="openZpointMetadata('+
b.id+","+e.id+')"title="\u041c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430">\u041c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430</a></li></ul></div></td>';a.oldColumns.forEach(function(a){switch(a.name){case "zpointName":var b;switch(e.zpointType){case "cw":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-22-snowflake.png";break;case "hw":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-93-tint.png";
break;case "heat":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-85-heat.png";break;case "gas":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-23-fire.png";break;case "env":b="images/es.png";break;case "el":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-242-flash.png";break;default:b=a.zpointType}d+="<td>";d+="<img class='marginLeft5' height=12 width=12 src=\""+b+"\"> <span class='paddingLeft5'></span>";d+=(e[a.name]||"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e")+
'<span ng-show="isSystemuser()">(id = '+e.id+")</span></td>";break;case "zpointLastDataDate":d+="<td>{{"+e[a.name]+" | date: 'dd.MM.yyyy HH:mm'}}</td>";break;case "zpointRefRange":d+='<td id="zpointRefRange'+e.id+'"></td>';break;default:d+="<td>"+(c.checkUndefinedNull(e[a.name])?"":e[a.name])+"</td>"}});d+="<td>";d+='<div class="btn-toolbar"><div class="btn-group pull-right"><i title="\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443 \u0443\u0447\u0435\u0442\u0430" class="btn btn-xs glyphicon glyphicon-trash nmc-button-in-table" ng-click="deleteZpointInit('+
b.id+","+e.id+')" data-target="#deleteZpointModal" data-toggle="modal"></i></div></div>';d+="</td>";d+="</tr>"});d+="</table></td>";e.innerHTML=d;k(e)(a)}}function u(){var b=a.zpointSettings.contManagementId,d=!1;a.data.rsoOrganizations.some(function(a){if(a.id==b)return d=!0});0==d&&e.getRsoOrganizationsWithId(b).then(function(b){a.data.rsoOrganizations=b.data;c.sortOrganizationsByName(a.data.rsoOrganizations)},function(a){console.log(a)})}function w(b){a.objectCtrlSettings.objectModalWindowTabs.forEach(function(a){var c,
e;c=document.getElementById(a.name)||null;e=document.getElementById(a.tabpanel)||null;0!==a.name.localeCompare(b)?(c.classList.remove("active"),e.classList.remove("active")):(c.classList.add("active"),e.classList.add("in"),e.classList.add("active"))})}function x(b){var c=[],e=[],d=null;a.data.buildingCategories.forEach(function(a){a.buildingType===b&&c.push(angular.copy(a))});c.forEach(function(b){a.data.buildingCategories.forEach(function(a){a.parentCategory===b.keyname&&(d=angular.copy(a),d.parentCategoryCaption=
b.caption,e.push(d))})});a.data.preparedBuildingCategoryList=e}function E(){var b=null;a.data.preparedBuildingCategoryList.some(function(c){if(c.keyname===a.currentObject.buildingTypeCategory)return b=c,!0});null!==b&&50<=b.caption.length?($("#inputBuildingCategory").removeClass("nmc-select-form"),$("#inputBuildingCategory").addClass("nmc-select-form-high")):($("#inputBuildingCategory").removeClass("nmc-select-form-high"),$("#inputBuildingCategory").addClass("nmc-select-form"));if(c.checkUndefinedNull(a.currentObject.buildingTypeCategory))return!1}
function G(){a.currentZpoint.metaData.metaData.forEach(function(b){var e=null,d="";a.currentZpoint.metaData.srcProp.some(function(a){if(b.srcProp===a.columnName)return e=a,!0});if(c.checkUndefinedNull(e)||c.checkUndefinedNull(e.deviceMapping)||c.checkUndefinedNull(e.deviceMappingInfo))return!1;b.haveToolTip=!0;var d=d+("<b>\u042f\u0447\u0435\u0439\u043a\u0430 \u043f\u0430\u043c\u044f\u0442\u0438 \u043f\u0440\u0438\u0431\u043e\u0440\u0430:</b> "+e.deviceMapping+"<br><br>"),d=d+("<b>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435:</b> <br> "+
e.deviceMappingInfo),f="#srcHelpBtn"+b.metaOrder+"srcProp";c.setToolTip("\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430",d,f,f,10,500)})}b.ctxId="management_rma_objects_page";a.messages={};a.messages.signClientsObjects="\u041d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u043e\u0432";a.messages.deleteObjects="\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b";
a.messages.deleteObject="\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043e\u0431\u044a\u0435\u043a\u0442";a.messages.viewProps="\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0430";a.messages.addZpoint="\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0442\u043e\u0447\u043a\u0443 \u0443\u0447\u0435\u0442\u0430";a.messages.setClient="\u041d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u043e\u0432";a.messages.viewDevices=
"\u041f\u0440\u0438\u0431\u043e\u0440\u044b";a.messages.markAllOn="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435";a.messages.markAllOff="\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435";a.messages.moveToNode="\u041f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c \u043a \u0443\u0437\u043b\u0443";a.messages.releaseFromNode="\u041e\u0442\u0432\u044f\u0437\u0430\u0442\u044c \u043e\u0442 \u0443\u0437\u043b\u0430";a.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";
a.messages.loadIndicators="\u0417\u0430\u0433\u0440\u0443\u0437\u0438\u0442\u044c \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f";a.messages.noObjects="\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";a.crudTableName=e.getObjectsUrl();a.objectCtrlSettings={};a.objectCtrlSettings.isCtrlEnd=!1;a.objectCtrlSettings.allSelected=!1;a.objectCtrlSettings.anySelected=!1;a.objectCtrlSettings.anyClientSelected=!1;a.objectCtrlSettings.objectsPerScroll=e.OBJECT_PER_SCROLL;a.objectCtrlSettings.objectsOnPage=
a.objectCtrlSettings.objectsPerScroll;a.objectCtrlSettings.vzletSystemList=[];a.objectCtrlSettings.extendedInterfaceFlag=!0;a.objectCtrlSettings.serverTimeZone=3;a.objectCtrlSettings.dateFormat="DD.MM.YYYY";a.objectCtrlSettings.ctxId="management_objects_2nd_menu_item";a.objectCtrlSettings.rmaUrl="../api/rma";a.objectCtrlSettings.clientsUrl="../api/rma/subscribers";a.objectCtrlSettings.subscrObjectsSuffix="/subscrContObjects";a.objectCtrlSettings.tempSchBaseUrl="../api/rma/temperatureCharts/byContObject";
var C=function(){c.getContextIds().forEach(function(a){var b=document.getElementById(a.permissionTagId);angular.isUndefined(b)||null==b||$("#"+a.permissionTagId).removeClass("nmc-hide")})};C();b.$on("servicePermissions:loaded",function(){C()});a.data={};a.data.currentGroupId=null;a.object={};a.objects=[];a.objectsOnPage=[];a.currentSug=null;a.groupUrl="../api/subscr/contGroup";var A=function(b){if(c.checkUndefinedNull(b))return"moveToObject: object id is undefined or null.";var d=e.findObjectById(Number(b),
a.objects);if(null!=d){d=a.objects.indexOf(d);if(d>a.objectCtrlSettings.objectsOnPage){var z=a.objects.slice(a.objectCtrlSettings.objectsOnPage,d+1);Array.prototype.push.apply(a.objectsOnPage,z);a.objectCtrlSettings.objectsOnPage=d+1}c.checkUndefinedNull(b)||f(function(){var a=document.getElementById("obj"+b);c.checkUndefinedNull(a)||a.scrollIntoView()},50)}},z=function(d){a.messages.noObjects="\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";var f=d.data;a.objects=d.data;var z=
0;a.objects.forEach(function(a){c.checkUndefinedNull(a.contObjectStats)||(z+=a.contObjectStats.contZpointCount)});console.log("\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0442\u043e\u0447\u0435\u043a \u0443\u0447\u0435\u0442\u0430 \u0443 \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d\u043d\u044b\u0445 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432: "+z);e.sortObjectsByFullName(a.objects);angular.isUndefined(a.filter)||""===a.filter?
(a.objectsWithoutFilter=a.objects,a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,f=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll),a.objectsOnPage=f,angular.isDefined(l.contObject)&&"null"!==l.contObject&&(a.toggleShowGroupDetails(Number(l.contObject)),l.contObject=null),b.$broadcast("objectSvc:loaded"),c.checkUndefinedNull(a.data.moveToObjectId)||(A(a.data.moveToObjectId),a.data.moveToObjectId=null)):a.searchObjects(a.filter);a.loading=!1},H=function(d){b.$broadcast("objectSvc:requestReloadData",
{contGroupId:a.data.currentGroupId});a.loading=!0;c.checkUndefinedNull(d)||(a.data.moveToObjectId=d);e.getRmaPromise().then(z)};a.objectsDataFilteredByGroup=function(b){a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;c.checkUndefinedNull(b)?(a.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",a.data.currentGroupId=null):(a.messages.groupMenuHeader=b.contGroupName,a.data.currentGroupId=
b.id,a.data.currentGroup=b);H()};a.loading=e.getLoadingStatus();a.columns=[{name:"fullName",header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","class":"col-md-5"},{name:"fullAddress",header:"\u0410\u0434\u0440\u0435\u0441","class":"col-md-5"}];a.captions={loading:"loading",totalElements:"totalElements"};a.extraProps={idColumnName:"id",defaultOrderBy:"fullName",nameColumnName:"fullName"};a.addMode=!1;a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.filter="";a.filterType="";a.bGroupByObject=
!1;a.bObject=!1;a.bList=!0;a.oldColumns=[{name:"zpointName",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-xs-5"},{name:"zpointModel",header:"\u041c\u043e\u0434\u0435\u043b\u044c","class":"col-xs-2"},{name:"zpointNumber",header:"\u041d\u043e\u043c\u0435\u0440","class":"col-xs-2"},{name:"tsNumber",header:"\u0422\u0435\u043f\u043b\u043e\u0441\u0438\u0441\u0442\u0435\u043c\u0430","class":"col-xs-2"}];a.refRange={};a.urlRefRange="../api/subscr/contObjects/";
a.cont_zpoint_setting_mode_check=[{keyname:"summer",caption:"\u041b\u0435\u0442\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"},{keyname:"winter",caption:"\u0417\u0438\u043c\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"}];a.data.metadataSchema=[{header:"\u041f\u043e\u043b\u0435 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a",headClass:"col-xs-3 col-md-3",name:"srcProp",type:"select_src_field"},{header:"\u0414\u0435\u043b\u0438\u0442\u0435\u043b\u044c",headClass:"col-xs-1 col-md-1",name:"srcPropDivision",
type:"input/text",disabled:!1},{header:"\u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430",headClass:"col-xs-1 col-md-1",name:"srcMeasureUnit",type:"select_measure_units",disabled:!1},{header:"\u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f \u043f\u0440\u0438\u0435\u043c\u043d\u0438\u043a\u0430",headClass:"col-xs-1 col-md-1",name:"destMeasureUnit",
type:"select_measure_units",disabled:!1},{header:"\u041f\u043e\u043b\u0435 \u043f\u0440\u0438\u0435\u043c\u043d\u0438\u043a",headClass:"col-xs-1 col-md-1",name:"destProp",type:"input/text",disabled:!0},{header:"\u0424\u0443\u043d\u043a\u0446\u0438\u044f",headClass:"col-xs-1 col-md-1",name:"propFunc",type:"input/text",disabled:!0}];a.toggleAddMode=function(){a.addMode=!a.addMode;a.object={};a.addMode&&a.newIdProperty&&a.newIdValue&&(a.object[a.newIdProperty]=a.newIdValue)};a.toggleEditMode=function(a){a.editMode=
!a.editMode};var D=function(a){var b={};b.id=a.id;b.zpointOrder=a.contServiceType.serviceOrder+a.customServiceName;b.exSystemKeyname=a.exSystemKeyname;b.tsNumber=a.tsNumber;b.exCode=a.exCode;b.version=a.version;b.contObjectId=a.contObjectId;b.startDate=a.startDate;b._activeDeviceObjectId=a._activeDeviceObjectId;b.rsoId=a.rsoId;b.zpointType=a.contServiceType.keyname;b.isManualLoading=a.isManualLoading;b.customServiceName=a.customServiceName;b.contServiceTypeKeyname=a.contServiceTypeKeyname;b.zpointName=
a.customServiceName;b.contZPointComment=a.contZPointComment;"undefined"!=typeof a.rso&&null!=a.rso?(b.zpointRSO=a.rso.organizationFullName||a.rso.organizationName,b.rsoId=a.rsoId):b.zpointRSO="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e";b.checkoutTime=a.checkoutTime;b.checkoutDay=a.checkoutDay;"undefined"==typeof a.doublePipe?b.piped=!1:(b.piped=!0,b.doublePipe=null===a.doublePipe?!1:a.doublePipe,b.singlePipe=!b.doublePipe);"undefined"!=typeof a.deviceObjects&&0<a.deviceObjects.length&&(a.deviceObjects[0].hasOwnProperty("deviceModel")?
b.zpointModel=a.deviceObjects[0].deviceModel.modelName:b.zpointModel="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e",b.zpointNumber=c.checkUndefinedNull(a.deviceObjects[0].number)?"":a.deviceObjects[0].number);b._activeDeviceObjectId=a._activeDeviceObjectId;b.zpointLastDataDate=a.lastDataDate;b.isDroolsDisable=a.isDroolsDisable;b.temperatureChartId=a.temperatureChartId;return b},I=function(a,b){var c=-1;b.some(function(b,e){if(b.id==a)return c=e,!0});return c},B=function(b){var e=D(b.data);m.success();
$("#showZpointOptionModal").modal("hide");var d=I(a.currentObject.id,a.objects),f=I(a.currentObject.id,a.objectsOnPage);-1<d&&"POST"===b.config.method&&(a.objects[d].contObjectStats.contZpointCount+=1);if(!c.checkUndefinedNull(a.currentObject.zpoints)&&angular.isArray(a.currentObject.zpoints)){var y=-1;a.currentObject.zpoints.some(function(b,c){if(b.id===a.zpointSettings.id)return y=c,!0});-1<y?(d=-1,d=I(a.currentObject.id,a.objects),f=I(a.currentObject.id,a.objectsOnPage),-1<d&&(a.objects[d].zpoints[y]=
e,a.objectsOnPage[f].zpoints[y]=e),!0===a.objectsOnPage[f].showGroupDetails&&(c.sortItemsBy(a.objectsOnPage[d].zpoints,"zpointOrder"),t(a.objectsOnPage[f]))):-1<d&&(a.objects[d].zpoints.push(e),!0===a.objectsOnPage[f].showGroupDetails&&(c.sortItemsBy(a.objectsOnPage[d].zpoints,"zpointOrder"),t(a.objectsOnPage[f])))}},O=function(b){m.success();a.objectCtrlSettings.allSelected=!1;a.objects.forEach(function(b){!0===b.selected&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+
".png");b.selected=!1});a.objectsOnPage.forEach(function(b){!0===b.selected&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png");b.selected=!1})},Q=function(a,b){var c=I(a,b);-1!=c&&b.splice(c,1)},N=function(a,b){m.success();$("#deleteObjectModal").modal("hide");$("#showObjOptionModal").modal("hide");$("#setClientModal").modal("hide")},L=function(d){b.$broadcast("objectSvc:requestReloadData");a.currentObject._activeContManagement=d._activeContManagement;
e.getZpointsDataByObject(d,"Ex").then(function(a){var b=[];angular.copy(a.data);a=b=a.data.map(function(a){var b;b=a.object;b.lastDataDate=a.lastDataDate;return b});var b=[],e;for(e=0;e<a.length;e+=1){var S=D(a[e]);b[e]=S}c.sortItemsBy(b,"zpointOrder");d.zpoints=b});var f=null,f=I(d.id,a.objects);null!=f&&(a.objects[f]=d);f=null;f=I(d.id,a.objectsOnPage);null!=f&&(a.objectsOnPage[f]=d);N(d,null)},R=function(b){a.getDevices(a.currentObject,!0);$("#deleteDeviceModal").modal("hide");$("#showDeviceModal").modal("hide")},
Y=function(b,c){Q(a.currentObject.id,a.objects);Q(a.currentObject.id,a.objectsOnPage);N(b,null)},X=function(b,c){a.currentObject.deleteObjectIds.forEach(function(b){Q(b,a.objects);Q(b,a.objectsOnPage)});N(b,null)},da=function(b){$("#deleteZpointModal").modal("hide");Q(a.currentZpoint.id,a.currentObject.zpoints);t(a.currentObject);var c=I(a.currentObject.id,a.objects);-1<c&&(--a.objects[c].contObjectStats.contZpointCount,Q(a.currentZpoint.id,a.objects[c].zpoints));N(b,null)},F=function(b){console.log(b);
var e="-1";if(c.checkUndefinedNull(b)||c.checkUndefinedNull(b.data))e="ERR_CONNECTION";c.checkUndefinedNull(b)||c.checkUndefinedNull(b.resultCode)&&(c.checkUndefinedNull(b.data)||c.checkUndefinedNull(b.data.resultCode))||(e=b.resultCode||b.data.resultCode);b=c.getServerErrorByResultCode(e);m.errorInfo(b.caption,b.description);a.zpointSettings.isSaving=!1;c.checkUndefinedNull(a.currentObject)||(a.currentObject.isSaving=!1)},T=function(b){N(b,null);if(0==a.objectCtrlSettings.isTreeView||c.checkUndefinedNull(a.data.currentTree)){if(H(b.id),
!c.checkUndefinedNull(a.data.currentGroupId)&&!c.checkUndefinedNull(a.data.currentGroup)){var e=a.groupUrl,d=a.objects.map(function(a){return a.id});d.push(b.id);p(e).update({contObjectIds:d},a.data.currentGroup,q,F)}}else c.checkUndefinedNull(a.data.selectedNode)||!c.checkUndefinedNull(a.data.selectedNode.type)&&"root"==a.data.selectedNode.type?a.loadTree(a.data.currentTree,b.id):(a.data.selectedNodeForMove=angular.copy(a.data.selectedNode),a.data.treeForMove=angular.copy(a.data.currentTree),a.data.treeForMove.childObjectList.shift(),
a.data.treeForMove.movingObjects=[b.id],c.checkUndefinedNull(b.id)||(a.data.moveToObjectId=b.id),a.moveToNode())};a.addObject=function(b,e){angular.isDefined(e.contManagementId)&&null!=e.contManagementId&&(b+="/?cmOrganizationId="+e.contManagementId);e._daDataSraw=null;c.checkUndefinedNull(a.currentSug)||(e._daDataSraw=JSON.stringify(a.currentSug));p(b).save(e,T,F)};a.deleteObject=function(b){var c=e.getRmaObjectsUrl();angular.isDefined(b)&&angular.isDefined(b.id)&&null!=b.id&&p(c)["delete"]({id:b[a.extraProps.idColumnName]},
Y,F)};a.deleteObjects=function(b){var c=e.getRmaObjectsUrl();angular.isDefined(b)&&angular.isDefined(b.id)&&null!=b.id?p(c)["delete"]({id:b[a.extraProps.idColumnName]},Y,F):angular.isDefined(b.deleteObjects)&&null!=b.deleteObjects&&angular.isArray(b.deleteObjects)&&p(c)["delete"]({contObjectIds:b.deleteObjectIds},X,F)};a.deleteZpoint=function(b){var c=e.getRmaObjectsUrl()+"/"+a.currentObject.id+"/zpoints";p(c)["delete"]({id:b[a.extraProps.idColumnName]},da,F)};a.updateObject=function(b,e){var d={id:e[a.extraProps.idColumnName]};
angular.isDefined(e.contManagementId)&&null!=e.contManagementId&&(d={cmOrganizationId:e.contManagementId});e._daDataSraw=null;c.checkUndefinedNull(a.currentSug)||(e._daDataSraw=JSON.stringify(a.currentSug));p(b).update(d,e,L,F)};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};a.sendObjectToServer=function(b){var c=b.isSaving=!0;a.emptyString(b.fullName)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430!"),
c=!1);a.emptyString(b.timezoneDefKeyname)&&1!=b.isLightForm&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0447\u0430\u0441\u043e\u0432\u043e\u0439 \u043f\u043e\u044f\u0441 \u043e\u0431\u044a\u0435\u043a\u0442\u0430!"),c=!1);a.checkUndefinedNull(b.contManagementId)&&1!=b.isLightForm&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0430\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f!"),
c=!1);a.emptyString(b.currentSettingMode)&&1!=b.isLightForm&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0440\u0435\u0436\u0438\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f!"),c=!1);if(!c)return b.isSaving=!1;c=e.getRmaObjectsUrl();angular.isDefined(b.id)&&null!=b.id?a.updateObject(c,b):a.addObject(c,b)};a.selectedItem=function(b){a.currentObject=angular.copy(b)};var M=function(){a.currentObject.geoState=
"red";a.currentObject.geoStateText="\u041d\u0435 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u0430\u0440\u0442\u0435";if(a.currentObject.isValidGeoPos||!c.checkUndefinedNull(a.currentSug)&&null!=a.currentSug.data.geo_lat&&null!=a.currentSug.data.geo_lon)a.currentObject.geoState="green",a.currentObject.geoStateText="\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u0430\u0440\u0442\u0435"};a.selectedObject=
function(b,d){e.getRmaObject(b).then(function(b){a.currentObject=b.data;angular.isDefined(a.currentObject._activeContManagement)&&null!=a.currentObject._activeContManagement&&(a.currentObject.contManagementId=a.currentObject._activeContManagement.organization.id);v();c.checkUndefinedNull(d)||(a.currentObject.isLightForm=d);c.checkUndefinedNull(a.currentObject.buildingType)||(x(a.currentObject.buildingType),E());M()},function(a){console.log(a)})};var U=function(b,e){n.get(a.objectCtrlSettings.tempSchBaseUrl+
"/"+b).then(function(a){e.tempSchedules=a.data;if(c.checkUndefinedNull(e.temperatureChartId))return"temperatureChartId is null";e.tempSchedules.some(function(a){if(a.id==e.temperatureChartId)return e.tChart=a,!0})},F)};a.selectedZpoint=function(b,c){a.selectedItem(e.findObjectById(b,a.objects));var d=null;angular.isDefined(a.currentObject.zpoints)&&angular.isArray(a.currentObject.zpoints)&&a.currentObject.zpoints.some(function(a){a.id===c&&(d=angular.copy(a))});a.currentZpoint=d};a.toggleShowGroupDetails=
function(b){var d=e.findObjectById(b,a.objects);null!=d&&(b=document.getElementById("zpointTable"+d.id),d.showGroupDetails=1==d.showGroupDetails&&null==b?!0:!d.showGroupDetails,!0===d.showGroupDetails?e.getZpointsDataByObject(d,"/vo").then(function(a){a=angular.copy(a.data);var b=[],e;for(e=0;e<a.length;e+=1){var S=D(a[e]);b[e]=S}c.sortItemsBy(b,"zpointOrder");d.zpoints=b;t(d);a=document.getElementById("btnDetail"+d.id);c.checkUndefinedNull(a)||(a.classList.remove("glyphicon-chevron-right"),a.classList.add("glyphicon-chevron-down"));
d.showGroupDetailsFlag=!d.showGroupDetailsFlag},F):(document.getElementById("obj"+d.id).getElementsByClassName("nmc-tr-zpoint")[0].innerHTML="",b=document.getElementById("btnDetail"+d.id),b.classList.remove("glyphicon-chevron-down"),b.classList.add("glyphicon-chevron-right")))};a.dateFormat=function(b){b=new Date(b+Math.round(36E5*a.objectCtrlSettings.serverTimeZone));return null==b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]).format(a.objectCtrlSettings.dateFormat)};a.onlyNoRead=
!1;a.showRow=function(b){return"undefined"!=typeof b.isRead||a.onlyNoRead?a.onlyNoRead&&a.onlyNoRead!=!b.isRead?!1:!0:!0};a.zpointSettings={};a.addZpoint=function(b){a.selectedItem(b);a.zpointSettings={};c.checkUndefinedNull(l.recentContServiceTypeKeyname)||(a.zpointSettings.contServiceTypeKeyname=l.recentContServiceTypeKeyname,a.changeServiceType(a.zpointSettings));c.checkUndefinedNull(l.recentRsoId)||(a.zpointSettings.rsoId=Number(l.recentRsoId));a.getDevices(b,!1);U(a.currentObject.id,a.zpointSettings)};
a.getZpointSettings=function(b,e){a.selectedZpoint(b,e);if(c.checkUndefinedNull(a.currentZpoint))return"currentZpoint is undefined or null.";var d=angular.copy(a.currentZpoint),f={};f.id=d.id;f.exSystemKeyname=d.exSystemKeyname;f.tsNumber=d.tsNumber;f.exCode=d.exCode;f.version=d.version;f.contObjectId=d.contObjectId;f.startDate=d.startDate;f._activeDeviceObjectId=d._activeDeviceObjectId;f.rsoId=d.rsoId;f.isManualLoading=d.isManualLoading;f.customServiceName=d.customServiceName;f.contServiceTypeKeyname=
d.contServiceTypeKeyname;f.contZPointComment=d.contZPointComment;f.zpointName=d.zpointName;switch(d.zpointType){case "heat":f.zpointType="\u0422\u0435\u043f\u043b\u043e\u0441\u043d\u0430\u0431\u0436\u0435\u043d\u0438\u0435";break;case "hw":f.zpointType="\u0413\u0412\u0421";break;case "cw":f.zpointType="\u0425\u0412\u0421";break;default:f.zpointType=d.zpointType}f.piped=d.piped;f.singlePipe=d.singlePipe;f.doublePipe=d.doublePipe;f.zpointModel=d.zpointModel;f.zpointRSO=d.zpointRSO;f.checkoutTime=d.checkoutTime;
f.checkoutDay=d.checkoutDay;f.isDroolsDisable=d.isDroolsDisable;f.temperatureChartId=d.temperatureChartId;f.winter={};f.summer={};a.zpointSettings=f;a.getDevices(a.currentObject,!1);U(a.currentObject.id,a.zpointSettings)};a.getZpointSettingsEx=function(b,c){a.getZpointSettings(b,c);u()};a.getZpointSettingsExpl=function(b,c){a.getZpointSettings(b,c);var e={},d={},y;p(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").query(function(b){for(y=0;y<b.length;y+=1)"winter"==
b[y].settingMode?e=b[y]:"summer"==b[y].settingMode&&(d=b[y]);a.zpointSettings.winter=e;a.zpointSettings.summer=d})};var V=function(a){m.success();$("#showZpointOptionModal").modal("hide");$("#showZpointExplParameters").modal("hide")},aa=function(b){m.success();p(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").update({id:a.zpointSettings.winter.id},a.zpointSettings.winter,V,F)};a.emptyString=function(a){return c.checkUndefinedEmptyNullValue(a)};a.checkUndefinedNull=
function(a){return c.checkUndefinedNull(a)};a.updateZpointCommonSettings=function(){var b=a.zpointSettings.isSaving=!0;a.emptyString(a.zpointSettings.customServiceName)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430!"),b=!1);a.emptyString(a.zpointSettings.contServiceTypeKeyname)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0442\u0438\u043f \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430!"),b=!1);a.checkUndefinedNull(a.zpointSettings._activeDeviceObjectId)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043f\u0440\u0438\u0431\u043e\u0440 \u0434\u043b\u044f \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430!"),b=!1);a.checkUndefinedNull(a.zpointSettings.rsoId)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0420\u0421\u041e \u0434\u043b\u044f \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430!"),b=!1);if(!b)return a.zpointSettings.isSaving=!1;c.checkUndefinedNull(a.zpointSettings.tChart)||(a.zpointSettings.temperatureChartId=a.zpointSettings.tChart.id,a.zpointSettings.tChart=null);b=e.getRmaObjectsUrl()+"/"+a.currentObject.id+"/zpoints";angular.isDefined(a.zpointSettings.id)&&null!=a.zpointSettings.id?(b=b+"/"+a.zpointSettings.id,n({url:b,
method:"PUT",data:a.zpointSettings}).then(B,F)):(a.zpointSettings.startDate=Date.now(),n({url:b,method:"POST",data:a.zpointSettings}).then(B,F))};a.updateZpointModeSettings=function(){a.zpointSettings.isSaving=!0;p(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").update({id:a.zpointSettings.summer.id},a.zpointSettings.summer,aa,F)};a.searchObjects=function(b){if(!(0>=a.objects.length)){a.objectsOnPage.forEach(function(a){if(1==a.showGroupDetailsFlag){var b=document.getElementById("obj"+
a.id);c.checkUndefinedNull(b)||(b.getElementsByClassName("nmc-tr-zpoint")[0].innerHTML="",b=document.getElementById("btnDetail"+a.id),b.classList.remove("glyphicon-chevron-down"),b.classList.add("glyphicon-chevron-right"))}a.showGroupDetailsFlag=!1});var e=[];angular.isUndefined(b)||""===b?(a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,e=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll)):a.objects.forEach(function(a){angular.isDefined(a.fullName)&&-1!=a.fullName.toUpperCase().indexOf(b.toUpperCase())&&
e.push(a)});a.objectsOnPage=e}};a.changeServiceType=function(b){c.checkUndefinedNull(b.contServiceTypeKeyname)||(l.recentContServiceTypeKeyname=b.contServiceTypeKeyname);if(a.emptyString(b.customServiceName))switch(b.contServiceTypeKeyname){case "heat":b.customServiceName="\u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u043e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u044f";break;default:a.data.serviceTypes.some(function(a){if(a.keyname==b.contServiceTypeKeyname)return b.customServiceName=a.caption,!0})}};
a.changeRso=function(a){c.checkUndefinedNull(a.rsoId)||(l.recentRsoId=a.rsoId)};a.$on("$destroy",function(){window.onkeydown=void 0});window.onkeydown=function(b){var c=document.getElementById("divWithObjectTable");38==b.keyCode?c.scrollTop-=20:40==b.keyCode?c.scrollTop+=20:34==b.keyCode?c.scrollTop+=10*a.objectCtrlSettings.objectsPerScroll:33==b.keyCode?c.scrollTop-=10*a.objectCtrlSettings.objectsPerScroll:b.ctrlKey&&36==b.keyCode?c.scrollTop=0:b.ctrlKey&&35==b.keyCode&&(a.objectCtrlSettings.objectsOnPage<
a.objects.length&&(a.loading=!0,f(function(){a.loading=!1},a.objects.length)),b=a.objects.slice(a.objectCtrlSettings.objectsOnPage,a.objects.length),Array.prototype.push.apply(a.objectsOnPage,b),a.objectCtrlSettings.objectsOnPage+=a.objects.length,a.$apply(),c.scrollTop=c.scrollHeight)};a.addMoreObjects=function(){if(!(0>=a.objects.length)){var b=a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll;b>=a.objects.length&&(b=a.objects.length);var c=a.objects.slice(a.objectCtrlSettings.objectsOnPage,
b);Array.prototype.push.apply(a.objectsOnPage,c);a.objectCtrlSettings.objectsOnPage=b>=a.objects.length?a.objects.length:a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll}};$("#divWithObjectTable").scroll(function(){if(angular.isUndefined(a.filter)||""==a.filter)a.addMoreObjects(),a.$apply()});a.isSystemuser=function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};a.isTestMode=function(){return c.isTestMode()};a.toggleObjects=
function(b){a.objectCtrlSettings.anySelected=b;a.objects.forEach(function(a){a.selected=b});a.objectsOnPage.forEach(function(a){a.selected=b})};a.toggleObject=function(b){var c=!1;a.objectsOnPage.some(function(a){if(1==a.selected)return c=!0});a.objectCtrlSettings.anySelected=c};a.setModeForObjects=function(b){a.settedMode=b;var c=[];!0===a.objectCtrlSettings.allSelected?c=a.objects.map(function(a){return a.id}):a.objectsOnPage.forEach(function(a){!0===a.selected&&c.push(a.id)});var d=e.getObjectsUrl()+
"/settingModeType";n({url:d,method:"PUT",params:{contObjectIds:c,currentSettingMode:b},data:null}).then(O,F)};a.getDevices=function(b,d){e.getDevicesByObject(b).then(function(e){e=e.data;e.forEach(function(a){angular.isDefined(a.contObjectInfo)&&null!=a.contObjectInfo&&(a.contObjectId=a.contObjectInfo.contObjectId);angular.isDefined(a.activeDataSource)&&null!=a.activeDataSource&&(a.subscrDataSourceId=a.activeDataSource.subscrDataSource.id,a.curDatasource=a.activeDataSource.subscrDataSource,a.subscrDataSourceAddr=
a.activeDataSource.subscrDataSourceAddr,a.dataSourceTable1h=a.activeDataSource.dataSourceTable1h,a.dataSourceTable24h=a.activeDataSource.dataSourceTable24h);var b=a.deviceModel.modelName||"",b=b+(a.number?", \u2116"+a.number:"");a.devCaption=b});b.devices=e;a.selectedItem(b);!c.checkUndefinedNull(b.devices)&&0<b.devices.length&&c.checkUndefinedNull(a.zpointSettings._activeDeviceObjectId)&&(a.zpointSettings._activeDeviceObjectId=b.devices[0].id);1==d&&$("#contObjectDevicesModal").modal()},F)};a.invokeHelp=
function(){alert("This is SPRAVKA!!!111")};var W=function(b){a.confirmCode=null;b=c.getConfirmCode(b);a.confirmLabel=b.label;a.sumNums=b.result};a.deleteObjectInit=function(b){a.selectedItem(b);W()};a.deleteZpointInit=function(b,c){a.selectedZpoint(b,c);a.deleteObjectInit(a.currentObject)};a.addObjectInit=function(b){a.currentObject={};a.currentObject.isLightForm=b;c.checkUndefinedNull(l.recentTimezone)||(a.currentObject.timezoneDefKeyname=l.recentTimezone);c.checkUndefinedNull(l.recentContManagementId)||
(a.currentObject.contManagementId=Number(l.recentContManagementId));c.checkUndefinedNull(l.recentSettingMode)||(a.currentObject.currentSettingMode=l.recentSettingMode);c.checkUndefinedNull(l.recentBuildingType)||(a.currentObject.buildingType=l.recentBuildingType,a.changeBuildingType(a.currentObject.buildingType));c.checkUndefinedNull(l.recentBuildingTypeCategory)||(a.currentObject.buildingTypeCategory=l.recentBuildingTypeCategory);M();$("#showObjOptionModal").modal();$("#showObjOptionModal").css("z-index",
"1041")};a.changeTimeZone=function(){c.checkUndefinedNull(a.currentObject.timezoneDefKeyname)||(l.recentTimezone=a.currentObject.timezoneDefKeyname)};a.changeContManagement=function(){c.checkUndefinedNull(a.currentObject.contManagementId)||(l.recentContManagementId=a.currentObject.contManagementId)};a.changeSettingMode=function(){c.checkUndefinedNull(a.currentObject.currentSettingMode)||(l.recentSettingMode=a.currentObject.currentSettingMode)};a.getDeviceModels=function(){e.getDeviceModels().then(function(b){a.data.deviceModels=
b.data},F)};a.getDeviceModels();(function(b){n.get(b).then(function(b){a.data.dataSources=b.data;c.sortItemsBy(a.data.dataSources,"dataSourceName")},F)})(e.getDatasourcesUrl());a.deviceDatasourceChange=function(){a.currentDevice.dataSourceTable1h=null;a.currentDevice.dataSourceTable24h=null;var b=a.currentDevice.subscrDataSourceAddr=null;a.data.dataSources.some(function(c){if(c.id===a.currentDevice.subscrDataSourceId)return b=c,!0});a.currentDevice.curDatasource=b};a.selectDevice=function(b){a.currentDevice=
angular.copy(b)};a.addDevice=function(){a.currentDevice={};a.currentDevice.contObjectId=a.currentObject.id;$("#showDeviceModal").modal()};a.deleteDeviceInit=function(b){W();a.selectDevice(b)};a.deleteObjectsInit=function(){W();a.currentObject={};var b=[];if(1==a.objectCtrlSettings.allSelected)b=a.objects,a.currentObject.deleteObjects=angular.copy(a.objects),a.currentObject.deleteObjectIds=a.objects.map(function(a){return a.id}),a.currentObject.countDeleteObjects=a.objects.length,$("#deleteObjectModal").modal();
else{var b=a.objectsOnPage,c=0,e=[],d=[];b.forEach(function(a){1==a.selected&&(e.push(angular.copy(a)),d.push(a.id),c+=1)});0<c&&(a.currentObject.deleteObjects=e,a.currentObject.deleteObjectIds=d,a.currentObject.countDeleteObjects=c,$("#deleteObjectModal").modal())}};a.saveDevice=function(a){var b=!0;null==a.contObjectId&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043e\u0431\u044a\u0435\u043a\u0442 \u0443\u0447\u0435\u0442\u0430"),b=!1);null==
a.subscrDataSourceId&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445"),b=!1);!1!==b&&e.sendDeviceToServer(a).then(R,F)};a.deleteDevice=function(a){var b=e.getRmaObjectsUrl(),b=b+"/"+a.contObjectInfo.contObjectId+"/deviceObjects/"+a.id;n["delete"](b).then(R,F)};var K=function(a){a=angular.copy(a);a=a.sort();for(var b=a.length;2<=b;)--b,a[b]==a[b-1]&&a.splice(b,1);
return a},ga=function(a,b){var c=angular.copy(b);n.get(a).then(function(b){b=b.data.map(function(a){return a.id});Array.prototype.push.apply(c,b);c=K(c);n.put(a,c).then(T,F)},function(a){console.log(a)})};a.setClientsInit=function(b){a.currentObject={};a.data.clientsOnPage=angular.copy(a.data.clients);c.checkUndefinedNull(b)?$("#setClientModal").modal():(a.selectedItem(b),a.objectCtrlSettings.isSetClientForOneObject=!0,e.getRmaObjectSubscribers(b.id).then(function(b){if(!angular.isArray(b.data))return $("#setClientModal").modal(),
"Object subscribers array is empty.";b.data.forEach(function(b){a.data.clientsOnPage.some(function(a){if(b==a.id)return a.selected=!0,a.selectionDisabled=!0})});$("#setClientModal").modal()},function(a){console.log(a)}))};var ha=function(){var b=[];1==a.objectCtrlSettings.allSelected?a.objects.forEach(function(a){1==a.selected&&(b.push(a.id),a.selected=!1)}):a.objectsOnPage.forEach(function(a){1==a.selected&&(b.push(a.id),a.selected=!1)});return b};a.setClients=function(){var b=[];1==a.objectCtrlSettings.isSetClientForOneObject?
(b.push(a.currentObject.id),a.objectCtrlSettings.isSetClientForOneObject=!1):(b=ha(),a.objectCtrlSettings.anySelected=!1);a.data.clientsOnPage.forEach(function(c){null!=c.id&&"undefined"!=typeof c.id&&1==c.selected&&1!=c.selectionDisabled&&ga(a.objectCtrlSettings.rmaUrl+"/"+c.id+a.objectCtrlSettings.subscrObjectsSuffix,b)})};a.selectAllClients=function(){a.data.clientsOnPage.forEach(function(b){1!=b.selectionDisabled&&(b.selected=a.objectCtrlSettings.selectedAllClients)});a.objectCtrlSettings.anyClientSelected=
a.objectCtrlSettings.selectedAllClients};a.selectClient=function(){var b=!1;a.data.clientsOnPage.some(function(a){if(1==a.selected&&1!=a.selectionDisabled)return b=!0});a.objectCtrlSettings.anyClientSelected=b};a.objectCtrlSettings.objectModalWindowTabs=[{name:"main_object_properties_tab",tabpanel:"main_object_properties"},{name:"extra_object_properties_tab",tabpanel:"extra_object_properties"}];a.checkEmptyNullValue=function(a){return""===a||null==a?!0:!1};a.checkNumericValue=function(b){return a.checkEmptyNullValue(b)?
!0:isNaN(parseFloat(b))||!isFinite(b)?!1:!0};a.checkPositiveNumberValue=function(b){var c;c=a.checkNumericValue(b);return c?c=0<=parseInt(b,10)?!0:!1:c};a.isPositiveNumberValue=function(a){return c.isPositiveNumberValue(a)};a.checkNumericInterval=function(b,c){return a.checkEmptyNullValue(b)||a.checkEmptyNullValue(c)||!a.checkNumericValue(b)||!a.checkNumericValue(c)?!1:parseInt(c,10)>=parseInt(b,10)?!0:!1};a.checkHHmm=function(a){return/(0[0-9]|1[0-9]|2[0-3]){1,2}:([0-5][0-9]){1}/.test(a)?!0:!1};
a.checkZpointSettingsFrom=function(b){return null!=b&&b.hasOwnProperty("summer")&&b.hasOwnProperty("winter")?a.checkPositiveNumberValue(b.summer.ov_BalanceM_ctrl)&&a.checkPositiveNumberValue(b.winter.ov_BalanceM_ctrl)&&a.checkHHmm(b.summer.ov_Worktime)&&a.checkHHmm(b.winter.ov_Worktime)&&a.checkPositiveNumberValue(b.summer.leak_Gush)&&a.checkPositiveNumberValue(b.winter.leak_Gush)&&a.checkPositiveNumberValue(b.summer.leak_Night)&&a.checkPositiveNumberValue(b.winter.leak_Night)&&a.checkNumericInterval(b.summer.wm_deltaT_min,
b.summer.wm_deltaT_max)&&a.checkNumericInterval(b.summer.wm_deltaQ_min,b.summer.wm_deltaQ_max)&&a.checkNumericInterval(b.winter.wm_deltaT_min,b.winter.wm_deltaT_max)&&a.checkNumericInterval(b.winter.wm_deltaQ_min,b.winter.wm_deltaQ_max)&&a.checkNumericInterval(b.summer.wm_P2_min,b.summer.wm_P2_max)&&a.checkNumericInterval(b.summer.wm_P1_min,b.summer.wm_P1_max)&&a.checkNumericInterval(b.winter.wm_P2_min,b.winter.wm_P2_max)&&a.checkNumericInterval(b.winter.wm_P1_min,b.winter.wm_P1_max)&&a.checkNumericInterval(b.summer.wm_T2_min,
b.summer.wm_T2_max)&&a.checkNumericInterval(b.summer.wm_T1_min,b.summer.wm_T1_max)&&a.checkNumericInterval(b.winter.wm_T2_min,b.winter.wm_T2_max)&&a.checkNumericInterval(b.winter.wm_T1_min,b.winter.wm_T1_max)&&a.checkNumericInterval(b.summer.wm_M2_min,b.summer.wm_M2_max)&&a.checkNumericInterval(b.summer.wm_M1_min,b.summer.wm_M1_max)&&a.checkNumericInterval(b.winter.wm_M2_min,b.winter.wm_M2_max)&&a.checkNumericInterval(b.winter.wm_M1_min,b.winter.wm_M1_max):!0};a.checkObjectPropertiesForm=function(b){return null!=
b&&b.hasOwnProperty("cwTemp")&&b.hasOwnProperty("heatArea")?a.checkNumericValue(b.cwTemp)&&a.checkNumericValue(b.heatArea):!0};$(document).ready(function(){$("#inputTSNumber").inputmask();$("#inputEXCode").inputmask();$("#inputObjAddress").suggestions({serviceUrl:"https://dadata.ru/api/v2",token:"f9879c8518e9c9e794ff06a6e81eebff263f97d5",type:"ADDRESS",count:10,onSelect:function(b){a.currentObject.fullAddress=b.value;a.currentSug=b;a.currentObject.isAddressAuto=!0;M();a.$apply()},onSearchComplete:function(a,
b){}});$("#inputObjAddress").change(function(){a.currentSug=null;a.currentObject.isAddressAuto=!1;a.currentObject.isValidGeoPos=!1;M();a.$apply()})});$("#showZpointOptionModal").on("hidden.bs.modal",function(){a.zpointSettings={}});$("#showZpointExplParameters").on("hidden.bs.modal",function(){a.zpointSettings={}});$("#showObjOptionModal").on("hidden.bs.modal",function(){a.currentObject.isSaving=!1;a.currentSug=null;w("main_object_properties_tab")});a.zpointMetadataIntegratorsFlag=!1;a.openZpointMetadata=
function(b,c){a.selectedZpoint(b,c);e.getZpointMetaSrcProp(b,c).then(function(d){d.data.forEach(function(a){a.title="\u0425\u0438\u043d\u0442 \u0434\u043b\u044f "+a.columnName});a.currentZpoint.metaData={};a.currentZpoint.metaData.srcProp=d.data;a.currentZpoint.metaData.srcProp.push({columnName:"",title:"\u041f\u0443\u0441\u0442\u0430\u044f \u0441\u0442\u0440\u043e\u043a\u0430"});e.getZpointMetaDestProp(b,c).then(function(d){a.currentZpoint.metaData.destProp=d.data;e.getZpointMetaMeasureUnits(b,c)},
F)},F)};a.$on("objectSvc:zpointMetadataMeasuresLoaded",function(){a.currentZpoint.metaData.measures=e.getZpointMetadataMeasures();e.getZpointMetadata(a.currentZpoint.contObjectId,a.currentZpoint.id).then(function(b){c.sortItemsBy(b.data,"destProp");a.currentZpoint.metaData.metaData=b.data;$("#metaDataEditorModal").modal()},F)});a.updateZpointMetaData=function(a){e.saveZpointMetadata(a.contObjectId,a.id,a.metaData.metaData).then(function(a){$("#metaDataEditorModal").modal("hide");m.success()},F)};
a.log=function(a){console.log(a)};a.showMetaSrcHelp=function(b,e,d,f){console.log(f);if(c.checkUndefinedNull(b)||c.checkUndefinedNull(a.currentZpoint.metaData.srcProp))return"Input params is incorrect!";var y=null;f="";console.log(b);console.log(a.currentZpoint.metaData.srcProp);a.currentZpoint.metaData.srcProp.some(function(a){if(b===a.columnName)return y=a,!0});console.log(y);if(c.checkUndefinedNull(y))return!1;f="\u041f\u043e\u043b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430: "+y.deviceMapping+
"<br>";f="\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435: <br> "+y.deviceMappingInfo;e="#srcHelpBtn"+e+d;c.setToolTip("\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430",f,e,e,10,500)};a.viewFullObjectList=function(){a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;a.data.currentTree=null;a.data.selectedNode=null;a.objectCtrlSettings.isFullObjectView=!0;a.messages.treeMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";
H()};a.objectCtrlSettings.isTreeView=!0;a.objectCtrlSettings.isFullObjectView=!1;a.data.trees=[];a.data.currentTree={};a.data.newTree={};a.data.defaultTree=null;a.data.selectedNode=null;a.selectNode=function(b){var d=a.data.currentTree,f=a.data.selectedNode;if(!c.checkUndefinedNull(f)){if(f.id==b.id||f.type==b.type=="root")return;d=c.findNodeInTree(f,d);c.checkUndefinedNull(d)||(d.isSelected=!1)}b.isSelected=!0;a.data.selectedNode=angular.copy(b);a.loading=!0;"root"==b.type?e.loadSubscrFreeObjectsByTree(a.data.currentTree.id).then(z):
e.loadSubscrObjectsByTreeNode(a.data.currentTree.id,b.id).then(z)};a.loadTree=function(d,f){a.loading=!0;c.checkUndefinedNull(f)||(a.data.moveToObjectId=f);e.loadSubscrTree(d.id).then(function(e){a.messages.treeMenuHeader=d.objectName||d.id;e=angular.copy(e.data);c.sortTreeNodesBy(e,"objectName");a.data.currentTree=e;a.data.selectedNode=null;a.objects=[];a.objectsOnPage=[];a.loading=!1;b.$broadcast("objectSvc:loaded");a.messages.noObjects="";c.checkUndefinedNull(a.data.moveToObjectId)||(A(a.data.moveToObjectId),
a.data.moveToObjectId=null)},F)};var ba=function(b){a.treeLoading=!0;e.loadSubscrTrees().then(function(e){a.treeLoading=!1;c.sortItemsBy(e.data,"objectName");a.data.trees=angular.copy(e.data);c.checkUndefinedNull(b)||1!=b.isActive||(a.data.defaultTree=c.findItemBy(a.data.trees,"id",Number(b.value)));if(!angular.isArray(a.data.trees)||0>=a.data.trees.length||c.checkUndefinedNull(a.data.defaultTree))return a.viewFullObjectList(),"View full object list!";a.loadTree(a.data.defaultTree)},F)},ca=function(b){a.objectCtrlSettings.isTreeView=
b.data.isActive;ba(b.data)};a.toggleTreeView=function(){a.objectCtrlSettings.isTreeView=!a.objectCtrlSettings.isTreeView;a.data.currentGroupId=null;0==a.objectCtrlSettings.isTreeView?H():e.loadDefaultTreeSetting().then(ca,F)};a.moveToNode=function(){e.putObjectsToTreeNode(a.data.currentTree.id,a.data.selectedNodeForMove.id,a.data.treeForMove.movingObjects).then(function(b){a.loading=!0;"root"==a.data.selectedNode.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(z):e.loadObjectsByTreeNode(a.data.currentTree.id,
a.data.selectedNode.id).then(z)},F)};a.data.buildingTypes=[];a.data.buildingCategories=[];a.data.preparedBuildingCategoryList=[];a.data.buildingCategories=e.getBuildingCategories();a.data.buildingTypes=e.getBuildingTypes();a.$on(e.BROADCASTS.BUILDING_TYPES_LOADED,function(){a.data.buildingTypes=e.getBuildingTypes()});a.$on(e.BROADCASTS.BUILDING_CATEGORIES_LOADED,function(){a.data.buildingCategories=e.getBuildingCategories()});a.changeBuildingType=function(b){a.currentObject.buildingTypeCategory=null;
l.recentBuildingTypeCategory=a.currentObject.buildingTypeCategory;$("#inputBuildingCategory").removeClass("nmc-select-form-high");$("#inputBuildingCategory").addClass("nmc-select-form");if(c.checkUndefinedNull(b))return!1;l.recentBuildingType=b;x(b)};a.changeBuildingCategory=function(){E();l.recentBuildingTypeCategory=a.currentObject.buildingTypeCategory};$("#showTreeOptionModal").on("shown.bs.modal",function(){$("#inputTreeName").focus()});$("#treeLevelModal").on("shown.bs.modal",function(){$("#inputLevelName").focus()});
$("#showObjOptionModal").on("shown.bs.modal",function(){$("#inputContObjectName").focus();$("#inputNumOfStories").inputmask("integer",{min:1,max:200})});$("#showZpointOptionModal").on("shown.bs.modal",function(){$("#inputZpointName").focus()});a.changeMetaToolTips=function(){G()};$("#metaDataEditorModal").on("shown.bs.modal",function(){G()});(function(){e.getRsoOrganizations().then(function(b){a.data.rsoOrganizations=b.data})})();(function(){e.getCmOrganizations().then(function(b){c.sortOrganizationsByName(b.data);
a.data.cmOrganizations=b.data})})();(function(){e.getServiceTypes().then(function(b){a.data.serviceTypes=b.data})})();(function(){e.getTimezones().then(function(b){a.data.timezones=b.data})})();(function(){n.get(a.objectCtrlSettings.clientsUrl).then(function(b){if(c.checkUndefinedNull(b)||c.checkUndefinedNull(b.data)||!angular.isArray(b.data))return!1;b.data.forEach(function(a){if(c.checkUndefinedNull(a.organization))return!1;a.organizationName=a.organization.organizationFullName||a.organization.organizationName});
a.data.clients=b.data},function(a){console.log(a)})})();0==a.objectCtrlSettings.isTreeView?H():e.loadDefaultTreeSetting().then(ca,F)}]);app=angular.module("portalNMC");
app.controller("MngmtOrganizationsCtrl",["$rootScope","$scope","$http","objectSvc","notificationFactory","crudGridDataFactory","mainSvc",function(a,b,d,g,l,k,h){a.ctxId="management_rma_organizations_page";b.extraProps={idColumnName:"id",defaultOrderBy:"organizationName",nameColumnName:"organizationName"};b.orderBy={field:b.extraProps.defaultOrderBy,asc:!0};b.ctrlSettings={};b.ctrlSettings.rmaUrl="../api/rma";b.ctrlSettings.organizationsUrl="../api/rma/organizations";b.headers={};b.ctrlSettings.organizationTypes=
{rso:{caption:"\u0420\u0421\u041e",fullCaption:"\u0420\u0435\u0441\u0443\u0440\u0441\u043e\u0441\u043d\u0430\u0431\u0436\u0430\u044e\u0449\u0430\u044f \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u044f"},cm:{caption:"\u0423\u041a",fullCaption:"\u0423\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0430\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f"},serv:{caption:"\u0421\u041a",fullCaption:"\u0421\u0435\u0440\u0432\u0438\u0441\u043d\u0430\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f"}};
b.isSystemuser=function(){return h.isSystemuser()};!0===b.isSystemuser()&&(b.ctrlSettings.organizationTypes.rma={caption:"\u0420\u041c\u0410",fullCaption:"\u0420\u0435\u0433\u0438\u043e\u043d\u0430\u043b\u044c\u043d\u043e\u0435 \u043c\u0435\u0442\u0440\u043e\u043b\u043e\u0433\u0438\u0447\u0435\u0441\u043a\u043e\u0435 \u0430\u0433\u0435\u043d\u0441\u0442\u0432\u043e"});b.ctrlSettings.organizationColumns=[{name:"organizationName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",
"class":"col-xs-3 col-md-3",type:"name"},{name:"organizationTypeName",caption:"\u0422\u0438\u043f \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438","class":"col-xs-2 col-md-2"},{name:"organizationDescription",caption:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","class":"col-xs-3 col-md-3"},{name:"organizationFullAddress",caption:"\u041f\u043e\u043b\u043d\u044b\u0439 \u0430\u0434\u0440\u0435\u0441","class":"col-xs-2 col-md-2"}];b.data={};b.data.organizations=[];b.data.currentOrganization=
{};var p=function(){d.get(b.ctrlSettings.organizationsUrl).then(function(a){a=angular.copy(a.data);a.forEach(function(a){if(!0===a.flagCm)return a.organizationType="cm",a.organizationTypeName=b.ctrlSettings.organizationTypes.cm.fullCaption,!0;if(!0===a.flagRso)return a.organizationType="rso",a.organizationTypeName=b.ctrlSettings.organizationTypes.rso.fullCaption,!0;if(!0===a.flagServ)return a.organizationType="serv",a.organizationTypeName=b.ctrlSettings.organizationTypes.serv.fullCaption,!0;if(!0===
a.flagRma)return a.organizationType="rma",a.organizationTypeName=b.ctrlSettings.organizationTypes.rma.fullCaption,!0});b.data.organizations=a},function(a){console.log(a)})};b.selectOrganization=function(a){b.data.currentOrganization=a};b.selectedItem=function(a){a=angular.copy(a);b.data.currentOrganization=a};b.editObjectList=function(a){b.selectedItem(a);b.getAvailableObjects(b.data.currentOrganization.id);b.getSelectedObjects(b.data.currentOrganization.id);b.showAvailableObjects_flag=!1};b.addOrganization=
function(){b.data.currentOrganization={};$("#showOrganizationOptionModal").modal()};b.setOrderBy=function(a){b.orderBy={field:a,asc:b.orderBy.field===a?!b.orderBy.asc:!0}};var m=function(a,b){l.success();$("#deleteOrganizationModal").modal("hide");$("#showOrganizationOptionModal").modal("hide");p()},n=function(a){a=h.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)};b.sendOrganizationToServer=function(a){var c=!0;if(angular.isUndefined(a)||null==a||angular.isUndefined(a.organizationName)||
null==a.organizationName||""==a.organizationName)l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043e\u0440\u0433\u0430\u043d\u0438\u0437\u0430\u0446\u0438\u0438!"),c=!1;if(0!=c){a.flagCm=!1;a.flagRso=!1;a.flagServ=!1;a.flagRma=!1;switch(a.organizationType){case "cm":a.flagCm=!0;break;case "rso":a.flagRso=!0;break;case "serv":a.flagServ=!0;break;case "rma":a.flagRma=!0}c=
b.ctrlSettings.organizationsUrl;angular.isDefined(a.id)&&null!=a.id?b.updateObject(c,a):b.saveNewOrganization(c,a)}};b.saveNewOrganization=function(a,b){k(a).save(b,m,n)};b.deleteObject=function(a){k(b.ctrlSettings.organizationsUrl)["delete"]({id:a[b.extraProps.idColumnName]},m,n)};b.updateObject=function(a,c){var d={id:c[b.extraProps.idColumnName]};k(a).update(d,c,m,n)};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=h.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};
b.isTestMode=function(){return h.isTestMode()};b.initCtrl=function(){p()};b.initCtrl()}]);app=angular.module("portalNMC");app.filter("viewHistory",function(){return function(a,b){if(angular.isArray(a,b)){var d=[];if(b)return a;a.forEach(function(a){angular.isUndefined(a.factEndDate)&&!a.isArchive&&d.push(a)});return d}}});
app.controller("MngmtPriceCtrl",["$rootScope","$scope","$http","mainSvc","notificationFactory","$log",function(a,b,d,g,l,k){a.ctxId="management_rma_price_page";b.messages={};b.messages.priceMenuItem1="\u0410\u043a\u0442\u0438\u0432\u0438\u0440\u043e\u0432\u0430\u0442\u044c";b.messages.priceMenuItem2="\u041d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u0430\u043c";b.messages.priceMenuItem3="\u0420\u0435\u0434\u0430\u043a\u0442\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0446\u0435\u043d\u044b";
b.messages.priceMenuItem4="\u041a\u043e\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c";b.messages.priceMenuItem5="\u0423\u0434\u0430\u043b\u0438\u0442\u044c";b.messages.priceMenuItem6="\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430";b.messages.priceMenuItem7="\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0446\u0435\u043d\u044b";b.ctrlSettings={};b.ctrlSettings.dateFormat="DD.MM.YYYY";b.ctrlSettings.modeView=!1;b.ctrlSettings.subscrUrl="../api/subscr";b.ctrlSettings.rmaUrl="../api/rma";
b.ctrlSettings.priceSuffix="/priceList";b.ctrlSettings.clientsUrl="../api/rma/subscribers";b.ctrlSettings.rmaClientsUrl="../api/rma/priceList/rma";b.ctrlSettings.modesUrl="../api/rma/priceList/subscribers";b.ctrlSettings.servicesUrl=b.ctrlSettings.subscrUrl+"/manage/service";b.ctrlSettings.packagesUrl=b.ctrlSettings.servicesUrl+"/servicePackList";b.ctrlSettings.itemsUrl=b.ctrlSettings.servicesUrl+"/serviceItemList";b.ctrlSettings.priceUrl=b.ctrlSettings.servicesUrl+"/servicePriceList";b.ctrlSettings.accountServicesUrl=
b.ctrlSettings.servicesUrl+"/access";b.ctrlSettings.subscriberContObjectCountUrl=b.ctrlSettings.subscrUrl+"/info/subscriberContObjectCount";b.ctrlSettings.MASTER_RMA_ID=0;b.ctrlSettings.priceListColumns=[{name:"priceListName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-xs-3 col-md-3"},{name:"factBeginDate",caption:"\u0414\u0430\u0442\u0430 \u0432\u0432\u043e\u0434\u0430","class":"col-xs-1 col-md-1"},{name:"factEndDate",caption:"\u0414\u0430\u0442\u0430 \u0437\u0430\u0432\u0435\u0440\u0448\u0435\u043d\u0438\u044f",
"class":"col-xs-1 col-md-1"}];b.ctrlSettings.subscriberContObjectCount=null;b.ctrlSettings.currency="";b.availablePackages=null;b.serviceListEdition=null;b.availablePackages=[];b.data={};b.data.currentClient={};b.data.currentPrice={};b.data.currentMode={};b.data.priceModes=[];b.data.clients=[];b.data.clientsAtWindow=[];b.data.prices=[];var h=function(a,c){l.success();$("#deletePriceModal").modal("hide");$("#pricePropModal").modal("hide");$("#clonePriceModal").modal("hide");$("#editPriceModal").modal("hide");
b.data.currentPrice={};m(b.data.currentMode.id)},p=function(a){a=g.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)},m=function(a){d.get(b.ctrlSettings.rmaUrl+"/"+a+b.ctrlSettings.priceSuffix).then(function(a){if(angular.isUndefined(a.data)||null==a.data||!angular.isArray(a.data))return!1;b.data.prices=a.data},p)};b.cloneInit=function(a){b.selectItem(a);b.data.clientsAtWindow=angular.copy(b.data.clients)};b.selectedAllPressed=function(){b.data.selectedAll=!b.data.selectedAll;b.data.clientsAtWindow.forEach(function(a){a.selected=
b.data.selectedAll})};b.activatedAllPressed=function(){b.data.activatedAll=!b.data.activatedAll;b.data.clientsAtWindow.forEach(function(a){a.selected&&(a.activated=b.data.activatedAll)})};b.selectItem=function(a){b.data.currentPrice=angular.copy(a)};b.dblClickPriceList=function(a){b.selectItem(a);$("#pricePropModal").modal()};b.deletePriceInit=function(a){b.selectItem(a);b.confirmCode=null;a=g.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.deletePrice=function(a){d["delete"](b.ctrlSettings.rmaUrl+
"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/"+a.id).then(h,p)};b.savePriceProp=function(a){d.put(b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/"+a.id,a).then(h,p)};b.copyPriceList=function(a){d.post(b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/?srcPriceListId="+a.id,null).then(h,p)};b.clonePriceList=function(){var a=[];b.data.clientsAtWindow.forEach(function(b){b.selected&&a.push(b.id)});var c=[];b.data.clientsAtWindow.forEach(function(a){a.activated&&
c.push(a.id)});if(0==a.length)return l.info("\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u043e \u043d\u0438 \u043e\u0434\u043d\u043e\u0433\u043e \u0430\u0431\u043e\u043d\u0435\u043d\u0442\u0430!"),1;d({method:"POST",url:b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/"+b.data.currentPrice.id+"/subscr",params:{subscriberIds:a,activeIds:c}}).then(h,p)};b.activatePriceList=function(a){b.selectItem(a);d.put(b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+
"/"+b.data.currentPrice.id+"/activate").then(h,p)};var n=function(a){d.get(a).then(function(a){if(angular.isUndefined(a.data)||null==a.data||!angular.isArray(a.data))return!1;a.data.forEach(function(a){a.organizationName=angular.isDefined(a.organization)&&null!=a.organization?a.organization.organizationFullName:a.subscriberName});b.data.clients=a.data},function(a){console.log(a)})};(function(){d.get(b.ctrlSettings.modesUrl).then(function(a){if(angular.isUndefined(a.data)||null==a.data||!angular.isArray(a.data))return!1;
b.data.priceModes=angular.copy(a.data);b.data.currentMode=angular.copy(b.data.priceModes[0]);m(b.data.currentMode.id);a=b.ctrlSettings.clientsUrl;b.data.currentMode.id==b.ctrlSettings.MASTER_RMA_ID&&(a=b.ctrlSettings.rmaClientsUrl);n(a)},function(a){console.log(a)})})();b.changeMode=function(a){var c=null;b.data.priceModes.some(function(b){if(b.id==a)return c=angular.copy(b),!0});b.data.currentMode=angular.copy(c);m(b.data.currentMode.id);var d=b.ctrlSettings.clientsUrl;b.data.currentMode.id==b.ctrlSettings.MASTER_RMA_ID&&
(d=b.ctrlSettings.rmaClientsUrl);n(d)};b.getSubscriberContObjectCount=function(a){d.get(a).then(function(a){b.ctrlSettings.subscriberContObjectCount=a.data},function(a){console.log(a)})};b.getSubscriberContObjectCount(b.ctrlSettings.subscriberContObjectCountUrl);b.getPriceList=function(a){d.get(a).then(function(a){var c=angular.copy(a.data);if(angular.isUndefined(c)||null==c||!angular.isArray(c))return!1;b.serviceListEdition.forEach(function(a){c.forEach(function(c){c.packId!==a.id||!angular.isUndefined(c.itemId)&&
null!==c.itemId||(a.price=c,b.ctrlSettings.currency=c.currency,angular.isDefined(c.priceValue)&&angular.isNumber(c.priceValue)&&(a.isAvailable=!0))});a.serviceItems.forEach(function(a){c.forEach(function(c){!angular.isUndefined(c.packId)&&null!==c.packId||c.itemId!==a.id||(a.price=c,b.ctrlSettings.currency=c.currency,angular.isDefined(c.priceValue)&&angular.isNumber(c.priceValue)&&(a.isAvailable=!0))})})});b.ctrlSettings.currency="";$("#editPriceModal").modal()},function(a){console.log(a)})};b.getPackages=
function(a){d.get(a).then(function(a){b.availablePackages=a.data},function(a){console.log(a)})};var e=function(a,b){$(a).qtip({suppress:!1,content:{text:b,button:!0},show:{event:"click"},style:{classes:"qtip-nmc-indicator-tooltip",width:1E3},hide:{event:"unfocus"},position:{my:"top left",at:"bottom left"}})};b.getPackages(b.ctrlSettings.packagesUrl);var c=function(a){var c=[];b.serviceListEdition.forEach(function(a){if(angular.isDefined(a.price)&&null!=a.price){if(angular.isUndefined(a.price.id)||
null==a.price.id)a.price.packId=a.id,a.price.priceValue=Number(a.price.priceValue);c.push(a.price)}a.serviceItems.forEach(function(a){if(angular.isDefined(a.price)&&null!=a.price){if(angular.isUndefined(a.price.id)||null==a.price.id)a.price.itemId=a.id,a.price.priceValue=Number(a.price.priceValue);c.push(a.price)}})});return c};b.updatePriceList=function(){var a=b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/"+b.data.currentPrice.id+"/items",e=[],e=c(b.serviceListEdition),
g=!0;e.some(function(a){if(!b.checkNumericValue(a.priceValue))return l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430!","\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u0430 \u0446\u0435\u043d\u0430 \u0443\u0441\u043b\u0443\u0433\u0438!"),g=!1,!0});if(!g)return!1;d.put(a,e).then(h,p)};b.toggleShowGroupDetails=function(a){a.showDetailsFlag=!a.showDetailsFlag};b.editPrice=function(a){b.confirmCode=null;var c=g.getConfirmCode();b.confirmLabel=c.label;
b.sumNums=c.result;b.viewPrice(a,!1)};b.viewPrice=function(a,c){b.ctrlSettings.modeView=c;b.selectItem(a);b.serviceListEdition=angular.copy(b.availablePackages);b.getPriceList(b.ctrlSettings.rmaUrl+"/"+b.data.currentMode.id+b.ctrlSettings.priceSuffix+"/"+b.data.currentPrice.id+"/items")};$("#editPriceModal").on("show.bs.modal",function(a){window.setTimeout(function(){b.availablePackages.forEach(function(a){e("#editpackage"+a.id,a.packDescription);a.serviceItems.forEach(function(a){e("#editservice"+
a.id,a.itemDescription)})});$("input[name='inputPrice']").inputmask()},500)});b.isSystemuser=function(){return g.isSystemuser()};b.checkNumericValue=function(a){return g.checkNumericValue(a)};b.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:b.ctrlSettings.dateFormat};$(document).ready(function(){$("#inputPlanBeginDate").datepicker({dateFormat:"yy-mm-dd",firstDay:b.dateOptsParamsetRu.locale.firstDay,dayNamesMin:b.dateOptsParamsetRu.locale.daysOfWeek,monthNames:b.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputPlanEndDate").datepicker({dateFormat:"yy-mm-dd",
firstDay:b.dateOptsParamsetRu.locale.firstDay,dayNamesMin:b.dateOptsParamsetRu.locale.daysOfWeek,monthNames:b.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});$(document).ready(function(){setTimeout(function(){$(":input").inputmask()},10)});$(document).ready(function(){$("#history-view").bootstrapToggle({on:"\u0434\u0430",
off:"\u043d\u0435\u0442"});$("#history-view").change(function(){b.ctrlSettings.viewHistoryFlag=!!$(this).prop("checked");b.$apply()})});$("#pricePropModal").on("shown.bs.modal",function(){$("#inputName").focus();$("#pricePropModal").keydown(function(a){13==a.keyCode&&(b.savePriceProp(b.data.currentPrice),b.$apply())})});$("#pricePropModal").on("hide.bs.modal",function(){$("#pricePropModal").off("keydown")});b.checkPropBtn=function(a){return!0};b.checkViewBtn=function(a){return!0};b.checkActivateBtn=
function(a){return(b.isSystemuser()&&0!=b.data.currentMode.id||!b.isSystemuser()&&b.isRma()&&!b.data.currentMode.rma)&!a.isActive&&!a.isArchive};b.checkDeleteBtn=function(a){return a.isDraft&&!a.isArchive};b.checkEditBtn=function(a){return a.isDraft&&!a.isArchive};b.checkCopyBtn=function(a){return!a.isArchive};b.checkCloneBtn=function(a){return a.isDraft&&!a.isArchive&&b.data.currentMode.rma}}]);app=angular.module("portalNMC");app.directive("fileread",[function(){return{scope:{fileread:"="},link:function(a,b,d){b.bind("change",function(b){var d=new FileReader;d.onload=function(b){a.$apply(function(){a.fileread=b.target.result})};d.readAsText(b.target.files[0])})}}}]);
app.controller("TempSchCtrl",["$scope","$rootScope","$cookies","$window","$http","$location","crudGridDataFactory","FileUploader","notificationFactory","indicatorSvc","mainSvc","$timeout","objectSvc",function(a,b,d,g,l,k,h,p,m,n,e,c,f){a.ctrlSettings={};a.ctrlSettings.ctxId="temp_sch_page";a.ctrlSettings.dateFormat="DD.MM.YYYY";a.ctrlSettings.systemDateFormat="YYYY-MM-DD";a.ctrlSettings.isTempSchSort=!0;a.ctrlSettings.localPlacesUrl="../api/rma/localPlaces";a.ctrlSettings.tempSchUrl="../api/rma/temperatureCharts";
a.extraProps={idColumnName:"id",defaultOrderBy:"place",nameColumnName:"name"};a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.ctrlSettings.tempSchColumns=[{name:"localPlaceName",caption:"\u041d\u0430\u0441\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u043f\u0443\u043d\u043a\u0442","class":"col-xs-3 col-md-3",type:"name",sortable:!0},{name:"rsoOrganizationName",caption:"\u0420\u0421\u041e","class":"col-xs-4 col-md-4",type:"name",sortable:!0},{name:"chartName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",
"class":"col-xs-3 col-md-3",type:"name",sortable:!0},{name:"flagAdjPump",caption:"\u041a\u043e\u0440. \u043d\u0430\u0441","class":"nmc-td-for-buttons",type:"checkbox",sortable:!1},{name:"flagElevator",caption:"\u042d\u043b\u0435\u0432\u0430\u0442\u043e\u0440","class":"nmc-td-for-buttons",type:"checkbox",sortable:!1}];a.ctrlSettings.sstColumns=[{name:"sstDate",caption:"\u0414\u0430\u0442\u0430","class":"col-xs-3 col-md-3",type:"name",sortable:!0},{name:"sstCalcValue",caption:"\u0420\u0430\u0441\u0447\u0438\u0442\u0430\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435",
"class":"col-xs-4 col-md-4",type:"outnumber",sortable:!0,temperature:!0},{name:"sstValue",caption:"\u0412\u043d\u0435\u0441\u0435\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435","class":"col-xs-4 col-md-4",type:"input",editable:!0,temperature:!0}];a.ctrlSettings.emptySchedule={t_Ambience:"",t_In:"",t_Out:"",isDeleted:!1};a.data={};a.data.currentTempSch={};a.data.currentTempSch.schedules=[angular.copy(a.ctrlSettings.emptySchedule)];a.data.tempSchedules=[];a.data.currentLocalPlace=
{};a.data.aveTemps=[];a.data.rsoOrganizations=[];a.data.localPlaces=[];a.data.currentLocalPlace={};var r=function(a,b){var c=null;b.some(function(b){if(b.id==a)return c=angular.copy(b),!0});return c},q=function(a){a=e.errorCallbackHandler(a);m.errorInfo(a.caption,a.description)},v=function(b){l.get(a.ctrlSettings.tempSchUrl+"/"+b.id+"/items").then(function(a){b.schedules=a.data;b.schedules.forEach(function(a){a.isDeleted=!1})},q)},t=function(){l.get(a.ctrlSettings.tempSchUrl).then(function(b){a.data.tempSchedules=
angular.copy(b.data);a.data.tempSchedules.forEach(function(b){var c=r(b.localPlaceId,a.data.localPlaces);b.localPlaceName=null==c?"\u041d\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043e":c.localPlaceName;c=r(b.rsoOrganizationId,a.data.rsoOrganizations);b.rsoOrganizationName=null==c?"\u041d\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043e":c.organizationName;v(b)})},q)},u=function(){$("#showTempSchModal").modal("hide");$("#deleteWindowModal").modal("hide");t()},w=
function(){f.getRsoOrganizations().then(function(b){a.data.rsoOrganizations=b.data;t()},q)};a.getSST=function(b,d){if(e.checkUndefinedNull(d))return"dateString is undefined or null!";if(e.checkUndefinedNull(b))return"localPlaceId is undefined or null!";l.get(a.ctrlSettings.localPlacesUrl+"/"+b+"/sst?sstDateStr="+d).then(function(b){a.data.aveTemps=b.data;a.orderBy={field:"sstDate",asc:!0};c(function(){$(".nmc-input-numeric").inputmask()},10)},q)};a.saveSST=function(b,c){l.put(a.ctrlSettings.localPlacesUrl+
"/"+b+"/sst/array?sstDateStr="+c,a.data.aveTemps).then(function(d){m.success();a.getSST(b,c)},q)};a.sstKeydown=function(a,b,c){13==a.keyCode&&c<b.length-1&&$("#inputsstValue"+b[c+1].id).focus()};a.selectedItem=function(b){a.confirmCode=null;var c=e.getConfirmCode();a.confirmLabel=c.label;a.sumNums=c.result;a.data.currentTempSch=angular.copy(b)};a.setOrderBy=function(b){if(0==b.sortable)return"The field is not sortable.";a.orderBy={field:b.name,asc:a.orderBy.field===b.name?!a.orderBy.asc:!0}};a.addTempSch=
function(){a.data.currentTempSch={};a.data.currentTempSch.chartDeviationValue=3;a.data.currentTempSch.schedules=[angular.copy(a.ctrlSettings.emptySchedule)]};var x=function(b,c){l.post(a.ctrlSettings.tempSchUrl+"/"+b+"/items",c).then(function(a){},q)},E=function(b,c){l.put(a.ctrlSettings.tempSchUrl+"/"+b+"/items/"+c.id,c).then(function(a){},q)},G=function(b,c){l["delete"](a.ctrlSettings.tempSchUrl+"/"+b+"/items/"+c.id).then(function(a){},q)};a.addSchedule=function(b){b.schedules.push(angular.copy(a.ctrlSettings.emptySchedule));
a.ctrlSettings.isTempSchSort=!1};a.sortSchedulesByTAmbience=function(b){if(!angular.isArray(b))return"Schedules is not array;";e.sortItemsBy(b,"t_Ambience");a.ctrlSettings.isTempSchSort=!0};a.deleteSchedule=function(a,b){var c=e.checkUndefinedNull(a)?-1:a;-1!=c&&b.splice(c,1)};a.delSchItem=function(a){a.isDeleted=!0};a.isNumeric=function(a){return e.isNumeric(a)};a.checkSchRow=function(b){return a.isNumeric(b.t_Ambience)&&""<b.t_In&&""<b.t_Out&&0<Number(b.t_In)&&0<Number(b.t_Out)&&Number(b.t_In)>=
Number(b.t_Out)};a.isAddButtonEnabled=function(a,b){var c=0;b.forEach(function(a){1!=a.isDeleted&&(c+=1)});return a==c-1};a.isRemoveButtonEnabled=function(a){var b=!1,c=0;a.forEach(function(a){1!=a.isDeleted&&(c+=1)});1<c&&(b=!0);return b};var C=function(b){var c=!0;e.checkPositiveNumberValue(b.maxT)||(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u043f\u043e\u043b\u043e\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0447\u0438\u0441\u043b\u043e\u043c!"),
c=!1);e.checkPositiveNumberValue(b.minT)||(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u043f\u043e\u043b\u043e\u0436\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u043c \u0447\u0438\u0441\u043b\u043e\u043c!"),c=!1);Number(b.maxT)<Number(b.minT)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041c\u0430\u043a\u0441\u0438\u043c\u0430\u043b\u044c\u043d\u0430\u044f \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u0430 \u0434\u043e\u043b\u0436\u043d\u0430 \u0431\u044b\u0442\u044c \u0431\u043e\u043b\u044c\u0448\u0435 \u043c\u0438\u043d\u0438\u043c\u0430\u043b\u044c\u043d\u043e\u0439!"),
c=!1);e.checkUndefinedEmptyNullValue(b.chartName)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u0435 "\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),c=!1);e.checkUndefinedNull(b.localPlaceId)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u0435 "\u041d\u0430\u0441\u0435\u043b\u0435\u043d\u043d\u044b\u0439 \u043f\u0443\u043d\u043a\u0442" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),
c=!1);e.checkUndefinedNull(b.rsoOrganizationId)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u0435 "\u0420\u0421\u041e" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),c=!1);e.checkUndefinedEmptyNullValue(b.chartDeviationValue)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u0435 "\u0414\u043e\u043f\u0443\u0441\u0442\u0438\u043c\u043e\u0435 \u043e\u0442\u043a\u043b\u043e\u043d\u0435\u043d\u0438\u0435" \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),
c=!1);b.schedules.some(function(b){if(1!=b.isDeleted&&0==a.checkSchRow(b))return m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d \u0442\u0435\u043c\u043f\u0435\u0440\u0430\u0442\u0443\u0440\u043d\u044b\u0439 \u0433\u0440\u0430\u0444\u0438\u043a!"),c=!1,!0});return c},A=function(a){a.t_Ambience=Number(a.t_Ambience);a.t_In=Number(a.t_In);a.t_Out=Number(a.t_Out)},z=function(b){var c=
b.data.id;angular.isArray(a.data.currentTempSch.schedules)&&(a.sortSchedulesByTAmbience(a.data.currentTempSch.schedules),a.data.currentTempSch.schedules.forEach(function(a){1!=a.isDeleted&&(A(a),x(c,a))}));u()},H=function(b){var c=b.data.id;angular.isArray(a.data.currentTempSch.schedules)&&(a.sortSchedulesByTAmbience(a.data.currentTempSch.schedules),a.data.currentTempSch.schedules.forEach(function(a){if(1==a.isDeleted&&!e.checkUndefinedNull(a.id))return G(c,a),"Item (id = "+a.id+") of tempSch ("+
c+") was deleted!";A(a);e.checkUndefinedNull(a.id)?x(c,a):E(c,a)}));u()};a.saveTempSch=function(b,c){if(0==C(b))return"Temperature schedule is not valid!";var d=a.ctrlSettings.tempSchUrl,f="POST",B=z;e.checkUndefinedNull(b.id)||(f="PUT",B=H,d+="/"+b.id,b.localPlaceInfo=null,b.rsoOrganizationInfo=null);e.checkUndefinedNull(c)||(b.isOk=c);l({url:d,method:f,data:b}).then(B,q)};a.isSystemuser=function(){return e.isSystemuser()};a.deleteTempSch=function(b){l["delete"](a.ctrlSettings.tempSchUrl+"/"+b.id).then(u,
q)};a.inputTempBlur=function(a){if(e.checkUndefinedNull(a.maxT)||e.checkUndefinedNull(a.minT))return"Tmax or Tmin is null or undefined";if(e.checkUndefinedNull(a.chartName)||""==a.chartName)a.chartName=a.maxT+"/"+a.minT};var D=!1,I=function(){D=!0},B=function(a){D=!1;$("#"+a.currentTarget.id).off("focus",I)},O=function(b){if(107==b.keyCode||187==b.keyCode)a.addSchedule(a.data.currentTempSch),a.$apply();0==b.shiftKey&&9==b.keyCode&&1==D&&(a.addSchedule(a.data.currentTempSch),a.$apply())};a.scheduleKeydown=
function(b,c,d){13==b.keyCode&&(c==d-1?a.addSchedule(a.data.currentTempSch):$("#inputtAmbience"+(c+1)).focus())};a.initSchedule=function(b){c(function(){$("#inputtAmbience"+b).inputmask();$("#inputtAmbience"+b).focus();$("#inputTIn"+b).inputmask();$("#inputTOut"+b).inputmask();b<a.data.currentTempSch.schedules.length-1||($("#inputTOut"+b).focus(I),$("#inputTOut"+b).blur(B))},10)};$("#showTempSchModal").on("shown.bs.modal",function(){$("#inputTmax").focus();$("#showTempSchModal").keydown(O);$("#inputChartDeviation").inputmask()});
$("#showTempSchModal").on("hidden.bs.modal",function(){$("#showTempSchModal").off("keydown",O)});a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:a.ctrlSettings.dateFormat};$(document).ready(function(){c(function(){$(":input").inputmask()},10);$("#inputSSTDate").datepicker({dateFormat:"MM, yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,monthNamesShort:"\u042f\u043d\u0432 \u0424\u0435\u0432 \u041c\u0430\u0440 \u0410\u043f\u0440 \u041c\u0430\u0439 \u0418\u044e\u043d \u0418\u044e\u043b \u0410\u0432\u0433 \u0421\u0435\u043d \u041e\u043a\u0442 \u041d\u043e\u044f \u0414\u0435\u043a".split(" "),
changeMonth:!0,changeYear:!0,showButtonPanel:!0,closeText:"\u041e\u043a",currentText:"",onClose:function(b,c){$(this).datepicker("setDate",new Date(c.selectedYear,c.selectedMonth,1));a.data.currentSSTDate=moment(new Date(c.selectedYear,c.selectedMonth,1)).format(a.ctrlSettings.systemDateFormat);a.getSST(a.data.currentLocalPlace.id,a.data.currentSSTDate);setTimeout(function(){$(".ui-datepicker-calendar").addClass("nmc-hide")},1)},beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").addClass("nmc-hide");
$(".ui-datepicker-current").addClass("nmc-hide")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-current").addClass("nmc-hide");$(".ui-datepicker-calendar").addClass("nmc-hide")},1)}})});a.uploadFile=function(){if(e.checkUndefinedNull(a.data.dataFile))return m.errorInfo("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u0430","\u0424\u0430\u0439\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d."),"Management temperature schedules. File loading is failed";
var b=!1;a.data.dataFile.split("\n").forEach(function(c){var d=c.split(",");if(!angular.isArray(d))return console.log(c+" is not a correct data string!"),c+" is not a correct data string!";var z=new Date('"'+d[0]+'"');a.data.aveTemps.some(function(a){var c=new Date('"'+a.sstDate+'"');if(z.getTime()==c.getTime())return c=d[1],e.isNumeric(c)?(a.sstValue=Number(c),b=a.isChanged=!0):console.log(c+" is not a number"),!0})});1==b?m.successInfo("\u0424\u0430\u0439\u043b \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u0437\u0430\u0433\u0440\u0443\u0436\u0435\u043d."):
m.errorInfo("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 \u0444\u043e\u0440\u043c\u0430\u0442 \u0444\u0430\u0439\u043b\u0430");$("#upLoadFileModal").modal("hide")};a.uploadFileAlter=function(){if(e.checkUndefinedNull(a.data.dataFile))return m.errorInfo("\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 \u0444\u0430\u0439\u043b\u0430","\u0424\u0430\u0439\u043b \u043d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d."),
"Management temperature schedules. File loading is failed";var b=a.data.dataFile.split("\n");a.dataArray=[];b.forEach(function(b){var c=b.split(";");if(!angular.isArray(c))return console.log(b+" is not a correct data string!"),b+" is not a correct data string!";a.dataArray.push(c)});$("#upLoadFileModal").modal("hide")};(function(){l.get(a.ctrlSettings.localPlacesUrl+"/all").then(function(b){a.data.localPlaces=b.data;0<a.data.localPlaces.length&&(a.data.currentLocalPlace.id=a.data.localPlaces[0].id);
w()},q)})()}]);app=angular.module("portalNMC");
app.controller("MngmtUsersCtrl",["$scope","$rootScope","$resource","crudGridDataFactory","notificationFactory","$http","objectSvc","mainSvc",function(a,b,d,g,l,k,h,p){b.ctxId="management_rma_users_page";a.extraProps={idColumnName:"id",defaultOrderBy:"fullName",nameColumnName:"fullName"};a.ctrlSettings={};a.ctrlSettings.orgUrl="../api/rma/contObjects/cmOrganizations";a.ctrlSettings.clientsUrl="../api/rma/subscribers";a.ctrlSettings.rmaUrl="../api/rma";a.ctrlSettings.userUrlSuffix="/subscrUsers";a.ctrlSettings.userColumns=
[{name:"userName",caption:"\u041b\u043e\u0433\u0438\u043d","class":"col-xs-2 col-md-2"},{name:"userNickname",caption:"\u0418\u043c\u044f","class":"col-xs-3 col-md-3"},{name:"userComment",caption:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439","class":"col-xs-7 col-md-7"}];a.data={};a.data.organizations=[];a.data.clients=[];a.data.users=[];a.data.currentUser={};a.data.currentClient={};var m=function(b){k.get(a.ctrlSettings.rmaUrl+"/"+b+a.ctrlSettings.userUrlSuffix).then(function(b){b.data.forEach(function(a){a.subscrRoles.some(function(b){"ROLE_SUBSCR_ADMIN"==
b.roleName&&(a.isAdmin=!0);"ROLE_SUBSCR_READONLY"==b.roleName&&(a.isReadonly=!0)})});a.data.users=b.data},function(a){console.log(a)})},n=function(){k.get(a.ctrlSettings.clientsUrl).then(function(b){if(!angular.isArray(b.data)||0===b.data.length)return"Subscribers is incorrect!";b.data.forEach(function(a){if(p.checkUndefinedNull(a.organization))return!1;a.organizationName=a.organization.organizationFullName||a.organization.organizationName});a.data.clients=b.data;a.data.currentClient.id=a.data.clients[0].id;
m(a.data.currentClient.id)},function(a){console.log(a)})};(function(){k.get(a.ctrlSettings.orgUrl).then(function(b){a.data.organizations=b.data;n()},function(a){console.log(a)})})();a.selectedItem=function(b){b=angular.copy(b);a.data.currentUser=b};a.addUser=function(){a.data.currentUser={};a.data.currentUser.id=null;a.data.currentUser.isAdmin=!1;a.data.currentUser.isReadonly=!1;$("#showUserOptionModal").modal()};var e=function(b,c){l.success();$("#deleteUserModal").modal("hide");$("#showUserOptionModal").modal("hide");
m(a.data.currentClient.id)},c=function(a){a=p.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)};a.sendUserToServer=function(b){if(0==a.checkForm(b))return!1;var c=a.ctrlSettings.rmaUrl+"/"+a.data.currentClient.id+a.ctrlSettings.userUrlSuffix;angular.isDefined(b.id)&&null!=b.id?a.updateObject(c,b):a.addObject(c,b)};a.addObject=function(a,b){a+="/?isAdmin="+b.isAdmin;angular.isDefined(b.password)&&null!=b.password&&""!=b.password&&(a+="&newPassword="+b.password);angular.isDefined(b.isReadonly)&&
null!=b.isReadonly&&(a+="&isReadonly="+b.isReadonly);g(a).save(b,e,c)};a.deleteObject=function(b){g(a.ctrlSettings.rmaUrl+"/"+a.data.currentClient.id+a.ctrlSettings.userUrlSuffix)["delete"]({id:b[a.extraProps.idColumnName]},e,c)};a.updateObject=function(b,d){var f={id:d[a.extraProps.idColumnName]};angular.isDefined(d.isAdmin)&&null!=d.isAdmin&&(f.isAdmin=d.isAdmin);angular.isDefined(d.password)&&null!=d.password&&""!=d.password&&(f.oldPassword=d.curpassword,f.newPassword=d.password);angular.isDefined(d.isReadonly)&&
null!=d.isReadonly&&(f.isReadonly=d.isReadonly);g(b).update(f,d,e,c)};a.deleteObjectInit=function(b){a.selectedItem(b);a.confirmCode=null;b=p.getConfirmCode();a.confirmLabel=b.label;a.sumNums=b.result};a.changeClient=function(){m(a.data.currentClient.id)};a.emptyString=function(a){return p.checkUndefinedEmptyNullValue(a)};a.checkPassword=function(){return!(null==a.data.currentUser.id&&a.emptyString(a.data.currentUser.password)||a.data.currentUser.password!=a.data.currentUser.passwordConfirm)};a.checkForm=
function(b){var c=!0;a.emptyString(b.userNickname)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f!"),c=!1);a.emptyString(b.userName)&&(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043b\u043e\u0433\u0438\u043d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f!"),c=!1);a.checkPassword()||
(l.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043f\u0430\u0440\u043e\u043b\u044c!"),c=!1);return c};a.isSystemuser=function(){return p.isSystemuser()};a.isTestMode=function(){return p.isTestMode()};$(document).ready(function(){$("#inputUserName").inputmask({mask:"a[*{1,20}]",greedy:!1,definitions:{"*":{validator:"[0-9a-z!_-]",cardinality:1,casing:"lower"}}})});$("#showUserOptionModal").on("shown.bs.modal",
function(){$("#inputFirstName").focus()})}]);app=angular.module("portalNMC");
app.controller("ManagementServicesCtrl",["$rootScope","$scope","$http","mainSvc","notificationFactory",function(a,b,d,g,l){a.ctxId="management_services_page";b.ctrlSettings={};b.ctrlSettings.dateFormat="DD.MM.YYYY";b.ctrlSettings.subscrUrl="../api/subscr";b.ctrlSettings.servicesUrl=b.ctrlSettings.subscrUrl+"/manage/service";b.ctrlSettings.packagesUrl=b.ctrlSettings.servicesUrl+"/servicePackList";b.ctrlSettings.itemsUrl=b.ctrlSettings.servicesUrl+"/serviceItemList";b.ctrlSettings.priceUrl=b.ctrlSettings.servicesUrl+
"/servicePriceList";b.ctrlSettings.accountServicesUrl=b.ctrlSettings.servicesUrl+"/access";b.ctrlSettings.subscriberContObjectCountUrl=b.ctrlSettings.subscrUrl+"/info/subscriberContObjectCount";b.ctrlSettings.subscriberContObjectCount=null;b.ctrlSettings.currency="";b.availablePackages=null;b.serviceListEdition=null;b.packages=[];b.availablePackages=[];b.getSubscriberContObjectCount=function(a){d.get(a).then(function(a){b.ctrlSettings.subscriberContObjectCount=a.data},function(a){console.log(a)})};
b.getSubscriberContObjectCount(b.ctrlSettings.subscriberContObjectCountUrl);b.getPriceList=function(a){d.get(a).then(function(a){var c=a.data;b.availablePackages.forEach(function(a){c.forEach(function(c){c.packId!==a.id||!angular.isUndefined(c.itemId)&&null!==c.itemId||(a.price=c,b.ctrlSettings.currency=c.currency)});a.serviceItems.forEach(function(a){c.forEach(function(c){!angular.isUndefined(c.packId)&&null!==c.packId||c.itemId!==a.id||(a.price=c,b.ctrlSettings.currency=c.currency)})})});b.ctrlSettings.currency=
""},function(a){console.log(a)})};b.getPackages=function(a){d.get(a).then(function(a){b.availablePackages=a.data;b.getPriceList(b.ctrlSettings.priceUrl);b.getSelectedPackages(b.ctrlSettings.accountServicesUrl)},function(a){console.log(a)})};var k=function(a,b){$(a).qtip({suppress:!1,content:{text:b,button:!0},show:{event:"click"},style:{classes:"qtip-nmc-indicator-tooltip",width:1E3},hide:{event:"unfocus"},position:{my:"top left",at:"bottom left"}})};b.getSelectedPackages=function(a){d.get(a).then(function(a){a.data.forEach(function(a){b.availablePackages.forEach(function(b){b.id!==
a.packId||a.hasOwnProperty("itemId")||(b.selected=!0);b.serviceItems.forEach(function(c){b.id===a.packId&&a.hasOwnProperty("itemId")&&c.id===a.itemId&&(c.selected=!0)})})});b.availablePackages.forEach(function(a){k("#package"+a.id,a.packDescription);a.serviceItems.forEach(function(a){k("#service"+a.id,a.itemDescription)})})},function(a){console.log(a)})};b.getPackages(b.ctrlSettings.packagesUrl);var h=function(a){!0===a.selected?a.changedFlag+=1:--a.changedFlag};b.serviceClick=function(a,b){h(b);
var c=!1;a.serviceItems.some(function(a){if(1!=a.selected)return c=!0});!1===c&&(a.selected=!0)};var p=function(a,b){var c=[];angular.isArray(a)&&a.forEach(function(a){var d=angular.copy(a),e=!1;d.serviceItems=[];a.serviceItems.forEach(function(a){a.changedFlag==b&&(a=angular.copy(a),d.serviceItems.push(a),e=!0)});1==e&&c.push(d)});return c};b.checkPackages=function(){b.serviceAddedList=[];b.serviceRemovedList=[];b.serviceAddedList=p(b.serviceListEdition,1);b.serviceRemovedList=p(b.serviceListEdition,
-1);b.confirmCode=null;var a=g.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result;$("#confirmSavingModal").modal()};var m=function(a){var c=[];b.serviceListEdition.forEach(function(a){!0===a.selected&&c.push({packId:a.id});a.serviceItems.forEach(function(b){!0===b.selected&&c.push({packId:a.id,itemId:b.id})})});return c},n=function(a){a=g.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)};b.savePackages=function(){var a=b.ctrlSettings.accountServicesUrl,e=null,e=m(b.serviceListEdition);
d.put(a,e).then(function(a){location.reload()},n)};b.toggleShowGroupDetails=function(a){a.showDetailsFlag=!a.showDetailsFlag};var e=function(a){a.forEach(function(a){a.changedFlag=0;a.serviceItems.forEach(function(a){a.changedFlag=0})})};b.editPackages=function(){b.serviceListEdition=angular.copy(b.availablePackages);e(b.serviceListEdition);$("#editServiceListModal").modal()};$("#editServiceListModal").on("show.bs.modal",function(a){window.setTimeout(function(){b.serviceListEdition.forEach(function(a){k("#editpackage"+
a.id,a.packDescription);a.serviceItems.forEach(function(a){k("#editservice"+a.id,a.itemDescription)})})},500)});b.packClick=function(a){!0===a.selected?a.changedFlag+=1:--a.changedFlag;angular.isArray(a.serviceItems)&&a.serviceItems.forEach(function(b){b.selected!==a.selected&&(b.selected=a.selected,h(b))})};b.isSystemuser=function(){return g.isSystemuser()};b.isAdmin=function(){return g.isAdmin()};b.isSystemViewInfo=function(){return g.getViewSystemInfo()}}]);app=angular.module("portalNMC");
app.controller("MonitorCtrl",["$rootScope","$http","$scope","$compile","$interval","$cookies","$location","objectSvc","monitorSvc","mainSvc","$timeout",function(a,b,d,g,l,k,h,p,m,n,e){function c(a){var b=null;d.objects.some(function(c){if(c.contObject.id===a)return b=c,!0});return b}function f(b){var c=document.getElementById("obj"+b.contObject.id);if(!angular.isUndefined(c)&&null!=c&&(c=c.getElementsByClassName("nmc-tr-object-events")[0],!angular.isUndefined(c)&&null!=c)){var e="",e='<td colspan=\'5\' style="padding-top: 2px !important;"><table id="eventTable'+
b.contObject.id+'" class="crud-grid table table-lighter table-bordered table-condensed table-hover nmc-child-table">',e=e+"<thead>",e=e+'<tr class="nmc-child-table-header">',e=e+'<th class="nmc-td-for-buttons">',e=e+"</th>";d.eventColumns.forEach(function(a){e+="<th>";e+=a.header||a.name;e+="</th>"});e+="</tr>";e+="</thead>";!angular.isUndefined(b)&&b.hasOwnProperty("eventTypes")&&0!=b.eventTypes.length&&(b.eventTypes.forEach(function(c){e+='<tr id="trEvent'+c.id+'" >';e+='<td class="nmc-td-for-buttons"><a href="#/notices/list/?objectMonitorId='+
b.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"&typeId="+c.id+'" ng-mousedown="setNoticeFilterByObjectAndType('+b.contObject.id+","+c.id+')"> <i class="btn btn-xs glyphicon glyphicon-list nmc-button-in-table"title="\u041f\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f"></i></a></td>';d.eventColumns.forEach(function(a){switch(a.name){case "typeName":e+='<td class="col-md-11" ng-class="{\'nmc-positive-notice\':'+
!c.isBaseEvent+'}">'+c[a.name];d.isSystemuser()&&(e+="<span>(id = "+c.id+")</span>");e+="</td>";break;case "typeCategory":var b=16,z="";"green"==c[a.name]&&(b=1);switch(c[a.name]){case "red":z="\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f";break;case "orange":z="\u041d\u0435\u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f";break;case "yellow":z="\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435";
break;case "red-mono":z="\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f";break;case "orange-mono":z="\u041d\u0435\u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f";break;case "yellow-mono":z="\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435"}e+='<td><img title="'+z+'" height="'+b+'" width="'+b+'" src="images/object-state-'+c[a.name]+'.png"/></td>';
break;default:e+="<td ng-class=\"{'nmc-positive-notice':"+!c.isBaseEvent+'}"> '+c[a.name]+"</td>"}});e+="</tr>"}),e+="</table></td>",c.innerHTML=e,g(c)(d))}}function r(a,b){return"<div style='font-size:8pt; text-align:center; padding:2px; color:black;'>"+a+" ("+Math.round(b.percent)+"%)</div>"}a.ctxId="monitor_page";d.messages={};d.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";d.messages.treeMenuHeader=
"\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";d.messages.noObjects="";d.objects=m.getAllMonitorObjects();a.monitorStart=h.search().fromDate||m.getMonitorSettings().fromDate||moment().subtract(6,"days").startOf("day").format("YYYY-MM-DD");a.monitorEnd=h.search().toDate||m.getMonitorSettings().toDate||moment().endOf("day").format("YYYY-MM-DD");d.monitorSettings={};d.monitorSettings.refreshPeriod=m.getMonitorSettings().refreshPeriod;
d.monitorSettings.createRoundDiagram=!1;d.monitorSettings.loadingFlag=m.getMonitorSettings().loadingFlag;d.monitorSettings.treeLoadingFlag=!0;d.monitorSettings.noGreenObjectsFlag=m.getMonitorSettings().noGreenObjectsFlag||!1;d.monitorSettings.objectsPerScroll=34;d.monitorSettings.objectsOnPage=d.monitorSettings.objectsPerScroll;d.monitorSettings.currentScrollYPos=window.pageYOffset||document.documentElement.scrollTop;d.monitorSettings.objectTopOnPage=0;d.monitorSettings.objectBottomOnPage=34;d.monitorSettings.isCtrlEnd=
!1;d.monitorSettings.ctxId="monitor_page";var q={timeout:m.getRequestCanceler().promise};d.monitorSettings.dateRangeSettings=n.getDateRangeOptions("monitor-ru");d.monitorSettings.monitorDates={startDate:a.monitorStart,endDate:a.monitorEnd};d.objectsOnPage=0===d.objects.length?[]:d.objects.slice(0,d.monitorSettings.objectsPerScroll);d.objectsOnPage.forEach(function(a){m.getMonitorEventsByObject(a)});var v=function(a){d.monitorSettings.loadingFlag=!1;d.monitorSettings.treeLoadingFlag=!1;m.setMonitorSettings({loadingFlag:!1});
console.log(a)};d.monitorState={};d.getMonitorState=function(){b.get("../api/subscr/contEvent/notifications/monitorColor?fromDate="+a.monitorStart+"&toDate="+a.monitorEnd,q).success(function(a){d.monitorState=a;a=document.getElementById("monitorTab");a.style.backgroundColor=d.monitorState.statusColor.toLowerCase();if("RED"===d.monitorState.statusColor||"ORANGE"==d.monitorState.statusColor)a.style.color="#eee";a.title=d.monitorState.colorDescription}).error(function(a){console.log(a)})};d.eventColumns=
[{name:"typeCategory",header:" ","class":""},{name:"typeEventCount",header:" ","class":""},{name:"typeName",header:"\u0422\u0438\u043f\u044b \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439","class":"col-md-10"}];d.getEventTypesByObject=function(e,g){var h=c(e);null!=h&&b.get("../api/subscr/contEvent/notifications/contObject/"+h.contObject.id+"/eventTypes/statusCollapse?fromDate="+a.monitorStart+"&toDate="+a.monitorEnd,q).success(function(a){if(a.hasOwnProperty("length")&&0!=a.length){var b=
[];a.forEach(function(a){var c={};c.id=a.contEventType.id;c.isBaseEvent=a.contEventType.isBaseEvent;c.typeCategory=a.statusColor.toLowerCase();var d=!1;angular.isArray(h.monitorEventsForMap)&&h.monitorEventsForMap.some(function(a){if(a.contEventType.id==c.id)return d=!0});d||(c.typeCategory+="-mono");c.typeEventCount=a.totalCount;c.typeName=a.contEventType.caption;b.push(c)});b.sort(function(a,b){return a.typeEventCount>b.typeEventCount?-1:a.typeEventCount<b.typeEventCount?1:0});h.eventTypes=b;g?
d.runChart(h.contObject.id):f(h)}}).error(function(a){console.log(a)})};d.toggleShowGroupDetails=function(a){var b=null;d.objects.some(function(c){if(c.contObject.id===a)return b=c,!0});if(null!=b){var c=document.getElementById("eventTable"+b.contObject.id);b.showGroupDetails=1==b.showGroupDetails&&null==c?!0:!b.showGroupDetails;c=null;!0===b.showGroupDetails?(d.getEventTypesByObject(b.contObject.id,!1),c=document.getElementById("btnDetail"+b.contObject.id),c.classList.remove("glyphicon-chevron-right"),
c.classList.add("glyphicon-chevron-down")):(document.getElementById("obj"+b.contObject.id).getElementsByClassName("nmc-tr-object-events")[0].innerHTML="",c=document.getElementById("btnDetail"+b.contObject.id),c.classList.remove("glyphicon-chevron-down"),c.classList.add("glyphicon-chevron-right"))}};d.getNoticesByObjectOnRightClick=function(a){d.setNoticeFilterByObject(a);window.open("#/notices/list/")};d.getNoticesByObjectAndRevisionOnRightClick=function(a){d.setNoticeFilterByObjectAndRevision(a);
window.open("#/notices/list/")};d.setNoticeFilterByObject=function(b){a.monitor={};m.setMonitorSettings({objectMonitorId:b});a.reportStart=a.monitorStart;a.reportEnd=a.monitorEnd};d.setNoticeFilterByObjectAndRevision=function(a){d.setNoticeFilterByObject(a);k.isNew=!0};d.setNoticeFilterByObjectAndType=function(a,b){d.setNoticeFilterByObject(a);k.typeIds=[b]};d.getNoticesByObjectAndType=function(a,b){d.setNoticeFilterByObjectAndType(a,b);window.open("#/notices/list/")};d.isSystemuser=function(){d.userInfo=
a.userInfo;return d.userInfo._system};d.refreshData=function(){d.monitorSettings.loadingFlag=!0;a.$broadcast("monitor:updateObjectsRequest")};d.getMonitor=function(a){m.checkUndefinedNull(a)?(d.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",d.monitorSettings.contGroupId=null,m.setMonitorSettings({contGroupId:null})):(d.monitorSettings.contGroupId=a.id,m.setMonitorSettings({contGroupId:a.id}),d.messages.groupMenuHeader=
a.contGroupName);d.refreshData()};d.getAllColorObjects=function(){d.monitorSettings.loadingFlag=!0;d.monitorSettings.noGreenObjectsFlag=!1;m.setMonitorSettings({noGreenObjectsFlag:!1});a.$broadcast("monitor:updateObjectsRequest")};d.getNoGreenObjects=function(){d.monitorSettings.loadingFlag=!0;d.monitorSettings.noGreenObjectsFlag=!0;m.setMonitorSettings({noGreenObjectsFlag:!0});a.$broadcast("monitor:updateObjectsRequest")};d.$watch("monitorSettings.monitorDates",function(b,c){c!==b&&(d.monitorSettings.loadingFlag=
!0,a.monitorStart=moment(b.startDate).format("YYYY-MM-DD"),a.monitorEnd=moment(b.endDate).format("YYYY-MM-DD"),m.setMonitorSettings({fromDate:a.monitorStart,toDate:a.monitorEnd}),d.monitorSettings.dateRangeSettings.startDate=moment(a.monitorStart).startOf("day"),d.monitorSettings.dateRangeSettings.endDate=moment(a.monitorEnd).endOf("day"),h.search("fromDate",a.monitorStart),h.search("toDate",a.monitorEnd),a.$broadcast("monitor:updateObjectsRequest"))},!1);d.$on("monitorObjects:getObjectEvents",function(a,
b){var c=b.obj;$("#imgObj"+c.contObject.id).qtip({content:{text:c.monitorEvents},style:{classes:"qtip-bootstrap qtip-nmc-monitor-tooltip"}})});d.$on("monitorObjects:updated",function(){d.monitorSettings.isTreeView=m.getMonitorSettings().isTreeView;d.objects=m.getAllMonitorObjects();window.scrollTo(0,0);d.monitorSettings.currentScrollYPos=window.pageYOffset||document.documentElement.scrollTop;d.monitorSettings.objectTopOnPage=0;d.monitorSettings.objectBottomOnPage=34;var a=d.objects.slice(0,d.monitorSettings.objectsPerScroll);
d.monitorSettings.loadingFlag=m.getMonitorSettings().loadingFlag;d.monitorSettings.noGreenObjectsFlag=m.getMonitorSettings().noGreenObjectsFlag;d.monitorSettings.objectsOnPage=d.monitorSettings.objectsPerScroll;d.objectsOnPage=a;d.objectsOnPage.forEach(function(a){m.getMonitorEventsByObject(a)});var a=document.getElementsByClassName("qtip"),b;for(b=0;b<a.length;b+=1)a[b].style.display="none"});d.$on("$destroy",function(){window.onkeydown=void 0});window.onkeydown=function(b){var c=null;38==b.keyCode?
(c=document.getElementById("divWithMonitorTable"),c.scrollTop-=20):40==b.keyCode?(c=document.getElementById("divWithMonitorTable"),c.scrollTop+=20):34==b.keyCode?(c=document.getElementById("divWithMonitorTable"),c.scrollTop+=10*d.monitorSettings.objectsPerScroll):33==b.keyCode?(c=document.getElementById("divWithMonitorTable"),c.scrollTop-=10*d.monitorSettings.objectsPerScroll):b.ctrlKey&&36==b.keyCode?(c=document.getElementById("divWithMonitorTable"),c.scrollTop=0):b.ctrlKey&&35==b.keyCode&&(d.monitorSettings.objectsOnPage<
d.objects.length&&(d.monitorSettings.loadingFlag=!0,e(function(){d.monitorSettings.loadingFlag=!1},d.objects.length)),b=d.objects.slice(d.monitorSettings.objectsOnPage,d.objects.length),b.forEach(function(b){"RED"===b.statusColor||"ORANGE"===b.statusColor?m.getMonitorEventsByObject(b):"YELLOW"===b.statusColor&&(b.monitorEvents="\u041d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043d\u0435\u0442 \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439",
a.$broadcast("monitorObjects:getObjectEvents",{obj:b}))}),Array.prototype.push.apply(d.objectsOnPage,b),d.monitorSettings.objectsOnPage+=d.objects.length,d.$apply(),c=document.getElementById("divWithMonitorTable"),c.scrollTop=c.scrollHeight)};d.$watch("monitorSettings.refreshPeriod",function(b,c){b!==c&&(m.setMonitorSettings({refreshPeriod:d.monitorSettings.refreshPeriod}),a.$broadcast("monitor:periodChanged"))},!1);0!=d.objects.length?(d.objects.slice(0,d.monitorSettings.objectsPerScroll),d.monitorSettings.loadingFlag=
m.getMonitorSettings().loadingFlag,angular.isDefined(m.getMonitorSettings().objectMonitorId)&&"null"!==m.getMonitorSettings().objectMonitorId&&(d.getEventTypesByObject(Number(m.getMonitorSettings().objectMonitorId),!1),m.setMonitorSettings({objectMonitorId:null}))):!1===d.monitorSettings.loadingFlag&&a.$broadcast("monitor:updateObjectsRequest");d.$on("$destroy",function(){window.onscroll=void 0});d.setMonitorEventsForObject=function(a){if(!angular.isUndefined(a.monitorEvents)){var b="#imgObj"+a.contObject.id;
$(b).ready(function(){$(b).qtip({content:{text:a.monitorEvents},style:{classes:"qtip-bootstrap qtip-nmc-monitor-tooltip"}})})}};d.addMoreObjectsForMonitor=function(){if(!(0>=d.objects.length)){var a=d.monitorSettings.objectsOnPage+d.monitorSettings.objectsPerScroll;a>=d.objects.length&&(a=d.objects.length);var b=d.objects.slice(d.monitorSettings.objectsOnPage,a);Array.prototype.push.apply(d.objectsOnPage,b);b.forEach(function(a){m.getMonitorEventsByObject(a)});d.monitorSettings.objectsOnPage=a>=d.objects.length?
d.objects.length:d.monitorSettings.objectsOnPage+d.monitorSettings.objectsPerScroll}};$("#divWithMonitorTable").scroll(function(){d.addMoreObjectsForMonitor();d.$apply()});var t=function(a){var b=!1;n.getContextIds().forEach(function(c){0==c.permissionTagId.localeCompare(a)&&(b=!0);var d=document.getElementById(c.permissionTagId);angular.isUndefined(d)||null==d||$("#"+c.permissionTagId).removeClass("nmc-hide")});0==b&&window.location.assign("#/notices/list")};t(d.monitorSettings.ctxId);a.$on("servicePermissions:loaded",
function(){t(d.monitorSettings.ctxId)});window.setTimeout(function(){t(d.monitorSettings.ctxId)},500);d.runChart=function(a){var b=-1;d.objects.some(function(c,d){if(c.contObject.id==a)return b=d,!0});if(-1!=b){var c=[],e;for(e=0;e<d.objects[b].eventTypes.length;e+=1)c[e]={label:d.objects[b].eventTypes[e].typeName,data:d.objects[b].eventTypes[e].typeEventCount};d.monitorSettings.createRoundDiagram=!1;$("#noticeChart-area").width(300);$("#noticeChart-area").height(300);$("#chartModal.modal-dialog").width(700);
$("#chartModal").modal();$.plot("#noticeChart-area",c,{series:{pie:{show:!0,label:{show:!1,formatter:r}}},legend:{show:!0,labelFormatter:r,position:"ne",margin:[-400,0]}})}};d.monitorSettings.isTreeView=!0;d.monitorSettings.isFullObjectView=!1;d.data.currentTree={};d.data.newTree={};d.data.defaultTree=null;d.viewFullObjectList=function(){d.monitorSettings.isFullObjectView=!0;d.monitorSettings.loadingFlag=!0;d.messages.treeMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";
m.setMonitorSettings({curTreeId:null,curTreeNodeId:null,isFullObjectView:!0});m.setMonitorSettings({currentTree:null,currentTreeNode:null});a.$broadcast("monitor:updateObjectsRequest")};d.selectNode=function(b){var c=d.data.currentTree,e=d.data.selectedNode;if(!n.checkUndefinedNull(e)){if(e.id==b.id||e.type==b.type=="root")return;c=n.findNodeInTree(e,c);n.checkUndefinedNull(c)||(c.isSelected=!1)}b.isSelected=!0;d.data.selectedNode=angular.copy(b);d.monitorSettings.loadingFlag=!0;d.messages.noObjects=
"\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";m.setMonitorSettings({loadingFlag:!0,curTreeId:d.data.currentTree.id,curTreeNodeId:b.id});m.setMonitorSettings({currentTree:angular.copy(d.data.currentTree),currentTreeNode:angular.copy(b)});a.$broadcast("monitor:updateObjectsRequest")};d.data.trees=[];d.loadTree=function(a,b){d.monitorSettings.treeLoadingFlag=!0;p.loadSubscrTree(a.id).then(function(c){d.monitorSettings.treeLoadingFlag=!1;d.messages.treeMenuHeader=a.objectName||
a.id;c=angular.copy(c.data);n.sortTreeNodesBy(c,"objectName");d.data.currentTree=c;m.setMonitorSettings({currentTree:angular.copy(d.data.currentTree),curTreeId:d.data.currentTree.id});if(!n.checkUndefinedNull(b))return n.findItemBy(d.data.trees,"id",c.id),c=n.findNodeInTree(b,d.data.currentTree),d.selectNode(c),"Current node is set.";d.objects=[];d.objectsOnPage=[];d.monitorSettings.isFullObjectView=!1;m.setMonitorSettings({isFullObjectView:!1});m.setMonitorSettings({currentTreeNode:null,curTreeNodeId:null});
d.messages.noObjects=""},v)};var u=function(a){d.monitorSettings.treeLoadingFlag=!0;p.loadSubscrTrees().then(function(b){d.monitorSettings.treeLoadingFlag=!1;n.sortItemsBy(b.data,"objectName");d.data.trees=angular.copy(b.data);n.checkUndefinedNull(a)||1!=a.isActive||(d.data.defaultTree=n.findItemBy(d.data.trees,"id",Number(a.value)));b=m.getMonitorSettings().currentTree;var c=m.getMonitorSettings().currentTreeNode;d.monitorSettings.isFullObjectView=m.getMonitorSettings().isFullObjectView;if(!n.checkUndefinedNull(b)&&
!n.checkUndefinedNull(c))return d.loadTree(b,c),"Current tree and current tree node is defined.";if(!angular.isArray(d.data.trees)||0>=d.data.trees.length||n.checkUndefinedNull(d.data.defaultTree)||1==d.monitorSettings.isFullObjectView)return d.viewFullObjectList(),"View full object list";m.setMonitorSettings({currentTree:d.data.defaultTree,curTreeId:d.data.defaultTree.id});d.loadTree(d.data.defaultTree)},v)};(function(){d.data.selectedNode=null;m.loadDefaultMonitorTreeSetting().then(function(a){u(a.data)},
v)})()}]);angular.module("portalNMC").controller("MonitorMapCtrl",function(a,b,d,g,l,k,h,p,m){function n(a){var c=null;b.objects.some(function(b){if(b.contObject.id===a)return c=b,!0});return c}a.ctxId="monitor_map_page";b.mapSettings={};b.mapSettings.zoomBound=9;b.mapSettings.loadingFlag=k.getLoadingStatus();b.mapSettings.ctxId="monitor_map_page";var e=[],c=[];b.objects=k.getAllMonitorObjects();console.log(b.objects);b.cities=k.getAllMonitorCities();console.log(b.cities);angular.isDefined(k.getMonitorSettings().mapZoomDetail)&&
(b.mapSettings.zoomDetail=Number(k.getMonitorSettings().mapZoomDetail));b.izhevsk={lat:56.85,lng:53.216667,zoom:8};d=b.izhevsk;angular.isDefined(k.getMonitorSettings().mapZoom)&&(d.zoom=Number(k.getMonitorSettings().mapZoom));angular.isDefined(k.getMonitorSettings().mapCenterLat)&&(d.lat=Number(k.getMonitorSettings().mapCenterLat));angular.isDefined(k.getMonitorSettings().mapCenterLng)&&(d.lng=Number(k.getMonitorSettings().mapCenterLng));angular.extend(b,{mapCenter:d});var f={type:"extraMarker",icon:"fa-home",
markerColor:"blue",prefix:"fa",shape:"circle"};b.currentTile={url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}};b.getEventTypesByObjectModFn=function(b){b=n(b);if(null!=b)return l.get("../api/subscr/contEvent/notifications/contObject/"+b.contObject.id+"/eventTypes/statusCollapse?fromDate="+a.monitorStart+"&toDate="+a.monitorEnd)};b.prepareObjectMarker=function(c){var d="<div id='"+
c.contObject.id+"'>",d=d+(""+c.contObject.fullName+"<br>"),d=d+"<hr class='nmc-hr-in-modal'>"+("\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439: <a title='\u0412\u0441\u0435\u0433\u043e \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439' href='#/notices/list/?objectMonitorId="+c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"' ng-mousedown='setNoticeFilterByObject("+c.contObject.id+")'>"+c.eventsCount+"</a>, \u043d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0445: <a title='\u041d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f' href='#/notices/list/?objectMonitorId="+
c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"&isNew=true' ng-mousedown='setNoticeFilterByObjectAndRevision("+c.contObject.id+")'>"+c.newEventsCount+"</a><br>");marker={focus:!1};marker.lng=c.contObject.contObjectGeo.geoPosX;marker.lat=c.contObject.contObjectGeo.geoPosY;marker.getMessageScope=function(){var a=b.$new(!0);angular.extend(a,{setNoticeFilterByObject:b.setNoticeFilterByObject});angular.extend(a,{setNoticeFilterByObjectAndRevision:b.setNoticeFilterByObjectAndRevision});
angular.extend(a,{setNoticeFilterByObjectAndType:b.setNoticeFilterByObjectAndType});b.getEventTypesByObjectModFn(c.contObject.id).success(function(b){if(b.hasOwnProperty("length")&&0!=b.length){var d=[];b.forEach(function(a){var b={};b.id=a.contEventType.id;b.isBaseEvent=a.contEventType.isBaseEvent;b.typeCategory=a.statusColor.toLowerCase();b.typeEventCount=a.totalCount;b.typeName=a.contEventType.caption;d.push(b)});d.sort(function(a,b){return a.typeEventCount>b.typeEventCount?-1:a.typeEventCount<
b.typeEventCount?1:0});c.eventTypes=d;if(angular.isDefined(c.eventTypes)){var e=[];c.eventTypes.forEach(function(a){var b={};b.id=a.id;var c=16,d="";"green"==a.typeCategory&&(c=1);switch(a.typeCategory){case "red":d="\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f";break;case "orange":d="\u041d\u0435\u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f"}b.size=c;b.title=
d;b.imgpath="images/object-state-"+a.typeCategory+".png";b.name=a.typeName;b.count=a.typeEventCount;e.push(b)});angular.extend(a,{eventMessages:e})}}}).error(function(a){console.log(a)});return a};marker.message=""+(d+"<hr class='nmc-hr-in-modal'>")+"<div ng-repeat='em in eventMessages'> <a href='#/notices/list/?objectMonitorId="+c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"&typeId=em.id' ng-mousedown='setNoticeFilterByObjectAndType("+c.contObject.id+",em.id)'><img ng-attr-title='{{em.title}}'ng-src='{{em.imgpath}}'/>{{em.name}} ({{em.count}}) </a></div></div>";
marker.compileMessage=!0;marker.icon={};marker.icon=angular.copy(f);marker.contObjectId=c.contObject.id;marker.isCityMarker=!1;marker.icon.markerColor="orange"===c.statusColor.toLowerCase()?"orange":c.statusColor.toLowerCase();return marker};var r=function(a){document.getElementsByClassName("leaflet-pane leaflet-popup-pane")[0].innerHTML="";var c={},d=null;b.cities.some(function(b){if(b.cityFiasUUID===a)return c.lat=b.cityGeoPosY,c.lng=b.cityGeoPosX,d=b,!0});c.zoom=b.mapSettings.zoomDetail||b.mapSettings.zoomBound+
2;angular.extend(b,{mapCenter:c});var f=d.contEventNotificationStatuses;e=[];e=b.setObjectsOnMap(f);b.viewCurrentCityObjectsFlag=!0;b.markersOnMap=e},q=function(a){b.currentCity={};b.cities.some(function(c){if(c.cityFiasUUID===a)return b.currentCity=angular.copy(c),!0});var c=b.currentCity.contEventNotificationStatuses;h.sortObjectsByConObjectFullName(c);c.forEach(function(a){"RED"!==a.statusColor&&"ORANGE"!==a.statusColor||k.getMonitorEventsByObject(a)});$("#showObjectsDetailModal").modal()};b.prepareCityMarker=
function(a){if(null!==a.cityGeoPosX&&null!==a.cityGeoPosY){var c="<div id='"+a.cityFiasUUID+"'>",c=c+(""+a.cityName+", "+a.contEventNotificationStatuses.length+" \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 <button class='glyphicon glyphicon-search marginLeft5' ng-click='viewObjectsOnMap(\""+a.cityFiasUUID+"\")' title='\u0421\u043c. \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043a\u0430\u0440\u0442\u0435'></button><br>"),c=c+"<hr class='nmc-hr-in-modal'>"+(""+a.monitorEventCount+
" \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439");0!==a.monitorEventCount&&(c+="<button class='marginLeft5' ng-click='viewObjectDetails(\""+a.cityFiasUUID+"\")'>\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435...</button>");var d={focus:!1};d.lng=a.cityGeoPosX;d.lat=a.cityGeoPosY;d.getMessageScope=function(){var a=b.$new(!0);angular.extend(a,{curMarker:d});angular.extend(a,{viewObjectsOnMap:r});angular.extend(a,{viewObjectDetails:q});
return a};d.message=""+c+"";d.compileMessage=!0;d.icon=angular.copy(f);d.cityFiasUUID=a.cityFiasUUID;d.icon.markerColor="orange"===a.cityContEventLevelColor.toLowerCase()?"orange":a.cityContEventLevelColor.toLowerCase();d.isCityMarker=!0;return d}};b.setCitiesOnMap=function(a,c){if(angular.isArray(a)&&0!==a.length&&angular.isArray(c))return a.forEach(function(a){if(angular.isUndefined(a.cityGeoPosX)||angular.isUndefined(a.cityGeoPosY)||null===a.cityGeoPosX||null===a.cityGeoPosY)console.warn("Warning. City without coordinates."),
console.warn(a);else{var d={},e=!1;angular.isDefined(c.length)&&0!=c.length&&c.some(function(b){if(angular.isUndefined(b.cityFiasUUID))return!1;if(a.cityFiasUUID===b.cityFiasUUID)return d=b,e=!0});d=b.prepareCityMarker(a);!0!==e&&c.push(d)}}),c};b.setObjectsOnMap=function(a){var c=[];if(angular.isArray(a)&&0!==a.length&&angular.isArray(c))return a.forEach(function(a){angular.isUndefined(a.contObject.contObjectGeo)||angular.isUndefined(a.contObject.contObjectGeo.geoPosX)||null===a.contObject.contObjectGeo||
null===a.contObject.contObjectGeo.geoPosX?(console.warn("Warning. Object without coordinates."),console.warn(a)):(a=b.prepareObjectMarker(a),c.push(a))}),c};b.mapCenter.zoom>b.mapSettings.zoomBound?(e=[],e=b.setObjectsOnMap(b.objects)):(e=[],b.setCitiesOnMap(b.cities,e));c=e;angular.extend(b,{markersOnMap:c});b.$on("monitorObjects:updated",function(){b.objects=k.getAllMonitorObjects();b.cities=k.getAllMonitorCities();b.mapCenter.zoom>b.mapSettings.zoomBound?(e=[],e=b.setObjectsOnMap(b.objects)):(e=
[],b.setCitiesOnMap(b.cities,e));m(function(){angular.isArray(b.markersOnMap)&&0===b.markersOnMap.length?(c=e,angular.extend(b,{markersOnMap:c})):b.markersOnMap=e},10);b.mapSettings.loadingFlag=!1});b.$watch("mapCenter.zoom",function(a,d){k.setMonitorSettings({mapZoom:a});if(a>b.mapSettings.zoomBound&&d<=b.mapSettings.zoomBound){var f=document.getElementsByClassName("leaflet-pane leaflet-popup-pane");f[0].innerHTML="";if(!0===b.viewCurrentCityObjectsFlag){b.viewCurrentCityObjectsFlag=!1;return}e=
[];e=b.setObjectsOnMap(b.objects)}a<=b.mapSettings.zoomBound&&d>b.mapSettings.zoomBound&&(f=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),f[0].innerHTML="",e=[],b.setCitiesOnMap(b.cities,e));m(function(){angular.isArray(b.markersOnMap)&&0===b.markersOnMap.length?(c=e,angular.extend(b,{markersOnMap:c})):b.markersOnMap=e},10)},!1);b.$watch("mapCenter.lat",function(a){k.setMonitorSettings({mapCenterLat:a})});b.$watch("mapCenter.lng",function(a){k.setMonitorSettings({mapCenterLng:a})});
b.setNoticeFilterByObject=function(b){a.reportStart=a.monitorStart;a.reportEnd=a.monitorEnd};b.setNoticeFilterByObjectAndRevision=function(a){b.setNoticeFilterByObject(a)};b.setNoticeFilterByObjectAndType=function(a,c){b.setNoticeFilterByObject(a)};b.isSystemuser=function(){return p.isSystemuser()};a.$on("monitor:updateObjectsRequest",function(){b.mapSettings.loadingFlag=!0});window.onkeydown=function(a){27==a.keyCode&&(a=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),angular.isDefined(a)&&
(a[0].innerHTML=""),b.mapSettings.abortCompareFlag=!0)};b.$on("$destroy",function(){window.onkeydown=void 0});var v=function(a){var b=!1;p.getContextIds().forEach(function(c){0==c.permissionTagId.localeCompare(a)&&(b=!0);var d=document.getElementById(c.permissionTagId);angular.isUndefined(d)||null==d||$("#"+c.permissionTagId).removeClass("nmc-hide")});0==b&&window.location.assign("#/")};v(b.mapSettings.ctxId);a.$on("servicePermissions:loaded",function(){v(b.mapSettings.ctxId)});window.setTimeout(function(){v(b.mapSettings.ctxId)},
500);b.data.currentTree=k.getMonitorSettings().currentTree;b.data.currentTreeNode=k.getMonitorSettings().currentTreeNode});app=angular.module("portalNMC");
app.controller("MonitorMapCtrl",["$rootScope","$scope","$compile","$cookies","$http","monitorSvc","objectSvc","mainSvc","$timeout",function(a,b,d,g,l,k,h,p,m){function n(a){var c=null;b.objects.some(function(b){if(b.contObject.id===a)return c=b,!0});return c}a.ctxId="monitor_map_page";b.mapSettings={};b.mapSettings.zoomBound=9;b.mapSettings.loadingFlag=k.getLoadingStatus();b.mapSettings.ctxId="monitor_map_page";var e=[],c=[];b.objects=k.getAllMonitorObjects();b.cities=k.getAllMonitorCities();angular.isDefined(k.getMonitorSettings().mapZoomDetail)&&
(b.mapSettings.zoomDetail=Number(k.getMonitorSettings().mapZoomDetail));b.izhevsk={lat:56.85,lng:53.216667,zoom:8};d=b.izhevsk;angular.isDefined(k.getMonitorSettings().mapZoom)&&(d.zoom=Number(k.getMonitorSettings().mapZoom));angular.isDefined(k.getMonitorSettings().mapCenterLat)&&(d.lat=Number(k.getMonitorSettings().mapCenterLat));angular.isDefined(k.getMonitorSettings().mapCenterLng)&&(d.lng=Number(k.getMonitorSettings().mapCenterLng));angular.extend(b,{mapCenter:d});var f={type:"extraMarker",icon:"fa-home",
markerColor:"blue",prefix:"fa",shape:"circle"};b.currentTile={url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}};b.getEventTypesByObjectModFn=function(b){b=n(b);if(null!=b)return l.get("../api/subscr/contEvent/notifications/contObject/"+b.contObject.id+"/eventTypes/statusCollapse?fromDate="+a.monitorStart+"&toDate="+a.monitorEnd)};b.prepareObjectMarker=function(c){var d="<div id='"+
c.contObject.id+"'>",d=d+(c.contObject.fullName+"<br>"),d=d+"<hr class='nmc-hr-in-modal'>"+("\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439: <a title='\u0412\u0441\u0435\u0433\u043e \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439' href='#/notices/list/?objectMonitorId="+c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"' ng-mousedown='setNoticeFilterByObject("+c.contObject.id+")'>"+c.eventsCount+"</a>, \u043d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0445: <a title='\u041d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435 \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u044f' href='#/notices/list/?objectMonitorId="+
c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"&isNew=true' ng-mousedown='setNoticeFilterByObjectAndRevision("+c.contObject.id+")'>"+c.newEventsCount+"</a><br>"),e={focus:!1};e.lng=c.contObjectGeo.geoPosX;e.lat=c.contObjectGeo.geoPosY;e.getMessageScope=function(){var a=b.$new(!0);angular.extend(a,{setNoticeFilterByObject:b.setNoticeFilterByObject});angular.extend(a,{setNoticeFilterByObjectAndRevision:b.setNoticeFilterByObjectAndRevision});angular.extend(a,{setNoticeFilterByObjectAndType:b.setNoticeFilterByObjectAndType});
return a};e.message=d+"<hr class='nmc-hr-in-modal'><div ng-repeat='em in eventMessages'> <a href='#/notices/list/?objectMonitorId="+c.contObject.id+"&monitorFlag=true&fromDate="+a.monitorStart+"&toDate="+a.monitorEnd+"&typeId=em.id' ng-mousedown='setNoticeFilterByObjectAndType("+c.contObject.id+",em.id)'><img ng-attr-title='{{em.title}}'ng-src='{{em.imgpath}}'/>{{em.name}} ({{em.count}}) </a></div></div>";e.compileMessage=!0;e.icon={};e.icon=angular.copy(f);e.contObjectId=c.contObject.id;e.isCityMarker=
!1;e.icon.markerColor="orange"===c.statusColor.toLowerCase()?"orange":c.statusColor.toLowerCase();return e};var r=function(a){document.getElementsByClassName("leaflet-pane leaflet-popup-pane")[0].innerHTML="";var c={},d=null;b.cities.some(function(b){if(b.cityFiasUUID===a)return c.lat=b.cityGeoPosY,c.lng=b.cityGeoPosX,d=b,!0});c.zoom=b.mapSettings.zoomDetail||b.mapSettings.zoomBound+2;angular.extend(b,{mapCenter:c});var f=d.contEventNotificationStatuses;e=[];e=b.setObjectsOnMap(f);b.viewCurrentCityObjectsFlag=
!0;b.markersOnMap=[];m(function(){b.markersOnMap=e},10)},q=function(a){b.currentCity={};b.cities.some(function(c){if(c.cityFiasUUID===a||p.checkUndefinedNull(c.cityFiasUUID)&&"null"==a)return b.currentCity=angular.copy(c),!0});if(!p.checkEmptyObject(b.currentCity)){var c=b.currentCity.contEventNotificationStatuses;h.sortObjectsByConObjectFullName(c);c.forEach(function(a){"RED"!==a.statusColor&&"YELLOW"!==a.statusColor||k.getMonitorEventsByObjectForMap(a)})}$("#showObjectsDetailModal").modal()};b.prepareCityMarker=
function(a){if(null!==a.cityGeoPosX&&null!==a.cityGeoPosY){var c="<div id='"+a.cityFiasUUID+"'>",c=c+(a.cityName+", "+a.contEventNotificationStatuses.length+" \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 <button class='glyphicon glyphicon-search marginLeft5' ng-click='viewObjectsOnMap(\""+a.cityFiasUUID+"\")' title='\u0421\u043c. \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043a\u0430\u0440\u0442\u0435'></button><br>"),c=c+"<hr class='nmc-hr-in-modal'>"+(a.monitorEventCount+" \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439");
0!==a.monitorEventCount&&(c+="<button class='marginLeft5' ng-click='viewObjectDetails(\""+a.cityFiasUUID+"\")'>\u041f\u043e\u0434\u0440\u043e\u0431\u043d\u0435\u0435...</button>");var d={focus:!1};d.lng=a.cityGeoPosX;d.lat=a.cityGeoPosY;d.getMessageScope=function(){var a=b.$new(!0);angular.extend(a,{curMarker:d});angular.extend(a,{viewObjectsOnMap:r});angular.extend(a,{viewObjectDetails:q});return a};d.message=c;d.compileMessage=!0;d.icon=angular.copy(f);d.cityFiasUUID=a.cityFiasUUID;d.icon.markerColor=
"orange"===a.cityContEventLevelColor.toLowerCase()?"orange":a.cityContEventLevelColor.toLowerCase();d.isCityMarker=!0;return d}};b.setCitiesOnMap=function(a,c){if(angular.isArray(a)&&0!==a.length&&angular.isArray(c))return a.forEach(function(a){if(angular.isUndefined(a.cityGeoPosX)||angular.isUndefined(a.cityGeoPosY)||null===a.cityGeoPosX||null===a.cityGeoPosY)console.warn("Warning. City without coordinates."),console.warn(a);else{var d={},e=!1;angular.isDefined(c.length)&&0!=c.length&&c.some(function(b){if(angular.isUndefined(b.cityFiasUUID))return!1;
if(a.cityFiasUUID===b.cityFiasUUID)return d=b,e=!0});d=b.prepareCityMarker(a);!0!==e&&c.push(d)}}),c};b.setObjectsOnMap=function(a){var c=[];if(angular.isArray(a)&&0!==a.length&&angular.isArray(c))return a.forEach(function(a){angular.isUndefined(a.contObjectGeo)||angular.isUndefined(a.contObjectGeo.geoPosX)||null===a.contObjectGeo||null===a.contObjectGeo.geoPosX?(console.warn("Warning. Object without coordinates."),console.warn(a)):(a=b.prepareObjectMarker(a),c.push(a))}),c};b.mapCenter.zoom>b.mapSettings.zoomBound?
(e=[],e=b.setObjectsOnMap(b.objects)):(e=[],b.setCitiesOnMap(b.cities,e));c=e;angular.extend(b,{markersOnMap:c});b.$on("monitorObjects:updated",function(){b.objects=k.getAllMonitorObjects();b.cities=k.getAllMonitorCities();b.mapCenter.zoom>b.mapSettings.zoomBound?(e=[],e=b.setObjectsOnMap(b.objects)):(e=[],b.setCitiesOnMap(b.cities,e));angular.isArray(b.markersOnMap)&&0===b.markersOnMap.length?(c=e,angular.extend(b,{markersOnMap:c})):(b.markersOnMap=[],m(function(){b.markersOnMap=e},10));b.mapSettings.loadingFlag=
!1});b.$watch("mapCenter.zoom",function(a,d){k.setMonitorSettings({mapZoom:a});var f=null;if(a>b.mapSettings.zoomBound&&d<=b.mapSettings.zoomBound){f=document.getElementsByClassName("leaflet-pane leaflet-popup-pane");f[0].innerHTML="";if(!0===b.viewCurrentCityObjectsFlag){b.viewCurrentCityObjectsFlag=!1;return}e=[];e=b.setObjectsOnMap(b.objects)}a<=b.mapSettings.zoomBound&&d>b.mapSettings.zoomBound&&(f=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),f[0].innerHTML="",e=[],b.setCitiesOnMap(b.cities,
e));angular.isArray(b.markersOnMap)&&0===b.markersOnMap.length?(c=e,angular.extend(b,{markersOnMap:c})):(b.markersOnMap=[],m(function(){b.markersOnMap=e},10))},!1);b.$watch("mapCenter.lat",function(a){k.setMonitorSettings({mapCenterLat:a})});b.$watch("mapCenter.lng",function(a){k.setMonitorSettings({mapCenterLng:a})});b.setNoticeFilterByObject=function(b){a.reportStart=a.monitorStart;a.reportEnd=a.monitorEnd};b.setNoticeFilterByObjectAndRevision=function(a){b.setNoticeFilterByObject(a)};b.setNoticeFilterByObjectAndType=
function(a,c){b.setNoticeFilterByObject(a)};b.isSystemuser=function(){return p.isSystemuser()};a.$on("monitor:updateObjectsRequest",function(){b.mapSettings.loadingFlag=!0});window.onkeydown=function(a){27==a.keyCode&&(a=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),angular.isDefined(a)&&(a[0].innerHTML=""),b.mapSettings.abortCompareFlag=!0)};b.$on("$destroy",function(){window.onkeydown=void 0});var v=function(a){var b=!1;p.getContextIds().forEach(function(c){0==c.permissionTagId.localeCompare(a)&&
(b=!0);var d=document.getElementById(c.permissionTagId);angular.isUndefined(d)||null==d||$("#"+c.permissionTagId).removeClass("nmc-hide")});0==b&&window.location.assign("#/")};v(b.mapSettings.ctxId);a.$on("servicePermissions:loaded",function(){v(b.mapSettings.ctxId)});window.setTimeout(function(){v(b.mapSettings.ctxId)},500);b.data.currentTree=k.getMonitorSettings().currentTree;b.data.currentTreeNode=k.getMonitorSettings().currentTreeNode}]);app=angular.module("portalNMC");app.filter("filterByCategories",function(){return function(a,b){if(!angular.isArray(b)||0==b.length)return a;var d=[];a.forEach(function(a){1==b.some(function(b){if(a.contEventCategoryKeyname==b.keyname)return!0})&&d.push(a)});return d}});
app.controller("NoticeCtrl",["$scope","$http","$resource","$rootScope","$cookies","$location","crudGridDataFactory","objectSvc","notificationFactory","mainSvc","$filter","$timeout",function(a,b,d,g,l,k,h,p,m,n,e,c){function f(){a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.selectedObjects=[];a.objects=angular.copy(a.objectsInWindow);a.objects.map(function(b){b.selected&&a.selectedObjects.push(b.id)});0==a.selectedObjects.length?(a.selectedObjects_list.caption=a.messages.defaultFilterCaption,
a.states.isSelectedAllObjects=!0):(a.selectedObjects_list.caption=a.selectedObjects.length,a.states.isSelectedAllObjects=!1)}function r(){a.noticeTypes=angular.copy(a.typesInWindow);a.states.criticalTypes_flag=a.states.tempCriticalTypes_flag;a.states.noCriticalTypes_flag=a.states.tempNoCriticalTypes_flag;a.states.undefinedCriticalTypes_flag=a.states.tempUndefinedCriticalTypes_flag;a.selectedNoticeTypes_list.caption="";a.selectedNoticeTypes=[];a.noticeTypes.map(function(b){b.selected&&a.selectedNoticeTypes.push(b.id)});
0==a.selectedNoticeTypes.length?(a.selectedNoticeTypes_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllTypes=!0):(a.selectedNoticeTypes_list.caption=a.selectedNoticeTypes.length,a.states.isSelectedAllTypes=!1)}function q(c){b.get(a.groupUrl+"/"+c.id+"/contObject").then(function(a){c.objects=a.data})}function v(){a.selectedObjects_list.caption="";a.selectedGroups=[];a.selectedObjects=[];a.groups=angular.copy(a.objectsInWindow);var b=a.joinObjectsFromSelectedGroups(a.groups);p.sortObjectsByFullName(b);
a.deleteDoublesObjects(b);a.addUniqueObjectsFromGroupsToSelectedObjects(b,a.selectedObjects);b=a.selectedObjects.map(function(a){return a.id});a.selectedObjects=b;a.groups.map(function(b){b.selected&&a.selectedGroups.push(b.id)});0==a.selectedGroups.length?(a.selectedObjects_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllObjects=!0):(a.selectedObjects_list.caption=a.selectedGroups.length,a.states.isSelectedAllObjects=!1)}function t(){a.noticeCategories=angular.copy(a.categoriesInWindow);
a.selectedNoticeCategories_list.caption="";a.selectedNoticeCategories=[];a.noticeCategories.map(function(b){b.selected&&a.selectedNoticeCategories.push(b.keyname)});0==a.selectedNoticeCategories.length?(a.selectedNoticeCategories_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllCategories=!0):(a.selectedNoticeCategories_list.caption=a.selectedNoticeCategories.length,a.states.isSelectedAllCategories=!1)}function u(){a.noticeDeviations=angular.copy(a.deviationsInWindow);a.selectedNoticeDeviations_list.caption=
"";a.selectedNoticeDeviations=[];a.noticeDeviations.map(function(b){b.selected&&a.selectedNoticeDeviations.push(b.keyname)});0==a.selectedNoticeDeviations.length?(a.selectedNoticeDeviations_list.caption=a.messages.defaultFilterCaption,a.states.isSelectedAllDeviations=!0):(a.selectedNoticeDeviations_list.caption=a.selectedNoticeDeviations.length,a.states.isSelectedAllDeviations=!1)}function w(a,b){a.hasOwnProperty("length")&&0!==a.length&&"undefined"!=typeof b&&a.forEach(function(a){a.selected&&b.push(a.id)})}
function x(b){$("#confirmActionModal").modal("hide");a.allSelected=!1;a.getResultsPage(1);m.success()}function E(a,c,d){b({url:a,method:"PUT",params:{notificationIds:c,isNew:d},data:null}).then(x)["catch"](A)}function G(a,b){return"<div style='font-size:8pt; text-align:center; padding:2px; color:black;'>"+a+" ("+Math.round(b.percent)+"%)</div>"}g.ctxId="notice_page";a.ctrlSettings={};a.ctrlSettings.dateFormat="DD.MM.YYYY HH:mm";a.ctrlSettings.serverTimeZone=3;a.ctrlSettings.showObjectsFlag=!0;a.ctrlSettings.loading=
!0;a.ctrlSettings.ctxId="notice_page";a.TEXT_CAPTION_LENGTH=135;a.TYPE_CAPTION_LENGTH=55;a.ZPOINT_CAPTION_LENGTH=10;a.OBJECT_CAPTION_LENGTH=35;a.objectsUrl="../api/subscr/contObjects";a.groupUrl="../api/subscr/contGroup";a.crudTableName="../api/subscr/contEvent/notifications";a.noticeTypesUrl="../api/contEvent/types";a.zpointListUrl=a.objectsUrl+"/zpoints";a.zpointShortInfoUrl=a.objectsUrl+"/zpoints/shortInfo";a.noticeCategoriesUrl="../api/subscr/contEvent/categories";a.noticeDeviationsUrl="../api/subscr/contEvent/deviations";
a.imgPathTmpl="images/notice-state-";var C=k.search();a.messages={};a.messages.markSelectedAsRevision="\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043a\u0430\u043a \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435";a.messages.markSelectedAsNew="\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043a\u0430\u043a \u043d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435";
a.messages.markOnPageAsRevision="\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u043d\u0430 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u0435 \u043a\u0430\u043a \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435";a.messages.markAllAsRevision="\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u043a\u0430\u043a \u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435";a.messages.markAllAsNew="\u041f\u043e\u043c\u0435\u0442\u0438\u0442\u044c \u0432\u0441\u0435 \u043a\u0430\u043a \u043d\u0435\u043f\u0440\u043e\u0447\u0438\u0442\u0430\u043d\u043d\u044b\u0435";
a.states={};a.states.applyObjects_flag=!1;a.states.applyTypes_flag=!1;a.states.criticalTypes_flag=!1;a.states.noCriticalTypes_flag=!1;a.states.undefinedCriticalTypes_flag=!1;a.states.tempCriticalTypes_flag=!1;a.states.tempNoCriticalTypes_flag=!1;a.states.tempUndefinedCriticalTypes_flag=!1;a.allSelected=!1;a.states.isSelectedAllObjects=!0;a.states.isSelectedAllCategories=!0;a.states.isSelectedAllDeviations=!0;a.states.isSelectedAllTypes=!0;a.states.isSelectedAllObjectsInWindow=!0;a.states.isSelectedAllCategoriesInWindow=
!0;a.states.isSelectedAllDeviationsInWindow=!0;a.states.isSelectedAllTypesInWindow=!0;a.messages.defaultFilterCaption="\u0412\u0441\u0435";a.selectedObjects_list={};a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeTypes_list={};a.selectedNoticeTypes_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeCategories_list={};a.selectedNoticeCategories_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeDeviations_list={};a.selectedNoticeDeviations_list.caption=
a.messages.defaultFilterCaption;a.zpointList=null;a.tableDef={tableClass:"crud-grid table table-lighter table-condensed table-hover table-striped",hideHeader:!1,headerClassTR:"nmc-main-table-header",columns:[{fieldName:"noticeObjectName",header:"\u041e\u0431\u044a\u0435\u043a\u0442",headerClass:"col-xs-2 nmc-text-align-center nmc-hide",dataClass:"col-xs-2 nmc-hide"},{fieldName:"noticeObjectNameCaption",header:"\u041e\u0431\u044a\u0435\u043a\u0442",headerClass:"col-xs-2 nmc-text-align-center",dataClass:"col-xs-2"},
{fieldName:"noticeZpoint",header:"\u0422\u043e\u0447\u043a\u0430 \u0443\u0447\u0435\u0442\u0430",headerClass:"col-xs-1 nmc-hide",dataClass:"col-xs-1 nmc-hide"},{fieldName:"noticeZpointCaption",header:" ",headerClass:"col-xs-1 nmc-td-for-button",dataClass:"col-xs-1 nmc-td-for-button nmc-text-align-center"},{fieldName:"noticeDate",header:"\u0414\u0430\u0442\u0430",headerClass:"col-xs-1 nmc-text-align-center",dataClass:"col-xs-1"},{fieldName:"noticeMessage",header:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435",
headerClass:"col-xs-1 nmc-hide",dataClass:"col-xs-1 nmc-hide"},{fieldName:"noticeCaption",header:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435",headerClass:"col-xs-7 nmc-text-align-center",dataClass:"col-xs-7"}]};a.data={};a.currentObject={};a.selectedObjects=[];a.selectedNoticeCategories=[];a.selectedNoticeDeviations=[];a.notices=[];a.noticesPromise=null;a.currentNotices=null;a.totalNotices=0;a.noticesPerPage=25;a.noticesPerPageList=[15,25,50,75,100];a.groups=[];a.isSystemuser=
function(){return n.isSystemuser()};a.isTestMode=function(){return n.isTestMode()};var A=function(a){a=n.errorCallbackHandler(a);m.errorInfo(a.caption,a.description)};a.initCtrl=function(){a.categoriesInWindow=angular.copy(a.noticeCategories);a.deviationsInWindow=angular.copy(a.noticeDeviations);if(angular.isDefined(C)&&C.hasOwnProperty("monitorFlag")&&"true"===C.monitorFlag){a.objectsInWindow=angular.copy(a.objects);var b=-1;a.objectsInWindow.some(function(a,c){if(a.id===Number(C.objectMonitorId))return b=
c,!0});if(-1<b){a.objectsInWindow[b].selected=!0;f();a.isNew=n.checkUndefinedNull(C.isNew)||"null"===C.isNew?null:!!C.isNew;!0===a.isNew&&(a.visibleText="\u0422\u043e\u043b\u044c\u043a\u043e \u043d\u043e\u0432\u044b\u0435");var c=[Number(C.typeId)];angular.isDefined(c)&&c.hasOwnProperty("length")&&0<c.length&&(a.typesInWindow=angular.copy(a.noticeTypes),c.forEach(function(b){var c=-1;a.typesInWindow.some(function(a,d){if(a.id===b)return c=d,!0});-1<c&&(a.typesInWindow[c].selected=!0)}),r())}}};var z=
function(a,c,d,e,z,B,f,A){c={fromDate:c,toDate:d,contEventTypeIds:z,contEventCategories:B,contEventDeviations:f,contObjectIds:e};n.checkUndefinedNull(A)||(c.isNew=A);return b({url:a,method:"GET",params:c})};a.pagination={current:1};a.pageChanged=function(b){a.getResultsPage(b)};var H=function(b){var c=null;null!=a.zpointList&&a.zpointList.some(function(a){if(b===a.contZPointId)return c=a,!0});return c},D=function(b){var c={};return b.map(function(b){c={};c.id=b.id;var d=b.contEventType.caption||b.contEventType.name;
c.contEventCategoryKeyname=b.contEventCategoryKeyname;c.noticeType=d;c.isBaseEvent=b.contEventType.isBaseEvent;c.noticeMessage=n.checkUndefinedNull(b.contEvent)?"":b.contEvent.message;c.zpoint=null;c.imgSTPath=a.imgPathTmpl+"green.png";angular.isString(d)&&(c.noticeTypeCaption=d.length>a.TYPE_CAPTION_LENGTH?d.substr(0,a.TYPE_CAPTION_LENGTH)+"...":d);if(!n.checkUndefinedNull(b.contEvent))switch(c.noticeCaption=null==b.contEvent.message?"":b.contEvent.message.length>a.TEXT_CAPTION_LENGTH?b.contEvent.message.substr(0,
a.TEXT_CAPTION_LENGTH)+"...":b.contEvent.message,c.zpoint=H(b.contEvent.contZPointId),b.contEvent.contServiceType){case "heat":c.imgSTPath="vendor_components/glyphicons_free/glyphicons/png/glyphicons-85-heat.png";break;case "hw":c.imgSTPath="vendor_components/glyphicons_free/glyphicons/png/glyphicons-93-tint.png";break;case "cw":c.imgSTPath="vendor_components/glyphicons_free/glyphicons/png/glyphicons-22-snowflake.png";break;case "gas":c.imgSTPath="vendor_components/glyphicons_free/glyphicons/png/glyphicons-23-fire.png";
break;case "env":c.imgSTPath="images/es.png";break;case "el":c.imgSTPath="vendor_components/glyphicons_free/glyphicons/png/glyphicons-242-flash.png";break;case null:c.imgSTPath="null";break;default:c.noticeZpoint=b.contServiceType,c.imgSTPath=b.contServiceType}c.contObjectId=b.contObjectId;for(d=0;d<a.objects.length;d+=1)if(a.objects[d].id==b.contObjectId){c.noticeObjectName=a.objects[d].fullName;break}angular.isString(c.noticeObjectName)&&(c.noticeObjectNameCaption=c.noticeObjectName.length>a.OBJECT_CAPTION_LENGTH?
c.noticeObjectName.substr(0,a.OBJECT_CAPTION_LENGTH)+"...":c.noticeObjectName);c.noticeDate=a.dateFormat(b.contEventTime);c.contEventLevelColor=n.checkUndefinedNull(b.contEventLevelColor)?"GREEN":b.contEventLevelColor;c.imgpath=a.imgPathTmpl+c.contEventLevelColor.toLowerCase()+".png";c.imgclass="GREEN"===c.contEventLevelColor?"":"nmc-img-critical-indicator";c.isNew=b.isNew;null!=c.zpoint&&(c.noticeZpoint=c.zpoint.customServiceName||c.zpoint.contServiceTypeCaption);c.noticeZpointCaption="";return c})};
a.getResultsPage=function(b){a.ctrlSettings.loading=!0;a.pagination.current=b;b=a.crudTableName+"/paged?page="+(b-1)+"&size="+a.noticesPerPage;angular.isDefined(C.fromDate)&&angular.isDefined(C.toDate)?(a.startDate=C.fromDate,a.endDate=C.toDate):(a.startDate=g.reportStart||moment().subtract(6,"days").format("YYYY-MM-DD"),a.endDate=g.reportEnd||moment().format("YYYY-MM-DD"));a.noticesPromise=z(b,a.startDate,a.endDate,a.selectedObjects,a.selectedNoticeTypes,a.selectedNoticeCategories,a.selectedNoticeDeviations,
a.isNew);a.currentNotices=a.noticesPromise.then(function(b){b=b.data;a.data=b;a.totalNotices=b.totalElements;b=D(b.objects);a.notices=b;a.ctrlSettings.loading=!1},function(b){A(b);a.ctrlSettings.loading=!1})};a.dateFormat=function(b){b=new Date(b+Math.round(36E5*a.ctrlSettings.serverTimeZone));return null==b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate(),b.getUTCHours(),b.getUTCMinutes()]).format(a.ctrlSettings.dateFormat)};a.selectObjectsClick=function(){a.states.isSelectElement=!1;
a.states.isSelectedAllObjectsInWindow=angular.copy(a.states.isSelectedAllObjects);a.objectsInWindow=1==a.ctrlSettings.showObjectsFlag?angular.copy(a.objects):angular.copy(a.groups)};a.selectNoticeTypesClick=function(){a.states.isSelectElement=!1;a.states.tempCriticalTypes_flag=angular.copy(a.states.criticalTypes_flag);a.states.tempNoCriticalTypes_flag=angular.copy(a.states.noCriticalTypes_flag);a.states.tempUndefinedCriticalTypes_flag=angular.copy(a.states.undefinedCriticalTypes_flag);angular.copy(a.noticeCategories);
a.selectedCategories=[];a.noticeCategories.forEach(function(b){1==b.selected&&a.selectedCategories.push(b)});a.typesInWindow=angular.copy(a.noticeTypes);a.states.isSelectedAllTypesInWindow=angular.copy(a.states.isSelectedAllTypes)};a.selectNoticeCategoriesClick=function(){a.states.isSelectElement=!1;a.categoriesInWindow=angular.copy(a.noticeCategories);a.states.isSelectedAllCategoriesInWindow=angular.copy(a.states.isSelectedAllCategories)};a.selectNoticeDeviationsClick=function(){a.states.isSelectElement=
!1;a.deviationsInWindow=angular.copy(a.noticeDeviations);a.states.isSelectedAllDeviationsInWindow=angular.copy(a.states.isSelectedAllDeviations)};a.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};a.deleteDoublesObjects=function(a){for(var b=a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&a.splice(b,1)};a.addUniqueObjectsFromGroupsToSelectedObjects=function(a,b){var c,d;for(c=0;c<a.length;c+=1){var e=!0;for(d=
0;d<b.length;d+=1)if(a[c].fullName===b[d].fullName){e=!1;break}e&&b.push(a[c])}};var I=function(){var b=document.getElementsByClassName("btn-group open");n.checkUndefinedNull(b)||0==b.length||b[0].classList.remove("open");a.states.isSelectElement=!1};a.selectObjects=function(){I();1==a.ctrlSettings.showObjectsFlag?f():v();a.getResultsPage(1)};a.selectNoticeTypes=function(){I();r();a.getResultsPage(1)};a.selectNoticeCategories=function(){I();t();a.getResultsPage(1)};a.selectNoticeDeviations=function(){I();
u();a.getResultsPage(1)};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b};a.showNoticeDetail=function(b){a.selectedItem(b);$("#showNoticeModal").modal()};var B=function(b){a.objects=b.data;p.sortObjectsByFullName(a.objects);angular.isDefined(a.zpointList)&&angular.isArray(a.zpointList)?a.$broadcast("notices:getNoticeTypes"):a.$broadcast("notices:getZpointList")};a.getObjects=function(){n.isRma()?p.rmaPromise.then(B):p.promise.then(B)};a.getObjects();a.getGroups=function(){b.get(a.groupUrl).then(function(b){b=
b.data;b.forEach(function(a){q(a)});n.sortItemsBy(b,"contGroupName");a.groups=b},function(a){console.log(a)})};a.getGroups();a.performAllNoticesOnPage=function(){a.notices.forEach(function(b){b.selected=a.allSelected})};a.getNoticeDeviations=function(c){b.get(c).success(function(b){a.noticeDeviations=b;a.$broadcast("notices:getNoticeTypes")}).error(function(a){console.log(a)})};a.getNoticeCategories=function(c){b.get(c).success(function(b){a.noticeCategories=b;a.getNoticeDeviations(a.noticeDeviationsUrl)}).error(function(a){console.log(a)})};
a.getNoticeTypes=function(c){b.get(c).success(function(b){a.noticeTypes=b;a.initCtrl();a.getResultsPage(1)}).error(function(a){console.log(a)})};a.getZpointList=function(c){b.get(c).success(function(b){a.zpointList=b;a.getNoticeCategories(a.noticeCategoriesUrl)}).error(function(a){console.log(a)})};a.$on("notices:getNoticeTypes",function(){a.getNoticeTypes(a.noticeTypesUrl)});a.$on("notices:getZpointList",function(){a.getZpointList(a.zpointShortInfoUrl)});a.$on("notices:selectObjects",function(){a.selectObjects()});
a.getAllNotices=function(){a.isNew=null;a.getResultsPage(1)};a.getOnlyNewNotices=function(){a.isNew=!0;a.getResultsPage(1)};a.noticeFilterCritical=function(a){if(!0===a.isCriticalEvent)return a};a.noticeFilterNoCritical=function(a){if(!1===a.isCriticalEvent)return a};a.noticeFilterUndefinedCritical=function(a){if(!a.hasOwnProperty("isCriticalEvent")||null==a.isCriticalEvent)return a};a.selectAllCritical=function(){a.states.tempCriticalTypes_flag?a.typesInWindow.forEach(function(a){!0===a.isCriticalEvent&&
(a.selected=!0)}):a.typesInWindow.forEach(function(a){!0===a.isCriticalEvent&&(a.selected=!1)})};a.selectAllNoCritical=function(){a.states.tempNoCriticalTypes_flag?a.typesInWindow.forEach(function(a){!1!==a.isCriticalEvent&&a.hasOwnProperty("isCriticalEvent")&&null!=a.isCriticalEvent||(a.selected=!0)}):a.typesInWindow.forEach(function(a){!1!==a.isCriticalEvent&&a.hasOwnProperty("isCriticalEvent")&&null!=a.isCriticalEvent||(a.selected=!1)})};a.selectAllUndefinedCritical=function(){a.states.tempUndefinedCriticalTypes_flag?
a.typesInWindow.forEach(function(a){a.hasOwnProperty("isCriticalEvent")&&null!=a.isCriticalEvent||(a.selected=!0)}):a.typesInWindow.forEach(function(a){a.hasOwnProperty("isCriticalEvent")&&null!=a.isCriticalEvent||(a.selected=!1)})};a.selectAllElements=function(b){a.states.isSelectElement=!0;b.forEach(function(a){a.selected=!1})};a.selectElement=function(b){a.states.isSelectElement=!0;return a.states[b]=!1};a.isFilterApplyDisabled=function(a,b){return 1==b?!1:!a.some(function(a){if(1==a.selected)return!0})};
a.revisionNotices=function(b){var c=[],d=a.crudTableName+"/revision";w(a.notices,c);"undefined"!=typeof c&&c.hasOwnProperty("length")&&0!=c.length&&E(d,c,b)};a.revisionAllNotices=function(c){b({url:a.crudTableName+"/revision/all",method:"PUT",params:{fromDate:a.startDate,toDate:a.endDate,contObjectIds:a.selectedObjects,contEventTypeIds:a.selectedNoticeTypes,isNew:a.isNew,revisionIsNew:c},data:null}).then(x)["catch"](A)};a.revisionNoticesOnPage=function(){var b=a.notices.map(function(a){return a.id}),
c=a.crudTableName+"/revision";"undefined"!=typeof b&&b.hasOwnProperty("length")&&0!=b.length&&E(c,b,!1)};a.confirmAction=function(){a.confirmationText===a.messages.markOnPageAsRevision&&a.revisionNoticesOnPage();a.confirmationText===a.messages.markAllAsRevision&&a.revisionAllNotices(!1)};a.clearAllFilters=function(){a.clearObjectFilter();a.clearTypeFilter();a.clearCategoryFilter();a.clearDeviationFilter();a.isNew=null;a.getResultsPage(1)};a.clearObjectFilter=function(){a.objects.forEach(function(a){a.selected=
!1});a.groups.forEach(function(a){a.selected=!1});a.selectedObjects_list.caption=a.messages.defaultFilterCaption;a.selectedObjects=[];a.selectedGroups=[];a.states.isSelectedAllObjects=!0};a.clearTypeFilter=function(){a.states.criticalTypes_flag=!1;a.states.noCriticalTypes_flag=!1;a.states.undefinedCriticalTypes_flag=!1;a.noticeTypes.forEach(function(a){a.selected=!1});a.selectedNoticeTypes_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeTypes=[];a.states.isSelectedAllTypes=!0};a.clearCategoryFilter=
function(){a.noticeCategories.forEach(function(a){a.selected=!1});a.selectedNoticeCategories_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeCategories=[];a.states.isSelectedAllCategories=!0};a.clearDeviationFilter=function(){a.noticeDeviations.forEach(function(a){a.selected=!1});a.selectedNoticeDeviations_list.caption=a.messages.defaultFilterCaption;a.selectedNoticeDeviations=[];a.states.isSelectedAllDeviations=!0};var O=function(a){var b=!1;n.getContextIds().forEach(function(c){0==
c.permissionTagId.localeCompare(a)&&(b=!0);var d=document.getElementById(c.permissionTagId);angular.isUndefined(d)||null==d||$("#"+c.permissionTagId).removeClass("nmc-hide")});0==b&&window.location.assign("#/")};O(a.ctrlSettings.ctxId);g.$on("servicePermissions:loaded",function(){O(a.ctrlSettings.ctxId)});window.setTimeout(function(){O(a.ctrlSettings.ctxId)},500);a.isDisabledFilters=function(){return a.ctrlSettings.loading};a.$on("navPlayerDatesChanged",function(){a.getResultsPage(1)});$(document).ready(function(){$("#object-toggle-view").bootstrapToggle();
$("#object-toggle-view").change(function(){a.ctrlSettings.showObjectsFlag=!!$(this).prop("checked");a.$apply();a.selectObjectsClick();if(a.selectedObjects_list.caption==a.messages.defaultFilterCaption)return"Object / group filter. No changes";a.clearObjectFilter();a.$broadcast("notices:selectObjects")})});a.runChart=function(){var b=[],c=[],d=[],e,z;for(e=0;e<a.notices.length;e+=1)if(0<c.length){var B=!1;for(z=0;z<c.length;z+=1)c[z]===a.notices[e].noticeType&&(d[z]+=1,B=!0);B||(c.push(a.notices[e].noticeType),
d.push(1))}else c.push(a.notices[e].noticeType),d.push(1);for(e=0;e<c.length;e+=1)b[e]={label:c[e],data:d[e]};$("#noticeChart-area").width(300);$("#noticeChart-area").height(300);$("#chartModal.modal-dialog").width(700);$("#chartModal").modal();$.plot("#noticeChart-area",b,{series:{pie:{show:!0,label:{show:!1,formatter:G}}},legend:{show:!0,labelFormatter:G,position:"ne",margin:[-400,0]}})}}]);app=angular.module("portalNMC");app.controller("ObjectsCtrl",["$scope","$rootScope","$cookies","$http","mainSvc",function(a,b,d,g,l){a.ctrlSettings={};a.ctrlSettings.pageAccess=!1;a.ctrlSettings.pageCtxId="object_list_view_page";b.ctxId="object_list_view_page";a.ctrlSettings.loadingPermissions=l.getLoadingServicePermissionFlag();a.ctrlSettings.pageAccess=l.checkContext(a.ctrlSettings.pageCtxId)||l.isCabinet()}]);app=angular.module("portalNMC");
app.controller("ObjectsMapCtrl",["$rootScope","$scope","$cookies","objectSvc","mainSvc","$timeout",function(a,b,d,g,l,k){a.ctxId="object_map_page";b.mapSettings={};b.mapSettings.userFormat="DD.MM.YYYY";b.mapSettings.systemFormat="YYYY-MM-DD";b.mapSettings.zoomBound=9;b.mapSettings.dateFrom=moment().subtract(30,"days").startOf("day").format(b.mapSettings.systemFormat);b.mapSettings.dateTo=moment().endOf("day").format(b.mapSettings.systemFormat);b.mapSettings.loadingFlag=g.getLoadingStatus();b.mapSettings.drawMarkersFlag=
!b.mapSettings.loadingFlag;b.mapSettings.abortCompareFlag=!1;b.mapSettings.ctxId="object_map";var h=[],p=[];b.objects=[];b.cities=[];b.objectsOfCities=[];b.izhevsk={lat:56.85,lng:53.216667,zoom:8};d=b.izhevsk;angular.isDefined(g.getObjectSettings().mapZoomDetail)&&(b.mapSettings.zoomDetail=Number(g.getObjectSettings().mapZoomDetail));angular.isDefined(g.getObjectSettings().mapZoom)&&(d.zoom=Number(g.getObjectSettings().mapZoom));angular.isDefined(g.getObjectSettings().mapCenterLat)&&(d.lat=Number(g.getObjectSettings().mapCenterLat));
angular.isDefined(g.getObjectSettings().mapCenterLng)&&(d.lng=Number(g.getObjectSettings().mapCenterLng));angular.extend(b,{mapCenter:d});var m={type:"extraMarker",icon:"fa-home",markerColor:"blue",prefix:"fa",shape:"circle"};angular.extend(b,{currentTile:{url:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",options:{attribution:'&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'}}});var n=function(a,b){var c=[];if(!angular.isArray(a)||0===a.length)return[];
a.forEach(function(a){angular.isArray(a.cityObjects)&&0!==a.cityObjects.length&&a.cityObjects.forEach(function(a){c.push(a)})});return c},e=function(a){var b=0,c=0,d=0;a.cityObjects.forEach(function(a){angular.isDefined(a.contObject.heatArea)&&null!=a.contObject.heatArea&&(d+=a.contObject.heatArea);angular.isUndefined(a.serviceTypeARTs)||null===a.serviceTypeARTs||0===a.serviceTypeARTs.length||a.serviceTypeARTs.forEach(function(a){switch(a.contServiceType){case "heat":c+=a.absConsValue;break;case "hw":b+=
a.absConsValue}})});var e={hw:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",hwMeasureUnit:"",heat:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",heatMeasureUnit:"",heatArea:null,heatAreaMeasureUnit:"",heatAverage:"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",heatAverageMeasureUnit:"",hwAverage:"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",hwAverageMeasureUnit:""};e.hw=b.toFixed(2);
e.hwMeasureUnit="\u043c3";e.heat=c.toFixed(2);e.heatMeasureUnit="\u0413\u041a\u0430\u043b";e.heatArea=d.toFixed(2);e.heatAreaMeasureUnit="\u043c2";0!=d&&(e.heatAverage=(c/d).toFixed(2),e.heatAverageMeasureUnit="\u0413\u041a\u0430\u043b/\u043c2",e.hwAverage=(b/d).toFixed(2),e.hwAverageMeasureUnit="\u043c3/\u043c2");a.servicesSummary=e},c=function(a,c){g.getCityConsumingData(a.cityFiasUUID,c).then(function(c){!0===b.mapSettings.abortCompareFlag?(b.mapSettings.abortCompareFlag=!1,b.comparingFlag=!1):
angular.isArray(c.data)&&0!==c.data.length?(b.newCityData=c.data[0],b.markerSettings.isNewDataFlag=!0,e(b.newCityData),c={},c.heatArea=a.servicesSummary.heatArea,"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==a.servicesSummary.hw&&"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==b.newCityData.servicesSummary.hw&&(c.hw=(a.servicesSummary.hw-b.newCityData.servicesSummary.hw).toFixed(2),c.hwPerCent=Math.abs(100*(a.servicesSummary.hw-b.newCityData.servicesSummary.hw)/b.newCityData.servicesSummary.hw).toFixed(2),
c.hwMeasureUnit="\u043c3",c.hwAveragePerCent=0<c.heatArea?Math.abs(100*(a.servicesSummary.hwAverage-b.newCityData.servicesSummary.hwAverage)/b.newCityData.servicesSummary.hwAverage).toFixed(2):null,c.hwAverage=(a.servicesSummary.hwAverage-b.newCityData.servicesSummary.hwAverage).toFixed(2)),"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==a.servicesSummary.heat&&"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==b.newCityData.servicesSummary.heat&&(c.heat=(a.servicesSummary.heat-
b.newCityData.servicesSummary.heat).toFixed(2),c.heatPerCent=Math.abs(100*(a.servicesSummary.heat-b.newCityData.servicesSummary.heat)/b.newCityData.servicesSummary.heat).toFixed(2),c.heatMeasureUnit="\u043c3",c.heatAveragePerCent=0<c.heatArea?Math.abs(100*(a.servicesSummary.heatAverage-b.newCityData.servicesSummary.heatAverage)/b.newCityData.servicesSummary.heatAverage).toFixed(2):null,c.heatAverage=(a.servicesSummary.heatAverage-b.newCityData.servicesSummary.heatAverage).toFixed(2)),b.diffCityData=
c,b.diffData=c,b.newData=angular.copy(b.newCityData.servicesSummary),b.markerSettings.isDiffDataFlag=!0,b.comparingFlag=!1):(console.log("Not enough objects for the city."),console.log(c.data))},function(a){console.log(a);b.comparingFlag=!1})},f=function(){g.getCitiesConsumingData(b.mapSettings).then(function(a){b.cities=a.data;b.objectsOfCities=n(b.cities,b.objectsOfCities);b.mapCenter.zoom>b.mapSettings.zoomBound?(h=b.setObjectsOnMap(b.objectsOfCities,h),b.markersOnMap=[],angular.extend(b,{markersOnMap:h})):
(p=b.setCitiesOnMap(b.cities,p),b.markersOnMap=[],angular.extend(b,{markersOnMap:p}));b.mapSettings.loadingFlag=!1;b.mapSettings.drawMarkersFlag=!b.mapSettings.loadingFlag},function(a){console.log(a);b.mapSettings.loadingFlag=!1;b.mapSettings.drawMarkersFlag=!b.mapSettings.loadingFlag})},r=function(a){var b={hw:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",hwMeasureUnit:"",heat:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",heatMeasureUnit:"",hwAverage:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",
hwAverageMeasureUnit:"",heatAverage:"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",heatAverageMeasureUnit:""};if(angular.isUndefined(a.serviceTypeARTs)||null===a.serviceTypeARTs||0===a.serviceTypeARTs.length)b.hw="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.hwMeasureUnit="",b.hwTemp="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.heat="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.heatMeasureUnit="",b.heatTemp="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",
b.hwAverage="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.hwAverageMeasureUnit="",b.heatAverage="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.heatAverageMeasureUnit="";a.serviceTypeARTs.forEach(function(c){switch(c.contServiceType){case "hw":!angular.isNumber(c.absConsValue)||angular.isUndefined(c.absConsValue)||null===c.absConsValue?(b.hw="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.hwMeasureUnit="",b.hwAverage="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",
b.hwAverageMeasureUnit=""):(b.hw=c.absConsValue.toFixed(2),b.hwMeasureUnit="\u043c<sup>3</sup>",0<a.contObject.heatArea?(b.hwAverage=(c.absConsValue/a.contObject.heatArea).toFixed(2),b.hwAverageMeasureUnit="\u043c<sup>3</sup>/\u043c<sup>2</sup>"):(b.hwAverage="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",b.hwAverageMeasureUnit=""));break;case "heat":!angular.isNumber(c.absConsValue)||angular.isUndefined(c.absConsValue)||null===c.absConsValue?(b.heat=
"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.heatMeasureUnit="",b.heatAverage="\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445",b.heatAverageMeasureUnit=""):(b.heat=c.absConsValue.toFixed(2),b.heatMeasureUnit="\u0413\u041a\u0430\u043b",0<a.contObject.heatArea?(b.heatAverage=(c.absConsValue/a.contObject.heatArea).toFixed(2),b.heatAverageMeasureUnit="\u0413\u041a\u0430\u043b/\u043c<sup>2</sup>"):(b.heatAverage="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",
b.heatAverageMeasureUnit=""));break;default:b.wtf=c.absConsValue,b.wtfMeasureUnit="Wtf"}});return b};f();var q=function(a){document.getElementsByClassName("leaflet-pane leaflet-popup-pane")[0].innerHTML="";var c={},d={};b.cities.some(function(b){if(b.cityFiasUUID===a)return c.lat=b.cityGeoPosY,c.lng=b.cityGeoPosX,d=b,!0});c.zoom=b.mapSettings.zoomDetail||b.mapSettings.zoomBound+2;var e=d.cityObjects;h=[];b.setObjectsOnMap(e,h);b.markersOnMap=h;b.viewCurrentCityObjectsFlag=!0;angular.extend(b,{mapCenter:c})},
v=function(){b.markerSettings.cmpFlag=!b.markerSettings.cmpFlag},t=function(a,c,d){b.markerSettings.runFlag=!1;d={};d.dateFrom=moment(a.dateFrom).subtract(c,"days").format(b.mapSettings.systemFormat);d.dateTo=moment(a.dateTo).subtract(c,"days").format(b.mapSettings.systemFormat);d.dateFromUserformat=moment(d.dateFrom).format(b.mapSettings.userFormat);d.dateToUserformat=moment(d.dateTo).format(b.mapSettings.userFormat);return b.cmpPeriod=d},u=function(a,c){b.mapSettings.abortCompareFlag=!1;b.markerSettings.cmpDataFlag=
!0;b.markerSettings.runFlag=!0;var d=angular.copy(c);g.getObjectConsumingData(d,a.contObject.id).then(function(c){if(!0===b.mapSettings.abortCompareFlag)b.mapSettings.abortCompareFlag=!1;else{b.newObjectData=c.data;var d,e=null;for(d=0;d<b.newObjectData.serviceTypeARTs.length;d+=1)e=b.newObjectData.serviceTypeARTs[d],e.absConsValue=null===e.absConsValue?null:Number(e.absConsValue.toFixed(2)),e.tempValue=null===e.tempValue?null:Number(e.tempValue.toFixed(2));d={};b.newData=r(c.data);e=r(a);"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==
e.hw&&"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==b.newData.hw&&(d.hw=(e.hw-b.newData.hw).toFixed(2),d.hwPerCent=Math.abs(100*(e.hw-b.newData.hw)/b.newData.hw).toFixed(2),d.hwMeasureUnit=" \u043c3",0<a.contObject.heatArea?(d.hwAverage=(e.hwAverage-b.newData.hwAverage).toFixed(2),d.hwAveragePerCent=Math.abs(100*(e.hwAverage-b.newData.hwAverage)/b.newData.hwAverage).toFixed(2),d.hwAverageMeasureUnit="m3/m2"):(d.hwAverage="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",
d.hwAverageMeasureUnit=""));"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==e.heat&&"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445"!==b.newData.heat&&(d.heat=(e.heat-b.newData.heat).toFixed(2),d.heatPerCent=Math.abs(100*(e.heat-b.newData.heat)/b.newData.heat).toFixed(2),d.heatMeasureUnit=" \u0413\u041a\u0430\u043b",0<a.contObject.heatArea?(d.heatAverage=(e.heatAverage-b.newData.heatAverage).toFixed(2),d.heatAveragePerCent=Math.abs(100*(e.heatAverage-b.newData.heatAverage)/b.newData.heatAverage).toFixed(2),
d.heatAverageMeasureUnit="\u0413\u041a\u0430\u043b/m2"):(d.heatAverage="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c",d.heatAverageMeasureUnit=""));var z=[];a.serviceTypeARTs.forEach(function(c){var d;for(d=0;d<b.newObjectData.serviceTypeARTs.length;d+=1)if(e=b.newObjectData.serviceTypeARTs[d],c.contServiceType===e.contServiceType){var f={};f.contServiceType=c.contServiceType;f.measureUnit=c.measureUnit;f.absConsValue=Number((c.absConsValue-e.absConsValue).toFixed(2));
f.absConsValueAverage=0<a.contObject.heatArea?Number((f.absConsValue/a.contObject.heatArea).toFixed(2)):null;f.absConsValueAveragePerCent=0<a.contObject.heatArea&&null!==e.absConsValue&&0!==e.absConsValue?Number((f.absConsValueAverage/e.absConsValue*a.contObject.heatArea*100).toFixed(2)):null;f.tempValue=Number((c.tempValue-e.tempValue).toFixed(2));f.absConsValuePerCent=0<e.absConsValue?Number(((c.absConsValue-e.absConsValue)/e.absConsValue*100).toFixed(2)):null;f.tempValuePerCent=0<e.tempValue?Number(((c.tempValue-
e.tempValue)/e.tempValue*100).toFixed(2)):null;z.push(f)}});b.diffObjectData=z;b.diffData=d}b.comparingFlag=!1})},w=function(a,d){b.mapSettings.abortCompareFlag=!1;b.markerSettings.cmpDataFlag=!0;b.markerSettings.runFlag=!0;var e=angular.copy(d);e.cityCompareFlag=!0;c(a,e)},x=function(a){var c="<div id='"+a.cityFiasUUID+"' class=''>",c=c+("<label>"+a.cityName+"</label>, "+a.cityObjects.length+" \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 <button class='glyphicon glyphicon-search marginLeft5' ng-click='viewObjectsOnMap(\""+
a.cityFiasUUID+"\")' title='\u0421\u043c. \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043a\u0430\u0440\u0442\u0435'></button><br>"),c=c+"<hr class='nmc-hr-in-modal'>"+("\u041f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435 \u0432 \u043f\u0435\u0440\u0438\u043e\u0434 \u0441 "+moment(b.mapSettings.dateFrom).format(b.mapSettings.userFormat)+" \u043f\u043e "+moment(b.mapSettings.dateTo).format(b.mapSettings.userFormat)+"<br>"),c=c+"<div class='row nmc-hide' ng-class=\"{'nmc-hide':!markerSettings.cmpFlag,'nmc-show':markerSettings.cmpFlag}\">    <div class='col-md-8'>\u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441 \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u044b\u043c \u043f\u0435\u0440\u0438\u043e\u0434\u043e\u043c        <select ng-model='daysAgo' ng-init='daysAgo=\"30\";changeCmpPeriod(markerSettings, daysAgo, cmpPeriod)' ng-change='changeCmpPeriod(markerSettings, daysAgo, cmpPeriod)'>            <option value='30'>\u043c\u0435\u0441\u044f\u0446 \u043d\u0430\u0437\u0430\u0434</option>            <option value='92'>\u043a\u0432\u0430\u0440\u0442\u0430\u043b \u043d\u0430\u0437\u0430\u0434</option>            <option value='182'>\u043f\u043e\u043b \u0433\u043e\u0434\u0430 \u043d\u0430\u0437\u0430\u0434</option>            <option value='365'>\u0433\u043e\u0434 \u043d\u0430\u0437\u0430\u0434</option>        </select>        <div>            \u0441 {{cmpPeriod.dateFromUserformat}} \u043f\u043e {{cmpPeriod.dateToUserformat}}        </div>    </div>    <div class='col-md-3'>        <button title='\u0421\u0440\u0430\u0432\u043d\u0438\u0442\u044c' ng-disabled='markerSettings.runFlag' class='btn btn-xs btn-primary' ng-click='comparingFlag=true;getObjectsConsumingForCity(curCity, cmpPeriod)'>\u0421\u0440\u0430\u0432\u043d\u0438\u0442\u044c</button><span ng-show=\"comparingFlag\" class=\"nmc-loading marginLeft5\"><i class=\"fa fa-spinner fa-spin\"></i> </span>    </div></div><div class='text-center'>    <i class='btn btn-xs glyphicon glyphicon-chevron-down' ng-class=\"{'glyphicon-chevron-down':!markerSettings.cmpFlag,'glyphicon-chevron-up':markerSettings.cmpFlag}\" ng-click='compareWith()'></i></div><hr class='nmc-hr-in-modal'><table class='table table-striped table-condensed nmc-table-popup'>    <tr>        <td class='col-md-4'>            <label>\u0413\u043e\u0440\u044f\u0447\u0430\u044f \u0432\u043e\u0434\u0430:</label>        </td>        <td class='col-md-4'>        </td>        <td class='col-md-4'>            <span ng-if='markerSettings.cmpDataFlag'><label>\u0413\u043e\u0440\u044f\u0447\u0430\u044f \u0432\u043e\u0434\u0430:</label></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>"+
("            "+a.servicesSummary.hw+" "+a.servicesSummary.hwMeasureUnit),c=c+"        </td>        <td>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")&&(diffData.hw>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.hwPerCent<100),'nmc-alert':(diffData.hwPerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")&&(diffData.hw<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.hwPerCent<100),'nmc-alert':(diffData.hwPerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")'>{{diffData.hwPerCent}}% <span class='marginRight5'></span> {{diffData.hw}} \u043c<sup>3</sup></span>        </td>        <td>            <span ng-if='markerSettings.cmpDataFlag'><span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>            {{newData.hw}} <span ng-if='(newData.hw!=null)&&(newData.hw!=\"NaN\")&&(newData.hw!=\"Infinity\")&&(newData.hw!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.hw!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u043c<sup>3</sup></span></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>"+
("            "+a.servicesSummary.hwAverage+" "+a.servicesSummary.hwAverageMeasureUnit),c=c+"        </td>        <td>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")&&(diffData.hwAverage>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.hwAveragePerCent<100),'nmc-alert':(diffData.hwAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")&&(diffData.hwAverage<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.hwAveragePerCent<100),'nmc-alert':(diffData.hwAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")'>{{diffData.hwAveragePerCent}}% <span class='marginRight5'></span> {{diffData.hwAverage}} \u043c<sup>3</sup>/\u043c<sup>2</sup></span>        </td>        <td>           <span ng-if='markerSettings.cmpDataFlag'> <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>            {{newData.hwAverage}} <span ng-if='(newData.hwAverage!=null)&&(newData.hwAverage!=\"NaN\")&&(newData.hwAverage!=\"Infinity\")&&(newData.hwAverage!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.hwAverage!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u043c<sup>3</sup>/\u043c<sup>2</sup></span></span>        </td>    </tr>    <tr >        <td>            <label >\u041e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u0435:</label>        </td>        <td>        </td>        <td>            <span ng-if='markerSettings.cmpDataFlag'><label>\u041e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u0435:</label></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>"+
("            "+a.servicesSummary.heat+" "+a.servicesSummary.heatMeasureUnit),c=c+"        </td>        <td>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!=\"Infinity\")&&(diffData.heat>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.heatPerCent<100),'nmc-alert':(diffData.heatPerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!=\"Infinity\")&&(diffData.heat<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.heatPerCent<100),'nmc-alert':(diffData.heatPerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!==\"Infinity\")'>{{diffData.heatPerCent}}% <span class='marginRight5'></span> {{diffData.heat}} \u0413\u041a\u0430\u043b</span>        </td>        <td>           <span ng-if='markerSettings.cmpDataFlag'> <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>            {{newData.heat}} {{newData.heatMeasureUnit}}</span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>"+
("            "+a.servicesSummary.heatAverage+" "+a.servicesSummary.heatAverageMeasureUnit);return c+"        </td>        <td>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!=\"Infinity\")&&(diffData.heatAverage>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.heatAveragePerCent<100),'nmc-alert':(diffData.heatAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!=\"Infinity\")&&(diffData.heatAverage<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.heatAveragePerCent<100),'nmc-alert':(diffData.heatAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!==\"Infinity\")'>{{diffData.heatAveragePerCent}}% <span class='marginRight5'></span> {{diffData.heatAverage}} \u0413\u041a\u0430\u043b/\u043c<sup>2</sup></span>        </td>        <td>            <span ng-if='markerSettings.cmpDataFlag'><span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>            {{newData.heatAverage}} <span ng-if='(newData.heatAverage!=null)&&(newData.heatAverage!=\"NaN\")&&(newData.heatAverage!=\"Infinity\")&&(newData.heatAverage!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.heatAverage!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u0413\u041a\u0430\u043b/\u043c<sup>2</sup></span></span>        </td>    </tr></table>    </div></div>"};
b.prepareCityMarker=function(a,c){if(null!==a.cityGeoPosX&&null!==a.cityGeoPosY){e(a);var d=x(a);c.focus=!1;c.city=a;c.lng=a.cityGeoPosX;c.lat=a.cityGeoPosY;c.getMessageScope=null;c.getMessageScope=function(){angular.extend(b,{markerSettings:{cmpFlag:!1,dateFrom:b.mapSettings.dateFrom,dateTo:b.mapSettings.dateTo}});var a=angular.copy(c.city);angular.extend(b,{curCity:a});angular.extend(b,{changeCmpPeriod:t});angular.extend(b,{compareWith:v});angular.extend(b,{viewObjectsOnMap:q});angular.extend(b,
{getObjectsConsumingForCity:w});return b};c.message=d;c.compileMessage=!0;c.icon=angular.copy(m);c.cityFiasUUID=a.cityFiasUUID;return c}};var E=function(a,b){var c=[];angular.isDefined(b.length)&&0!=b.length&&(b.forEach(function(b,d){if(!angular.isUndefined(b.cityFiasUUID)){var e=!0;a.some(function(a){if(a.cityFiasUUID===b.cityFiasUUID)return e=!1,!0});!0===e&&c.push(d)}}),c.forEach(function(a){b.splice(a,1)}));return b};b.setCitiesOnMap=function(a,c){if(!angular.isArray(a)||0===a.length||!angular.isArray(c))return[];
c=E(a,c);var d=[];a.forEach(function(a){if(angular.isUndefined(a.cityGeoPosX)||angular.isUndefined(a.cityGeoPosY)||null===a.cityGeoPosX||null===a.cityGeoPosY)console.warn("Warning. City without coordinates."),console.warn(a);else{var c={},e=!1;angular.isDefined(d.length)&&0!=d.length&&d.some(function(b){if(angular.isUndefined(b.cityFiasUUID))return!1;if(a.cityFiasUUID===b.cityFiasUUID)return c=b,e=!0});c=b.prepareCityMarker(a,c);c.focus=!1;!0!==e&&d.push(c)}});for(var e=d.length;1<=e;)--e,angular.isUndefined(d[e].cityFiasUUID)&&
d.splice(e,1);b.mapSettings.drawMarkersFlag=!1;return d};var G=function(a){var c=r(a),d="<div id='"+a.contObject.id+"' class=''>",d=d+("<label>"+a.contObject.fullName+"</label><br>"),d=d+"<hr class='nmc-hr-in-modal'>"+("\u041f\u043e\u0442\u0440\u0435\u0431\u043b\u0435\u043d\u0438\u0435 \u0432 \u043f\u0435\u0440\u0438\u043e\u0434 \u0441 "+moment(b.mapSettings.dateFrom).format(b.mapSettings.userFormat)+" \u043f\u043e "+moment(b.mapSettings.dateTo).format(b.mapSettings.userFormat)+"<br>"),d=d+"<div class='row nmc-hide' ng-class=\"{'nmc-hide':!markerSettings.cmpFlag,'nmc-show':markerSettings.cmpFlag}\">    <div class='col-md-9'>\u0441\u0440\u0430\u0432\u043d\u0438\u0442\u044c \u0441 \u0430\u043d\u0430\u043b\u043e\u0433\u0438\u0447\u043d\u044b\u043c \u043f\u0435\u0440\u0438\u043e\u0434\u043e\u043c        <select ng-model='daysAgo' ng-init='daysAgo=\"30\";changeCmpPeriod(markerSettings, daysAgo, cmpPeriod)' ng-change='changeCmpPeriod(markerSettings, daysAgo, cmpPeriod)'>            <option value='30'>\u043c\u0435\u0441\u044f\u0446 \u043d\u0430\u0437\u0430\u0434</option>            <option value='92'>\u043a\u0432\u0430\u0440\u0442\u0430\u043b \u043d\u0430\u0437\u0430\u0434</option>            <option value='182'>\u043f\u043e\u043b \u0433\u043e\u0434\u0430 \u043d\u0430\u0437\u0430\u0434</option>            <option value='365'>\u0433\u043e\u0434 \u043d\u0430\u0437\u0430\u0434</option>        </select>        <div>            \u0441 {{cmpPeriod.dateFromUserformat}} \u043f\u043e {{cmpPeriod.dateToUserformat}}        </div>    </div>    <div class='col-md-2'>        <button title='\u0421\u0440\u0430\u0432\u043d\u0438\u0442\u044c' ng-diabled='markerSettings.runFlag' class='btn btn-xs btn-primary' ng-click='getObjectsConsumingForObject(curObject,cmpPeriod)'>\u0421\u0440\u0430\u0432\u043d\u0438\u0442\u044c</button><span ng-show=\"comparingFlag\" class=\"nmc-loading marginLeft5\"><i class=\"fa fa-spinner fa-spin\"></i> </span>    </div></div><div class='text-center'>    <i class='btn btn-xs glyphicon glyphicon-chevron-down' ng-class=\"{'glyphicon-chevron-down':!markerSettings.cmpFlag,'glyphicon-chevron-up':markerSettings.cmpFlag}\" ng-click='compareWith()'></i></div><hr class='nmc-hr-in-modal'><table class='table table-striped table-condensed nmc-table-popup'>    <tr>        <td class='col-md-4'>            <label>\u0413\u043e\u0440\u044f\u0447\u0430\u044f \u0432\u043e\u0434\u0430:</label>        </td>        <td class='col-md-4'>        </td>        <td class='col-md-4'>            <span ng-if='markerSettings.cmpDataFlag'><label>\u0413\u043e\u0440\u044f\u0447\u0430\u044f \u0432\u043e\u0434\u0430:</label></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>"+
("            "+c.hw+" "+c.hwMeasureUnit),d=d+"        </td>        <td>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")&&(diffData.hw>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.hwPerCent<100),'nmc-alert':(diffData.hwPerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")&&(diffData.hw<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.hwPerCent<100),'nmc-alert':(diffData.hwPerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwPerCent!=null)&&(diffData.hwPerCent!=\"NaN\")&&(diffData.hwPerCent!=\"Infinity\")'>{{diffData.hwPerCent}}% <span class='marginRight5'></span> {{diffData.hw}} \u043c<sup>3</sup></span>        </td>        <td>            <span ng-if='markerSettings.cmpDataFlag'><span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span></span>            {{newData.hw}} <span ng-if='(newData.hw!=null)&&(newData.hw!=\"NaN\")&&(newData.hw!=\"Infinity\")&&(newData.hw!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.hw!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u043c<sup>3</sup></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>"+
("            "+c.hwAverage+" "+c.hwAverageMeasureUnit),d=d+"        </td>        <td>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")&&(diffData.hwAverage>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.hwAveragePerCent<100),'nmc-alert':(diffData.hwAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")&&(diffData.hwAverage<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.hwAveragePerCent<100),'nmc-alert':(diffData.hwAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.hwAveragePerCent!=null)&&(diffData.hwAveragePerCent!=\"NaN\")&&(diffData.hwAveragePerCent!=\"Infinity\")'>{{diffData.hwAveragePerCent}}% <span class='marginRight5'></span> {{diffData.hwAverage}} \u043c<sup>3</sup>/\u043c<sup>2</sup></span>        </td>        <td>            <span ng-if='markerSettings.cmpDataFlag'><span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span></span>            {{newData.hwAverage}} <span ng-if='(newData.hwAverage!=null)&&(newData.hwAverage!=\"NaN\")&&(newData.hwAverage!=\"Infinity\")&&(newData.hwAverage!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.hwAverage!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u043c<sup>3</sup>/\u043c<sup>2</sup></span>        </td>    </tr>    <tr >        <td>            <label >\u041e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u0435:</label>        </td>        <td>        </td>        <td>           <span ng-if='markerSettings.cmpDataFlag'> <label>\u041e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u0435:</label></span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>"+
("            "+c.heat+" "+c.heatMeasureUnit),d=d+"        </td>        <td>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!=\"Infinity\")&&(diffData.heat>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.heatPerCent<100),'nmc-alert':(diffData.heatPerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!=\"Infinity\")&&(diffData.heat<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.heatPerCent<100),'nmc-alert':(diffData.heatPerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatPerCent!=null)&&(diffData.heatPerCent!=\"NaN\")&&(diffData.heatPerCent!=\"Infinity\")'>{{diffData.heatPerCent}}% <span class='marginRight5'></span> {{diffData.heat}} \u0413\u041a\u0430\u043b</span>        </td>        <td>           <span ng-if='markerSettings.cmpDataFlag'> <span class='marginLeft15'>\u0412\u0441\u0435\u0433\u043e:</span>            {{newData.heat}} {{newData.heatMeasureUnit}}</span>        </td>    </tr>    <tr >        <td>            <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>"+
("            "+c.heatAverage+" "+c.heatAverageMeasureUnit);return d+"        </td>        <td>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!=\"Infinity\")&&(diffData.heatAverage>0)'><i class='glyphicon glyphicon-triangle-top' ng-class=\"{'nmc-normal':(diffData.heatAveragePerCent<100),'nmc-alert':(diffData.heatAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!=\"Infinity\")&&(diffData.heatAverage<0)'><i class='glyphicon glyphicon-triangle-bottom' ng-class=\"{'nmc-normal-alt':(diffData.heatAveragePerCent<100),'nmc-alert':(diffData.heatAveragePerCent>=100)}\"></i></span>            <span ng-if='(diffData.heatAveragePerCent!=null)&&(diffData.heatAveragePerCent!=\"NaN\")&&(diffData.heatAveragePerCent!==\"Infinity\")'>{{diffData.heatAveragePerCent}}% <span class='marginRight5'></span> {{diffData.heatAverage}} \u0413\u041a\u0430\u043b/\u043c<sup>2</sup></span>        </td>        <td>           <span ng-if='markerSettings.cmpDataFlag'> <span class='marginLeft15'>\u0423\u0434\u0435\u043b\u044c\u043d\u043e\u0435:</span>            {{newData.heatAverage}} <span ng-if='(newData.heatAverage!=null)&&(newData.heatAverage!=\"NaN\")&&(newData.heatAverage!=\"Infinity\")&&(newData.heatAverage!=\"\u041d\u0435\u0442 \u0434\u0430\u043d\u043d\u044b\u0445\")&&(newData.heatAverage!=\"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u043f\u043b\u043e\u0449\u0430\u0434\u044c\")'>\u0413\u041a\u0430\u043b/\u043c<sup>2</sup></span> </span>        </td>    </tr></table>    </div></div>"};
b.prepareObjectMarker=function(a,c){if(null!==a.contObjectGeo.geoPosX&&null!==a.contObjectGeo.geoPosY){var d=G(a);c.focus=!1;c.object=a;c.lng=a.contObjectGeo.geoPosX;c.lat=a.contObjectGeo.geoPosY;c.getMessageScope=null;c.getMessageScope=function(){angular.extend(b,{markerSettings:{cmpFlag:!1,dateFrom:b.mapSettings.dateFrom,dateTo:b.mapSettings.dateTo}});var a=angular.copy(c.object);angular.extend(b,{curObject:a});angular.extend(b,{changeCmpPeriod:t});angular.extend(b,{compareWith:v});angular.extend(b,
{viewObjectsOnMap:q});angular.extend(b,{getObjectsConsumingForObject:u});a=angular.copy(c.city);angular.extend(b,{curCity:a});angular.extend(b,{getObjectsConsumingForCity:w});return b};c.message=d;c.compileMessage=!0;c.icon=angular.copy(m);c.contObjectId=a.contObject.id;return c}};var C=function(a,b){var c=[];angular.isDefined(b.length)&&0!=b.length&&(b.forEach(function(b,d){if(!angular.isUndefined(b.contObjectId)){var e=!0;a.some(function(a){if(a.contObject.id===b.contObjectId)return e=!1,!0});!0===
e&&c.push(d)}}),c.forEach(function(a){b.splice(a,1)}));return b};b.setObjectsOnMap=function(a,c){if(!angular.isArray(a)||0===a.length||!angular.isArray(c))return[];c=C(a,c);a.forEach(function(a){if(angular.isUndefined(a.contObjectGeo.geoPosX)||angular.isUndefined(a.contObjectGeo.geoPosY)||null===a.contObjectGeo.geoPosX||null===a.contObjectGeo.geoPosY)console.warn("Warning. Object without coordinates."),console.warn(a);else{var d={},e=!1;angular.isDefined(c.length)&&0!=c.length&&c.some(function(b){if(angular.isUndefined(b.contObjectId))return!1;
if(a.contObject.id===b.contObjectId)return d=b,e=!0});d=b.prepareObjectMarker(a,d);d.focus=!1;!0!==e&&c.push(d)}});for(var d=c.length;1<=d;)--d,angular.isUndefined(c[d].contObjectId)&&c.splice(d,1);b.mapSettings.drawMarkersFlag=!1;return c};b.mapCenter.zoom>b.mapSettings.zoomBound?(h=b.setObjectsOnMap(b.objectsOfCities,h),b.markersOnMap=h):(p=b.setCitiesOnMap(b.cities,p),b.markersOnMap=p);b.$watch("mapCenter.zoom",function(a,c){g.setObjectSettings({mapZoom:a});var d=null;if(a>b.mapSettings.zoomBound&&
c<=b.mapSettings.zoomBound){if(!0===b.viewCurrentCityObjectsFlag){b.viewCurrentCityObjectsFlag=!1;return}d=document.getElementsByClassName("leaflet-pane leaflet-popup-pane");d[0].innerHTML="";h=b.setObjectsOnMap(b.objectsOfCities,h);b.markersOnMap=[];k(function(){b.markersOnMap=h},10)}a<=b.mapSettings.zoomBound&&c>b.mapSettings.zoomBound&&(d=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),d[0].innerHTML="",p=b.setCitiesOnMap(b.cities,p),b.markersOnMap=[],k(function(){b.markersOnMap=
p},10))},!1);b.$watch("mapCenter.lat",function(a){g.setObjectSettings({mapCenterLat:a})});b.$watch("mapCenter.lng",function(a){g.setObjectSettings({mapCenterLng:a})});b.objectDates={startDate:moment().subtract(30,"days").startOf("day"),endDate:moment().endOf("day")};b.queryDateOptsObjMapRu={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",fromLabel:"\u0441",toLabel:"\u043f\u043e",cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",
daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
ranges:{"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0434\u0435\u043d\u044c":[moment().startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 7 \u0434\u043d\u0435\u0439":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 30 \u0434\u043d\u0435\u0439":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},startDate:moment().subtract(30,"days").startOf("day"),endDate:moment().endOf("day"),maxDate:moment().endOf("day"),format:"DD.MM.YYYY",
separator:" \u043f\u043e "};b.$watch("objectDates",function(a,c){if(!angular.isUndefined(c)&&c!==a){b.mapSettings.dateFrom=moment(a.startDate).format("YYYY-MM-DD");b.mapSettings.dateTo=moment(a.endDate).format("YYYY-MM-DD");var d=document.getElementsByClassName("leaflet-pane leaflet-popup-pane");angular.isDefined(d)&&(d[0].innerHTML="");b.mapSettings.loadingFlag=!0;b.mapSettings.drawMarkersFlag=!b.mapSettings.loadingFlag;f()}},!1);b.$on("leafletDirectiveMarker.click",function(a,c){b.diffObjectData=
[];b.newObjectData=[];b.newCityData={};b.diffCityData={};b.diffData={};b.newData={}});a.$on("objectSvc:loaded",function(){b.mapSettings.loadingFlag=g.getLoadingStatus()});window.onkeydown=function(a){27==a.keyCode&&(a=document.getElementsByClassName("leaflet-pane leaflet-popup-pane"),angular.isDefined(a)&&(a[0].innerHTML=""),b.mapSettings.abortCompareFlag=!0)};b.$on("$destroy",function(){window.onkeydown=void 0});var A=function(a){var b=!1;l.getContextIds().forEach(function(c){0==c.permissionTagId.localeCompare(a)&&
(b=!0);var d=document.getElementById(c.permissionTagId);angular.isUndefined(d)||null==d||$("#"+c.permissionTagId).removeClass("nmc-hide")});0==b&&window.location.assign("#/")};A(b.mapSettings.ctxId);a.$on("servicePermissions:loaded",function(){A(b.mapSettings.ctxId)})}]);app=angular.module("portalNMC");
app.controller("ObjectGroupsCtrl",["$rootScope","$scope","crudGridDataFactory","notificationFactory","objectSvc","mainSvc",function(a,b,d,g,l,k){a.ctxId="object_groups_page";b.ctrlSettings={};b.ctrlSettings.selectedAll=!1;b.groups=[];b.objects=[];b.availableObjects=[];b.selectedObjects=[];b.objectsBackup=[];b.currentGroup={};b.orderBy={field:"contGroupName",asc:!0};b.objectUrl="../api/subscr/contObjects";b.groupUrl="../api/subscr/contGroup";var h=function(a){g.success();$("#deleteGroupModal").modal("hide");
$("#editGroupModal").modal("hide");b.currentGroup={};b.getData(b.groupUrl,"groups")},p=function(a){a=k.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};b.saveGroup=function(){var a=b.selectedObjects.map(function(a,b,c){return a.id});null==b.currentGroup.id?d(b.groupUrl).save({contObjectIds:a},b.currentGroup,h,p):d(b.groupUrl).update({contObjectIds:a},b.currentGroup,h,p)};b.deleteGroup=function(a){d(b.groupUrl)["delete"]({id:a.id},h,p)};b.getData=function(a,g){d(a).query(function(a){switch(g){case "groups":k.sortItemsBy(a,
"contGroupName");b.groups=angular.copy(a);break;case "availableObjects":b.availableObjects=angular.copy(a);l.sortObjectsByFullName(b.availableObjects);break;case "selectedObjects":b.selectedObjects=angular.copy(a);l.sortObjectsByFullName(b.selectedObjects);break;default:console.log("Data type is undefined.")}})};b.selectedGroup=function(a){b.showAvailableObjects_flag=!1;b.currentGroup=a;b.getData(b.groupUrl+"/"+a.id+"/contObject","selectedObjects");b.getData(b.groupUrl+"/"+a.id+"/contObject/available",
"availableObjects")};b.addGroup=function(){b.currentGroup={};b.selectedObjects=[];b.showAvailableObjects_flag=!1;b.getData(b.groupUrl+"/0/contObject/available","availableObjects");$("#editGroupModal").modal()};b.checkForm=function(){return!(""===b.currentGroup.contGroupName||null==b.currentGroup.contGroupName)};b.removeSelectedObject=function(a){b.availableObjects.push(a);b.selectedObjects.splice(b.selectedObjects.indexOf(a),1)};b.selectAllAvailableEntities=function(){var a;for(a=0;a<b.availableObjects.length;a+=
1)b.availableObjects[a].selected=b.ctrlSettings.selectedAll};b.addSelectedObjects=function(){var a=angular.copy(b.availableObjects),d;for(d=0;d<b.availableObjects.length;d+=1){var e=b.availableObjects[d];if(e.selected){var c=angular.copy(e);c.selected=null;var f=-1;a.some(function(a,b,c){return a.fullName===e.fullName?(f=b,!0):!1});a.splice(f,1);b.selectedObjects.push(c);e.selected=null}}b.availableObjects=a;b.showAvailableObjects_flag=!1};b.isSystemuser=function(){b.userInfo=a.userInfo;return b.userInfo._system};
b.isSystemViewInfo=function(){return k.getViewSystemInfo()};b.setOrderBy=function(a){b.orderBy={field:a,asc:b.orderBy.field===a?!b.orderBy.asc:!0}};b.getData(b.groupUrl,"groups");b.isAdmin=function(){return k.isAdmin()};b.isReadonly=function(){return k.isReadonly()};b.isROfield=function(){return b.isReadonly()}}]);app=angular.module("portalNMC");
app.controller("ParamSetsCtrl",["$scope","$rootScope","$resource","$http","crudGridDataFactory","notificationFactory","objectSvc","mainSvc","reportSvc","$filter",function(a,b,d,g,l,k,h,p,m,n){function e(a){return null!=a.paramSpecialType.specialTypeDirectoryUrl&&"undefined"!=typeof a.paramSpecialType.specialTypeDirectoryUrl&&null!=a.paramSpecialType.specialTypeDirectoryKey&&"undefined"!=typeof a.paramSpecialType.specialTypeDirectoryKey&&null!=a.paramSpecialType.specialTypeDirectoryCaption&&"undefined"!=
typeof a.paramSpecialType.specialTypeDirectoryCaption&&null!=a.paramSpecialType.specialTypeDirectoryValue&&"undefined"!=typeof a.paramSpecialType.specialTypeDirectoryValue}function c(){var b=null,b=a.currentReportType.reportMetaParamSpecialList.map(function(b){var c={};c.paramSpecialCaption=b.paramSpecialCaption;c.reportMetaParamSpecialId=b.id;c.paramSpecialRequired=b.paramSpecialRequired;c.paramSpecialTypeKeyname=b.paramSpecialType.keyname;c.reportMetaParamCategory=b.reportMetaParamCategory;c.reportMetaParamCategoryOrder=
b.reportMetaParamCategory.categoryOrder;c.reportMetaParamCategoryKeyname=b.reportMetaParamCategoryKeyname;c.reportMetaParamOrder=b.reportMetaParamOrder;c.reportMetaParamFullOrder=1E3*b.reportMetaParamCategory.categoryOrder+(p.checkUndefinedNull(b.reportMetaParamOrder)?0:b.reportMetaParamOrder);e(b)&&(c.specialTypeDirectoryUrl=b.paramSpecialType.specialTypeDirectoryUrl,c.specialTypeDirectoryKey=b.paramSpecialType.specialTypeDirectoryKey,c.specialTypeDirectoryCaption=b.paramSpecialType.specialTypeDirectoryCaption,
c.specialTypeDirectoryValue=b.paramSpecialType.specialTypeDirectoryValue,a.getDirectory(".."+c.specialTypeDirectoryUrl,c));c.textValue=null;c.boolValue=null;c.numericValue=null;c.oneDateValue=null;c.startDateValue=null;c.endDateValue=null;c.oneDateValueFormatted=null;c.startDateValueFormatted=null;c.endDateValueFormatted=null;return c});f(b);p.sortNumericItemsBy(b,"reportMetaParamFullOrder");a.currentParamSpecialList=b}function f(a){var b=[];a.forEach(function(a){var c=!1;b.forEach(function(b){if(b.keyname===
a.reportMetaParamCategory.keyname)return c=!0});!1===c&&b.push(angular.copy(a.reportMetaParamCategory))});var c=[];b.forEach(function(b,d){a.some(function(a){if(a.reportMetaParamCategory.keyname===b.keyname&&"SPECIAL_CATEGORY_SWITCH"===a.paramSpecialTypeKeyname)return c.push(b.keyname),!0})});c.forEach(function(a){b.some(function(c,d){if(c.keyname===a)return b.splice(d,1),!0})});b.forEach(function(b){var c=angular.copy(b);c.paramSpecialCaption=b.caption;c.paramSpecialTypeKeyname="SPECIAL_CATEGORY_CAPTION";
c.reportMetaParamFullOrder=1E3*b.categoryOrder-1;c.paramSpecialRequired=!1;c.reportMetaParamCategory=angular.copy(b);a.push(c)})}function r(a){a.forEach(function(b,c){"SPECIAL_CATEGORY_CAPTION"===b.paramSpecialTypeKeyname&&a.splice(c,1)})}b.ctxId="param_sets_page";var q=36E5*p.getServerTimeZone();a.ctrlSettings={};a.ctrlSettings.dateFormat="DD.MM.YYYY";a.ctrlSettings.selectedAll=!1;a.ctrlSettings.ctxId="paramset_page";a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.currentSign=9999;a.columns=
[{name:"reportType",header:"\u0422\u0438\u043f \u043e\u0442\u0447\u0435\u0442\u0430","class":"col-xs-11 col-md-11"}];a.paramsetColumns=[{name:"name",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-xs-5 col-md-5"},{name:"period",header:"\u041f\u0435\u0440\u0438\u043e\u0434","class":"col-xs-2 col-md-2"},{name:"fileType",header:"\u0422\u0438\u043f \u0444\u0430\u0439\u043b\u0430","class":"col-xs-1 col-md-1"},{name:"outputFileNameTemplate",header:"\u0428\u0430\u0431\u043b\u043e\u043d \u0438\u043c\u0435\u043d\u0438 \u0444\u0430\u0439\u043b\u0430",
"class":"col-xs-3 col-md-3"}];a.extraProps={idColumnName:"id",defaultOrderBy:"name",deleteConfirmationProp:"name"};a.createParamset_flag=!1;a.editParamset_flag=!1;a.createByTemplate_flag=!1;a.currentObject={};a.createByTemplate_flag=!1;a.archiveParamset={};a.activeStartDateFormat=new Date;a.activeStartDateFormatted=moment().format(a.ctrlSettings.dateFormat);a.currentParamSpecialList=null;a.fileTypes=["PDF","HTML","XLSX"];a.groupUrl="../api/subscr/contGroup";a.crudTableName="../api/reportParamset";
a.headers={};a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b";a.objects=[];a.availableObjectGroups=[];a.categories=m.getReportCategories();a.contServiceTypes=m.getContServiceTypes();a.isSystemuser=function(){return p.isSystemuser()};m.getReportPeriodsIsLoaded()&&(a.reportPeriods=angular.copy(m.getReportPeriods()));var v=function(b){k.success();$("#moveToArchiveModal").modal("hide");a.createByTemplate_flag||a.getActive();$("#createParamsetModal").modal("hide");
a.setDefault()},t=function(b){k.success();$("#deleteObjectModal").modal("hide");a.getArchive();a.setDefault()},u=function(a){a=p.errorCallbackHandler(a);k.errorInfo(a.caption,a.description)};a.deleteObject=function(b){l(a.crudTableName+"/archive"+a.currentReportType.suffix)["delete"]({id:b[a.extraProps.idColumnName]},t,u)};a.getActive=function(){a.currentMode="";m.getReportTypesIsLoaded()&&(a.reportTypes=m.getReportTypes(),m.getParamsetsForTypes(a.reportTypes,a.currentMode))};a.getActive();a.getArchive=
function(){a.currentMode="/archive";m.getReportTypesIsLoaded()&&(a.reportTypes=m.getReportTypes(),m.getParamsetsForTypes(a.reportTypes,a.currentMode))};a.$on("reportSvc:reportTypesIsLoaded",function(){a.setCurrentServiceType(a.contServiceTypes[0]);var b=n("withReportTypes")(a.categories);angular.isArray(b)&&0<b.length&&(b[0]["class"]="active");a.setCurrentCategory(b[0]);a.reportTypes=m.getReportTypes();m.getParamsetsForTypes(a.reportTypes,a.currentMode)});a.$on("reportSvc:reportPeriodsIsLoaded",function(){a.reportPeriods=
m.getReportPeriods()});a.toggleShowGroupDetails=function(a,b){p.checkUndefinedNull(a.showGroupDetails)&&(a.showGroupDetails={});a.showGroupDetails[b.keyname]=!a.showGroupDetails[b.keyname]};a.selectedItem=function(b,c){a.setCurrentReportType(b);var d=angular.copy(c);a.currentObject=d;a.activeStartDateFormat=null==d.activeStartDate?null:new Date(d.activeStartDate);var e=new Date(d.activeStartDate);a.activeStartDateFormatted=null==d.activeStartDate?"":moment([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]).format(a.ctrlSettings.dateFormat);
a.getTemplates()};a.checkAndSaveParamset=function(b,c){if(!c.name||""==c.name)return k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430 \u043e\u0442\u0447\u0435\u0442\u0430. \u0417\u0430\u043f\u043e\u043b\u043d\u0438\u0442\u0435 \u043f\u043e\u043b\u0435 '\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435'."),
"Add / edit paramset: no name";if(!p.checkUndefinedNull(b)&&angular.isArray(b)){var d;for(d=0;d<b.length;d+=1)if(c.id!=b[d].id&&0==c.name.localeCompare(b[d].name))return k.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u0412\u0430\u0440\u0438\u0430\u043d\u0442 \u043e\u0442\u0447\u0435\u0442\u0430 \u0434\u043e\u043b\u0436\u0435\u043d \u0438\u043c\u0435\u0442\u044c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u043e\u0435 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 . \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u0435 \u043f\u043e\u043b\u0435 '\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435'."),
"Add / edit paramset: name is not unique."}!1===a.checkRequiredFieldsOnSave()?$("#messageForUserModal").modal():a.saveParamset(c)};a.saveParamset=function(b){angular.isArray(a.currentParamSpecialList)&&a.currentParamSpecialList.forEach(function(b){var c=(new Date(moment(b.oneDateValueFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD"))).getTime();b.oneDateValue=isNaN(c)?null:c-q;b.startDateValue=null==b.startDateValueFormatted?null:b.startDateValueFormatted.getTime();b.endDateValue=null==b.endDateValueFormatted?
null:b.endDateValueFormatted.getTime()});b.paramSpecialList=a.currentParamSpecialList;var c="",d=a.selectedObjects.map(function(a){return a.id}),c=new Date(moment(a.activeStartDateFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD")),c=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate());b.activeStartDate=p.checkStrForDate(a.activeStartDateFormatted)?c:null;b.allRequiredParamsPassed=!b.showParamsBeforeRunReport;null==a.currentSign||"undefined"==typeof a.currentSign?(c=new Date(moment(a.psStartDateFormatted,
a.ctrlSettings.dateFormat).format("YYYY-MM-DD")),c=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate()),b.paramsetStartDate=isNaN(c)?null:new Date(c),c=new Date(moment(a.psEndDateFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD")),c=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate()),b.paramsetEndDate=isNaN(c)?null:new Date(c)):(b.paramsetStartDate=null,b.paramsetEndDate=null);if(a.createByTemplate_flag)b.id=null,c=a.crudTableName+"/createByTemplate/"+a.archiveParamset.id,l(c).save({contObjectIds:d},
b,v,u);else if(c=a.crudTableName+a.currentReportType.suffix,a.createParamset_flag&&(b._active=!0,l(c).save({reportTemplateId:b.reportTemplate.id,contObjectIds:d},b,v,u)),a.editParamset_flag){var e=!1;if(p.checkUndefinedNull(d)||0==d.length)e=!0;l(c).update({reportParamsetId:b.id,contObjectIds:d,clearContObjectIds:e},b,v,u)}};a.toArchive=function(a,b){return d(a,{},{update:{method:"PUT",params:{reportParamsetId:b}}})};a.moveToArchive=function(b){a.toArchive(a.crudTableName+"/archive/move",b.id).update({},
b,v,u)};var w=function(){$("#main_properties_tab").addClass("active");$("#set_of_objects_tab").removeClass("active");$("#extra_properties_tab").removeClass("active");$("#createParamsetModal").modal()};a.createByTemplate=function(b,c){a.selectedItem(b,c);a.createByTemplate_flag=!0;a.archiveParamset={};a.archiveParamset.id=c.id;a.archiveParamset.name=c.name;a.currentParamSpecialList=x(c,a.currentReportType);a.currentObject=angular.copy(c);a.currentObject.id=null;a.currentObject._active=!0;a.currentObject.activeEndDate=
null;a.getAvailableObjects(c.id);a.getSelectedObjects(a.archiveParamset.id);a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;w()};a.setDefault=function(){a.currentObject={};a.createByTemplate_flag=!1;a.archiveParamset={};a.activeStartDateFormat=null;a.activeStartDateFormatted="";a.currentReportType={};a.createParamset_flag=!1;a.editParamset_flag=!1;a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.currentSign=9999;a.selectedObjects=[]};a.currentReportType={};a.setCurrentReportType=
function(b){a.currentReportType=b};a.getDirectory=function(a,b){g.get(a).success(function(a){b.specialTypeDirectoryValues=a;p.checkUndefinedNull(b.directoryValue)&&(b.directoryValue=null,angular.isArray(a)&&0<a.length&&a.some(function(a){if(1==a.isDefault)return b.directoryValue=a[b.specialTypeDirectoryValue],!0}))}).error(function(a){console.log(a)})};a.addParamSet=function(b){a.setCurrentReportType(b);c();a.psStartDateFormatted=moment().format(a.ctrlSettings.dateFormat);a.psEndDateFormatted=moment().format(a.ctrlSettings.dateFormat);
a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.createByTemplate_flag=!1;a.createParamset_flag=!0;a.editParamset_flag=!1;a.currentSign=9999;a.getTemplates();a.getAvailableObjects(0);a.selectedObjects=[];w();a.currentObject={};a.currentObject.reportPeriodKey="CURRENT_MONTH";a.currentObject.outputFileType=a.fileTypes[0];a.currentReportPeriod={};a.currentObject.showParamsBeforeRunReport=!0;a.currentObject._active=!0;a.currentObject.paramSpecialList=[]};var x=function(b,c){var d=c.reportMetaParamSpecialList.map(function(c){var d=
{};d.paramSpecialCaption=c.paramSpecialCaption;d.reportMetaParamSpecialId=c.id;d.paramSpecialRequired=c.paramSpecialRequired;d.paramSpecialTypeKeyname=c.paramSpecialType.keyname;d.reportMetaParamCategory=c.reportMetaParamCategory;d.reportMetaParamCategoryOrder=c.reportMetaParamCategory.categoryOrder;d.reportMetaParamCategoryKeyname=c.reportMetaParamCategoryKeyname;d.reportMetaParamOrder=c.reportMetaParamOrder;d.reportMetaParamFullOrder=1E3*c.reportMetaParamCategory.categoryOrder+(p.checkUndefinedNull(c.reportMetaParamOrder)?
0:c.reportMetaParamOrder);e(c)&&(d.specialTypeDirectoryUrl=c.paramSpecialType.specialTypeDirectoryUrl,d.specialTypeDirectoryKey=c.paramSpecialType.specialTypeDirectoryKey,d.specialTypeDirectoryCaption=c.paramSpecialType.specialTypeDirectoryCaption,d.specialTypeDirectoryValue=c.paramSpecialType.specialTypeDirectoryValue,a.getDirectory(".."+d.specialTypeDirectoryUrl,d));if(0==b.paramSpecialList.length)return d.textValue=null,d.boolValue=null,d.numericValue=null,d.oneDateValue=null,d.startDateValue=
null,d.endDateValue=null,d.oneDateValueFormatted=null,d.startDateValueFormatted=null,d.endDateValueFormatted=null,d.directoryValue=null,d;var f=-1;b.paramSpecialList.some(function(a,b,d){return a.reportMetaParamSpecialId===c.id?(f=b,!0):!1});-1!=f?(d.id=b.paramSpecialList[f].id||null,d.textValue=b.paramSpecialList[f].textValue||null,d.boolValue=b.paramSpecialList[f].boolValue||null,d.numericValue=b.paramSpecialList[f].numericValue||null,d.oneDateValue=b.paramSpecialList[f].oneDateValue||null,d.startDateValue=
b.paramSpecialList[f].startDateValue||null,d.endDateValue=b.paramSpecialList[f].endDateValue||null,d.oneDateValueFormatted=null!==b.paramSpecialList[f].oneDateValue?moment.utc(b.paramSpecialList[f].oneDateValue+q).format(a.ctrlSettings.dateFormat):"",d.startDateValueFormatted=angular.isUndefined(b.paramSpecialList[f].startDateValue)||null==b.paramSpecialList[f].startDateValue?null:new Date(b.paramSpecialList[f].startDateValue),d.endDateValueFormatted=null==b.paramSpecialList[f].endDateValue?null:
new Date(b.paramSpecialList[f].endDateValue),p.checkUndefinedNull(b.paramSpecialList[f].directoryValue)?d.directoryValue=null:p.isNumeric(b.paramSpecialList[f].directoryValue)?d.directoryValue=Number(b.paramSpecialList[f].directoryValue):d.directoryValue=b.paramSpecialList[f].directoryValue,d.version=b.paramSpecialList[f].version||null):(d.id=null,d.textValue=null,d.boolValue=null,d.numericValue=null,d.oneDateValue=null,d.startDateValue=null,d.endDateValue=null,d.oneDateValueFormatted=null,d.startDateValueFormatted=
null,d.endDateValueFormatted=null,d.directoryValue=null);return d});f(d);p.sortNumericItemsBy(d,"reportMetaParamFullOrder");return d};a.editParamSet=function(b,c){a.selectedItem(b,c);a.currentParamSpecialList=x(c,a.currentReportType);a.currentObject.showParamsBeforeRunReport=!a.currentObject.allRequiredParamsPassed;a.createParamset_flag=!1;a.editParamset_flag=!0;a.createByTemplate_flag=!1;a.getAvailableObjects(c.id);a.getSelectedObjects(a.currentObject.id);a.currentSign=c.reportPeriod.sign;if(null==
a.currentSign||"undefined"==typeof a.currentSign)a.paramsetStartDateFormat=new Date(c.paramsetStartDate),a.psStartDateFormatted=null!=c.paramsetStartDate?moment([a.paramsetStartDateFormat.getUTCFullYear(),a.paramsetStartDateFormat.getUTCMonth(),a.paramsetStartDateFormat.getUTCDate()]).format(a.ctrlSettings.dateFormat):"",a.paramsetEndDateFormat=new Date(c.paramsetEndDate),a.psEndDateFormatted=null!=c.paramsetEndDate?moment([a.paramsetEndDateFormat.getUTCFullYear(),a.paramsetEndDateFormat.getUTCMonth(),
a.paramsetEndDateFormat.getUTCDate()]).format(a.ctrlSettings.dateFormat):"";a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;w()};a.availableObjects=[];a.selectedObjects=[];a.getAvailableObjects=function(b){l(a.crudTableName+"/"+b+"/contObject/available").query(function(b){a.availableObjects=angular.copy(b)})};a.getSelectedObjects=function(b){l(a.crudTableName+"/"+b+"/contObject").query(function(b){a.selectedObjects=b;h.sortObjectsByFullName(a.selectedObjects)})};a.prepareObjectsList=function(){a.availableObjectGroups.forEach(function(a){a.selected=
!1});a.ctrlSettings.selectedAll=!1};a.getGroupObjects=function(b){l(a.groupUrl+"/"+b.id+"/contObject").query(function(a){b.objects=a})};a.getAvailableObjectGroups=function(){l(a.groupUrl).query(function(b){b.forEach(function(b){a.getGroupObjects(b)});p.sortItemsBy(b,"contGroupName");a.availableObjectGroups=b})};a.getAvailableObjectGroups();a.viewAvailableObjects=function(b){a.showAvailableObjects_flag=!a.showAvailableObjects_flag;(a.showAvailableObjectGroups_flag=b)?(a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",
a.availableEntities=a.availableObjectGroups):(a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b",a.availableObjects=h.sortObjectsByFullNameEx(a.availableObjects),a.availableEntities=a.availableObjects)};a.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};a.deleteDoublesObjects=function(a){for(var b=a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&
a.splice(b,1)};a.addUniqueObjectsFromGroupsToSelectedObjects=function(a,b){var c,d;for(c=0;c<a.length;c+=1){var e=!0;for(d=0;d<b.length;d+=1)if(a[c].fullName===b[d].fullName){e=!1;break}e&&b.push(a[c])}};a.removeGroupObjectsFromAvailableObjects=function(a,b){var c,d;for(d=0;d<a.length;d+=1){var e=-1;for(c=0;c<b.length;c+=1)if(a[d].fullName===b[c].fullName){e=c;break}0<=e&&b.splice(e,1)}};var E=function(b,c){var d={},e=[],f=[],g=[];a.addObject_flag?(e=a.availableObjects,g=f=a.selectedObjects):(f=a.availableObjects,
g=e=a.selectedObjects);var h;for(h=0;h<e.length;h+=1)if(e[h].id==a.currentObjectId){d=angular.copy(e[h]);d.selected=!1;e.splice(h,1);break}f.push(d);return g.map(function(a){return a.id})};a.getResource=function(a,b){return d(a,{},{update:{method:"PUT",params:{reportParamsetId:b}},addObject:{method:"POST",params:{contObjectId:b}},removeObject:{method:"DELETE"}})};a.removeSelectedObject=function(b){a.availableObjects.push(b);a.selectedObjects.splice(a.selectedObjects.indexOf(b),1);a.availableObjects=
h.sortObjectsByFullNameEx(a.availableObjects)};a.selectAllAvailableEntities=function(){var b;for(b=0;b<a.availableEntities.length;b+=1)a.availableEntities[b].selected=a.ctrlSettings.selectedAll};a.addSelectedEntities=function(){if(a.showAvailableObjectGroups_flag){var b=a.joinObjectsFromSelectedGroups(a.availableEntities);h.sortObjectsByFullName(b);a.deleteDoublesObjects(b);a.addUniqueObjectsFromGroupsToSelectedObjects(b,a.selectedObjects);a.removeGroupObjectsFromAvailableObjects(b,a.availableObjects)}var b=
angular.copy(a.availableObjects),c;for(c=0;c<a.availableObjects.length;c+=1){var d=a.availableObjects[c];if(d.selected){var e=angular.copy(d);e.selected=null;var f=-1;b.some(function(a,b,c){return a.fullName===d.fullName?(f=b,!0):!1});b.splice(f,1);a.selectedObjects.push(e);d.selected=null}}a.availableObjects=b;a.showAvailableObjects_flag=!1;h.sortObjectsByFullName(a.selectedObjects)};a.removeObject=function(b){a.addObject_flag=!1;a.currentObjectId=b.id;E(!1,b.id)};a.templatesForCurrentParaset=[];
a.getTemplates=function(){l("../api/reportTemplate"+a.currentReportType.suffix).query(function(b){a.templatesForCurrentParaset=b;a.createParamset_flag&&(a.currentObject.reportTemplate=a.templatesForCurrentParaset[0])})};a.closeSaveObjectModal=function(){$("#saveObjectModal").hide()};var G=function(){$("#inputSettlementMonth").datepicker({dateFormat:"MM, yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,
monthNamesShort:"\u042f\u043d\u0432 \u0424\u0435\u0432 \u041c\u0430\u0440 \u0410\u043f\u0440 \u041c\u0430\u0439 \u0418\u044e\u043d \u0418\u044e\u043b \u0410\u0432\u0433 \u0421\u0435\u043d \u041e\u043a\u0442 \u041d\u043e\u044f \u0414\u0435\u043a".split(" "),changeMonth:!0,changeYear:!0,showButtonPanel:!0,closeText:"\u041e\u043a",currentText:"",onClose:function(b,c){$(this).datepicker("setDate",new Date(c.selectedYear,c.selectedMonth,1));a.currentObject.settlementMonth=c.selectedMonth+1;a.currentObject.settlementYear=
c.selectedYear;setTimeout(function(){$(".ui-datepicker-calendar").addClass("nmc-hide")},1)},beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").addClass("nmc-hide");$(".ui-datepicker-current").addClass("nmc-hide")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-current").addClass("nmc-hide");$(".ui-datepicker-calendar").addClass("nmc-hide")},1)}});$("#inputSettlementMonth").datepicker("setDate",new Date(a.currentObject.settlementYear,a.currentObject.settlementMonth-
1,1))};a.$watch("currentObject.reportPeriodKey",function(b){if(p.checkUndefinedNull(a.reportPeriods))return console.log(a.reportPeriods),"reportPeriods is undefined or null.";var c;for(c=0;c<a.reportPeriods.length;c+=1)b==a.reportPeriods[c].keyname&&(a.currentSign=a.reportPeriods[c].sign,a.currentReportPeriod=a.reportPeriods[c],null==a.currentSign||"undefined"==typeof a.currentSign)&&(a.paramsetStartDateFormat=null==a.currentObject.paramsetStartDate?null:new Date(a.currentObject.paramsetStartDate),
a.paramsetEndDateFormat=null==a.currentObject.paramsetEndDate?null:new Date(a.currentObject.paramsetEndDate));p.checkUndefinedNull(a.currentReportPeriod)||1!=a.currentReportPeriod.isSettlementMonth||(p.checkUndefinedNull(a.currentObject.settlementMonth)&&(a.currentObject.settlementMonth=(new Date).getMonth()+1),p.checkUndefinedNull(a.currentObject.settlementYear)&&(a.currentObject.settlementYear=(new Date).getFullYear()),G())},!1);a.isDisabled=function(){return a.isROfield()||a.currentObject.common||
!a.currentObject._active};a.isSpecialParamDisabled=function(b,c){var d=!1;c.some(function(a){if(b.reportMetaParamCategory.keyname===a.reportMetaParamCategory.keyname&&"SPECIAL_CATEGORY_SWITCH"===a.paramSpecialTypeKeyname&&!0!==a.boolValue)return d=!0});return a.isDisabled()||d};a.showAddObjectButton=function(){return!a.showAvailableObjects_flag&&a.set_of_objects_flag};a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),
firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},singleDatePicker:!0,format:a.ctrlSettings.dateFormat};
$(document).ready(function(){$("#inputSingleDateStart").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputSingleDateEnd").datepicker({dateFormat:"dd.mm.yy",
firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputStartDate").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,
monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});var C=function(a){p.getContextIds().forEach(function(b){b.permissionTagId.localeCompare(a);var c=document.getElementById(b.permissionTagId);angular.isUndefined(c)||null==c||$("#"+b.permissionTagId).removeClass("nmc-hide")})};C(a.ctrlSettings.ctxId);
b.$on("servicePermissions:loaded",function(){C(a.ctrlSettings.ctxId)});a.checkDateInterval=function(b,c){if(!p.checkStrForDate(b)||!p.checkStrForDate(c)||null==b||null==c||""==b||""==c)return!1;var d=p.strDateToUTC(b,a.ctrlSettings.dateFormat),d=null!=d?new Date(d):null,e=p.strDateToUTC(c,a.ctrlSettings.dateFormat),e=null!=e?new Date(e):null;return null==d||null==e?!1:e>=d};a.checkOutputFileZipped=function(){if(!a.currentReportType.hasOwnProperty("reportMetaParamCommon"))return!1;var b=!1;a.currentReportType.reportMetaParamCommon.manyContObjectsZipOnly&&
(1<a.selectedObjects.length||0===a.selectedObjects.length)&&(b=a.currentObject.outputFileZipped=!0);return b};a.checkRequiredFieldsOnSave=function(){a.currentObject.psStartDateFormatted=a.psStartDateFormatted;a.currentObject.psEndDateFormatted=a.psEndDateFormatted;a.currentObject.selectedObjects=a.selectedObjects;r(a.currentParamSpecialList);a.currentObject.currentParamSpecialList=a.currentParamSpecialList;a.currentObject.currentReportPeriod=a.currentReportPeriod;var b=m.checkPSRequiredFieldsOnSave(a.currentReportType,
a.currentObject,a.currentSign,"create");a.messageForUser=b.message;return b.flag};a.isAdmin=function(){return p.isAdmin()};a.isReadonly=function(){return p.isReadonly()};a.isTestMode=function(){return p.isTestMode()};a.isSystemViewInfo=function(){return p.getViewSystemInfo()};a.isROfield=function(){return a.isReadonly()};a.setActiveTab=function(a){var b;b=document.getElementById("a_teplo_sys");b.classList.remove("active");b=document.getElementById("a_electro_sys");b.classList.remove("active");b=document.getElementById("a_gas_sys");
b.classList.remove("active");b=document.getElementById(a);b.classList.add("active")};$("#createParamsetModal").on("shown.bs.modal",function(){3<Number(a.currentObject.settlementDay)&&9>=Number(a.currentObject.settlementDay)&&(a.currentObject.settlementDay="0"+a.currentObject.settlementDay,a.$apply());$("#inputSettlementDay").inputmask("d",{placeholder:""});$("#inputFileTemplate").inputmask("Regex",{regex:"[a-zA-Z0-9]+"});a.currentParamSpecialList.forEach(function(b){if("SPECIAL_DATE"!==b.paramSpecialTypeKeyname)return!0;
$("#inputSpecialDate"+b.reportMetaParamSpecialId).datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(a){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})})});a.setCurrentServiceType=function(b){a.currentServiceType=
angular.copy(b)};a.setCurrentCategory=function(b){a.currentCategory=b};a.setCurrentServiceType(a.contServiceTypes[0]);b=n("withReportTypes")(a.categories);angular.isArray(b)&&0<b.length&&(b[0]["class"]="active");a.setCurrentCategory(b[0]);a.preview=function(a){window.open(a.previewUrl)}}]);app=angular.module("portalNMC");
app.controller("ReportsCtrl",["$scope","$rootScope","$http","crudGridDataFactoryWithCanceler","notificationFactory","objectSvc","mainSvc","$timeout","reportSvc","$q","$filter",function(a,b,d,g,l,k,h,p,m,n,e){function c(b){$("#creationReportModal").modal("hide");!0===a.createReportInProgress&&0===b.status?a.createReportInProgress=!1:w(b)}function f(a){var b=[];a.forEach(function(a){var c=!1;b.forEach(function(b){if(b.keyname===a.reportMetaParamCategory.keyname)return c=!0});!1===c&&b.push(angular.copy(a.reportMetaParamCategory))});
var c=[];b.forEach(function(b,d){a.some(function(a){if(a.reportMetaParamCategory.keyname===b.keyname&&"SPECIAL_CATEGORY_SWITCH"===a.paramSpecialTypeKeyname)return c.push(b.keyname),!0})});c.forEach(function(a){b.some(function(c,d){if(c.keyname===a)return b.splice(d,1),!0})});b.forEach(function(b){var c=angular.copy(b);c.paramSpecialCaption=b.caption;c.paramSpecialTypeKeyname="SPECIAL_CATEGORY_CAPTION";c.reportMetaParamFullOrder=1E3*b.categoryOrder-1;c.paramSpecialRequired=!1;c.reportMetaParamCategory=
angular.copy(b);a.push(c)})}function r(a){a.forEach(function(b,c){"SPECIAL_CATEGORY_CAPTION"===b.paramSpecialTypeKeyname&&a.splice(c,1)})}var q=0,v=0,t=36E5*h.getServerTimeZone();b.ctxId="reports_page";a.ctrlSettings={};a.ctrlSettings.dateFormat="DD.MM.YYYY";a.ctrlSettings.selectedAll=!1;a.ctrlSettings.htmlLoading=h.getHtmlLoading();a.ctrlSettings.openModes={create:{name:"create",isContext:!1},edit:{name:"edit"},preview:{name:"preview"}};a.ctrlSettings.currentReportPreviewEnabledFlag=!1;a.contServiceTypes=
m.getContServiceTypes();var u=m.getRequestCanceler();a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.currentSign=9999;a.extraProps={idColumnName:"id",defaultOrderBy:"name",deleteConfirmationProp:"name"};a.activeStartDateFormat=new Date;a.activeStartDateFormatted=moment().format(a.ctrlSettings.dateFormat);a.fileTypes=["PDF","HTML","XLSX"];a.currentObject={};a.currentReportPeriod={};a.reportObjects=[];a.paramsetColumns=[{name:"name",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",
"class":"col-xs-5 col-md-5"},{name:"period",header:"\u041f\u0435\u0440\u0438\u043e\u0434","class":"col-xs-2 col-md-2"},{name:"fileType",header:"\u0422\u0438\u043f \u0444\u0430\u0439\u043b\u0430","class":"col-xs-1 col-md-1"},{name:"outputFileNameTemplate",header:"\u0428\u0430\u0431\u043b\u043e\u043d \u0438\u043c\u0435\u043d\u0438 \u0444\u0430\u0439\u043b\u0430","class":"col-xs-3 col-md-3"}];a.groupUrl="../api/subscr/contGroup";a.paramsetsUrl="../api/reportParamset";a.headers={};a.headers.addObjects=
"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b";a.ctrlSettings.reportCountList=5;a.createReportWithParamsInProgress=!1;a.isSystemuser=function(){a.userInfo=b.userInfo;return a.userInfo._system};a.categories=m.getReportCategories();a.resourceCategories=m.getResourceCategories();a.currentResourceCategory=m.getDefaultResourceCategory();a.setCurrentServiceType=function(b){a.currentServiceType=angular.copy(b)};a.setCurrentCategory=function(b){a.currentCategory=
b};a.$on("reportSvc:reportTypesIsLoaded",function(){a.setCurrentServiceType(a.contServiceTypes[0]);a.reportObjects=m.getReportTypes();q=a.reportObjects.length;a.getActive()});a.$on("reportSvc:reportPeriodsIsLoaded",function(){a.reportPeriods=m.getReportPeriods()});m.getReportPeriodsIsLoaded()&&(a.reportPeriods=angular.copy(m.getReportPeriods()));a.oldColumns=[{name:"name",header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430","class":"col-xs-5 col-md-5"},
{name:"activeStartDate",header:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 \u0441","class":"col-xs-2 col-md-2"}];var w=function(b){a.createReportWithParamsInProgress=!1;b=h.errorCallbackHandler(b);l.errorInfo(b.caption,b.description)};a.getSelectedObjectsByParamset=function(b,c,d){g(a.paramsetsUrl+"/"+c.id+"/contObject",u).query(function(a){h.checkUndefinedNull(d)||1!=d?c.selectedObjects=a:c.selectedObjects=[k.getCurrentObject()];k.sortObjectsByFullName(c.selectedObjects);c.currentParamSpecialList=
x(b,c);c.currentReportPeriod=angular.copy(c.reportPeriod);a=m.checkPSRequiredFieldsOnSave(b,c,c.reportPeriod.sign,"run");c.checkFlag=a.flag;c.messageForUser=a.message;h.checkUndefinedNull(b)||(b.checkedParamsetsCount+=1)})};a.getParamsets=function(b,c){g(b,u).query(function(b){c.paramsetsCount=b.length;c.checkedParamsetsCount=0;b=angular.copy(b);b.forEach(function(b){var d=b.reportPeriod.sign;if(null==d||"undefined"==typeof d)d=new Date(b.paramsetStartDate),b.psStartDateFormatted=null!=b.paramsetStartDate?
moment([d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()]).format(a.ctrlSettings.dateFormat):"",d=new Date(b.paramsetEndDate),b.psEndDateFormatted=null!=b.paramsetEndDate?moment([d.getUTCFullYear(),d.getUTCMonth(),d.getUTCDate()]).format(a.ctrlSettings.dateFormat):"";a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.getSelectedObjectsByParamset(c,b)});h.sortItemsBy(b,"name");c.paramsets=b;v+=1;v===q&&p(function(){var b=e("notEmptyCategories")(a.categories);angular.isArray(b)&&0<b.length&&
(b[0]["class"]="active");a.setCurrentCategory(b[0])},100)})};a.getActive=function(){if(0!==a.reportObjects.length&&"undefined"!=typeof a.reportObjects[0].suffix){var b;for(b=0;b<a.reportObjects.length;b+=1)a.getParamsets(a.paramsetsUrl+a.reportObjects[b].suffix,a.reportObjects[b])}};m.getReportTypesIsLoaded()&&(a.reportObjects=m.getReportTypes(),q=a.reportObjects.length,a.getActive());a.toggleReportShowGroupDetails=function(a,b){h.checkUndefinedNull(a.showGroupDetails)&&(a.showGroupDetails={});a.showGroupDetails[b.keyname]=
!a.showGroupDetails[b.keyname]};a.selectedReport=function(b,c){a.setCurrentReportType(b);var d=angular.copy(c);a.currentObject=d;h.checkUndefinedNull(a.currentObject.settlementYear)&&(a.currentObject.settlementYear=(new Date).getFullYear());h.checkUndefinedNull(a.currentObject.settlementMonth)&&(a.currentObject.settlementMonth=(new Date).getMonth());a.activeStartDateFormat=null==d.activeStartDate?null:new Date(d.activeStartDate);var e=new Date(d.activeStartDate);a.activeStartDateFormatted=null==d.activeStartDate?
"":moment([e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate()]).format(a.ctrlSettings.dateFormat);a.getTemplates()};a.checkAndRunParamset=function(b,c,d){if(!1===a.checkRequiredFieldsOnSave())$("#messageForUserModal").modal();else{var e=null,f=new Blob([a.ctrlSettings.htmlLoading],{type:"text/html"});d&&(e=window.URL.createObjectURL(f),e=window.open(e,"PreviewWin"));a.createReportWithParams(b,c,a.selectedObjects,d,e)}};a.currentReportType={};a.setCurrentReportType=function(b){a.currentReportType=b};
a.getDirectory=function(a,b){d.get(a,{timeout:u.promise}).success(function(a){b.specialTypeDirectoryValues=a}).error(function(a){console.log(a)})};var x=function(b,c){if(h.checkUndefinedNull(b)||h.checkUndefinedNull(c))return console.log("Paramset:"),console.log(c),console.log("Report type:"),console.log(b),null;var d=b.reportMetaParamSpecialList.map(function(b){var d={};d.paramSpecialCaption=b.paramSpecialCaption;d.reportMetaParamSpecialId=b.id;d.paramSpecialRequired=b.paramSpecialRequired;d.paramSpecialTypeKeyname=
b.paramSpecialType.keyname;d.reportMetaParamCategory=b.reportMetaParamCategory;d.reportMetaParamCategoryOrder=b.reportMetaParamCategory.categoryOrder;d.reportMetaParamCategoryKeyname=b.reportMetaParamCategoryKeyname;d.reportMetaParamOrder=b.reportMetaParamOrder;d.reportMetaParamFullOrder=1E3*b.reportMetaParamCategory.categoryOrder+(h.checkUndefinedNull(b.reportMetaParamOrder)?0:b.reportMetaParamOrder);null!=b.paramSpecialType.specialTypeDirectoryUrl&&"undefined"!=typeof b.paramSpecialType.specialTypeDirectoryUrl&&
null!=b.paramSpecialType.specialTypeDirectoryKey&&"undefined"!=typeof b.paramSpecialType.specialTypeDirectoryKey&&null!=b.paramSpecialType.specialTypeDirectoryCaption&&"undefined"!=typeof b.paramSpecialType.specialTypeDirectoryCaption&&null!=b.paramSpecialType.specialTypeDirectoryValue&&"undefined"!=typeof b.paramSpecialType.specialTypeDirectoryValue&&(d.specialTypeDirectoryUrl=b.paramSpecialType.specialTypeDirectoryUrl,d.specialTypeDirectoryKey=b.paramSpecialType.specialTypeDirectoryKey,d.specialTypeDirectoryCaption=
b.paramSpecialType.specialTypeDirectoryCaption,d.specialTypeDirectoryValue=b.paramSpecialType.specialTypeDirectoryValue,a.getDirectory(".."+d.specialTypeDirectoryUrl,d));if(0===c.paramSpecialList.length)return d.textValue=null,d.boolValue=null,d.numericValue=null,d.oneDateValue=null,d.startDateValue=null,d.endDateValue=null,d.oneDateValueFormatted=null,d.startDateValueFormatted=null,d.endDateValueFormatted=null,d.directoryValue=null,d;var e=-1;c.paramSpecialList.some(function(a,c,d){return a.reportMetaParamSpecialId===
b.id?(e=c,!0):!1});-1!=e?(d.id=c.paramSpecialList[e].id||null,d.textValue=c.paramSpecialList[e].textValue||null,d.boolValue=c.paramSpecialList[e].boolValue||null,d.numericValue=c.paramSpecialList[e].numericValue||null,d.oneDateValue=c.paramSpecialList[e].oneDateValue||null,d.startDateValue=c.paramSpecialList[e].startDateValue||null,d.endDateValue=c.paramSpecialList[e].endDateValue||null,d.oneDateValueFormatted=null!==c.paramSpecialList[e].oneDateValue?moment.utc(c.paramSpecialList[e].oneDateValue+
t).format(a.ctrlSettings.dateFormat):"",d.startDateValueFormatted=null==c.paramSpecialList[e].startDateValue?null:new Date(c.paramSpecialList[e].startDateValue),d.endDateValueFormatted=null==c.paramSpecialList[e].endDateValue?null:new Date(c.paramSpecialList[e].endDateValue),h.checkUndefinedNull(c.paramSpecialList[e].directoryValue)?d.directoryValue=null:h.isNumeric(c.paramSpecialList[e].directoryValue)?d.directoryValue=Number(c.paramSpecialList[e].directoryValue):d.directoryValue=c.paramSpecialList[e].directoryValue,
d.version=c.paramSpecialList[e].version||null):(d.id=null,d.textValue=null,d.boolValue=null,d.numericValue=null,d.oneDateValue=null,d.startDateValue=null,d.endDateValue=null,d.directoryValue=null,d.oneDateValueFormatted=null,d.startDateValueFormatted=null,d.endDateValueFormatted=null);return d});f(d);h.sortNumericItemsBy(d,"reportMetaParamFullOrder");return d};a.editParamSet=function(b,c,d,e){a.createReportWithParamsInProgress=!1;a.showMessageForUserModalExFlag=!1;a.selectedReport(b,c);a.currentParamSpecialList=
x(a.currentReportType,c);a.currentObject.showParamsBeforeRunReport=!a.currentObject.allRequiredParamsPassed;a.editParamset_flag=!0;a.createByTemplate_flag=!1;a.getAvailableObjects(c.id);a.currentSign=c.reportPeriod.sign;if(null==a.currentSign||"undefined"==typeof a.currentSign)a.paramsetStartDateFormat=new Date(c.paramsetStartDate),a.psStartDateFormatted=null!=c.paramsetStartDate?moment([a.paramsetStartDateFormat.getUTCFullYear(),a.paramsetStartDateFormat.getUTCMonth(),a.paramsetStartDateFormat.getUTCDate()]).format(a.ctrlSettings.dateFormat):
"",a.paramsetEndDateFormat=new Date(c.paramsetEndDate),a.psEndDateFormatted=null!=c.paramsetEndDate?moment([a.paramsetEndDateFormat.getUTCFullYear(),a.paramsetEndDateFormat.getUTCMonth(),a.paramsetEndDateFormat.getUTCDate()]).format(a.ctrlSettings.dateFormat):"";a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;a.getSelectedObjects(d,e)};a.availableObjects=[];a.selectedObjects=[];a.availableObjectGroups=[];a.getAvailableObjects=function(b){g(a.paramsetsUrl+"/"+b+"/contObject/available",u).query(function(b){a.availableObjects=
angular.copy(b)})};a.getSelectedObjects=function(b,c){g(a.paramsetsUrl+"/"+a.currentObject.id+"/contObject",u).query(function(d){a.selectedObjects=d;h.checkUndefinedNull(c)||1!=c||(a.selectedObjects=[k.getCurrentObject()]);k.sortObjectsByFullName(a.selectedObjects);switch(b){case a.ctrlSettings.openModes.edit:$("#main_properties_tab").addClass("active");$("#set_of_objects_tab").removeClass("active");$("#extra_properties_tab").removeClass("active");$("#editParamsetModal").modal();break;case a.ctrlSettings.openModes.create:d=
a.checkRequiredFieldsOnSave();!1===d?(a.showMessageForUserModalExFlag=!0,$("#messageForUserModal").modal()):a.createReport(a.currentReportType,a.currentObject,c);break;case a.ctrlSettings.openModes.preview:a.checkRequiredFieldsOnSave()}})};a.prepareObjectsList=function(){a.availableObjectGroups.forEach(function(a){a.selected=!1});a.ctrlSettings.selectedAll=!1};a.getGroupObjects=function(b){g(a.groupUrl+"/"+b.id+"/contObject",u).query(function(a){b.objects=a})};a.getAvailableObjectGroups=function(){g(a.groupUrl,
u).query(function(b){b.forEach(function(b){a.getGroupObjects(b)});h.sortItemsBy(b,"contGroupName");a.availableObjectGroups=b})};a.getAvailableObjectGroups();a.viewAvailableObjects=function(b){a.showAvailableObjects_flag=!a.showAvailableObjects_flag;(a.showAvailableObjectGroups_flag=b)?(a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",a.availableEntities=a.availableObjectGroups):(a.headers.addObjects=
"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b",a.availableObjects=k.sortObjectsByFullNameEx(a.availableObjects),a.availableEntities=a.availableObjects)};a.removeSelectedObject=function(b){a.availableObjects.push(b);a.selectedObjects.splice(a.selectedObjects.indexOf(b),1);k.sortObjectsByFullName(a.availableObjects)};a.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};
a.deleteDoublesObjects=function(a){for(var b=a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&a.splice(b,1)};a.addUniqueObjectsFromGroupsToSelectedObjects=function(a,b){var c,d;for(d=0;d<a.length;d+=1){var e=!0;for(c=0;c<b.length;c+=1)if(a[d].fullName===b[c].fullName){e=!1;break}e&&b.push(a[d])}};a.removeGroupObjectsFromAvailableObjects=function(a,b){var c,d;for(d=0;d<a.length;d+=1){var e=-1;for(c=0;c<b.length;c+=1)if(a[d].fullName===b[c].fullName){e=c;break}0<=e&&b.splice(e,1)}};a.selectAllAvailableEntities=
function(){var b;for(b=0;b<a.availableEntities.length;b+=1)a.availableEntities[b].selected=a.ctrlSettings.selectedAll};a.addSelectedEntities=function(){if(a.showAvailableObjectGroups_flag){var b=a.joinObjectsFromSelectedGroups(a.availableEntities);k.sortObjectsByFullName(b);a.deleteDoublesObjects(b);a.addUniqueObjectsFromGroupsToSelectedObjects(b,a.selectedObjects);a.removeGroupObjectsFromAvailableObjects(b,a.availableObjects)}var b=angular.copy(a.availableObjects),c;for(c=0;c<a.availableObjects.length;c+=
1){var d=a.availableObjects[c];if(d.selected){var e=angular.copy(d);e.selected=null;var f=-1;b.some(function(a,b,c){return a.fullName===d.fullName?(f=b,!0):!1});b.splice(f,1);a.selectedObjects.push(e);d.selected=null}}a.availableObjects=b;k.sortObjectsByFullName(a.selectedObjects);a.showAvailableObjects_flag=!1};a.removeObject=function(b){a.addObject_flag=!1;a.currentObjectId=b.id;objectPerform(!1,b.id)};a.templatesForCurrentParaset=[];a.getTemplates=function(){g("../api/reportTemplate"+a.currentReportType.suffix,
u).query(function(b){a.templatesForCurrentParaset=b;a.createParamset_flag&&(a.currentObject.reportTemplate=a.templatesForCurrentParaset[0])})};a.$watch("currentObject.reportPeriodKey",function(b){if(!angular.isArray(a.reportPeriods))return"reportPeriods is no array.";var c;for(c=0;c<a.reportPeriods.length;c+=1)b==a.reportPeriods[c].keyname&&(a.currentSign=a.reportPeriods[c].sign,a.currentReportPeriod=a.reportPeriods[c],null==a.currentSign||"undefined"==typeof a.currentSign)&&(a.paramsetStartDateFormat=
null==a.currentObject.paramsetStartDate?null:new Date(a.currentObject.paramsetStartDate),a.paramsetEndDateFormat=null==a.currentObject.paramsetEndDate?null:new Date(a.currentObject.paramsetEndDate))},!1);a.isDisabled=function(){return 1==a.createReportWithParamsInProgress};a.showAddObjectButton=function(){return!a.showAvailableObjects_flag&&a.set_of_objects_flag};a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),
firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},singleDatePicker:!0,format:a.ctrlSettings.dateFormat};
$(document).ready(function(){$("#inputSingleDateStart").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputSingleDateEnd").datepicker({dateFormat:"dd.mm.yy",
firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputStartDate").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,
monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});a.checkDateInterval=function(b,c){if(!h.checkStrForDate(b)||!h.checkStrForDate(c))return!1;if(null==b||null==c||""==b||""==c)return console.log("1"),!1;var d=h.strDateToUTC(b,a.ctrlSettings.dateFormat),d=null!=d?new Date(d):null,e=h.strDateToUTC(c,
a.ctrlSettings.dateFormat),e=null!=e?new Date(e):null;return null==d||null==e?!1:e>=d};a.checkRequiredFields=function(){if(!a.currentObject.hasOwnProperty("reportPeriodKey")||!a.currentObject.hasOwnProperty("reportTemplate"))return!1;var b=!0;if(null==a.currentSign)var b=h.strDateToUTC(a.psStartDateFormatted,a.ctrlSettings.dateFormat),b=new Date(b),c=h.strDateToUTC(a.psEndDateFormatted,a.ctrlSettings.dateFormat),c=new Date(c),b=!isNaN(b.getTime())&&!isNaN(c.getTime())&&a.checkDateInterval(a.psStartDateFormatted,
a.psEndDateFormatted);return!(null==a.currentObject.reportPeriodKey||null==a.currentObject.reportTemplate.id)&&b};a.checkPSRequiredFields=function(b){if(!b.hasOwnProperty("reportPeriodKey")||!b.hasOwnProperty("reportTemplate"))return!1;var c=!0;if(null==a.currentSign)var c=h.strDateToUTC(b.psStartDateFormatted,a.ctrlSettings.dateFormat),c=new Date(c),d=h.strDateToUTC(b.psEndDateFormatted,a.ctrlSettings.dateFormat),d=new Date(d),c=!isNaN(c.getTime())&&!isNaN(d.getTime())&&a.checkDateInterval(b.psStartDateFormatted,
b.psEndDateFormatted);return!(null==b.reportPeriodKey||null==b.reportTemplate.id)&&c};a.checkOutputFileZipped=function(){if(!a.currentReportType.hasOwnProperty("reportMetaParamCommon"))return!1;var b=!1;a.currentReportType.reportMetaParamCommon.manyContObjectsZipOnly&&(1<a.selectedObjects.length||0===a.selectedObjects.length)&&(b=a.currentObject.outputFileZipped=!0);return b};a.checkRequiredFieldsOnSave=function(){a.currentObject.psStartDateFormatted=a.psStartDateFormatted;a.currentObject.psEndDateFormatted=
a.psEndDateFormatted;a.currentObject.selectedObjects=a.selectedObjects;var b=angular.copy(a.currentParamSpecialList);r(b);a.currentObject.currentParamSpecialList=b;a.currentObject.currentReportPeriod=a.currentReportPeriod;b=m.checkPSRequiredFieldsOnSave(a.currentReportType,a.currentObject,a.currentSign,"run");a.messageForUser=b.message;return b.flag};a.createReport=function(b,e,f){b="../api/reportService"+b.suffix+"/"+e.id;b=h.checkUndefinedNull(f)||1!=f||h.checkUndefinedNull(k.getCurrentObject())?
b+"/download":b+("/context/"+k.getCurrentObject().id);a.createReportInProgress=!0;f=n.defer();f={url:b,method:"GET",responseType:"arraybuffer",timeout:f.promise,cancel:f,isReportRequest:!0};$("#creationReportModal").modal();d(f).then(function(b){if(0!=a.createReportInProgress){a.createReportInProgress=!1;$("#creationReportModal").modal("hide");var c=b.headers()["content-disposition"],c=c.substr(c.indexOf("=")+2,c.length-c.indexOf("=")-3);b=new Blob([b.data],{type:b.headers()["content-type"]});-1<
b.type.indexOf("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")?c+=".xlsx":-1<b.type.indexOf("application/zip")?c+=".zip":-1<b.type.indexOf("application/pdf")?c+=".pdf":-1<b.type.indexOf("text/html")&&(c+=".html");saveAs(b,c);a.ctrlSettings.openModes.create.isContext=!1}},c)["catch"](c)};a.previewReport=function(b,c,d){a.selectedReport(b,c);c.checkFlag?(b="../api/reportService"+b.suffix+"/"+c.id,h.checkUndefinedNull(d)||1!=d?b+="/preview":b+="/contextPreview/"+k.getCurrentObject().id,
d=window.open("","_blank"),d.document.write(a.ctrlSettings.htmlLoading),d.document.location.assign(b)):(a.showMessageForUserModalExFlag=!0,a.messageForUser=c.messageForUser,$("#messageForUserModal").modal())};a.createReportWithParams=function(b,e,f,g,k){e=angular.copy(e);f=f.map(function(a){return a.id});angular.isArray(a.currentParamSpecialList)&&a.currentParamSpecialList.forEach(function(b){b.startDateValue=null==b.startDateValueFormatted?null:b.startDateValueFormatted.getTime();b.endDateValue=
null==b.endDateValueFormatted?null:b.endDateValueFormatted.getTime();var c=(new Date(moment(b.oneDateValueFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD"))).getTime();b.oneDateValue=isNaN(c)?null:c-t});e.paramSpecialList=a.currentParamSpecialList;null==a.currentSign||"undefined"==typeof a.currentSign?(k=h.strDateToUTC(a.psStartDateFormatted,a.ctrlSettings.dateFormat),e.paramsetStartDate=null!=k?new Date(k):null,k=h.strDateToUTC(a.psEndDateFormatted,a.ctrlSettings.dateFormat),e.paramsetEndDate=
null!=k?new Date(k):null):(e.paramsetStartDate=null,e.paramsetEndDate=null);g?(e.outputFileType="HTML",e.outputFileZipped=!1):e.outputFileZipped||e.outputFileType.toLowerCase();var r="../api/reportService"+b.suffix+"/"+e.id+"/download";b=!1;if(h.checkUndefinedNull(f)||0==f.length)b=!0;a.createReportWithParamsInProgress=!0;k=n.defer();b={url:r,method:"PUT",params:{contObjectIds:f,clearContObjectIds:b},data:e,responseType:"arraybuffer",timeout:k.promise,cancel:k,isReportRequest:!0};$("#creationReportModal").modal();
d(b).then(function(b){if(0!=a.createReportWithParamsInProgress){a.createReportWithParamsInProgress=!1;$("#creationReportModal").modal("hide");var c=b.headers()["content-disposition"],c=c.substr(c.indexOf("=")+2,c.length-c.indexOf("=")-3);b=new Blob([b.data],{type:b.headers()["content-type"]});g?(c=window.URL.createObjectURL(b),window.open(c,"PreviewWin")):(-1<b.type.indexOf("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet")?c+=".xlsx":-1<b.type.indexOf("application/zip")?c+=".zip":
-1<b.type.indexOf("application/pdf")?c+=".pdf":-1<b.type.indexOf("text/html")&&(c+=".html"),saveAs(b,c));a.ctrlSettings.openModes.create.isContext=!1}},function(b){if(0!=a.createReportWithParamsInProgress)if(a.createReportWithParamsInProgress=!1,a.ctrlSettings.openModes.create.isContext=!1,g){var d=window.open(r,"PreviewWin");h.checkUndefinedNull(d)||d.document.write(b.status+", "+b.statusText);alert("\u041f\u0440\u0438 \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u0438 \u0441\u0442\u0440\u0430\u043d\u0438\u0446\u044b \u0434\u043b\u044f \u043f\u0440\u0435\u0434\u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u043e\u0442\u0447\u0435\u0442\u0430 \u043f\u0440\u043e\u0438\u0437\u043e\u0448\u043b\u0430 \u043e\u0448\u0438\u0431\u043a\u0430. \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b.");
h.checkUndefinedNull(d)||d.close();console.log(b)}else c(b)})["catch"](c)};a.setActiveTab=function(a){var b;b=document.getElementById("rep_a_teplo_sys");b.classList.remove("active");b=document.getElementById("rep_a_electro_sys");b.classList.remove("active");b=document.getElementById("rep_a_gas_sys");b.classList.remove("active");b=document.getElementById(a);b.classList.add("active")};a.setCurrentServiceType(a.contServiceTypes[0]);a.data={};m.loadReportsContextLaunch().then(function(b){b=angular.copy(b.data);
b.forEach(function(b){a.reportObjects.some(function(a){if(a.reportType===b.reportTemplate.reportTypeKeyname)return b.reportType=angular.copy(a),!0})});b.length>a.ctrlSettings.reportCountList?(a.data.reportEntities=angular.copy(a.categories),a.data.reportEntities.forEach(function(a){a.reports=[]}),b.forEach(function(b){var c;for(c=0;c<a.data.reportEntities.length;c+=1)if(0==b.reportType.reportCategory.localeCompare(a.data.reportEntities[c].name)){a.data.reportEntities[c].reports.push(b);break}})):
a.data.reportEntities=b;b.forEach(function(b){var c=b.reportPeriod.sign;if(null==c||"undefined"==typeof c)c=new Date(b.paramsetStartDate),b.psStartDateFormatted=null!=b.paramsetStartDate?moment([c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()]).format(a.ctrlSettings.dateFormat):"",c=new Date(b.paramsetEndDate),b.psEndDateFormatted=null!=b.paramsetEndDate?moment([c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()]).format(a.ctrlSettings.dateFormat):"";a.set_of_objects_flag=!1;a.showAvailableObjects_flag=
!1;a.getSelectedObjectsByParamset(b.reportType,b,!0)})},w);a.createContextReport=function(b){if(!h.checkUndefinedNull(b.reports))return"Entity is category";if(h.checkUndefinedNull(b.reportType))return l.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!","\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u0438\u043f \u043e\u0442\u0447\u0435\u0442\u0430. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043e\u0442\u0447\u0435\u0442\u0430."),
"Report type is not available.";a.ctrlSettings.openModes.create.isContext=!0;b.reportType.reportMetaParamSpecialList_flag=0<b.reportType.reportMetaParamSpecialList.length?!0:!1;a.editParamSet(b.reportType,b,a.ctrlSettings.openModes.create,!0)};a.previewContextReport=function(b){if(!h.checkUndefinedNull(b.reports))return"Entity is category";if(h.checkUndefinedNull(b.reportType))return l.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!","\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u0438\u0442\u044c \u0442\u0438\u043f \u043e\u0442\u0447\u0435\u0442\u0430. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0438 \u043e\u0442\u0447\u0435\u0442\u0430."),
"Report type is not available.";if("COMMERCE_REPORT"==b.reportType.keyname||"COMMERCE_REPORT_M_V"==b.reportType.keyname)return l.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!","\u041f\u0440\u0435\u0434\u0432\u0430\u0440\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0439 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440 \u0434\u043b\u044f \u043a\u043e\u043c\u043c\u0435\u0440\u0447\u0435\u0441\u043a\u0438\u0445 \u043e\u0442\u0447\u0435\u0442\u043e\u0432 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u0435\u043d."),
"Preview for the commercial reports is not available.";b.reportType.reportMetaParamSpecialList_flag=0<b.reportType.reportMetaParamSpecialList.length?!0:!1;a.selectedObjects=[k.getCurrentObject()];a.previewReport(b.reportType,b,!0)};a.createReportWithParamsRequestCancel=function(){d.pendingRequests.forEach(function(a){a.cancel&&1==a.isReportRequest&&(a.cancel.resolve(),console.log("Cancelling Request "+a.method+" on URL:"+a.url))})};a.isSpecialParamDisabled=function(b,c){var d=!1;c.some(function(a){if(b.reportMetaParamCategory.keyname===
a.reportMetaParamCategory.keyname&&"SPECIAL_CATEGORY_SWITCH"===a.paramSpecialTypeKeyname&&!0!==a.boolValue)return d=!0});return a.isDisabled()||d}}]);app=angular.module("portalNMC");
app.controller("ReportSettingsCtrl",["$scope","$rootScope","$resource","crudGridDataFactory","notificationFactory","mainSvc","reportSvc",function(a,b,d,g,l,k,h){b.ctxId="report_settings_page";a.ctrlSettings={};a.ctrlSettings.dateFormat="DD.MM.YYYY";a.ctrlSettings.ctxId="report_template";a.isPositionSystemChanged=!1;a.active_tab_active_templates=!0;a.currentObject={};a.createByTemplate_flag=!1;a.archiveTemplate={};a.activeStartDateFormat=new Date;a.activeStartDateFormatted=moment().format(a.ctrlSettings.dateFormat);
a.currentReportType={};a.objects=[];a.columns=[{name:"reportTypeName",header:"\u0422\u0438\u043f \u043e\u0442\u0447\u0435\u0442\u0430","class":"col-md-11"}];a.crudTableName="../api/reportTemplate";a.extraProps={idColumnName:"id",defaultOrderBy:"name",deleteConfirmationProp:"name"};a.categories=h.getReportCategories();a.isSystemuser=function(){a.userInfo=b.userInfo;return a.userInfo._system};a.reportTypes=[];a.$on("reportSvc:reportTypesIsLoaded",function(){a.reportTypes=h.getReportTypes();a.objects=
a.reportTypes;a.getActive()});a.getReportTypes=function(){g("../api/reportSettings/reportType").query(function(b){a.reportTypes=b;var c=[],d,e;for(e=0;e<b.length;e+=1)!b[e]._enabled||!a.isSystemuser()&&b[e].isDevMode||(d={},d.reportType=b[e].keyname,d.reportTypeName=b[e].caption,d.reportCategory=b[e].reportCategory,d.suffix=b[e].suffix,c.push(d));a.objects=c;a.getActive()})};a.oldColumns=[{name:"name",header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u0448\u0430\u0431\u043b\u043e\u043d\u0430",
"class":"col-md-5"},{name:"activeStartDate",header:"\u0414\u0435\u0439\u0441\u0442\u0432\u0443\u0435\u0442 \u0441","class":"col-md-2"}];var p=function(b){l.success();$("#editTemplateModal").modal("hide");$("#moveToArchiveModal").modal("hide");$("#createTemplateModal").modal("hide");a.createByTemplate_flag||a.getActive();a.setDefault()},m=function(b){l.success();$("#deleteObjectModal").modal("hide");a.getArchive();a.setDefault()},n=function(a){a=k.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)};
a.selectToDelete=function(b,d){a.setCurrentReportType(b);a.selectedItem(d)};a.deleteObject=function(b){g(a.crudTableName+"/archive"+a.currentReportType.suffix)["delete"]({id:b[a.extraProps.idColumnName]},m,n)};a.getTemplates=function(a,b){g(a).query(function(a){b.templates=a;b.templatesCount=a.length})};a.getActive=function(){if(0!==a.objects.length&&"undefined"!=typeof a.objects[0].suffix){var b;for(b=0;b<a.objects.length;b+=1)a.getTemplates(a.crudTableName+a.objects[b].suffix,a.objects[b])}};a.getArchive=
function(){if(0!==a.objects.length&&"undefined"!=typeof a.objects[0].suffix){var b;for(b=0;b<a.objects.length;b+=1)a.getTemplates(a.crudTableName+"/archive"+a.objects[b].suffix,a.objects[b])}};a.toogleShowGroupDetails=function(a){a.showGroupDetails=!a.showGroupDetails};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b};a.updateTemplate=function(b){var c;a.createByTemplate_flag?(b.activeStartDate=null==a.activeStartDateFormat?null:a.activeStartDateFormat.getTime(),c=new Date(b.activeStartDate),
a.activeStartDateFormatted=null==b.activeStartDate?"":moment([c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate()]).format(a.ctrlSettings.dateFormat),c=a.crudTableName+"/createByTemplate/"+a.archiveTemplate.id,g(c).save({},b,p,n)):(c=a.crudTableName+a.currentReportType.suffix,g(c).update({reportTemplateId:b.id},b,p,n))};a.saveTemplate=function(){var b={};b.reportTemplate=a.currentObject;var d=new Date(a.activeStartDateFormatted),d=Date.UTC(d.getFullYear(),d.getMonth(),d.getDate());b.reportTemplate.activeStartDate=
k.checkStrForDate(a.activeStartDateFormatted)?d:null;b.reportTemplate._active=!0;b.reportColumnSettings={};b.reportColumnSettings.allTsList=a.systems;a.isPositionSystemChanged?(b.reportColumnSettings.ts1List=a.system2.defineColumns,b.reportColumnSettings.ts2List=a.system1.defineColumns):(b.reportColumnSettings.ts1List=a.system1.defineColumns,b.reportColumnSettings.ts2List=a.system2.defineColumns);g("../api/reportWizard"+a.currentReportType.suffix).save(b,p,n)};a.toArchive=function(a,b){return d(a,
{},{update:{method:"PUT",params:{reportTemplateId:b}}})};a.moveToArchive=function(b){a.toArchive(a.crudTableName+"/archive/move",b.id).update({},b,p,n)};a.createByTemplate=function(b,d){a.setCurrentReportType(b);a.createByTemplate_flag=!0;a.archiveTemplate={};a.archiveTemplate.id=d.id;a.archiveTemplate.name=d.name;a.currentObject={};a.currentObject.name=angular.copy(d.name);a.currentObject.description=angular.copy(d.description)};a.systems=[];a.system1={};a.system2={};a.systems=[a.system1,a.system2];
a.getWizard=function(){g("../api/reportWizard/columnSettings"+a.currentReportType.suffix).get(function(b){a.obtainedSystems=b;a.systems=b.allTsList;a.system1=b.allTsList[0];a.system2=b.allTsList[1];a.system1.defaultColumns=b.ts1List;a.system2.defaultColumns=b.ts2List;a.system1.defineColumns=[];a.system2.defineColumns=[]})};a.addColumns=function(a,b){var c,d;for(c=0;c<a.length;c+=1)if(a[c].selected){a[c]["class"]="";a[c].selected=!1;if("undefined"!=typeof b){var e=!1;for(d=0;d<=b.length;d+=1)"undefined"!=
typeof b[d]&&b[d].columnNumber==a[c].columnNumber&&(e=!0);if(e)continue}d=angular.copy(a[c]);d.selected=!1;d["class"]="";b.push(d)}return b};a.removeColumns=function(a){var b=[],c;for(c=0;c<a.length;c+=1)a[c].selected||(a[c].selected=!1,b.push(a[c]));return b};a.moveColumnsUp=function(a){var b,c;for(c=1;c<a.length;c+=1)a[c].selected&&(b=a[c-1],a[c-1]=a[c],a[c]=b);return a};a.moveColumnsDown=function(a){var b,c;for(c=a.length-2;0<=c;--c)a[c].selected&&(b=a[c+1],a[c+1]=a[c],a[c]=b);return a};a.changeSystemPosition=
function(){a.isPositionSystemChanged=!a.isPositionSystemChanged;var b=a.systems[0];a.systems[0]=a.systems[1];a.systems[1]=b};a.selectColumn=function(a){a.selected=!a.selected;a["class"]=a.selected?"active":""};a.toggleEditColumnName=function(a){a.edit=!a.edit};a.cancelEditColumnName=function(b){b.columnHeader=b.oldColumnName;a.toggleEditColumnName(b)};a.editColumnName=function(b){b.oldColumnName=b.columnHeader;a.toggleEditColumnName(b)};a.setDefault=function(){a.currentObject={};a.createByTemplate_flag=
!1;a.archiveTemplate={};a.activeStartDateFormat=new Date;a.system1.defineColumns=[];a.system2.defineColumns=[]};a.setCurrentReportType=function(b){a.currentReportType.reportType=b.reportType;a.currentReportType.reportTypeName=b.reportTypeName;a.currentReportType.suffix=b.suffix};a.editTemplate=function(b,d){a.selectedItem(d);a.setCurrentReportType(b)};a.addTemplate=function(b){a.setCurrentReportType(b);a.getWizard();a.setDefault();$("#createTemplateModal").modal()};a.preview=function(a){window.open(a.reportType.previewUrl)};
a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:a.ctrlSettings.dateFormat};$(document).ready(function(){$("#inputStartDate").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});var e=
function(a){k.getContextIds().forEach(function(b){b.permissionTagId.localeCompare(a);var c=document.getElementById(b.permissionTagId);angular.isUndefined(c)||null==c||$("#"+b.permissionTagId).removeClass("nmc-hide")})};e(a.ctrlSettings.ctxId);b.$on("servicePermissions:loaded",function(){e(a.ctrlSettings.ctxId)});a.isDisabled=function(){return a.isROfield()||a.currentObject.common};a.isAdmin=function(){return k.isAdmin()};a.isReadonly=function(){return k.isReadonly()};a.isROfield=function(){return a.isReadonly()};
h.getReportTypesIsLoaded()&&(a.reportTypes=h.getReportTypes(),a.objects=a.reportTypes,a.getActive())}]);angular.module("portalNMC").controller("SettingsMeterPeriodSettingCtrl",["$scope","$rootScope","$routeParams","$resource","$cookies","$compile","$parse","crudGridDataFactory","notificationFactory","$http","objectSvc","mainSvc","$timeout","$window","meterPeriodsSvc",function(a,b,d,g,l,k,h,p,m,n,e,c,f,r,q){function v(a){var b=c.errorCallbackHandler(a);m.errorInfo(b.caption,b.description);console.log(a)}function t(b){console.log(b);b=angular.copy(b.data);c.sortItemsBy(b,a.extraProps.defaultOrderBy);
a.data.meterPeriodSettings=b}function u(b){console.log(b);var d=angular.copy(a.data.meterPeriodSettings);201===b.status&&(d.push(angular.copy(b.data)),c.sortItemsBy(d,a.extraProps.defaultOrderBy),a.data.meterPeriodSettings=d);if(200===b.status){var e=c.findItemBy(d,a.extraProps.idColumnName,b.data.id),e=d.indexOf(e);-1!==e&&(d[e]=angular.copy(b.data));c.sortItemsBy(d,a.extraProps.defaultOrderBy);a.data.meterPeriodSettings=d}$("#showMeterPeriodSettingModal").modal("hide")}function w(a){console.log(a);
q.loadMeterPeriods().then(t,v);$("#deleteWindowModal").modal("hide")}b.ctxId="management_rma_meter_period_setting_page";a.extraProps={idColumnName:"id",defaultOrderBy:"name",nameColumnName:"name"};a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.ctrlSettings={};a.ctrlSettings.periodColumns=[{name:"name",caption:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","class":"col-xs-3",type:"name"},{name:"description",caption:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","class":"col-xs-3"},
{name:"fromDay",caption:"\u041d\u0430\u0447\u0430\u043b\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430","class":"col-xs-1"},{name:"toDay",caption:"\u041a\u043e\u043d\u0435\u0446 \u043f\u0435\u0440\u0438\u043e\u0434\u0430","class":"col-xs-1"},{name:"valueCount",caption:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u0439","class":"col-xs-1"}];a.data={};a.data.meterPeriodSettings=[];a.data.currentMeterPeriodSetting={};a.checkPeriod=function(a){return Number(a.fromDay)>
Number(a.toDay)};a.saveMeterPeriodSetting=function(){var b;b=a.data.currentMeterPeriodSetting;if(angular.isUndefined(b)||null===b)m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041f\u0435\u0440\u0438\u043e\u0434 \u043d\u0435 \u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0432\u0432\u0435\u0434\u0435\u043d\u043d\u044b\u0435 \u0434\u0430\u043d\u043d\u044b\u0435!"),b=!1;else{var c=!0,d=!0,e=!0;if(angular.isUndefined(b.name)||null===b.name||
""===b.name)m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0437\u0432\u0430\u043d\u0438\u0435 \u043f\u0435\u0440\u0438\u043e\u0434\u0430!"),c=!1;if(angular.isUndefined(b.fromDay)||null===b.fromDay||""===b.fromDay)m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0447\u0430\u043b\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430!"),c=d=!1;if(angular.isUndefined(b.toDay)||
null===b.toDay||""===b.toDay)m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043a\u043e\u043d\u0435\u0446 \u043f\u0435\u0440\u0438\u043e\u0434\u0430!"),c=e=!1;d&&e&&a.checkPeriod(b)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043f\u0435\u0440\u0438\u043e\u0434!"),c=!1);b=c}if(!1===b)return!1;b="PUT";if(angular.isUndefined(a.data.currentMeterPeriodSetting.id)||
null===a.data.currentMeterPeriodSetting.id)b="POST";q.saveMeterPeriod(b,a.data.currentMeterPeriodSetting).then(u,v)};a.addMeterPeriod=function(){a.data.currentMeterPeriodSetting={};$("#showMeterPeriodSettingModal").modal()};a.selectedItem=function(b){a.confirmCode=null;var d=c.getConfirmCode();a.confirmLabel=d.label;a.sumNums=d.result;a.data.currentMeterPeriodSetting=angular.copy(b)};a.deleteMeterPeriodSetting=function(a){q.deleteMeterPeriod(a.id).then(w,v)};a.isSystemuser=function(){return c.isSystemuser()};
a.isTestMode=function(){return c.isTestMode()};a.isSystemViewInfo=function(){return c.getViewSystemInfo()};q.loadMeterPeriods().then(t,v);$("#showMeterPeriodSettingModal").on("shown.bs.modal",function(){$("#inputMeterPeriodName").focus();$("#inputMeterPeriodFromDay").inputmask("integer",{mask:"9[9]",min:1,max:31});$("#inputMeterPeriodToDay").inputmask("integer",{mask:"9[9]",min:1,max:31});$("#inputMeterPeriodValueCount").inputmask("integer",{max:5})})}]);app=angular.module("portalNMC");
app.controller("SettingsNoticesCtrl",["$rootScope","$scope","$http","notificationFactory","mainSvc",function(a,b,d,g,l){a.ctxId="settings_notices_page";b.ctrlSettings={};b.ctrlSettings.ctxId="settings_notices";b.ctrlSettings.apiUrl="../api/subscr/contEventType";b.ctrlSettings.noticeTypesUrl=b.ctrlSettings.apiUrl+"/actions/available";b.ctrlSettings.contactsUrl="../api/subscr/subscrAction/users";b.ctrlSettings.imgPathTmpl="images/notice-state-";b.ctrlSettings.orderBy={field:"name",asc:!0};b.ctrlSettings.colorLevel=
{green:{name:"green",min:7E4,max:79999,title:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435"},yellow:{name:"yellow",min:3E4,max:59999,title:"\u0423\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0435"},orange:{name:"orange",min:2E4,max:29999,title:"\u041d\u0435\u043a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f"},red:{name:"red",min:1E4,max:19999,title:"\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f"}};
b.currentNotice={};b.columns=[{name:"name",header:"\u0422\u0438\u043f",headerClass:"col-xs-5 col-md-5 nmc-button-sort ",dataClass:"col-xs-5 col-md-5"},{name:"comment",header:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",headerClass:"col-xs-5 col-md-5",dataClass:"col-xs-5 col-md-5"}];b.contactColumns=[{name:"userName",header:"\u0422\u0438\u043f","class":"col-xs-5 col-md-5 nmc-button-sort "},{name:"comment",header:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439",
"class":"col-xs-5 col-md-5"}];b.noticeTypes=[];b.contacts=[];var k=function(a){a=l.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)},h=function(a){var d=angular.copy(b.contacts);d.forEach(function(b){var c=a.length,d;for(d=0;d<c;d+=1)b.id==a[d].subscrActionUserId&&(b.isSms=a[d].isSms,b.isEmail=a[d].isEmail)});b.currentNotice.contacts=d;$("#editNoticeModal").modal()},p=function(a){$("#editNoticeModal").modal("hide");b.currentNotice={}};b.getContacts=function(a){d.get(a).success(function(a){b.contacts=
angular.copy(a)}).error(k)};b.getContacts(b.ctrlSettings.contactsUrl);b.getNoticeTypes=function(a){d.get(a).success(function(a){a=angular.copy(a);a.sort(function(a,b){return a.name>b.name?1:a.name<b.name?-1:0});a.forEach(function(a){for(var c in b.ctrlSettings.colorLevel)if(a.contEventLevel>=b.ctrlSettings.colorLevel[c].min&&a.contEventLevel<=b.ctrlSettings.colorLevel[c].max){a.color=b.ctrlSettings.colorLevel[c].name;a.imgpath=b.ctrlSettings.imgPathTmpl+a.color.toLowerCase()+".png";a.title=b.ctrlSettings.colorLevel[c].title;
break}});b.noticeTypes=a}).error(k)};b.getNoticeTypes(b.ctrlSettings.noticeTypesUrl);b.getNoticeTypeSettings=function(a){b.selectItem(a);d.get(b.ctrlSettings.apiUrl+"/"+a.id+"/actions").success(h).error(k)};b.putNoticeTypeSettings=function(a){var g=b.ctrlSettings.apiUrl+"/"+a.id+"/actions",e=[];a.contacts.forEach(function(a){l.checkUndefinedNull(a.isSms)&&l.checkUndefinedNull(a.isEmail)||e.push({subscrActionUserId:a.id,isSms:a.isSms||!1,isEmail:a.isEmail||!1})});d.put(g,e).success(p).error(k)};b.setOrderBy=
function(a){b.ctrlSettings.orderBy.field=a;b.ctrlSettings.orderBy.asc=!b.ctrlSettings.orderBy.asc};b.selectItem=function(a){b.currentNotice=angular.copy(a)};b.isSystemViewInfo=function(){return l.getViewSystemInfo()}}]);app=angular.module("portalNMC");
app.controller("SettingsObjectTreesCtrl",["$scope","$rootScope","$routeParams","$resource","$cookies","$compile","$parse","crudGridDataFactory","notificationFactory","$http","objectSvc","mainSvc","$timeout","$window",function(a,b,d,g,l,k,h,p,m,n,e,c,f,r){b.ctxId="management_rma_objects_page";a.messages={};a.messages.markAllOn="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435";a.messages.markAllOff="\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435";a.messages.moveToNode=
"\u041f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c \u043a \u0443\u0437\u043b\u0443";a.messages.releaseFromNode="\u041e\u0442\u0432\u044f\u0437\u0430\u0442\u044c \u043e\u0442 \u0443\u0437\u043b\u0430";a.crudTableName=e.getObjectsUrl();a.objectCtrlSettings={};a.objectCtrlSettings.isCtrlEnd=!1;a.objectCtrlSettings.allSelected=!1;a.objectCtrlSettings.anySelected=!1;a.objectCtrlSettings.anyClientSelected=!1;a.objectCtrlSettings.objectsPerScroll=34;a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;
a.objectCtrlSettings.vzletSystemList=[];a.objectCtrlSettings.extendedInterfaceFlag=!0;a.objectCtrlSettings.serverTimeZone=3;a.objectCtrlSettings.dateFormat="DD.MM.YYYY";a.objectCtrlSettings.ctxId="management_objects_2nd_menu_item";a.objectCtrlSettings.rmaUrl="../api/rma";a.objectCtrlSettings.clientsUrl="../api/rma/subscribers";a.objectCtrlSettings.subscrObjectsSuffix="/subscrContObjects";a.objectCtrlSettings.tempSchBaseUrl="../api/rma/temperatureCharts/byContObject";var q=function(){c.getContextIds().forEach(function(a){var b=
document.getElementById(a.permissionTagId);angular.isUndefined(b)||null==b||$("#"+a.permissionTagId).removeClass("nmc-hide")})};q();b.$on("servicePermissions:loaded",function(){q()});a.data={};a.object={};a.objects=[];a.objectsOnPage=[];a.currentSug=null;var v=function(c){a.objects=c.data;e.sortObjectsByFullName(a.objects);angular.isUndefined(a.filter)||""===a.filter?(a.objectsWithoutFilter=a.objects,a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,c=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll),
a.objectsOnPage=c,b.$broadcast("objectSvc:loaded")):a.searchObjects(a.filter);a.loading=!1},t=function(c){b.$broadcast("objectSvc:requestReloadData");a.loading=!0;e.getRmaPromise().then(v)};a.loading=e.getLoadingStatus();a.columns=[{name:"fullName",header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","class":"col-md-5"},{name:"fullAddress",header:"\u0410\u0434\u0440\u0435\u0441","class":"col-md-5"}];a.captions={loading:"loading",totalElements:"totalElements"};a.filter="";a.filterType="";a.bGroupByObject=
!1;a.bObject=!1;a.bList=!0;var u=function(a){a=c.errorCallbackHandler(a);m.errorInfo(a.caption,a.description)},w=function(b){u(b);a.zpointSettings.isSaving=!1;a.currentObject.isSaving=!1};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b};a.selectedObject=function(b,c){e.getObject(b).then(function(b){a.currentObject=b.data},function(a){console.log(a)})};a.dateFormat=function(b){b=new Date(b+Math.round(36E5*
a.objectCtrlSettings.serverTimeZone));return null==b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]).format(a.objectCtrlSettings.dateFormat)};a.emptyString=function(a){return c.checkUndefinedEmptyNullValue(a)};a.checkUndefinedNull=function(a){return c.checkUndefinedNull(a)};a.searchObjects=function(b){if(!(0>=a.objects.length)){a.objectsOnPage.forEach(function(a){if(1==a.showGroupDetailsFlag){var b=document.getElementById("obj"+a.id);c.checkUndefinedNull(b)||(b.getElementsByClassName("nmc-tr-zpoint")[0].innerHTML=
"",b=document.getElementById("btnDetail"+a.id),b.classList.remove("glyphicon-chevron-down"),b.classList.add("glyphicon-chevron-right"))}a.showGroupDetailsFlag=!1});var d=[];angular.isUndefined(b)||""===b?(d=[],a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,d=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll)):(d=[],a.objects.forEach(function(a){angular.isDefined(a.fullName)&&-1!=a.fullName.toUpperCase().indexOf(b.toUpperCase())&&d.push(a)}));a.objectsOnPage=d}};a.$on("$destroy",
function(){window.onkeydown=void 0});window.onkeydown=function(b){var c=null;38==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop-=20):40==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop+=20):34==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop+=10*a.objectCtrlSettings.objectsPerScroll):33==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop-=10*a.objectCtrlSettings.objectsPerScroll):b.ctrlKey&&36==b.keyCode?(c=
document.getElementById("divWithObjectTable"),c.scrollTop=0):b.ctrlKey&&35==b.keyCode&&(a.objectCtrlSettings.objectsOnPage<a.objects.length&&(a.loading=!0,f(function(){a.loading=!1},a.objects.length)),b=a.objects.slice(a.objectCtrlSettings.objectsOnPage,a.objects.length),Array.prototype.push.apply(a.objectsOnPage,b),a.objectCtrlSettings.objectsOnPage+=a.objects.length,a.$apply(),c=document.getElementById("divWithObjectTable"),c.scrollTop=c.scrollHeight)};a.addMoreObjects=function(){if(!(0>=a.objects.length)){var b=
a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll;b>=a.objects.length&&(b=a.objects.length);var c=a.objects.slice(a.objectCtrlSettings.objectsOnPage,b);Array.prototype.push.apply(a.objectsOnPage,c);a.objectCtrlSettings.objectsOnPage=b>=a.objects.length?a.objects.length:a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll}};$("#divWithObjectTable").scroll(function(){if(angular.isUndefined(a.filter)||""==a.filter)a.addMoreObjects(),a.$apply()});a.isSystemuser=
function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};a.isSystemViewInfo=function(){return c.getViewSystemInfo()};a.toggleObjects=function(b){a.objectCtrlSettings.anySelected=b;a.objects.forEach(function(a){a.selected=b});a.objectsOnPage.forEach(function(a){a.selected=b})};a.toggleObject=function(b){var c=a.objectCtrlSettings.allSelected=!1;a.objectsOnPage.some(function(a){if(1==a.selected)return c=!0});a.objectCtrlSettings.anySelected=c};a.invokeHelp=
function(){alert("This is SPRAVKA!!!111")};var x=function(b){a.confirmCode=null;b=c.getConfirmCode(b);a.confirmLabel=b.label;a.sumNums=b.result},E=function(){var b=[];1==a.objectCtrlSettings.allSelected?a.objects.forEach(function(a){1==a.selected&&(b.push(a.id),a.selected=!1)}):a.objectsOnPage.forEach(function(a){1==a.selected&&(b.push(a.id),a.selected=!1)});return b};a.checkEmptyNullValue=function(a){return""===a||null==a?!0:!1};a.checkNumericValue=function(b){return a.checkEmptyNullValue(b)?!0:
isNaN(parseFloat(b))||!isFinite(b)?!1:!0};a.checkPositiveNumberValue=function(b){var c;c=a.checkNumericValue(b);return c?c=0<=parseInt(b,10)?!0:!1:c};a.checkNumericInterval=function(b,c){return a.checkEmptyNullValue(b)||a.checkEmptyNullValue(c)||!a.checkNumericValue(b)||!a.checkNumericValue(c)?!1:parseInt(c,10)>=parseInt(b,10)?!0:!1};a.checkHHmm=function(a){return/(0[0-9]|1[0-9]|2[0-3]){1,2}:([0-5][0-9]){1}/.test(a)?!0:!1};$("#showZpointOptionModal").on("hidden.bs.modal",function(){a.zpointSettings=
{}});$("#showZpointExplParameters").on("hidden.bs.modal",function(){a.zpointSettings={}});$("#showObjOptionModal").on("hidden.bs.modal",function(){a.currentObject.isSaving=!1;a.currentSug=null});a.data.treeTemplates=e.getRmaTreeTemplates();a.objectCtrlSettings.treeSettings={};a.objectCtrlSettings.treeSettings.nodesPropName="childObjectList";a.data.currentDeleteMessage="";var G={objectName:"",type:"root",childObjectList:[]};a.objectCtrlSettings.isTreeView=!0;a.data.currentTree={};a.data.newTree={};
a.findNodeInTree=function(a,b){return c.findNodeInTree(a,b)};a.selectNode=function(b){a.objectCtrlSettings.allSelected=!1;var d=a.data.currentTree,f=a.data.selectedNode;if(1==a.objectCtrlSettings.isObjectMoving){d=a.data.treeForMove;if(c.checkUndefinedNull(a.data.selectedNodeForMove)){b.isSelected=!0;a.data.selectedNodeForMove=angular.copy(b);return}f=a.data.selectedNodeForMove}f.id!=b.id&&f.type==b.type!="root"&&(c.checkUndefinedNull(f)||(d=c.findNodeInTree(f,d),c.checkUndefinedNull(d)||(d.isSelected=
!1)),b.isSelected=!0,1==a.objectCtrlSettings.isObjectMoving?a.data.selectedNodeForMove=angular.copy(b):(a.data.selectedNode=angular.copy(b),a.loading=!0,"root"==b.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(v):e.loadObjectsByTreeNode(a.data.currentTree.id,b.id).then(v)))};a.data.trees=[];a.loadTree=function(b,d){a.loading=!0;a.objectCtrlSettings.allSelected=!1;e.loadTree(b.id).then(function(d){a.messages.treeMenuHeader=b.objectName||b.id;var f=angular.copy(d.data);c.sortTreeNodesBy(f,
"objectName");f.childObjectList.unshift(angular.copy(G));a.data.currentTree=f;f.childObjectList[0].isSelected=!0;a.data.selectedNode=angular.copy(f.childObjectList[0]);e.loadFreeObjectsByTree(b.id).then(v);if(c.checkUndefinedNull(a.data.currentTree.templateId))return"Tree is free";e.loadTreeTemplateItems(a.data.currentTree.templateId).then(function(b){a.data.currentTreeTemplateItems=angular.copy(b.data);f.childObjectList[0].templateId=a.data.currentTree.templateId;f.childObjectList[0].templateItemId=
a.data.currentTree.templateItemId},u)},u)};var C=function(){a.data.currentTree={};e.loadTrees().then(function(b){c.sortItemsBy(b.data,"objectName");a.data.trees=angular.copy(b.data);if(!angular.isArray(a.data.trees)||0>=a.data.trees.length)return a.messages.treeMenuHeader="\u0412\u044b\u0431\u0435\u0440\u0435\u0442\u0435 \u0438\u0435\u0440\u0430\u0440\u0445\u0438\u044e",t(),"Object tree array is empty.";a.loadTree(a.data.trees[0])},u)},A=function(b,d){var e;e="root"==d.type?a.data.currentTree:d;if(c.checkUndefinedNull(e)||
!angular.isArray(e.childObjectList))return"Parent is incorrect node!";e.childObjectList.push(b)},z=function(b){var c=!0;a.emptyString(b.objectName)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435!"),c=!1);return c},H=function(b){var c=null;a.data.currentTreeTemplateItems.some(function(a){if(b==a.id)return c=a,!0});return c},D=function(b){var c=null;a.data.currentTreeTemplateItems.some(function(a){if(b==
a.itemLevel)return c=a,!0});return c};a.saveNode=function(b,d,f){if(0==z(b))return"Node is no correct!";A(b,d);angular.isArray(a.data.currentTree.childObjectList)&&0<a.data.currentTree.childObjectList.length&&"root"==a.data.currentTree.childObjectList[0].type&&a.data.currentTree.childObjectList.shift();e.updateTree(a.data.currentTree).then(function(b){var e=b.data;c.sortTreeNodesBy(e,"objectName");e.childObjectList.unshift(angular.copy(G));c.checkUndefinedNull(e.templateId)||(e.childObjectList[0].templateId=
e.templateId);c.checkUndefinedNull(e.templateItemId)||(e.childObjectList[0].templateItemId=e.templateItemId);var g=-1;a.data.trees.some(function(a,b){if(a.id==e.id)return g=b,!0});-1!=g&&(a.data.trees[g]=e,a.data.currentTree=e);if(c.checkUndefinedNull(f)||1!=f)$("#treeLevelModal").modal("hide");else{a.data.parentLevel=c.findNodeInTree(d,a.data.currentTree);a.data.currentLevel={childObjectList:[]};if(!c.checkUndefinedNull(a.data.parentLevel.templateItemId)){b=H(a.data.parentLevel.templateItemId);b=
D(b.itemLevel+1);if(null==b)return"Template item is no find.";a.data.currentLevel.levelType=b.itemName;a.data.currentLevel.objectName=b.itemNameTemplate;a.data.currentLevel.templateId=b.templateId;a.data.currentLevel.templateItemId=b.id}$("#inputLevelName").focus()}},u)};a.saveTree=function(b){if(0==z(b))return"Tree is no correct!";angular.isArray(b.childObjectList)&&0<b.childObjectList.length&&"root"==b.childObjectList[0].type&&b.childObjectList.shift();e.createTree(b).then(function(b){b=angular.copy(b.data);
b.childObjectList.unshift(angular.copy(G));c.checkUndefinedNull(b.templateId)||(b.childObjectList[0].templateId=b.templateId);c.checkUndefinedNull(b.templateItemId)||(b.childObjectList[0].templateItemId=b.templateItemId);a.data.trees.push(b);c.sortItemsBy(a.data.trees,"objectName");a.loadTree(b);$("#showTreeOptionModal").modal("hide")},u)};a.removeNodeInit=function(b){a.data.currentDeleteItem=b;a.data.currentDeleteMessage="root"==b.type?a.data.currentTree.objectName||a.data.currentTree.id:b.objectName||
b.id;x(!0);a.deleteHandler=function(b){if(c.checkUndefinedNull(b))return"Deleting item is undefined or null.";c.checkUndefinedNull(b.type)||"root"!=b.type?e.deleteTreeNode(a.data.currentTree.id,b.id).then(function(b){a.loadTree(a.data.currentTree)},w):e.deleteTree(a.data.currentTree.id).then(function(a){C()},u);$("#deleteWindowModal").modal("hide")};$("#deleteWindowModal").modal()};a.moveToNodeInit=function(b){a.data.selectedNodeForMove=null;var d=[];c.checkUndefinedNull(b)?(d=E(),a.objectCtrlSettings.anySelected=
!1):(a.selectedItem(b),d.push(b.id));a.data.treeForMove=angular.copy(a.data.currentTree);a.data.treeForMove.childObjectList.shift();a.data.treeForMove.movingObjects=d};a.moveToNode=function(){e.putObjectsToTreeNode(a.data.currentTree.id,a.data.selectedNodeForMove.id,a.data.treeForMove.movingObjects).then(function(b){a.loading=!0;"root"==a.data.selectedNode.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(v):e.loadObjectsByTreeNode(a.data.currentTree.id,a.data.selectedNode.id).then(v);$("#viewTreeModal").modal("hide")},
w)};a.releaseFromNode=function(b){var d=[];c.checkUndefinedNull(b)?(d=E(),a.objectCtrlSettings.anySelected=!1):(a.selectedItem(b),d.push(b.id));e.releaseObjectsFromTreeNode(a.data.currentTree.id,a.data.selectedNode.id,d).then(function(b){a.loading=!0;"root"==a.data.selectedNode.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(v):e.loadObjectsByTreeNode(a.data.currentTree.id,a.data.selectedNode.id).then(v)},u)};a.toggleTreeView=function(){a.objectCtrlSettings.isTreeView=!a.objectCtrlSettings.isTreeView;
0==a.objectCtrlSettings.isTreeView?t():C()};a.createTreeByTemplate=function(b){e.loadTreeTemplateItems(b.id).then(function(c){a.data.currentTreeTemplateItems=angular.copy(c.data);var d=null;a.data.currentTreeTemplateItems.some(function(a){if(0==a.itemLevel)return d=a,!0});if(null==d)return"Incorrect template. itemLevel == 0 is absent.";a.data.newTree={};a.data.newTree.templateId=b.id;a.data.newTree.templateItemId=d.id;a.data.newTree.objectName=d.itemName;$("#showTreeOptionModal").modal()},u)};a.addNodeDisabled=
function(b){if(c.checkUndefinedNull(b.templateItemId))return!1;if(!angular.isArray(a.data.currentTreeTemplateItems))return!0;b=H(b.templateItemId);return null==b||b.itemLevel<a.data.currentTreeTemplateItems.length-1?!1:!0};a.createNodeInit=function(b){a.data.parentLevel=b;a.data.currentLevel={childObjectList:[]};if(!c.checkUndefinedNull(b.templateItemId)){b=H(b.templateItemId);b=D(b.itemLevel+1);if(null==b)return"Template item is no find.";a.data.currentLevel.levelType=b.itemName;a.data.currentLevel.objectName=
b.itemNameTemplate;a.data.currentLevel.templateId=b.templateId;a.data.currentLevel.templateItemId=b.id}};$("#viewTreeModal").on("shown.bs.modal",function(){a.objectCtrlSettings.isObjectMoving=!0;a.$apply()});$("#viewTreeModal").on("hidden.bs.modal",function(){a.objectCtrlSettings.isObjectMoving=!1;a.$apply()});$("#showTreeOptionModal").on("shown.bs.modal",function(){$("#inputTreeName").focus()});$("#treeLevelModal").on("shown.bs.modal",function(){$("#inputLevelName").focus()});$("#showObjOptionModal").on("shown.bs.modal",
function(){$("#inputContObjectName").focus()});$("#showZpointOptionModal").on("shown.bs.modal",function(){$("#inputZpointName").focus()});0==a.objectCtrlSettings.isTreeView?t():C()}]);angular.module("portalNMC").controller("SettingsObjectViewCtrl",["$scope","$rootScope","$routeParams","$resource","$cookies","$compile","$parse","$timeout","crudGridDataFactory","notificationFactory","$http","objectSvc","mainSvc","reportSvc","indicatorSvc",function(a,b,d,g,l,k,h,p,m,n,e,c,f,r,q){function v(b){var c=document.getElementById("obj"+b.id);if(!angular.isUndefined(c)&&null!==c){var c=c.getElementsByClassName("nmc-tr-zpoint")[0],d="",d=d+('<td class="nmc-td-for-buttons-in-object-page" ng-hide="!objectCtrlSettings.extendedInterfaceFlag"></td><td></td><td style="padding-top: 2px !important;"><table id="zpointTable'+
b.id+'" class="crud-grid table table-lighter table-bordered table-condensed table-hover nmc-child-object-table">'),d=d+'<thead><tr class="nmc-child-table-header">',d=d+'<th class="nmc-td-for-button"></th>';a.oldColumns.forEach(function(a){d+='<th class="'+a["class"]+'">';d+=a.header||a.name;d+="</th>"});d+="</tr></thead>";b.zpoints.forEach(function(c){d+='<tr id="trZpoint'+c.id+'" ng-dblclick="getIndicators('+b.id+","+c.id+')">';d+='<td class="nmc-td-for-button"><div class="btn-group"><i title="\u0414\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u043d\u0430\u0434 \u0442\u043e\u0447\u043a\u043e\u0439 \u0443\u0447\u0435\u0442\u0430" type="button" class="btn btn-xs glyphicon glyphicon-menu-hamburger nmc-button-in-table dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="font-size: .9em;"></i><ul class="dropdown-menu"><li><a ng-click="getZpointSettings('+
b.id+","+c.id+')"data-target="#showZpointOptionModal"data-toggle="modal"data-placement="bottom"title="\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0451\u0442\u0430">\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430</a></li><li><a ng-click="getZpointSettingsExpl('+b.id+","+c.id+')"data-target="#showZpointExplParameters"data-toggle="modal"data-placement="bottom"title="\u042d\u043a\u0441\u043f\u043b\u0443\u0430\u0442\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0451\u0442\u0430">\u042d\u043a\u0441\u043f\u043b\u0443\u0430\u0442\u0430\u0446\u0438\u043e\u043d\u043d\u044b\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b</a></li><li><a ng-click="openDeviceProperties('+
b.id+","+c.id+')"title="\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0443\u0447\u0435\u0442\u0430">\u0421\u0432\u043e\u0439\u0441\u0442\u0432\u0430 \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0443\u0447\u0435\u0442\u0430</a></li><li><a ng-click="openZpointMetadata('+b.id+","+c.id+')"title="\u041c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430">\u041c\u0435\u0442\u0430\u0434\u0430\u043d\u043d\u044b\u0435 \u043f\u0440\u0438\u0431\u043e\u0440\u0430</a></li><li ng-if=\'isDirectDevice('+
b.id+","+c.id+")'><a ng-click=\"openSchedule("+b.id+","+c.id+')"title="\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043e\u043f\u0440\u043e\u0441\u0430">\u0420\u0430\u0441\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043e\u043f\u0440\u043e\u0441\u0430</a></li>';f.checkUndefinedNull(c.deviceObject.activeDataSource)||(d+='<li><a ng-click="openDatasource('+b.id+","+c.id+')"title="\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445">\u0418\u0441\u0442\u043e\u0447\u043d\u0438\u043a \u0434\u0430\u043d\u043d\u044b\u0445</a></li>');
d+="<li>";d=!0===c.isImpulse?d+"<a href='#/objects/impulse-indicators/":"el"===c.zpointType?d+"<a href='#/objects/indicator-electricity/":d+"<a href='#/objects/indicators/";d+="?objectId="+encodeURIComponent(b.id)+"&zpointId="+encodeURIComponent(c.id)+"&objectName="+encodeURIComponent(b.fullName)+"&zpointName="+encodeURIComponent(c.zpointName)+"&deviceModel="+encodeURIComponent(c.zpointModel)+"&deviceSN="+encodeURIComponent(c.zpointNumber);f.checkUndefinedNull(c.measureUnitCaption)||(d+="&mu="+encodeURIComponent(c.measureUnitCaption));
d+='\' target="_blank" ng-mousedown="setIndicatorsParams('+b.id+","+c.id+')">\u041f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430</a>';d+="</li>";d+="</ul>";d+="</div>";d+="</td>";a.oldColumns.forEach(function(a){switch(a.name){case "zpointName":var b;switch(c.zpointType){case "cw":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-22-snowflake.png";break;case "hw":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-93-tint.png";
break;case "heat":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-85-heat.png";break;case "gas":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-23-fire.png";break;case "env":b="images/es.png";break;case "el":b="vendor_components/glyphicons_free/glyphicons/png/glyphicons-242-flash.png";break;default:b=a.zpointType}d+="<td>";d+="<img class='marginLeft5' height=12 width=12 src=\""+b+"\"> <span class='paddingLeft5'></span>";d+=(c[a.name]||"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e")+
'<span ng-show="isSystemuser()">(id = '+c.id+")</span></td>";break;case "zpointLastDataDate":d+="<td>{{"+c[a.name]+" | date: 'dd.MM.yyyy HH:mm'}} <i ng-if='"+c[a.name]+"' title=\"\u041f\u043e\u043a\u0430\u0437\u0430\u0442\u044c \u0434\u0435\u0442\u0430\u043b\u0438 \u043f\u043e \u043f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u043c \u0434\u0430\u043d\u043d\u044b\u043c\"ng-attr-id=\"{{'zldd'+"+c.id+'}}"class="btn btn-xs glyphicon glyphicon-eject gly-rotate-180"></i></td>';break;case "zpointRefRange":d+=
'<td id="zpointRefRange'+c.id+'"></td>';break;case "zpointTimeOffsetString":b="";f.checkUndefinedNull(c[a.name])||(0===c[a.name].indexOf("+")&&(b="\u0427\u0430\u0441\u044b \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0441\u043f\u0435\u0448\u0430\u0442"),0===c[a.name].indexOf("-")&&(b="\u0427\u0430\u0441\u044b \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u043e\u0442\u0441\u0442\u0430\u044e\u0442"));d+="<td title='"+b+"'>";f.checkUndefinedNull(c[a.name])||(d+=c[a.name]);d+="</td>";break;default:d+="<td>",
f.checkUndefinedNull(c[a.name])||(d+=c[a.name]),d+="</td>"}});d+="</tr>"});d+="</table></td>";c.innerHTML=d;k(c)(a)}}function t(b){var c=b.data[0];n.success();a.objects.forEach(function(b){b.id===c&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png",b.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,b.nextSettingModeTitle=
a.cont_zpoint_setting_mode_check[1].caption):b.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption))});a.objectsOnPage.forEach(function(b){b.id===c&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png",b.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?
(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption):b.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption))})}function u(){var b=a.currentObject.contManagementId,
d=!1;a.data.cmOrganizations.some(function(a){if(a.id===b)return d=!0});!1===d&&c.getCmOrganizationsWithId(b).then(function(b){a.data.cmOrganizations=b.data;f.sortOrganizationsByName(a.data.cmOrganizations)},function(a){console.log(a)})}function w(a){if(f.checkUndefinedNull(a)||f.checkEmptyObject(a))return!1;Object.keys(a).forEach(function(b){var c="#zldd"+b,d="",d=d+"<table class='table table-condensed noMargin'>",d=d+"<tboby>";a[b].forEach(function(a){d+="<tr><td>";switch(a.timeDetailType){case "1h":d+=
"\u0427\u0430\u0441\u043e\u0432\u044b\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f";break;case "24h":d+="\u0421\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f";break;case "1mon":d+="\u0415\u0436\u0435\u043c\u0435\u0441\u044f\u0447\u043d\u044b\u0435 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u044f";break;case "1h_abs":d+="\u0427\u0430\u0441\u043e\u0432\u044b\u0435 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u044b";
break;case "24h_abs":d+="\u0421\u0443\u0442\u043e\u0447\u043d\u044b\u0435 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u044b";break;case "1mon_abs":d+="\u0415\u0436\u0435\u043c\u0435\u0441\u044f\u0447\u043d\u044b\u0435 \u0438\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u044b";break;case "abs":d+="\u0418\u043d\u0442\u0435\u0433\u0440\u0430\u0442\u043e\u0440\u044b";break;default:d+=a.timeDetailType}d+="</td>";d+="<td> "+a.dataDateString+"</td></tr>"});d+="</tboby>";d+="</table>";
f.setToolTip("\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435",d,c,c,1,300)})}function x(a){a=c.getObjectsUrl()+"/"+a+"/contZPoints/timeDetailLastDate";e.get(a).then(function(a){w(a.data)},function(a){console.log(a)})}function E(b,d){c.getRefRangeByObjectAndZpoint(b,d).success(function(b){if(null!=b[0]){var c=a.dateFormat(b[0].periodBeginDate),e=a.dateFormat(b[0].periodEndDate);d.zpointRefRange="c "+c+" \u043f\u043e "+e;d.zpointRefRangeAuto=b[0].isAuto?
"auto":"manual"}else d.zpointRefRange="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d",d.zpointRefRangeAuto="notSet";G(d)}).error(function(a){console.log(a)})}function G(b){var c=document.getElementById("zpointRefRange"+b.id);if(angular.isUndefined(c)||null==c)return!1;switch(b.zpointRefRangeAuto){case "auto":c.innerHTML='<div class="progress progress-striped noMargin"><div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"><strong>'+
b.zpointRefRange+"</strong></div></div>";break;case "manual":c.innerHTML='<div class="progress progress-striped noMargin"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"><strong>'+b.zpointRefRange+"</strong></div></div>";break;default:c.innerHTML=b.zpointRefRange}k(c)(a)}function C(a){var b=[];a.forEach(function(a){1==a.isVisible&&b.push(a.fieldName)});return b}function A(a,b,c){c=C(c);if(0<c.length){var d=
new Date,d=new Date(d.getFullYear()+10,d.getMonth(),d.getDate());document.cookie="indicator"+b+a.id+"="+c+";expires="+d.toUTCString()}else l["indicator"+b+a.id]=null}function z(a,b){var c=l["indicator"+b+a.id];return f.checkUndefinedNull(c)?null:c.split(",")}function H(a,b){var c=a.length,d=b.length,e=0,y=[],S;for(S=0;S<c;S+=1){for(var f=0,g=0;b[f]!==a[S]&&f<d;)f+=1;for(;y[g]!==a[S]&&g<e;)g+=1;f!=d&&g==e&&(y[e++]=a[S])}return y}function D(a,b){var c=b.length;return a==c-2?H(b[c-2],b[c-1]):H(b[a],
D(a+1,b))}function I(){var b=!0,c=C(a.data.waterColumns);0==C(a.data.electricityColumns).length&&0==c.length&&(n.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u0412\u044b\u0431\u0435\u0440\u0435\u0442\u0435 \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u043d\u0443 \u043a\u043e\u043b\u043e\u043d\u043a\u0443."),b=!1);return b}function B(b){var c=[];angular.isArray(b)&&0<b.length&&b.forEach(function(b){if(null===b.vcValue)return!1;var d=JSON.parse(b.vcValue);b.keyname=b.vcKey;b.caption=d.caption;
b.waterColumns=d.waterColumns;b.electricityColumns=d.electricityColumns;b.indicatorHwKind=d.indicatorHwKind;b.indicatorHwPerPage=d.indicatorHwPerPage;b.indicatorElKind=d.indicatorElKind;b.indicatorElMode=d.indicatorElMode;f.checkUndefinedNull(d.widgets)?(b.widgets={},0<a.data.heatWidgetList.length&&(b.widgets.heat=a.data.heatWidgetList[0].widgetName,a.data.heatWidgetList.some(function(a){if(!0===a.isDefault)return b.widgets.heat=a.widgetName,!0})),0<a.data.hwWidgetList.length&&(b.widgets.hw=a.data.hwWidgetList[0].widgetName,
a.data.hwWidgetList.some(function(a){if(!0===a.isDefault)return b.widgets.hw=a.widgetName,!0})),0<a.data.cwWidgetList.length&&(b.widgets.cw=a.data.cwWidgetList[0].widgetName,a.data.cwWidgetList.some(function(a){if(!0===a.isDefault)return b.widgets.cw=a.widgetName,!0})),0<a.data.elWidgetList.length&&(b.widgets.el=a.data.elWidgetList[0].widgetName,a.data.elWidgetList.some(function(a){if(!0===a.isDefault)return b.widgets.el=a.widgetName,!0}))):b.widgets=d.widgets;c.push(b)});angular.isArray(c)&&0!==
c.length||(b=angular.copy(P),a.data.selectedIndicatorMode=b,c.push(b));return c}function O(){var b="../api/subscr/vcookie";f.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||(b+="?vcMode=OBJECT_INDICATOR_PREFERENCES");e.get(b).then(function(b){a.data.indicatorModes=B(b.data);angular.isArray(a.data.indicatorModes)&&0<a.data.indicatorModes.length&&(f.sortItemsBy(a.data.indicatorModes,"caption"),a.data.selectedIndicatorMode=angular.copy(a.data.indicatorModes[0]),a.messages.modeHeader=a.data.selectedIndicatorMode.caption)},
K)}function Q(a){var b={},c={};b.vcMode="OBJECT_INDICATOR_PREFERENCES";b.vcKey=a.keyname;c.caption=a.caption;c.waterColumns=a.waterColumns;c.electricityColumns=a.electricityColumns;c.indicatorHwKind=a.indicatorHwKind;c.indicatorHwPerPage=a.indicatorHwPerPage;c.indicatorElMode=a.indicatorElMode;c.indicatorElKind=a.indicatorElKind;c.widgets=a.widgets;b.vcValue=JSON.stringify(c);return b}function N(b){a.data.indicatorModes.forEach(function(a){a.isCurrentMode=!1});if(f.checkUndefinedNull("../api/subscr/vcookie/user")||
f.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||f.checkUndefinedNull(b))return console.log("Request required params is null!"),!1;e.get("../api/subscr/vcookie/user?vcMode=OBJECT_INDICATOR_PREFERENCES&vcKey=OIP_"+b).then(function(b){if(f.checkUndefinedNull(b)||f.checkUndefinedNull(b.data)||0===b.data.length)return!1;var c=JSON.parse(b.data[0].vcValue);a.data.indicatorModes.some(function(a){if(a.keyname===c)return a.isCurrentMode=!0})},K)}function L(b){var c=[],d=[],e=null;a.data.buildingCategories.forEach(function(a){a.buildingType===
b&&c.push(angular.copy(a))});c.forEach(function(b){a.data.buildingCategories.forEach(function(a){a.parentCategory===b.keyname&&(e=angular.copy(a),e.parentCategoryCaption=b.caption,d.push(e))})});a.data.preparedBuildingCategoryList=d}function R(){var b=null;a.data.preparedBuildingCategoryList.some(function(c){if(c.keyname===a.currentObject.buildingTypeCategory)return b=c,!0});null!==b&&50<=b.caption.length?($("#inputBuildingCategory").removeClass("nmc-select-form"),$("#inputBuildingCategory").addClass("nmc-select-form-high")):
($("#inputBuildingCategory").removeClass("nmc-select-form-high"),$("#inputBuildingCategory").addClass("nmc-select-form"));if(f.checkUndefinedNull(a.currentObject.buildingTypeCategory))return!1}function Y(b){a.objectCtrlSettings.objectModalWindowTabs.forEach(function(a){var c,d;c=document.getElementById(a.name)||null;d=document.getElementById(a.tabpanel)||null;0!==a.name.localeCompare(b)?(c.classList.remove("active"),d.classList.remove("active")):(c.classList.add("active"),d.classList.add("in"),d.classList.add("active"))})}
var X=null;a.crudTableName=c.getObjectsUrl();a.messages={};a.messages.setSelectedInWinterMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u0437\u0438\u043c\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";a.messages.setSelectedInSummerMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043b\u0435\u0442\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";
a.messages.setAllInWinterMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u0441\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u0437\u0438\u043c\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";a.messages.setAllInSummerMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u0441\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043b\u0435\u0442\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";a.messages.markAllOn="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435";
a.messages.markAllOff="\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435";a.messages.setIndicatorInterfaceForObjects="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 \u0434\u043b\u044f \u0442\u043e\u0447\u0435\u043a \u0443\u0447\u0435\u0442\u0430";a.messages.noObjects="\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";a.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";
a.messages.modeHeader="\u0412\u044b\u0431\u0435\u0440\u0435\u0442\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435";a.messages.setIndicatorInterface="\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0439 \u0434\u043b\u044f \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u0439";a.objectCtrlSettings={};a.objectCtrlSettings.isCtrlEnd=
!1;a.objectCtrlSettings.allSelected=!1;a.objectCtrlSettings.objectsPerScroll=c.OBJECT_PER_SCROLL;a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;a.objectCtrlSettings.vzletSystemList=[];a.objectCtrlSettings.extendedInterfaceFlag=!0;a.objectCtrlSettings.serverTimeZone=3;a.objectCtrlSettings.dateFormat="DD.MM.YYYY";a.objectCtrlSettings.mapAccess=!1;a.objectCtrlSettings.mapCtxId="object_map_2nd_menu_item";a.objectCtrlSettings.htmlLoading=f.getHtmlLoading();var da=function(){f.getContextIds().forEach(function(a){var b=
document.getElementById(a.permissionTagId);angular.isUndefined(b)||null===b||$("#"+a.permissionTagId).removeClass("nmc-hide")})};da();b.$on("servicePermissions:loaded",function(){da()});a.object={};a.objects=[];a.objectsOnPage=[];a.data={};a.data.currentGroupId=null;a.data.currentDevice={};a.data.dataSourcesForCurDevice=[];a.data.deviceModelsForCurDevice=[];a.data.currentDatasource={};a.data.datasourceTypesForDatasource={};(function(){c.getCmOrganizations().then(function(b){a.data.cmOrganizations=
b.data;f.sortOrganizationsByName(a.data.cmOrganizations)})})();var F=function(d){a.messages.noObjects="\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";var e=d.data;e.forEach(function(b){b.imgsrc="images/object-mode-"+b.currentSettingMode+".png";b.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption):
b.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption);angular.isDefined(b._activeContManagement)&&null!==b._activeContManagement&&(b.contManagementId=b._activeContManagement.organizationId)});a.objects=d.data;c.sortObjectsByFullName(a.objects);e=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll);
a.objectsOnPage=e;a.loading=!1;angular.isDefined(l.contObject)&&"null"!==l.contObject&&(d=c.findObjectById(Number(l.contObject),a.objects),null!==d&&(d=a.objects.indexOf(d),d>a.objectCtrlSettings.objectsOnPage&&(e=a.objects.slice(a.objectCtrlSettings.objectsOnPage,d+1),Array.prototype.push.apply(a.objectsOnPage,e),a.objectCtrlSettings.objectsOnPage=d+1,a.objectCtrlSettings.tmpCurContObj=l.contObject,p(function(){var b=document.getElementById("obj"+a.objectCtrlSettings.tmpCurContObj);f.checkUndefinedNull(b)||
b.scrollIntoView();a.objectCtrlSettings.tmpCurContObj=null},50)),a.toggleShowGroupDetails(Number(l.contObject))),l.contObject=null);b.$broadcast("objectSvc:loaded")},T=function(){c.getPromise().then(F)};a.refreshObjectsData=function(){b.$broadcast("objectSvc:requestReloadData",{contGroupId:a.data.currentGroupId});a.loading=!0;T()};a.objectsDataFilteredByGroup=function(b){a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;f.checkUndefinedNull(b)?(a.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",
a.data.currentGroupId=null):(a.messages.groupMenuHeader=b.contGroupName,a.data.currentGroupId=b.id);a.refreshObjectsData()};a.viewFullObjectList=function(){a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;a.objectCtrlSettings.isFullObjectView=!0;a.messages.treeMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";T()};a.loading=c.getLoadingStatus();a.treeLoading=!0;a.columns=[{name:"fullName",
header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","class":"col-xs-10 col-md-10"}];a.captions={loading:"loading...",totalElements:"totalElements"};a.extraProps={idColumnName:"id",defaultOrderBy:"fullName",nameColumnName:"fullName"};a.addMode=!1;a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.filter="";a.filterType="";a.oldColumns=[{name:"zpointName",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430",
"class":"col-xs-3 col-md-3"},{name:"zpointModel",header:"\u041c\u043e\u0434\u0435\u043b\u044c \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0443\u0447\u0435\u0442\u0430","class":"col-xs-2 col-md-2"},{name:"zpointNumber",header:"\u0421\u0435\u0440\u0438\u0439\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440 \u043f\u0440\u0438\u0431\u043e\u0440\u0430 \u0443\u0447\u0435\u0442\u0430","class":"col-xs-2 col-md-2"},{name:"zpointRefRange",header:"\u042d\u0442\u0430\u043b\u043e\u043d\u043d\u044b\u0439 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b",
"class":"col-xs-2 col-md-2 nmc-width-12-per-cent"},{name:"zpointLastDataDate",header:"\u041f\u043e\u0441\u043b\u0435\u0434\u043d\u0438\u0435 \u0434\u0430\u043d\u043d\u044b\u0435","class":"col-xs-2 col-md-2"},{name:"zpointTimeOffsetString",header:"\u0420\u0430\u0441\u0445\u043e\u0436\u0434\u0435\u043d\u0438\u0435 \u0432\u0440\u0435\u043c\u0435\u043d\u0438","class":"col-xs-1 col-md-1 nmc-width-10-per-cent"}];a.refRange={};a.urlRefRange="../api/subscr/contObjects/";a.cont_zpoint_setting_mode_check=[{keyname:"summer",
caption:"\u041b\u0435\u0442\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"},{keyname:"winter",caption:"\u0417\u0438\u043c\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"}];a.toggleAddMode=function(){a.addMode=!a.addMode;a.object={};a.addMode&&a.newIdProperty&&a.newIdValue&&(a.object[a.newIdProperty]=a.newIdValue)};a.toggleEditMode=function(a){a.editMode=!a.editMode};var M=function(b){n.success();$("#showZpointOptionModal").modal("hide");var c=-1;a.currentObject.zpoints.some(function(b,d){if(b.id===
a.zpointSettings.id)return c=d,!0});if(-1<c){b=!1;a.currentObject.zpoints[c].zpointName!==a.zpointSettings.customServiceName&&(b=!0);var d=-1;a.objects.some(function(b,c){a.currentObject.id===b.id&&(d=c)});-1<d&&(a.objects[d].zpoints[c].customServiceName=a.zpointSettings.customServiceName,a.objectsOnPage[d].zpoints[c].zpointName=a.zpointSettings.customServiceName,a.objects[d].zpoints[c].isManualLoading=a.zpointSettings.isManualLoading,a.objectsOnPage[d].zpoints[c].isManualLoading=a.zpointSettings.isManualLoading);
b&&v(a.objectsOnPage[d])}a.zpointSettings={}},U=function(b){n.success();a.objectCtrlSettings.allSelected=!1;a.objects.forEach(function(b){!0===b.selected&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png",b.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption):
b.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption));b.selected=!1});a.objectsOnPage.forEach(function(b){!0===b.selected&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png",b.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?(b.currentSettingModeTitle=
a.cont_zpoint_setting_mode_check[0].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption):b.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,b.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,b.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption));b.selected=!1})},V=function(b,c){n.success();$("#deleteObjectModal").modal("hide");
$("#showObjOptionModal").modal("hide");var d=-1;angular.isDefined(a.currentObject)&&a.currentObject!=={}&&(a.objects.some(function(b,c){if(b.id===a.currentObject.id)return d=c,!0}),-1!==d&&(a.currentObject.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?(a.currentObject.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption,a.currentObject.nextSettingMode=a.cont_zpoint_setting_mode_check[1].keyname,a.currentObject.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption):
a.currentObject.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(a.currentObject.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption,a.currentObject.nextSettingMode=a.cont_zpoint_setting_mode_check[0].keyname,a.currentObject.nextSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption),a.objects[d]=a.currentObject,a.objects[d].imgsrc="images/object-mode-"+a.currentObject.currentSettingMode+".png",a.objectsOnPage[d]=a.currentObject,a.objectsOnPage[d].imgsrc="images/object-mode-"+
a.currentObject.currentSettingMode+".png"),a.currentObject={})},aa=function(c){b.$broadcast("objectSvc:requestReloadData");a.currentObject._activeContManagement=c._activeContManagement;V(c,null)},W=function(b){V(b,function(){a.toggleAddMode()})},K=function(b){a.treeLoading=!1;b=f.errorCallbackHandler(b);n.errorInfo(b.caption,b.description)};a.addObject=function(){m(a.crudTableName).save(a.object,W,K)};a.deleteObject=function(b){m(a.crudTableName)["delete"]({id:b[a.extraProps.idColumnName]},V,K)};
a.deleteObject=function(a,b){m(a)["delete"]({id:b},V,K)};a.updateObject=function(b){var c={id:b[a.extraProps.idColumnName]};angular.isDefined(b.contManagementId)&&null!==b.contManagementId&&(c={id:b[a.extraProps.idColumnName],cmOrganizationId:b.contManagementId});m(a.crudTableName).update(c,b,aa,K)};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};a.selectedObjectBy=function(b){b=angular.copy(b);a.currentObject=b;c.setCurrentObject(a.currentObject);N(b.id)};
a.selectedObject=function(b){a.currentObject=c.findObjectById(b,a.objects);f.checkUndefinedNull(a.currentObject.buildingType)||(L(a.currentObject.buildingType),R())};a.selectedObjectEx=function(b){a.selectedObject(b);angular.isArray(a.data.cmOrganizations)&&u()};a.selectedZpoint=function(b,c){a.selectedObject(b);var d=null;a.currentObject.zpoints.some(function(a){if(a.id===c)return d=angular.copy(a),!0});a.currentZpoint=d};a.toggleShowGroupDetails=function(b){var d=c.findObjectById(b,a.objects);if(null!==
d){var e=document.getElementById("zpointTable"+d.id);d.showGroupDetails=!0===d.showGroupDetails&&null===e?!0:!d.showGroupDetails;!0===d.showGroupDetails?c.getZpointsDataByObject(d,"/vo").then(function(a){var c=[],e=c=a.data;a=[];var y;for(y=0;y<e.length;y+=1){var J={};J.id=e[y].id;J.zpointOrder=e[y].contServiceType.serviceOrder+e[y].customServiceName;J.zpointType=e[y].contServiceType.keyname;J.zpointTypeCaption=e[y].contServiceType.caption;J.isManualLoading=e[y].isManualLoading;J.customServiceName=
e[y].customServiceName;J.zpointName=e[y].customServiceName;J.zpointRSO="undefined"!=typeof e[y].rso&&null!=e[y].rso?e[y].rso.organizationFullName||e[y].rso.organizationName:"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e";J.checkoutTime=e[y].checkoutTime;J.checkoutDay=e[y].checkoutDay;"undefined"==typeof e[y].doublePipe?J.piped=!1:(J.piped=!0,J.doublePipe=null===e[y].doublePipe?!1:e[y].doublePipe,J.singlePipe=!J.doublePipe);"undefined"!=typeof e[y].deviceObjects&&0<e[y].deviceObjects.length&&(J.deviceObject=
e[y].deviceObjects[0],e[y].deviceObjects[0].hasOwnProperty("deviceModel")?(J.zpointModel=e[y].deviceObjects[0].deviceModel.modelName,J.devCaption=e[y].deviceObjects[0].deviceModel.modelName||"",J.isImpulse=e[y].deviceObjects[0].isImpulse,!0===J.isImpulse&&(f.checkUndefinedNull(X)||X.all.some(function(a){a.keyname===e[y].deviceObjects[0].impulseMu&&(J.measureUnitCaption=a.caption)}))):J.zpointModel="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e",J.zpointNumber=e[y].deviceObjects[0].number,J.devCaption+=
e[y].deviceObjects[0].number?", \u2116"+e[y].deviceObjects[0].number:"");J.zpointLastDataDate=e[y].lastDataDate;f.checkUndefinedNull(e[y].deviceObjectTimeOffset)||(J.zpointTimeOffsetString=f.prepareTimeOffset(e[y].deviceObjectTimeOffset));E(d,J);a[y]=J}f.sortItemsBy(a,"zpointOrder");d.zpoints=a;v(d);a=document.getElementById("btnDetail"+d.id);angular.isDefined(a)&&null!=a&&(a.classList.remove("glyphicon-chevron-right"),a.classList.add("glyphicon-chevron-down"));d.showGroupDetailsFlag=!d.showGroupDetailsFlag;
x(b)}):(document.getElementById("obj"+d.id).getElementsByClassName("nmc-tr-zpoint")[0].innerHTML="",e=document.getElementById("btnDetail"+d.id),e.classList.remove("glyphicon-chevron-down"),e.classList.add("glyphicon-chevron-right"))}};a.dateFormat=function(b){b=new Date(b+Math.round(36E5*a.objectCtrlSettings.serverTimeZone));return null===b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]).format(a.objectCtrlSettings.dateFormat)};a.onlyNoRead=!1;a.showRow=function(b){return"undefined"!=
typeof b.isRead||a.onlyNoRead?a.onlyNoRead&&a.onlyNoRead!=!b.isRead?!1:!0:!0};a.showDetails=function(b){a.bdirectories&&(a.currentObject=b,$("#showDirectoryStructModal").modal())};a.getIndicators=function(b,c){a.setIndicatorsParams(b,c);var d="#/objects",d=!0===a.currentZpoint.isImpulse?d+"/impulse-indicators":"el"===a.currentZpoint.zpointType?d+"/indicator-electricity":d+"/indicators",d=d+("/?objectId="+encodeURIComponent(b)+"&zpointId="+encodeURIComponent(c)+"&objectName="+encodeURIComponent(a.currentObject.fullName)+
"&zpointName="+encodeURIComponent(a.currentZpoint.zpointName)),d=d+("&deviceModel="+encodeURIComponent(a.currentZpoint.zpointModel)),d=d+("&deviceSN="+encodeURIComponent(a.currentZpoint.zpointNumber));f.checkUndefinedNull(a.currentZpoint.measureUnitCaption)||(d+="&mu="+encodeURIComponent(a.currentZpoint.measureUnitCaption));window.open(d,"_blank")};a.setIndicatorsParams=function(c,d){a.selectedZpoint(c,d);l.contZPoint=a.currentZpoint.id;l.contObject=a.currentObject.id;l.contZPointName=a.currentZpoint.zpointName;
l.contObjectName=a.currentObject.fullName;l.deviceModel=a.currentZpoint.zpointModel;l.deviceSN=a.currentZpoint.zpointNumber;if(angular.isUndefined(l.timeDetailType)||"undefined"==l.timeDetailType||"null"==l.timeDetailType)l.timeDetailType="24h";l.isManualLoading=(null===a.currentZpoint.isManualLoading?!1:a.currentZpoint.isManualLoading)||!1;b.reportStart=moment().subtract(6,"days").startOf("day").format("YYYY-MM-DD");b.reportEnd=moment().endOf("day").format("YYYY-MM-DD")};a.zpointSettings={};a.getZpointSettings=
function(b,c){a.selectedZpoint(b,c);var d=a.currentZpoint,e={};e.id=d.id;e.isManualLoading=d.isManualLoading;e.customServiceName=d.customServiceName;e.zpointTypeCaption=d.zpointTypeCaption;e.zpointName=d.zpointName;switch(d.zpointType){case "heat":e.zpointType="\u0422\u0421";break;case "hw":e.zpointType="\u0413\u0412\u0421";break;case "cw":e.zpointType="\u0425\u0412";break;default:e.zpointType=d.zpointType}e.piped=d.piped;e.singlePipe=d.singlePipe;e.doublePipe=d.doublePipe;e.zpointModel=d.zpointModel;
e.devCaption=d.devCaption;e.zpointRSO=d.zpointRSO;e.checkoutTime=d.checkoutTime;e.checkoutDay=d.checkoutDay;e.winter={};e.summer={};a.zpointSettings=e;a.prepareRefRange()};a.getZpointSettingsExpl=function(b,d){a.getZpointSettings(b,d);var e={},y={},f=c.getObjectsUrl()+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode";m(f).query(function(b){var c;for(c=0;c<b.length;c+=1)"winter"==b[c].settingMode?e=b[c]:"summer"==b[c].settingMode&&(y=b[c]);a.zpointSettings.winter=e;a.zpointSettings.summer=
y})};a.prepareRefRange=function(){ga(a.currentObject.id,a.zpointSettings.id);a.editRefRangeOff()};a.editRefRangeOn=function(){a.toggleFlag=!0;document.getElementById("i_ref_range_save").style.display="block";document.getElementById("i_ref_range_add").style.display="none";document.getElementById("inp_ref_range_start").disabled=!1;document.getElementById("inp_ref_range_end").disabled=!1};a.editRefRangeOff=function(){a.toggleFlag=!1;document.getElementById("i_ref_range_save").style.display="none";document.getElementById("i_ref_range_add").style.display=
"block";document.getElementById("inp_ref_range_start").disabled=!0;document.getElementById("inp_ref_range_end").disabled=!0};var ga=function(b,c){e.get(a.urlRefRange+"/"+b+"/zpoints/"+c+"/referencePeriod").success(function(b){null!=b[0]?(a.refRange=b[0],a.refRange.cont_zpoint_id=c,a.beginDate=a.dateFormat(a.refRange.periodBeginDate),a.endDate=a.dateFormat(a.refRange.periodEndDate),0==a.refRange.isAuto?(document.getElementById("spn_if_manual").style.display="block",document.getElementById("spn_if_auto").style.display=
"none"):(document.getElementById("spn_if_manual").style.display="none",document.getElementById("spn_if_auto").style.display="block")):(a.refRange={},a.refRange.cont_zpoint_id=c,a.beginDate="",a.endDate="",document.getElementById("spn_if_manual").style.display="none",document.getElementById("spn_if_auto").style.display="none")}).error(function(a){n.errorInfo(a.statusText,a.description)})};a.addRefRange=function(){var b=a.urlRefRange+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/referencePeriod";
a.refRange.id="";var c=new Date(moment(a.beginDate,a.objectCtrlSettings.dateFormat).format("YYYY-MM-DD")),c=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate());a.refRange.periodBeginDate=isNaN(c)?null:(new Date(c)).getTime();c=new Date(moment(a.endDate,a.objectCtrlSettings.dateFormat).format("YYYY-MM-DD"));c=Date.UTC(c.getFullYear(),c.getMonth(),c.getDate());a.refRange.periodEndDate=isNaN(c)?null:(new Date(c)).getTime();e.post(b,a.refRange).success(function(b){a.editRefRangeOff();a.refRange=b;document.getElementById("zpointRefRange"+
a.currentZpoint.id);a.beginDate=a.dateFormat(a.refRange.periodBeginDate);a.endDate=a.dateFormat(a.refRange.periodEndDate);a.currentZpoint.zpointRefRange="c "+a.beginDate+" \u043f\u043e "+a.endDate;a.currentZpoint.zpointRefRangeAuto=a.refRange.isAuto?"auto":"manual";G(a.currentZpoint)}).error(function(a){n.errorInfo(a.statusText,a.description)})};var ha=function(b){n.success();m(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").update({id:a.zpointSettings.winter.id},
a.zpointSettings.winter,ba,K)},ba=function(b){n.success();$("#showZpointOptionModal").modal("hide");$("#showZpointExplParameters").modal("hide");a.zpointSettings={}};a.updateZpointCommonSettings=function(){e({url:a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id,method:"PUT",data:a.zpointSettings}).then(M,K)};a.updateZpointModeSettings=function(){m(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").update({id:a.zpointSettings.summer.id},a.zpointSettings.summer,
ha,K)};a.searchObjects=function(b){if(!(0>=a.objects.length)){a.objectsOnPage.forEach(function(a){if(1==a.showGroupDetailsFlag){var b=document.getElementById("obj"+a.id);f.checkUndefinedNull(b)||(b.getElementsByClassName("nmc-tr-zpoint")[0].innerHTML="",b=document.getElementById("btnDetail"+a.id),b.classList.remove("glyphicon-chevron-down"),b.classList.add("glyphicon-chevron-right"))}a.showGroupDetailsFlag=!1});var c=[];angular.isUndefined(b)||""===b?(c=[],a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,
c=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll)):(c=[],a.objects.forEach(function(a){-1!=a.fullName.toUpperCase().indexOf(b.toUpperCase())&&c.push(a)}));a.objectsOnPage=c}};a.$on("$destroy",function(){window.onkeydown=void 0});window.onkeydown=function(b){38==b.keyCode?(b=document.getElementById("divWithSettingsObjectTable"),b.scrollTop-=20):40==b.keyCode?(b=document.getElementById("divWithSettingsObjectTable"),b.scrollTop+=20):34==b.keyCode?(b=document.getElementById("divWithSettingsObjectTable"),
b.scrollTop+=10*a.objectCtrlSettings.objectsPerScroll):33==b.keyCode?(b=document.getElementById("divWithSettingsObjectTable"),b.scrollTop-=10*a.objectCtrlSettings.objectsPerScroll):b.ctrlKey&&36==b.keyCode?(b=document.getElementById("divWithSettingsObjectTable"),b.scrollTop=0):b.ctrlKey&&35==b.keyCode&&(b=a.objects.slice(a.objectCtrlSettings.objectsOnPage,a.objects.length),Array.prototype.push.apply(a.objectsOnPage,b),a.objectCtrlSettings.objectsOnPage+=a.objects.length,a.$apply(),b=document.getElementById("divWithSettingsObjectTable"),
b.scrollTop=b.scrollHeight)};a.addMoreObjects=function(){if(!(0>=a.objects.length)){var b=a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll;b>=a.objects.length&&(b=a.objects.length);var c=a.objects.slice(a.objectCtrlSettings.objectsOnPage,b);Array.prototype.push.apply(a.objectsOnPage,c);a.objectCtrlSettings.objectsOnPage=b>=a.objects.length?a.objects.length:a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll}};a.isSystemViewInfo=function(){return f.getViewSystemInfo()};
a.isSystemuser=function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};a.toggleObjects=function(b){a.objects.forEach(function(a){a.selected=b});a.objectsOnPage.forEach(function(a){a.selected=b})};a.setModeForObject=function(b){var d=b.nextSettingMode;a.settedMode=d;b=[b.id];var y=c.getObjectsUrl()+"/settingModeType";e({url:y,method:"PUT",params:{currentSettingMode:d},data:b}).then(t,K)};a.setModeForObjects=function(b){a.settedMode=b;var d=[];!0===
a.objectCtrlSettings.allSelected?d=a.objects.map(function(a){return a.id}):a.objectsOnPage.forEach(function(a){!0===a.selected&&d.push(a.id)});var y=c.getObjectsUrl()+"/settingModeType";e({url:y,method:"PUT",params:{currentSettingMode:b},data:d}).then(U,K)};a.getVzletSystemList=function(){var b=c.getVzletSystemList();0===b.length?c.getDeviceMetaDataVzletSystemList().then(function(b){a.objectCtrlSettings.vzletSystemList=b.data},function(a){n.errorInfo(a.statusText,a.description)}):a.objectCtrlSettings.vzletSystemList=
b};a.getVzletSystemList();a.getDevices=function(a){c.getDevicesByObject(a).then(function(b){var c=[];b.data.forEach(function(a){!0===a.metaVzletExpected&&c.push(a)});a.devices=c},K)};a.getDeviceMetaDataVzlet=function(b,d){c.getDeviceMetaDataVzlet(b,d).then(function(b){d.metaData=b.data;a.currentDevice=d;$("#metaDataEditorModal").modal()},function(a){n.errorInfo(a.statusText,a.description)})};a.updateDeviceMetaData=function(b){var c="",c=angular.isDefined(b.metaData.id)&&null!==b.metaData.id?"PUT":
"POST";e({url:"../api/subscr/contObjects/"+b.contObject.id+"/deviceObjects/"+b.id+"/metaVzlet",method:c,data:b.metaData}).then(function(b){a.currentDevice={};$("#metaDataEditorModal").modal("hide")},function(a){console.log(a);n.errorInfo(a.statusText,a.description)})};a.selectedDevice=function(b){a.data.currentDevice=angular.copy(b);b=a.data.currentDevice;angular.isDefined(b.contObjectInfo)&&null!=b.contObjectInfo&&(b.contObjectId=b.contObjectInfo.contObjectId);angular.isDefined(b.activeDataSource)&&
null!=b.activeDataSource&&(b.subscrDataSourceId=Number(b.activeDataSource.subscrDataSource.id),b.curDatasource=b.activeDataSource.subscrDataSource,b.subscrDataSourceAddr=b.activeDataSource.subscrDataSourceAddr,b.dataSourceTable1h=b.activeDataSource.dataSourceTable1h,b.dataSourceTable24h=b.activeDataSource.dataSourceTable24h)};a.openDeviceProperties=function(b,c){a.selectedZpoint(b,c);if(f.checkUndefinedNull(a.currentZpoint))return!1;a.selectedDevice(a.currentZpoint.deviceObject);if(!f.checkUndefinedNull(a.data.currentDevice.activeDataSource)){var d=
angular.copy(a.data.currentDevice.activeDataSource.subscrDataSource);a.data.dataSourcesForCurDevice=[d]}f.checkUndefinedNull(a.data.currentDevice.deviceModel)||(a.data.deviceModelsForCurDevice=[a.data.currentDevice.deviceModel]);$("#showDeviceModal").modal()};a.isDirectDevice=function(b,d){a.selectedObject(b);var e=null;if(f.checkUndefinedNull(a.currentObject)||f.checkUndefinedNull(a.currentObject.zpoints))return!1;a.currentObject.zpoints.some(function(a){if(a.id===d)return e=angular.copy(a),!0});
return f.checkUndefinedNull(e)?!1:c.isDirectDevice(e.deviceObject)};a.invokeHelp=function(){alert("This is SPRAVKA!!!111")};a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:"dd.mm.yy"};$(document).ready(function(){$("#inp_ref_range_start").datepicker({dateFormat:a.dateOptsParamsetRu.format,firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames});$("#inp_ref_range_end").datepicker({dateFormat:a.dateOptsParamsetRu.format,firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames});
$("#divWithSettingsObjectTable").scroll(function(){if(angular.isUndefined(a.filter)||""==a.filter)a.addMoreObjects(),a.$apply()});$("#inputAddress").suggestions({serviceUrl:"https://dadata.ru/api/v2",token:"f9879c8518e9c9e794ff06a6e81eebff263f97d5",type:"ADDRESS",count:5,onSelect:function(b){console.log(b);a.currentObject.fullAddress=b.value;a.$apply()}})});a.checkEmptyNullValue=function(a){return""===a||null==a?!0:!1};a.checkNumericValue=function(b){return a.checkEmptyNullValue(b)?!0:isNaN(parseFloat(b))||
!isFinite(b)?!1:!0};a.checkPositiveNumberValue=function(a){return f.checkPositiveNumberValue(a)};a.checkNumericInterval=function(b,c){return a.checkEmptyNullValue(b)||a.checkEmptyNullValue(c)||!a.checkNumericValue(b)||!a.checkNumericValue(c)?!1:parseInt(c,10)>=parseInt(b,10)?!0:!1};a.checkHHmm=function(a){return f.checkHHmm(a)};a.checkZpointSettingsFrom=function(b){return null!=b&&b.hasOwnProperty("summer")&&b.hasOwnProperty("winter")?a.checkPositiveNumberValue(b.summer.ov_BalanceM_ctrl)&&a.checkPositiveNumberValue(b.winter.ov_BalanceM_ctrl)&&
a.checkHHmm(b.summer.ov_Worktime)&&a.checkHHmm(b.winter.ov_Worktime)&&a.checkPositiveNumberValue(b.summer.leak_Gush)&&a.checkPositiveNumberValue(b.winter.leak_Gush)&&a.checkPositiveNumberValue(b.summer.leak_Night)&&a.checkPositiveNumberValue(b.winter.leak_Night)&&a.checkNumericInterval(b.summer.wm_deltaT_min,b.summer.wm_deltaT_max)&&a.checkNumericInterval(b.summer.wm_deltaQ_min,b.summer.wm_deltaQ_max)&&a.checkNumericInterval(b.winter.wm_deltaT_min,b.winter.wm_deltaT_max)&&a.checkNumericInterval(b.winter.wm_deltaQ_min,
b.winter.wm_deltaQ_max)&&a.checkNumericInterval(b.summer.wm_P2_min,b.summer.wm_P2_max)&&a.checkNumericInterval(b.summer.wm_P1_min,b.summer.wm_P1_max)&&a.checkNumericInterval(b.winter.wm_P2_min,b.winter.wm_P2_max)&&a.checkNumericInterval(b.winter.wm_P1_min,b.winter.wm_P1_max)&&a.checkNumericInterval(b.summer.wm_T2_min,b.summer.wm_T2_max)&&a.checkNumericInterval(b.summer.wm_T1_min,b.summer.wm_T1_max)&&a.checkNumericInterval(b.winter.wm_T2_min,b.winter.wm_T2_max)&&a.checkNumericInterval(b.winter.wm_T1_min,
b.winter.wm_T1_max)&&a.checkNumericInterval(b.summer.wm_M2_min,b.summer.wm_M2_max)&&a.checkNumericInterval(b.summer.wm_M1_min,b.summer.wm_M1_max)&&a.checkNumericInterval(b.winter.wm_M2_min,b.winter.wm_M2_max)&&a.checkNumericInterval(b.winter.wm_M1_min,b.winter.wm_M1_max):!0};a.checkObjectPropertiesForm=function(b){return null!=b&&b.hasOwnProperty("cwTemp")&&b.hasOwnProperty("heatArea")?a.checkNumericValue(b.cwTemp)&&a.checkNumericValue(b.heatArea):!0};a.isAdmin=function(){return f.isAdmin()};a.isReadonly=
function(){return f.isReadonly()};a.isROfield=function(){return a.isReadonly()||!a.isAdmin()};a.isCabinet=function(){return f.isCabinet()};a.objectCtrlSettings.isTreeView=!f.isCabinet();a.objectCtrlSettings.isFullObjectView=!1;a.data.currentTree={};a.data.newTree={};a.data.defaultTree=null;a.selectNode=function(b){var d=a.data.currentTree,e=a.data.selectedNode;if(!f.checkUndefinedNull(e)){if(e.id==b.id||e.type==b.type=="root")return;d=f.findNodeInTree(e,d);f.checkUndefinedNull(d)||(d.isSelected=!1)}b.isSelected=
!0;a.data.selectedNode=angular.copy(b);a.loading=!0;"root"==b.type?c.loadSubscrFreeObjectsByTree(a.data.currentTree.id).then(F):c.loadSubscrObjectsByTreeNode(a.data.currentTree.id,b.id).then(F)};a.data.trees=[];a.loadTree=function(d,e){a.loading=!0;a.treeLoading=!0;c.loadSubscrTree(d.id).then(function(c){a.treeLoading=!1;a.messages.treeMenuHeader=d.objectName||d.id;c=angular.copy(c.data);f.sortTreeNodesBy(c,"objectName");a.data.currentTree=c;a.objects=[];a.objectsOnPage=[];a.loading=!1;b.$broadcast("objectSvc:loaded");
a.messages.noObjects=""},K)};var ca=function(b){a.treeLoading=!0;c.loadSubscrTrees().then(function(c){a.treeLoading=!1;f.sortItemsBy(c.data,"objectName");a.data.trees=angular.copy(c.data);f.checkUndefinedNull(b)||1!=b.isActive||(a.data.defaultTree=f.findItemBy(a.data.trees,"id",Number(b.value)));if(!angular.isArray(a.data.trees)||0>=a.data.trees.length||f.checkUndefinedNull(a.data.defaultTree))return a.viewFullObjectList(),"View full object list!";a.loadTree(a.data.defaultTree)},K)},ea=function(b){a.objectCtrlSettings.isTreeView=
b.data.isActive;ca(b.data)};a.toggleTreeView=function(){a.objectCtrlSettings.isTreeView=!a.objectCtrlSettings.isTreeView;0==a.objectCtrlSettings.isTreeView?T():c.loadDefaultTreeSetting().then(ea,K)};var fa=q.getWaterColumns();a.data.waterColumns=angular.copy(fa);var Z=q.getElectricityColumns();a.data.electricityColumns=angular.copy(Z);a.selectAllWaterColumns=function(){a.data.selectedIndicatorMode.waterColumns.forEach(function(b){b.isVisible=a.selectAllWaterColumnFlag})};a.selectAllElectricityColumns=
function(){a.data.selectedIndicatorMode.electricityColumns.forEach(function(b){b.isVisible=a.selectAllElectricityColumnFlag})};a.initIndicatorColumnsPref=function(){a.data.waterColumns=angular.copy(fa);a.data.electricityColumns=angular.copy(Z);var b=[],c=[];a.selectAllWaterColumnFlag=!1;a.selectAllElectricityColumnFlag=!1;a.objectsOnPage.forEach(function(a){if(!0===a.selected){var d=z(a,"hw");f.checkUndefinedNull(d)||b.push(d);d=z(a,"el");f.checkUndefinedNull(d)||c.push(d)}});1==b.length?b=b[0]:1<
b.length&&(b=D(0,b));0!=b.length?b.forEach(function(b){a.data.waterColumns.some(function(a){if(a.fieldName==b)return a.isVisible=!0})}):(a.selectAllWaterColumnFlag=!0,a.data.waterColumns.forEach(function(a){a.isVisible=!0}));1==c.length?c=c[0]:1<c.length&&(c=D(0,c));0!=c.length?c.forEach(function(b){a.data.electricityColumns.some(function(a){if(a.fieldName==b)return a.isVisible=!0})}):(a.selectAllElectricityColumnFlag=!0,a.data.electricityColumns.forEach(function(a){a.isVisible=!0}));$("#columnSettingsModal").modal()};
a.setIndicatorColumnsPref=function(){if(0==I())return"Columns are not tested.";a.objectsOnPage.forEach(function(b){!0===b.selected&&(A(b,"hw",a.data.waterColumns),A(b,"el",a.data.electricityColumns))});$("#columnSettingsModal").modal("hide")};a.data.selectedWaterColumns=[];a.data.selectedElectricityColumns=[];a.openSchedule=function(b,c){a.selectedZpoint(b,c);a.getDeviceSchedulerSettings(b,a.currentZpoint.deviceObject)};a.getDeviceSchedulerSettings=function(b,d){c.getDeviceSchedulerSettings(b,d.id).then(function(b){a.data.currentScheduler=
b.data;a.selectedDevice(d);$("#scheduleEditorModal").modal()},K)};var P={keyname:"INDICATOR_MODE_"+(new Date).getTime(),caption:"\u041d\u043e\u0432\u043e\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 1","class":"nmc-mode-menu-item-active",isActive:!0,waterColumns:angular.copy(fa),indicatorHwKind:"24h",indicatorHwPerPage:25,electricityColumns:angular.copy(Z),indicatorElMode:"",indicatorElKind:"24h"};P.waterColumns.forEach(function(a){a.isVisible=!0});P.electricityColumns.forEach(function(a){a.isVisible=
!0});a.data.indicatorModes=[];a.addIndicatorMode=function(){var b={keyname:"INDICATOR_MODE_"+(new Date).getTime(),caption:"\u041f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 "+(a.data.indicatorModes.length+1),waterColumns:angular.copy(fa),indicatorHwKind:"24h",indicatorHwPerPage:25,electricityColumns:angular.copy(Z),indicatorElMode:"",indicatorElKind:"24h"};a.data.indicatorModes.push(b)};a.deleteIndicatorModeInit=function(b){a.data.deletingMode=b;a.messages.deleteMessage=
'\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u0435 "'+b.caption+'"?';$("#messageForUserModal").modal()};a.deleteIndicatorMode=function(b){if(f.checkUndefinedNull(b)||f.checkUndefinedNull(b.vcMode)||f.checkUndefinedNull(b.vcKey))return console.log("Indicator mode is incorrect!"),!1;var c={};c.vcMode=
b.vcMode;c.vcKey=b.vcKey;c.vcValue=null;e.put("../api/subscr/vcookie/list",[c]).then(function(b){n.success();$("#messageForUserModal").modal("hide");if(f.checkUndefinedNull(b.data)||!angular.isArray(b.data)||0===b.data.length)return console.log("Response from server on the mode deleting  is undefined or null!"),!1;var c=b.data[0],d=-1;a.data.indicatorModes.some(function(a,b){if(a.keyname===c.vcKey)return d=b,!0});-1!==d&&a.data.indicatorModes.splice(d,1);a.data.selectedIndicatorMode.keyname==c.vcKey&&
(0===a.data.indicatorModes.length&&(b=angular.copy(P),a.data.indicatorModes.push(b)),a.data.selectedIndicatorMode=a.data.indicatorModes[0],a.messages.modeHeader=a.data.selectedIndicatorMode.caption)},K)};a.modeClick=function(b){a.selectAllWaterColumnFlag=!1;a.selectAllElectricityColumnFlag=!1;a.data.selectedIndicatorMode=angular.copy(b);a.messages.modeHeader=a.data.selectedIndicatorMode.caption};a.initIndicatorPreferences=function(){a.selectAllWaterColumnFlag=!1;a.selectAllElectricityColumnFlag=!1;
angular.isArray(a.data.indicatorModes)&&0<a.data.indicatorModes.length&&(f.sortItemsBy(a.data.indicatorModes,"caption"),a.data.selectedIndicatorMode=angular.copy(a.data.indicatorModes[0]),a.messages.modeHeader=a.data.selectedIndicatorMode.caption)};a.saveIndicatorPreferencesAsInit=function(b){a.data.selectedIndicatorModeSaveAs=angular.copy(b);a.data.selectedIndicatorModeSaveAs.keyname="INDICATOR_MODE_"+(new Date).getTime();$("#editIndicatorModeModal").modal()};a.saveIndicatorPreferencesAs=function(b){if(f.checkUndefinedNull(b))return console.log("Saving mode is undefined or null!"),
!1;a.data.selectedIndicatorModeSaveAs=angular.copy(b);a.data.selectedIndicatorModeSaveAs.keyname="INDICATOR_MODE_"+(new Date).getTime();if(f.checkUndefinedNull(a.data.selectedIndicatorModeSaveAs))return console.log("$scope.data.selectedIndicatorModeSaveAs is undefined or null!"),!1;var c=!0;a.data.indicatorModes.some(function(a){if(a.caption===b.caption&&!f.checkUndefinedNull(a.vcKey))return n.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u043c. \u0418\u0437\u043c\u0435\u043d\u0438\u0442\u0435 \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043f\u043e\u043f\u044b\u0442\u043a\u0443."),
c=!1,!0});if(!1===c)return!1;a.saveIndicatorPreferences(a.data.selectedIndicatorModeSaveAs)};a.saveIndicatorPreferences=function(b){var c=[];if(f.checkUndefinedNull(b))return console.log("Saving mode is undefined or null!"),!1;var d=!0;""<b.caption||(n.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0434\u043b\u044f \u043f\u0440\u0435\u0434\u0441\u0442\u0430\u0432\u043b\u0435\u043d\u0438\u044f!"),
d=!1);if(!1===d)return!1;c.push(Q(b));e.put("../api/subscr/vcookie/list",c).then(function(b){if(f.checkUndefinedNull(b.data)||!angular.isArray(b.data)||0===b.data.length)return console.log("Response data = "+b.data),!1;if(1===b.data.length){var c=B(b.data),d=-1;a.data.indicatorModes.some(function(a,b){if(a.keyname===c[0].keyname)return d=b,!0});-1!==d?a.data.indicatorModes[d]=c[0]:a.data.indicatorModes.push(c[0]);if(1<a.data.indicatorModes.length){var e=-1;a.data.indicatorModes.some(function(a,b){if(f.checkUndefinedNull(a.vcKey))return e=
b,!0});-1!==e&&a.data.indicatorModes.splice(e,1)}a.messages.modeHeader=c[0].caption}else a.data.indicatorModes=B(b.data);$("#columnSettingsModal").modal("hide");$("#editIndicatorModeModal").modal("hide")},K)};a.setDefaultObjectIndicatorModeForObjects=function(b){if(f.checkUndefinedNull("../api/subscr/vcookie/user")||f.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||f.checkUndefinedNull(b))return console.log("Request required params is null!"),!1;var c=[];!0===a.objectCtrlSettings.allSelected?
c=a.objects.map(function(a){var c={vcMode:"OBJECT_INDICATOR_PREFERENCES"};c.vcKey="OIP_"+a.id;c.vcValue=JSON.stringify(b.keyname);return c}):a.objectsOnPage.forEach(function(a){!0===a.selected&&c.push({vcMode:"OBJECT_INDICATOR_PREFERENCES",vcKey:"OIP_"+a.id,vcValue:JSON.stringify(b.keyname)})});if(0===c.length)return!1;e.put("../api/subscr/vcookie/user/list",c).then(function(a){n.success()},K)};a.setDefaultObjectIndicatorMode=function(a,b){if(f.checkUndefinedNull("../api/subscr/vcookie/user")||f.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||
f.checkUndefinedNull(a))return console.log("Request required params is null!"),!1;var c={vcMode:"OBJECT_INDICATOR_PREFERENCES"};c.vcKey="OIP_"+a;c.vcValue=JSON.stringify(b.keyname);e.put("../api/subscr/vcookie/user/list",[c]).then(function(a){n.success()},K)};a.editDefaultIndicatorMode=function(){a.data.selectedIndicatorMode.isEditMode=!0};a.applyChangeCaption=function(){a.messages.modeHeader=a.data.selectedIndicatorMode.caption;a.data.selectedIndicatorMode.isEditMode=!1};a.cancelChangeCaption=function(){a.data.selectedIndicatorMode.caption=
a.messages.modeHeader;a.data.selectedIndicatorMode.isEditMode=!1};a.widgetPreview=function(b){a.data.widgetPreview={};a.data.widgetPreview.type=b;a.data.widgetPreview.options={zpointName:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0442\u043e\u0447\u043a\u0438 \u0443\u0447\u0435\u0442\u0430",contZpointId:1,contObjectId:1,previewMode:!0}};a.openZpointMetadata=function(b,d){a.selectedZpoint(b,d);c.getZpointMetaSrcProp(b,d).then(function(e){a.currentZpoint.metaData={};
a.currentZpoint.metaData.srcProp=e.data;a.currentZpoint.metaData.srcProp.push({columnName:""});c.getZpointMetaDestProp(b,d).then(function(e){a.currentZpoint.metaData.destProp=e.data;c.getZpointMetaMeasureUnits(b,d)},K)},K)};a.$on("objectSvc:zpointMetadataMeasuresLoaded",function(){a.currentZpoint.metaData.measures=c.getZpointMetadataMeasures();c.getZpointMetadata(a.currentObject.id,a.currentZpoint.id).then(function(b){f.sortItemsBy(b.data,"destProp");a.currentZpoint.metaData.metaData=b.data;$("#metaDataEditorModal").modal()},
K)});a.openDatasource=function(b,c){a.selectedZpoint(b,c);if(f.checkUndefinedNull(a.currentZpoint.deviceObject.activeDataSource))return console.log("Datasource is incorrect!"),!1;a.data.currentDatasource=angular.copy(a.currentZpoint.deviceObject.activeDataSource.subscrDataSource);if(f.checkUndefinedNull(a.data.currentDatasource.rawModemIdentity)&&!f.checkUndefinedNull(a.data.currentDatasource.rawModemModelId)){var d=findModemIdentity(a.data.currentDatasource.rawModemModelId);a.data.currentDatasource.rawModemIdentity=
d.rawModemModelIdentity;a.data.currentDatasource.rawModemDialupAvailable=d.isDialup}d=[angular.copy(a.data.currentDatasource.dataSourceType)];a.data.datasourceTypesForDatasource=d;$("#showDatasourceModal").modal()};a.data.buildingTypes=[];a.data.buildingCategories=[];a.data.preparedBuildingCategoryList=[];a.data.buildingCategories=c.getBuildingCategories();a.data.buildingTypes=c.getBuildingTypes();a.$on(c.BROADCASTS.BUILDING_TYPES_LOADED,function(){a.data.buildingTypes=c.getBuildingTypes()});a.$on(c.BROADCASTS.BUILDING_CATEGORIES_LOADED,
function(){a.data.buildingCategories=c.getBuildingCategories()});a.changeBuildingType=function(b){a.currentObject.buildingTypeCategory=null;l.recentBuildingTypeCategory=a.currentObject.buildingTypeCategory;$("#inputBuildingCategory").removeClass("nmc-select-form-high");$("#inputBuildingCategory").addClass("nmc-select-form");if(f.checkUndefinedNull(b))return!1;l.recentBuildingType=b;L(b)};a.changeBuildingCategory=function(){R();l.recentBuildingTypeCategory=a.currentObject.buildingTypeCategory};a.data.heatWidgetList=
[];a.data.hwWidgetList=[];a.data.cwWidgetList=[];a.data.elWidgetList=[];$("#showObjOptionModal").on("shown.bs.modal",function(){$("#inputContObjectName").focus();$("#inputNumOfStories").inputmask("integer",{min:1,max:200})});a.objectCtrlSettings.objectModalWindowTabs=[{name:"main_object_properties_tab",tabpanel:"main_object_properties"},{name:"extra_object_properties_tab",tabpanel:"extra_object_properties"}];$("#showObjOptionModal").on("hidden.bs.modal",function(){Y("main_object_properties_tab")});
a.$on("objectSvc:deviceMetadataMeasuresLoaded",function(){X=c.getDeviceMetadataMeasures()});(function(){e.get("../api/subscr/vcookie/widgets/list").then(function(b){a.data.heatWidgetList=[];a.data.hwWidgetList=[];a.data.cwWidgetList=[];a.data.elWidgetList=[];if(!angular.isArray(b.data))return!1;b.data.forEach(function(b){switch(b.contServiceType){case "heat":a.data.heatWidgetList.push(b);break;case "hw":a.data.hwWidgetList.push(b);break;case "cw":a.data.cwWidgetList.push(b);break;case "el":a.data.elWidgetList.push(b)}});
P.widgets={};0<a.data.heatWidgetList.length&&(P.widgets.heat=a.data.heatWidgetList[0].widgetName,a.data.heatWidgetList.some(function(a){if(!0===a.isDefault)return P.widgets.heat=a.widgetName,!0}));0<a.data.hwWidgetList.length&&(P.widgets.hw=a.data.hwWidgetList[0].widgetName,a.data.hwWidgetList.some(function(a){if(!0===a.isDefault)return P.widgets.hw=a.widgetName,!0}));0<a.data.cwWidgetList.length&&(P.widgets.cw=a.data.cwWidgetList[0].widgetName,a.data.cwWidgetList.some(function(a){if(!0===a.isDefault)return P.widgets.cw=
a.widgetName,!0}));0<a.data.elWidgetList.length&&(P.widgets.el=a.data.elWidgetList[0].widgetName,a.data.elWidgetList.some(function(a){if(!0===a.isDefault)return P.widgets.el=a.widgetName,!0}));O()},K)})();0==a.objectCtrlSettings.isTreeView?T():c.loadDefaultTreeSetting().then(ea,K);X=c.getDeviceMetadataMeasures()}]);app=angular.module("portalNMC");
app.controller("SettingsProgramCtrl",["$rootScope","$scope","$http","notificationFactory","mainSvc","$timeout",function(a,b,d,g,l,k){function h(){k(function(){b.data.modifySettings.forEach(function(a){if(!l.checkUndefinedNull(a.subscrPref.prefDescription)){var b=a.id;a=a.subscrPref.prefDescription;$("#prefHelpButton"+b).qtip({suppress:!1,content:{text:a,button:!0},show:{event:"click"},hide:{event:"unfocus"},style:{classes:"qtip-nmc-indicator-tooltip",width:1E3},position:{my:"bottom left",at:"top right",
target:$("#prefHelpButton"+b)}})}});$("#inputHourCountValue").inputmask();$("#inputDayCountValue").inputmask();$("#inputMapValueSUBSCR_ZOOM_MAP_PREF").inputmask();$("#inputMapValueSUBSCR_LNG_MAP_PREF").inputmask();$("#inputMapValueSUBSCR_LAT_MAP_PREF").inputmask()})}function p(a){var b=!0;l.isNumeric(a.value)||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u0414\u043b\u044f "'+a.subscrPref.caption+'" \u0432\u0432\u0435\u0434\u0435\u043d\u043e \u043d\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435.'),
b=!1);0>=a.value&&(g.errorInfo('\u041e\u0448\u0438\u0431\u043a\u0430. \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e "'+a.subscrPref.caption+'"',"\u0412\u0432\u0435\u0434\u0435\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043c\u0435\u043d\u044c\u0448\u0435 \u0438\u043b\u0438 \u0440\u0430\u0432\u043d\u043e \u043d\u0443\u043b\u044e, \u0430 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0432 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0435 \u043e\u0442 1 \u0434\u043e 100"),
b=!1);100<a.value&&(g.errorInfo('\u041e\u0448\u0438\u0431\u043a\u0430. \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e "'+a.subscrPref.caption+'"',"\u0412\u0432\u0435\u0434\u0435\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0431\u043e\u043b\u044c\u0448\u0435 100, \u0430 \u0434\u043e\u043b\u0436\u043d\u043e \u0431\u044b\u0442\u044c \u0432 \u0438\u043d\u0442\u0435\u0440\u0432\u0430\u043b\u0435 \u043e\u0442 1 \u0434\u043e 100"),
b=!1);return b}function m(){var a={};b.data.modifySettings.forEach(function(b){"SUBSCR_SMS_PREF_TYPE"==b.subscrPrefCategory&&(a[b.subscrPrefKeyname]=b)});return a}function n(){var a={};b.data.modifySettings.forEach(function(b){"SUBSCR_MAP_PREF_TYPE"==b.subscrPrefCategory&&(a[b.subscrPrefKeyname]=b)});return a}function e(a){var b=!0;l.isNumeric(a.value)||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u0414\u043b\u044f "'+a.subscrPref.caption+'" \u0432\u0432\u0435\u0434\u0435\u043d\u043e \u043d\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435.'),
b=!1);return b}function c(a){return!l.checkUndefinedNull(a)&&1==a.SUBSCR_SMS_PREF.isActive}function f(a){return!l.checkUndefinedNull(a)&&1==a.SUBSCR_MAP_PREF.isActive}function r(){var a=m(),b=n();if(!c(a)&&!f(b))return!0;var d=!0;if(c(a)){var d=a.SUBSCR_SMS_PREF.value,h=!0;l.checkUndefinedNull(d)||""==d?(g.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435",'\u041f\u043e\u043b\u0435 "URL \u0441\u0435\u0440\u0432\u0438\u0441\u0430 \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0421\u041c\u0421" \u043d\u0435\u0437\u0430\u043f\u043e\u043b\u043d\u0435\u043d\u043e!'),
d=!1):(-1>=d.indexOf("##PHONE##")&&(g.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435","\u0412 url \u0430\u0434\u0440\u0435\u0441\u0435 \u0441\u0435\u0440\u0432\u0438\u0441\u0430 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 '##PHONE##' - \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u043d\u0430 \u043c\u0435\u0441\u0442\u043e \u043f\u043e\u0434\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0442\u0435\u043b\u0435\u0444\u043e\u043d\u043d\u043e\u0433\u043e \u043d\u043e\u043c\u0435\u0440\u0430."),
h=!1),-1>=d.indexOf("##MSG##")&&(g.errorInfo("\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435","\u0412 url \u0430\u0434\u0440\u0435\u0441\u0435 \u0441\u0435\u0440\u0432\u0438\u0441\u0430 \u043e\u0442\u0441\u0443\u0442\u0441\u0442\u0432\u0443\u0435\u0442 '##MSG##' - \u0443\u043a\u0430\u0437\u0430\u0442\u0435\u043b\u044c \u043d\u0430 \u043c\u0435\u0441\u0442\u043e \u043f\u043e\u0434\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0442\u0435\u043a\u0441\u0442\u0430 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u044f."),
h=!1),d=h);a=p(a.SUBSCR_DAY_COUNT_SMS_PREF)&p(a.SUBSCR_HOUR_COUNT_SMS_PREF);d&=a}a=!0;f(b)&&(a=b.SUBSCR_ZOOM_MAP_PREF,h=!0,l.isNumeric(a.value)||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u0414\u043b\u044f "'+a.subscrPref.caption+'" \u0432\u0432\u0435\u0434\u0435\u043d\u043e \u043d\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435.'),h=!1),0>a.value&&(g.errorInfo('\u041e\u0448\u0438\u0431\u043a\u0430. \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e "'+
a.subscrPref.caption+'"',"\u0412\u0432\u0435\u0434\u0435\u043d\u043d\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043c\u0435\u043d\u044c\u0448\u0435 \u043d\u0443\u043b\u044f"),h=!1),a=h&e(b.SUBSCR_LNG_MAP_PREF)&e(b.SUBSCR_LAT_MAP_PREF));return d&&a}b.testData={};b.testData.smsSetting={isActive:!0,subscrPrefCategory:"SUBSCR_SMS_PREF",subscrPref:{caption:"URL \u0441\u0435\u0440\u0432\u0438\u0441\u0430 \u0434\u043b\u044f \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0438 \u0421\u041c\u0421",
isActiveCaption:"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0443 \u0421\u041c\u0421",placeholder:"https://service/send.php?login=<\u041b\u043e\u0433\u0438\u043d>&psw=<\u041f\u0430\u0440\u043e\u043b\u044c>&phones=##PHONE##&mes=##MSG##",keyname:"SMS_PREF",prefName:"SMS_PREF"},dayCountValue:20,hourCountValue:10};a.ctxId="program_tree_settings_page";b.ctrlSettings={};b.ctrlSettings.settingsUrl="../api/subscr/subscrPrefValues";b.ctrlSettings.isSaving=
!1;b.data={};b.data.originalSettings=[];b.data.modifySettings=[];b.data.items=[];b.data.items.trees=[{name:"\u0414\u0435\u04401"},{name:"\u0414\u0435\u04402"}];var q=function(a){b.ctrlSettings.isSaving=!1;a=l.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};b.setActiveFlagForSmsSetting=function(a){b.data.modifySettings.forEach(function(b){if("SUBSCR_DAY_COUNT_SMS_PREF"==b.subscrPrefKeyname||"SUBSCR_HOUR_COUNT_SMS_PREF"==b.subscrPrefKeyname)b.isActive=a})};b.setActiveFlagForMapSetting=
function(a){b.data.modifySettings.forEach(function(b){if("SUBSCR_LNG_MAP_PREF"==b.subscrPrefKeyname||"SUBSCR_LAT_MAP_PREF"==b.subscrPrefKeyname||"SUBSCR_ZOOM_MAP_PREF"==b.subscrPrefKeyname)b.isActive=a})};var v=function(a){angular.isArray(a)&&a.forEach(function(a){l.isNumeric(a.value)&&(a.value=Number(a.value))});b.data.originalSettings=angular.copy(a);b.data.modifySettings=angular.copy(a);h()},t=function(a){if(l.checkUndefinedNull(a))return console.log("subscrPrefKey is undefined or null"),!1;d.get(b.ctrlSettings.settingsUrl+
"/objectTreeTypes?subscrPrefKeyname="+a).success(function(c){b.data.items[a]=angular.copy(c)}).error(q)};b.checkSMSUrl=function(a){var b=!0;if(l.checkUndefinedNull(a)||""==a)return!1;-1>=a.indexOf("##PHONE##")&&(b=!1);-1>=a.indexOf("##MSG##")&&(b=!1);return b};b.checkAttemptionCount=function(a){var b=!0;if(!l.isNumeric(a)||0>=a||100<a)b=!1;return b};b.checkPositiveNumberValue=function(a){return l.checkPositiveNumberValue(a)};b.isNumeric=function(a){return l.isNumeric(a)};b.saveSettings=function(){if(0==
r())return!1;b.ctrlSettings.isSaving=!0;d.put(b.ctrlSettings.settingsUrl,b.data.modifySettings).success(function(a){b.ctrlSettings.isSaving=!1;g.success();v(a)}).error(q)};b.cancelSettings=function(){b.data.modifySettings=angular.copy(b.data.originalSettings);h()};b.setOrderBy=function(a){b.ctrlSettings.orderBy.field=a;b.ctrlSettings.orderBy.asc=!b.ctrlSettings.orderBy.asc};b.selectItem=function(a){b.currentNotice=angular.copy(a)};b.isAdmin=function(){return l.isAdmin()};b.isDisabled=function(){return!b.isAdmin()||
1==b.ctrlSettings.isSaving};b.isSystemViewInfo=function(){return l.getViewSystemInfo()};(function(){d.get(b.ctrlSettings.settingsUrl).success(function(a){angular.isArray(a)&&a.forEach(function(a){"SUBSCR_OBJECT_TREE"==a.subscrPrefCategory&&t(a.subscrPrefKeyname)});v(a)}).error(q)})()}]);angular.module("portalNMC").controller("SettingsTenantsCtrl",["$scope","$rootScope","$routeParams","$resource","$cookies","$compile","$parse","crudGridDataFactory","notificationFactory","$http","subscrCabinetsSvc","mainSvc","$timeout","$window","objectSvc","meterPeriodsSvc",function(a,b,d,g,l,k,h,p,m,n,e,c,f,r,q,v){function t(){$("body").removeClass("printSelected");$(".printSelection").remove()}function u(a,b){a.some(function(a){if(a.contObjectInfo.contObjectId===b.contObjectId&&!c.checkUndefinedNull(b.meterPeriodSettings))return a.meterPeriodSettings=
b.meterPeriodSettings,!0})}function w(b){u(a.objects,b);u(a.objectsOnPage,b)}function x(b){console.log(b);if(c.checkUndefinedNull(b)||c.checkUndefinedNull(b.data))return console.log("successGetMeterPeriodByObjectCallback: response is empty!"),!1;w(b.data);a.data.resourceSystems.forEach(function(a){c.checkUndefinedNull(b.data.meterPeriodSettings)||c.checkUndefinedNull(b.data.meterPeriodSettings[a.keyname])||(a.value=b.data.meterPeriodSettings[a.keyname])});!0===S&&$("#nmcMeterPeriodsModal").modal()}
function E(){q.loadObjectMeterPeriods().then(function(a){a.data.forEach(function(a){w(a)})},L)}function G(a){var b={};a.forEach(function(a){c.checkUndefinedNull(a.value)||(c.checkUndefinedNull(b.meterPeriodSettings)&&(b.meterPeriodSettings={}),b.meterPeriodSettings[a.keyname]=a.value)});return b.meterPeriodSettings}function C(a){if(!angular.isArray(a))return console.log("Meter period data for resource systems is incorrect."),!1;var b=R();if(0===b.length)return"Cabinet array is empty.";a={contObjectIds:b,
meterPeriodSettings:G(a)};if(c.checkUndefinedNull(a.meterPeriodSettings))return console.log("Meter period settings is incorrect."),!1;q.setMeterPeriods(a).then(function(a){console.log(a);if(c.checkUndefinedNull(a)||c.checkUndefinedNull(a.data)||!angular.isArray(a.data))return console.log("Success callback for setMeterPeriods: response is empty!"),!1;a.data.forEach(function(a){w(a)})},L)}function A(b){var d={};if(c.checkUndefinedNull(a.data.currentObjectData)||c.checkUndefinedNull(a.data.currentObjectData.contObjectInfo)||
c.checkUndefinedNull(a.data.currentObjectData.contObjectInfo.contObjectId))return console.log("Current object data is incorrect."),!1;if(!angular.isArray(b))return console.log("Meter period data for resource systems is incorrect."),!1;d.contObjectId=a.data.currentObjectData.contObjectInfo.contObjectId;d.meterPeriodSettings=G(b);if(c.checkUndefinedNull(d.meterPeriodSettings))return console.log("Meter period settings is incorrect."),!1;q.setMeterPeriodForObject(d).then(function(a){console.log(a);S=
!1;q.getMeterPeriodByObject(a.data.id).then(x,L)},L)}b.ctxId="settings_tenants_page";var z=[{keyname:"heat",caption:"\u0421\u0438\u0441\u0442\u0435\u043c\u0430 \u043e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u044f",shortCaption:"\u0421\u041e"},{keyname:"hw",caption:"\u0413\u043e\u0440\u044f\u0447\u0435\u0435 \u0432\u043e\u0434\u043e\u0441\u043d\u0430\u0431\u0436\u0435\u043d\u0438\u0435",shortCaption:"\u0413\u0412\u0421"},{keyname:"cw",caption:"\u0425\u043e\u043b\u043e\u0434\u043d\u043e\u0435 \u0432\u043e\u0434\u043e\u0441\u043d\u0430\u0431\u0436\u0435\u043d\u0438\u0435",
shortCaption:"\u0425\u0412\u0421"},{keyname:"el",caption:"\u042d\u043b\u0435\u043a\u0442\u0440\u043e\u044d\u043d\u0435\u0440\u0433\u0438\u044f",shortCaption:"\u042d\u043b-\u0432\u043e"}];a.messages={};a.messages.createTenants="\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439";a.messages.recreateTenantPasswords="\u041f\u0435\u0440\u0435\u0441\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u0438";a.messages.sendLoginInfoByEmail=
"\u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043d\u0430 \u044d\u043b. \u043f\u043e\u0447\u0442\u0443";a.messages.deleteLogins="\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439";a.messages.deleteLogin="\u0423\u0434\u0430\u043b\u0438\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f";a.messages.viewProps="\u0414\u0430\u043d\u043d\u044b\u0435 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f";
a.messages.createTenant="\u0421\u043e\u0437\u0434\u0430\u0442\u044c \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f";a.messages.changeTenantPassword="\u0421\u043c\u0435\u043d\u0438\u0442\u044c \u043f\u0430\u0440\u043e\u043b\u044c";a.messages.meterPeriods="\u041e\u0442\u0447\u0435\u0442\u043d\u044b\u0435 \u043f\u0435\u0440\u0438\u043e\u0434\u044b";a.messages.setMeterPeriods="\u041d\u0430\u0437\u043d\u0430\u0447\u0438\u0442\u044c \u043e\u0442\u0447\u0435\u0442\u043d\u044b\u0435 \u043f\u0435\u0440\u0438\u043e\u0434\u044b";
a.messages.markAllOn="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435";a.messages.markAllOff="\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435";a.messages.moveToNode="\u041f\u0440\u0438\u0432\u044f\u0437\u0430\u0442\u044c \u043a \u0443\u0437\u043b\u0443";a.messages.releaseFromNode="\u041e\u0442\u0432\u044f\u0437\u0430\u0442\u044c \u043e\u0442 \u0443\u0437\u043b\u0430";a.objectCtrlSettings={};a.objectCtrlSettings.isCtrlEnd=!1;a.objectCtrlSettings.allSelected=!1;a.objectCtrlSettings.anySelected=
!1;a.objectCtrlSettings.objectsPerScroll=q.OBJECT_PER_SCROLL;a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;a.objectCtrlSettings.vzletSystemList=[];a.objectCtrlSettings.extendedInterfaceFlag=!0;a.objectCtrlSettings.serverTimeZone=3;a.objectCtrlSettings.dateFormat="DD.MM.YYYY";a.objectCtrlSettings.ctxId="settings_tenants_2nd_menu_item";a.objectCtrlSettings.rmaUrl="../api/rma";var H=function(){c.getContextIds().forEach(function(a){var b=document.getElementById(a.permissionTagId);
angular.isUndefined(b)||null==b||$("#"+a.permissionTagId).removeClass("nmc-hide")})};H();b.$on("servicePermissions:loaded",function(){H()});a.data={};a.data.resourceSystems=[];a.object={};a.objects=[];a.objectsOnPage=[];a.currentSug=null;var D=function(d){var J=d.data,f=angular.copy(a.objects);angular.isArray(f)&&0<f.length&&J.forEach(function(a,b){f.some(function(b){if(b.contObjectInfo.contObjectId==a.contObjectInfo.contObjectId)return c.checkUndefinedNull(b.selected)||(a.selected=b.selected),!0})});
a.objects=d.data;e.sortCabinetsByContObjectFullName(a.objects);angular.isUndefined(a.filter)||""===a.filter?(a.objectsWithoutFilter=a.objects,a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,J=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll),a.objectsOnPage=J,b.$broadcast("subscrCabinets:loaded")):a.searchObjects(a.filter);a.loading=!1;$("#deleteCabinetModal").modal("hide");E()},I=function(a){D(a);m.success()},B=function(b){var d=angular.copy(b.data),e=-1;a.objects.some(function(a,
b){if(c.checkUndefinedNull(a.cabinet)||c.checkUndefinedNull(a.cabinet.subscrUser))return!1;if(a.cabinet.subscrUser.id==d.id)return e=b,!0});-1<e&&(a.objects[e].cabinet.subscrUser=d);e=-1;a.objectsOnPage.some(function(a,b){if(c.checkUndefinedNull(a.cabinet)||c.checkUndefinedNull(a.cabinet.subscrUser))return!1;if(a.cabinet.subscrUser.id==d.id)return e=b,!0});-1<e&&(a.objectsOnPage[e].cabinet.subscrUser=d);$("#createPasswordModal").modal("hide");$("#showTenantOptionModal").modal("hide");m.success()},
O=function(c){b.$broadcast("subscrCabinets:requestReloadCabinetsData");a.loading=!0;e.getPromise().then(D)};a.selectCabinet=function(b){a.data.selectedCabinet=angular.copy(b)};a.loading=e.getLoadingStatus();a.columns=[{name:"fullName",header:"\u041d\u0430\u0437\u0432\u0430\u043d\u0438\u0435","class":"col-xs-5"},{name:"fullAddress",header:"\u0410\u0434\u0440\u0435\u0441","class":"col-xs-5"}];a.captions={loading:"loading",totalElements:"totalElements"};a.extraProps={idColumnName:"id",defaultOrderBy:"fullName",
nameColumnName:"fullName"};a.addMode=!1;a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.filter="";a.filterType="";a.bGroupByObject=!1;a.bObject=!1;a.bList=!0;var Q=function(b){a.confirmCode=null;b=c.getConfirmCode(b);a.confirmLabel=b.label;a.sumNums=b.result},N=function(a){console.log(a);if(!c.checkUndefinedNull(a)&&!c.checkUndefinedNull(a.status)&&406===a.status)return m.warning("\u041d\u0435 \u0432\u0441\u0435 \u043a\u0430\u0431\u0438\u043d\u0435\u0442\u044b \u0431\u044b\u043b\u0438 \u0441\u043e\u0437\u0434\u0430\u043d\u044b."),
D(a),!0;var b="-1";if(c.checkUndefinedNull(a)||c.checkUndefinedNull(a.data))b="ERR_CONNECTION";c.checkUndefinedNull(a)||c.checkUndefinedNull(a.resultCode)&&(c.checkUndefinedNull(a.data)||c.checkUndefinedNull(a.data.resultCode))||(b=a.resultCode||a.data.resultCode);a=c.getServerErrorByResultCode(b);m.errorInfo(a.caption,a.description)},L=function(a){N(a)},R=function(){var b=[];a.objects.forEach(function(a){1==a.selected&&b.push(a.contObjectInfo.contObjectId)});return b},Y=function(){var b=[],d=[],
d=a.objects;d.forEach(function(a){1==a.selected&&(c.checkUndefinedNull(a.cabinet)||b.push(a.cabinet.id))});return b},X=function(){var b=[],d=[],d=a.objects;d.forEach(function(a){1==a.selected&&(c.checkUndefinedNull(a.cabinet)||c.checkUndefinedNull(a.cabinet.subscrUser)||b.push(a.cabinet.subscrUser.id))});return b};a.createCabinets=function(a){var b=[];c.checkUndefinedNull(a)?b=R():b.push(a.contObjectInfo.contObjectId);if(0==b.length)return"Cabinet array is empty.";e.createCabinets(b).then(I,L)};a.deleteCabinetsInit=
function(b){Q();a.data.selectedCabinet={};var d=[];c.checkUndefinedNull(b)?d=Y():(a.selectCabinet(b),c.checkUndefinedNull(b.cabinet)||d.push(b.cabinet.id));a.data.selectedCabinet.cabinetsIdsForDelete=d};a.deleteCabinets=function(a){if(0==a.cabinetsIdsForDelete.length)return"Cabinet array is empty.";e.deleteCabinets(a.cabinetsIdsForDelete).then(I,L)};a.resetPasswords=function(b){a.data.selectedCabinet={};var d=[];c.checkUndefinedNull(b)?d=X():(a.selectCabinet(b),c.checkUndefinedNull(b.cabinet)||d.push(b.cabinet.subscrUser.id));
e.resetPassword(d).then(I,L)};a.checkPasswordFields=function(b){if(c.checkUndefinedNull(b)||c.checkUndefinedNull(b.cabinet)||c.checkUndefinedNull(b.cabinet.subscrUser))return!1;var d=!0;a.emptyString(b.cabinet.subscrUser.passwordPocket)&&(d=!1);b.cabinet.subscrUser.passwordPocket!=b.cabinet.subscrUser.passwordPocketConfirm&&(d=!1);return d};a.checkPassword=function(b){if(c.checkUndefinedNull(b)||c.checkUndefinedNull(b.cabinet)||c.checkUndefinedNull(b.cabinet.subscrUser))return!1;var d=!0;a.emptyString(b.cabinet.subscrUser.passwordPocket)&&
(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041f\u0430\u0440\u043e\u043b\u044c \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c!"),d=!1);b.cabinet.subscrUser.passwordPocket!=b.cabinet.subscrUser.passwordPocketConfirm&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",'\u041f\u043e\u043b\u044f "\u041f\u0430\u0440\u043e\u043b\u044c" \u0438 "\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u043f\u0430\u0440\u043e\u043b\u044f" \u043d\u0435 \u0441\u043e\u0432\u043f\u0430\u0434\u0430\u044e\u0442!'),
d=!1);return d};a.updateCabinet=function(a,b){if(c.checkUndefinedNull(b)||1!=b)a.cabinet.subscrUser.passwordPocket=null;e.updateCabinet(a).then(B,L)};a.createPassword=function(b){if(c.checkUndefinedNull(b))return"Cabinet is null or undefined.";if(0==a.checkPassword(b))return"User password is incorrect!";a.updateCabinet(b,!0)};var da=function(a,b){var d=!0;c.checkUndefinedNull(a.cabinet.subscrUser.contactEmail)&&(1==b&&m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u044d\u043b. \u043f\u043e\u0447\u0442\u0430 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f"),
d=!1);return d},F=function(){var b="\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439:\n";a.objects.forEach(function(a){1!=a.selected||da(a,!1)||(b+="- "+a.cabinet.subscrCabinetNr+"\n")});"\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439:\n"!=b&&(b="\u0423 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u044d\u043b. \u043f\u043e\u0447\u0442\u0430. \u041e\u0442\u043f\u0440\u0430\u0432\u0438\u0442\u044c \u0438\u043c \u043f\u0438\u0441\u044c\u043c\u0430 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e. \u0417\u0430\u0434\u0430\u0439\u0442\u0435 \u0438\u043c \u044d\u043b. \u043f\u043e\u0447\u0442\u0443 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443.",
m.warning(b))},T=function(a,b){var d=!0;c.checkUndefinedNull(a.cabinet.subscrUser.passwordPocket)&&(1==b&&m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f \u043f\u0430\u0440\u043e\u043b\u044c \u0431\u044b\u043b \u0438\u0437\u043c\u0435\u043d\u0435\u043d. \u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u043d\u0430 \u044d\u043b. \u043f\u043e\u0447\u0442\u0443 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430. \u0415\u0441\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u044c \u0431\u044b\u043b \u0443\u0442\u0435\u0440\u044f\u043d, \u0442\u043e \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0439\u0442\u0435 \u0435\u043c\u0443 \u043d\u043e\u0432\u044b\u0439 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443."),
d=!1);return d},M=function(){var b="\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439:\n";a.objects.forEach(function(a){1!=a.selected||T(a,!1)||(b+="- "+a.cabinet.subscrCabinetNr+"\n")});"\u0423 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439:\n"!=b&&(b="\u0423 \u043d\u0435\u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u0435\u0439 \u043f\u0430\u0440\u043e\u043b\u0438 \u0431\u044b\u043b\u0438 \u0438\u0437\u043c\u0435\u043d\u0435\u043d\u044b. \u041e\u0442\u043f\u0440\u0430\u0432\u043a\u0430 \u043d\u0430 \u044d\u043b. \u043f\u043e\u0447\u0442\u0443 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u0430. \u0415\u0441\u043b\u0438 \u043f\u0430\u0440\u043e\u043b\u0438 \u0431\u044b\u043b\u0438 \u0443\u0442\u0435\u0440\u044f\u043d\u044b, \u0442\u043e \u0441\u0433\u0435\u043d\u0435\u0440\u0438\u0440\u0443\u0439\u0442\u0435 \u0438\u043c \u043d\u043e\u0432\u044b\u0435 \u0438 \u043f\u043e\u0432\u0442\u043e\u0440\u0438\u0442\u0435 \u043e\u0442\u043f\u0440\u0430\u0432\u043a\u0443.",
m.warning(b))};a.sendLDByEmail=function(b){a.data.selectedCabinet={};var d=[];if(c.checkUndefinedNull(b))M(),F(),d=X();else{if(!T(b,!0)||!da(b,!0))return"User data is incorrect!";a.selectCabinet(b);c.checkUndefinedNull(b.cabinet)||d.push(b.cabinet.subscrUser.id)}e.sendLDByEmail(d).then(function(){m.success()},L)};var U=function(a,b){var c=-1;b.some(function(b,d){if(b.id==a)return c=d,!0});return c},V=function(a,b){var c=U(a,b);-1!=c&&b.splice(c,1)},aa=function(a,b){m.success();$("#deleteObjectModal").modal("hide");
$("#showObjOptionModal").modal("hide");$("#setClientModal").modal("hide")},W=function(c){b.$broadcast("subscrCabinets:requestReloadCabinetsData");a.currentObject._activeContManagement=c._activeContManagement;var d;d=U(c.id,a.objects);null!=d&&(a.objects[d]=c);d=U(c.id,a.objectsOnPage);null!=d&&(a.objectsOnPage[d]=c);aa(c,null)},K=function(b,c){V(a.currentObject.id,a.objects);V(a.currentObject.id,a.objectsOnPage);aa(b,null)},ga=function(b,c){a.currentObject.deleteObjectIds.forEach(function(b){V(b,
a.objects);V(b,a.objectsOnPage)});aa(b,null)},ha=function(b){aa(b,null);0==a.objectCtrlSettings.isTreeView||c.checkUndefinedNull(a.data.currentTree)?O(b.id):c.checkUndefinedNull(a.data.selectedNode.type)||"root"!=a.data.selectedNode.type?(a.data.selectedNodeForMove=angular.copy(a.data.selectedNode),a.data.treeForMove=angular.copy(a.data.currentTree),a.data.treeForMove.childObjectList.shift(),a.data.treeForMove.movingObjects=[b.id],a.moveToNode()):a.loadTree(a.data.currentTree,b.id)};a.addObject=function(b,
d){angular.isDefined(d.contManagementId)&&null!=d.contManagementId&&(b+="/?cmOrganizationId="+d.contManagementId);d._daDataSraw=null;c.checkUndefinedNull(a.currentSug)||(d._daDataSraw=JSON.stringify(a.currentSug));p(b).save(d,ha,L)};a.deleteObject=function(b){var c=e.getRmaObjectsUrl();angular.isDefined(b)&&angular.isDefined(b.id)&&null!=b.id&&p(c)["delete"]({id:b[a.extraProps.idColumnName]},K,L)};a.deleteObjects=function(b){var c=e.getRmaObjectsUrl();angular.isDefined(b)&&angular.isDefined(b.id)&&
null!=b.id?p(c)["delete"]({id:b[a.extraProps.idColumnName]},K,L):angular.isDefined(b.deleteObjects)&&null!=b.deleteObjects&&angular.isArray(b.deleteObjects)&&p(c)["delete"]({contObjectIds:b.deleteObjectIds},ga,L)};a.updateObject=function(b,d){var e={id:d[a.extraProps.idColumnName]};angular.isDefined(d.contManagementId)&&null!=d.contManagementId&&(e={cmOrganizationId:d.contManagementId});d._daDataSraw=null;c.checkUndefinedNull(a.currentSug)||(d._daDataSraw=JSON.stringify(a.currentSug));p(b).update(e,
d,W,L)};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};a.sendObjectToServer=function(b){var c=b.isSaving=!0;a.emptyString(b.fullName)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u0430!"),c=!1);a.emptyString(b.timezoneDefKeyname)&&1!=b.isLightForm&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0447\u0430\u0441\u043e\u0432\u043e\u0439 \u043f\u043e\u044f\u0441 \u043e\u0431\u044a\u0435\u043a\u0442\u0430!"),c=!1);a.checkUndefinedNull(b.contManagementId)&&1!=b.isLightForm&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u0430 \u0443\u043f\u0440\u0430\u0432\u043b\u044f\u044e\u0449\u0430\u044f \u043a\u043e\u043c\u043f\u0430\u043d\u0438\u044f!"),c=!1);a.emptyString(b.currentSettingMode)&&1!=b.isLightForm&&
(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0440\u0435\u0436\u0438\u043c \u0444\u0443\u043d\u043a\u0446\u0438\u043e\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f!"),c=!1);if(!c)return b.isSaving=!1;c=e.getRmaObjectsUrl();angular.isDefined(b.id)&&null!=b.id?a.updateObject(c,b):a.addObject(c,b)};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b};var ba=function(){a.currentObject.geoState="red";a.currentObject.geoStateText="\u041d\u0435 \u043e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u0430\u0440\u0442\u0435";
if(a.currentObject.isValidGeoPos||!c.checkUndefinedNull(a.currentSug)&&null!=a.currentSug.data.geo_lat&&null!=a.currentSug.data.geo_lon)a.currentObject.geoState="green",a.currentObject.geoStateText="\u041e\u0442\u043e\u0431\u0440\u0430\u0436\u0430\u0435\u0442\u0441\u044f \u043d\u0430 \u043a\u0430\u0440\u0442\u0435"};a.selectedObject=function(b,d){e.getRmaObject(b).then(function(b){a.currentObject=b.data;angular.isDefined(a.currentObject._activeContManagement)&&null!=a.currentObject._activeContManagement&&
(a.currentObject.contManagementId=a.currentObject._activeContManagement.organization.id);c.checkUndefinedNull(d)||(a.currentObject.isLightForm=d);ba()},function(a){console.log(a)})};a.toggleShowGroupDetails=function(b){b=e.findObjectById(b,a.objects);null!=b&&(b.showGroupDetails=1==b.showGroupDetails?!0:!b.showGroupDetails)};a.dateFormat=function(b){b=new Date(b+Math.round(36E5*a.objectCtrlSettings.serverTimeZone));return null==b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]).format(a.objectCtrlSettings.dateFormat)};
a.onlyNoRead=!1;a.showRow=function(b){return"undefined"!=typeof b.isRead||a.onlyNoRead?a.onlyNoRead&&a.onlyNoRead!=!b.isRead?!1:!0:!0};a.showDetails=function(b){a.bdirectories&&(a.currentObject=b,$("#showDirectoryStructModal").modal())};a.emptyString=function(a){return c.checkUndefinedEmptyNullValue(a)};a.checkUndefinedNull=function(a){return c.checkUndefinedNull(a)};a.searchObjects=function(b){if(!(0>=a.objects.length)){var c=[];angular.isUndefined(b)||""===b?(c=[],a.objectCtrlSettings.objectsOnPage=
a.objectCtrlSettings.objectsPerScroll,c=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll)):(c=[],a.objects.forEach(function(a){angular.isDefined(a.contObjectInfo.fullName)&&-1!=a.contObjectInfo.fullName.toUpperCase().indexOf(b.toUpperCase())&&c.push(a)}));a.objectsOnPage=c}};a.$on("$destroy",function(){window.onkeydown=void 0});window.onkeydown=function(b){var c=null;38==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop-=20):40==b.keyCode?(c=document.getElementById("divWithObjectTable"),
c.scrollTop+=20):34==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop+=10*a.objectCtrlSettings.objectsPerScroll):33==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop-=10*a.objectCtrlSettings.objectsPerScroll):b.ctrlKey&&36==b.keyCode?(c=document.getElementById("divWithObjectTable"),c.scrollTop=0):b.ctrlKey&&35==b.keyCode&&(a.objectCtrlSettings.objectsOnPage<a.objects.length&&(a.loading=!0,f(function(){a.loading=!1},a.objects.length)),b=a.objects.slice(a.objectCtrlSettings.objectsOnPage,
a.objects.length),Array.prototype.push.apply(a.objectsOnPage,b),a.objectCtrlSettings.objectsOnPage+=a.objects.length,a.$apply(),c=document.getElementById("divWithObjectTable"),c.scrollTop=c.scrollHeight)};a.addMoreObjects=function(){if(!(0>=a.objects.length)){var b=a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll;b>=a.objects.length&&(b=a.objects.length);var c=a.objects.slice(a.objectCtrlSettings.objectsOnPage,b);Array.prototype.push.apply(a.objectsOnPage,c);a.objectCtrlSettings.objectsOnPage=
b>=a.objects.length?a.objects.length:a.objectCtrlSettings.objectsOnPage+a.objectCtrlSettings.objectsPerScroll}};$("#divWithObjectTable").scroll(function(){if(angular.isUndefined(a.filter)||""==a.filter)a.addMoreObjects(),a.$apply()});a.isSystemuser=function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};a.isSystemViewInfo=function(){return c.getViewSystemInfo()};a.toggleObjects=function(b){a.objectCtrlSettings.anySelected=b;a.objects.forEach(function(a){a.selected=
b});a.objectsOnPage.forEach(function(a){a.selected=b})};a.toggleObject=function(b){var c=!1;a.objectsOnPage.some(function(a){if(1==a.selected)return c=!0});a.objectCtrlSettings.anySelected=1==c?!0:!1};a.invokeHelp=function(){alert("This is SPRAVKA!!!111")};a.deleteObjectInit=function(b){a.selectedItem(b);Q()};a.addObjectInit=function(b){a.currentObject={};a.currentObject.isLightForm=b;ba();$("#showObjOptionModal").modal();$("#showObjOptionModal").css("z-index","1041")};a.deleteObjectsInit=function(){Q();
a.currentObject={};var b=[];if(1==a.objectCtrlSettings.allSelected)b=a.objects,a.currentObject.deleteObjects=angular.copy(a.objects),a.currentObject.deleteObjectIds=a.objects.map(function(a){return a.id}),a.currentObject.countDeleteObjects=a.objects.length,$("#deleteObjectModal").modal();else{var b=a.objectsOnPage,c=0,d=[],e=[];b.forEach(function(a){1==a.selected&&(d.push(angular.copy(a)),e.push(a.id),c+=1)});0<c&&(a.currentObject.deleteObjects=d,a.currentObject.deleteObjectIds=e,a.currentObject.countDeleteObjects=
c,$("#deleteObjectModal").modal())}};a.checkEmptyNullValue=function(a){return""===a||null==a?!0:!1};a.checkNumericValue=function(b){return a.checkEmptyNullValue(b)?!0:isNaN(parseFloat(b))||!isFinite(b)?!1:!0};a.checkPositiveNumberValue=function(b){var c;c=a.checkNumericValue(b);return c?c=0<=parseInt(b,10)?!0:!1:c};a.checkNumericInterval=function(b,c){return a.checkEmptyNullValue(b)||a.checkEmptyNullValue(c)||!a.checkNumericValue(b)||!a.checkNumericValue(c)?!1:parseInt(c,10)>=parseInt(b,10)?!0:!1};
a.checkHHmm=function(a){return/(0[0-9]|1[0-9]|2[0-3]){1,2}:([0-5][0-9]){1}/.test(a)?!0:!1};a.checkObjectPropertiesForm=function(b){return null!=b&&b.hasOwnProperty("cwTemp")&&b.hasOwnProperty("heatArea")?a.checkNumericValue(b.cwTemp)&&a.checkNumericValue(b.heatArea):!0};$(document).ready(function(){$("#inputTSNumber").inputmask();$("#inputEXCode").inputmask();$("#inputObjAddress").suggestions({serviceUrl:"https://dadata.ru/api/v2",token:"f9879c8518e9c9e794ff06a6e81eebff263f97d5",type:"ADDRESS",count:10,
onSelect:function(b){a.currentObject.fullAddress=b.value;a.currentSug=b;a.currentObject.isAddressAuto=!0;ba();a.$apply()},onSearchComplete:function(a,b){}});$("#inputObjAddress").change(function(){a.currentSug=null;a.currentObject.isAddressAuto=!1;a.currentObject.isValidGeoPos=!1;ba();a.$apply()})});$("#showObjOptionModal").on("hidden.bs.modal",function(){a.currentObject.isSaving=!1;a.currentSug=null});a.data.treeTemplates=e.getRmaTreeTemplates();a.objectCtrlSettings.treeSettings={};a.objectCtrlSettings.treeSettings.nodesPropName=
"childObjectList";a.data.currentDeleteMessage="";var ca={objectName:"",type:"root",childObjectList:[]};a.objectCtrlSettings.isTreeView=!1;a.data.currentTree={};a.data.newTree={};a.findNodeInTree=function(a,b){return c.findNodeInTree(a,b)};a.selectNode=function(b){var d=a.data.currentTree,f=a.data.selectedNode;if(1==a.objectCtrlSettings.isObjectMoving){d=a.data.treeForMove;if(c.checkUndefinedNull(a.data.selectedNodeForMove)){b.isSelected=!0;a.data.selectedNodeForMove=angular.copy(b);return}f=a.data.selectedNodeForMove}f.id!=
b.id&&f.type==b.type!="root"&&(c.checkUndefinedNull(f)||(d=c.findNodeInTree(f,d),c.checkUndefinedNull(d)||(d.isSelected=!1)),b.isSelected=!0,1==a.objectCtrlSettings.isObjectMoving?a.data.selectedNodeForMove=angular.copy(b):(a.data.selectedNode=angular.copy(b),a.loading=!0,"root"==b.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(D):e.loadObjectsByTreeNode(a.data.currentTree.id,b.id).then(D)))};a.data.trees=[];a.loadTree=function(b,d){a.loading=!0;e.loadTree(b.id).then(function(d){a.messages.treeMenuHeader=
b.objectName||b.id;var f=angular.copy(d.data);f.childObjectList.unshift(angular.copy(ca));a.data.currentTree=f;f.childObjectList[0].isSelected=!0;a.data.selectedNode=angular.copy(f.childObjectList[0]);e.loadFreeObjectsByTree(b.id).then(D);if(c.checkUndefinedNull(a.data.currentTree.templateId))return"Tree is free";e.loadTreeTemplateItems(a.data.currentTree.templateId).then(function(b){a.data.currentTreeTemplateItems=angular.copy(b.data);f.childObjectList[0].templateId=a.data.currentTree.templateId;
f.childObjectList[0].templateItemId=a.data.currentTree.templateItemId},N)},N)};var ea=function(){e.loadTrees().then(function(b){c.sortItemsBy(b.data,"objectName");a.data.trees=angular.copy(b.data);if(!angular.isArray(a.data.trees)||0>=a.data.trees.length)return a.messages.treeMenuHeader="\u0412\u044b\u0431\u0435\u0440\u0435\u0442\u0435 \u0434\u0435\u0440\u0435\u0432\u043e",O(),"Object tree array is empty.";a.loadTree(a.data.trees[0])},N)},fa=function(b,d){var e;e="root"==d.type?a.data.currentTree:
d;if(c.checkUndefinedNull(e)||!angular.isArray(e.childObjectList))return"Parent is incorrect node!";e.childObjectList.push(b)},Z=function(b){var c=!0;a.emptyString(b.objectName)&&(m.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435!"),c=!1);return c},P=function(b){var c=null;a.data.currentTreeTemplateItems.some(function(a){if(b==a.id)return c=a,!0});return c},y=function(b){var c=
null;a.data.currentTreeTemplateItems.some(function(a){if(b==a.itemLevel)return c=a,!0});return c};a.saveNode=function(b,d,f){if(0==Z(b))return"Node is no correct!";fa(b,d);angular.isArray(a.data.currentTree.childObjectList)&&0<a.data.currentTree.childObjectList.length&&"root"==a.data.currentTree.childObjectList[0].type&&a.data.currentTree.childObjectList.shift();e.updateTree(a.data.currentTree).then(function(b){var e=b.data;e.childObjectList.unshift(angular.copy(ca));c.checkUndefinedNull(e.templateId)||
(e.childObjectList[0].templateId=e.templateId);c.checkUndefinedNull(e.templateItemId)||(e.childObjectList[0].templateItemId=e.templateItemId);var g=-1;a.data.trees.some(function(a,b){if(a.id==e.id)return g=b,!0});-1!=g&&(a.data.trees[g]=e,a.data.currentTree=e);if(c.checkUndefinedNull(f)||1!=f)$("#treeLevelModal").modal("hide");else{a.data.parentLevel=c.findNodeInTree(d,a.data.currentTree);a.data.currentLevel={childObjectList:[]};if(!c.checkUndefinedNull(a.data.parentLevel.templateItemId)){b=P(a.data.parentLevel.templateItemId);
b=y(b.itemLevel+1);if(null==b)return"Template item is no find.";a.data.currentLevel.objectName=b.itemName;a.data.currentLevel.templateId=b.templateId;a.data.currentLevel.templateItemId=b.id}$("#inputLevelName").focus()}},N)};a.saveTree=function(b){if(0==Z(b))return"Tree is no correct!";angular.isArray(b.childObjectList)&&0<b.childObjectList.length&&"root"==b.childObjectList[0].type&&b.childObjectList.shift();e.createTree(b).then(function(b){b=angular.copy(b.data);b.childObjectList.unshift(angular.copy(ca));
c.checkUndefinedNull(b.templateId)||(b.childObjectList[0].templateId=b.templateId);c.checkUndefinedNull(b.templateItemId)||(b.childObjectList[0].templateItemId=b.templateItemId);a.data.trees.push(b);a.loadTree(b);$("#showTreeOptionModal").modal("hide")},N)};a.removeNodeInit=function(b){a.data.currentDeleteItem=b;a.data.currentDeleteMessage="root"==b.type?a.data.currentTree.objectName||a.data.currentTree.id:b.objectName||b.id;Q(!0);a.deleteHandler=function(b){if(c.checkUndefinedNull(b))return"Deleting item is undefined or null.";
c.checkUndefinedNull(b.type)||"root"!=b.type?e.deleteTreeNode(a.data.currentTree.id,b.id).then(function(b){a.loadTree(a.data.currentTree)},L):e.deleteTree(a.data.currentTree.id).then(function(a){ea()},N);$("#deleteWindowModal").modal("hide")};$("#deleteWindowModal").modal()};a.moveToNodeInit=function(b){a.data.selectedNodeForMove=null;var d=[];c.checkUndefinedNull(b)?d=R():(a.selectedItem(b),d.push(b.id));a.data.treeForMove=angular.copy(a.data.currentTree);a.data.treeForMove.childObjectList.shift();
a.data.treeForMove.movingObjects=d};a.moveToNode=function(){e.putObjectsToTreeNode(a.data.currentTree.id,a.data.selectedNodeForMove.id,a.data.treeForMove.movingObjects).then(function(b){a.loading=!0;"root"==a.data.selectedNode.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(D):e.loadObjectsByTreeNode(a.data.currentTree.id,a.data.selectedNode.id).then(D);$("#viewTreeModal").modal("hide")},L)};a.releaseFromNode=function(b){var d=[];c.checkUndefinedNull(b)?d=R():(a.selectedItem(b),d.push(b.id));
e.releaseObjectsFromTreeNode(a.data.currentTree.id,a.data.selectedNode.id,d).then(function(b){a.loading=!0;"root"==a.data.selectedNode.type?e.loadFreeObjectsByTree(a.data.currentTree.id).then(D):e.loadObjectsByTreeNode(a.data.currentTree.id,a.data.selectedNode.id).then(D)},N)};a.toggleTreeView=function(){a.objectCtrlSettings.isTreeView=!a.objectCtrlSettings.isTreeView;0==a.objectCtrlSettings.isTreeView?O():ea()};a.createTreeByTemplate=function(b){e.loadTreeTemplateItems(b.id).then(function(c){a.data.currentTreeTemplateItems=
angular.copy(c.data);var d=null;a.data.currentTreeTemplateItems.some(function(a){if(0==a.itemLevel)return d=a,!0});if(null==d)return"Incorrect template. itemLevel == 0 is absent.";a.data.newTree={};a.data.newTree.templateId=b.id;a.data.newTree.templateItemId=d.id;a.data.newTree.objectName=d.itemName;$("#showTreeOptionModal").modal()},N)};a.addNodeDisabled=function(b){if(c.checkUndefinedNull(b.templateItemId))return!1;if(!angular.isArray(a.data.currentTreeTemplateItems))return!0;b=P(b.templateItemId);
return null==b||b.itemLevel<a.data.currentTreeTemplateItems.length-1?!1:!0};a.createNodeInit=function(b){a.data.parentLevel=b;a.data.currentLevel={childObjectList:[]};if(!c.checkUndefinedNull(b.templateItemId)){b=P(b.templateItemId);b=y(b.itemLevel+1);if(null==b)return"Template item is no find.";a.data.currentLevel.objectName=b.itemName;a.data.currentLevel.templateId=b.templateId;a.data.currentLevel.templateItemId=b.id}};$("#viewTreeModal").on("shown.bs.modal",function(){a.objectCtrlSettings.isObjectMoving=
!0;a.$apply()});$("#viewTreeModal").on("hidden.bs.modal",function(){a.objectCtrlSettings.isObjectMoving=!1;a.$apply()});a.printTenant=function(){$("body").addClass("printSelected");$("body").append("<div class='printSelection'></div>");$("#showTenantOptionModal").clone().appendTo(".printSelection");window.print();window.setTimeout(t,0)};$("#showTreeOptionModal").on("shown.bs.modal",function(){$("#inputTreeName").focus()});$("#treeLevelModal").on("shown.bs.modal",function(){$("#inputLevelName").focus()});
$("#showTenantOptionModal").on("shown.bs.modal",function(){$("#inputTenantName").focus()});$("#createPasswordModal").on("shown.bs.modal",function(){$("#inputTenantPassword").focus()});a.data.meterPeriods=[];a.data.currentObject={};var S=!1,ia=!1;a.openMeterPeriods=function(b){a.data.resourceSystems=angular.copy(z);a.data.currentObjectData=b;S=!0;ia=!1;q.getMeterPeriodByObject(b.contObjectInfo.contObjectId).then(x,L)};a.setMeterPeriodsInit=function(){ia=!0;a.data.resourceSystems=angular.copy(z);$("#nmcMeterPeriodsModal").modal()};
a.saveMeterPeriodSettings=function(a){!1===ia?A(a):!0===ia&&C(a)};v.loadMeterPeriods().then(function(b){console.log(b);if(angular.isUndefined(b)||null===b||!angular.isArray(b.data))return console.log("Meter periods is empty."),!1;a.data.meterPeriods=angular.copy(b.data)},L);0==a.objectCtrlSettings.isTreeView?O():ea()}]);app=angular.module("portalNMC");
app.controller("SettingsUsersCtrl",["$rootScope","$scope","$http","notificationFactory","crudGridDataFactory","mainSvc",function(a,b,d,g,l,k){a.ctxId="settings_users_page";b.extraProps={idColumnName:"id",defaultOrderBy:"fullName",nameColumnName:"fullName"};b.ctrlSettings={};b.ctrlSettings.orgUrl="../api/rma/contObjects/cmOrganizations";b.ctrlSettings.clientsUrl="../api/rma/subscribers";b.ctrlSettings.subscrUrl="../api/subscr";b.ctrlSettings.userUrlSuffix="/subscrUsers";b.ctrlSettings.userColumns=
[{name:"userName",caption:"\u041b\u043e\u0433\u0438\u043d","class":"col-xs-2 col-md-2"},{name:"userNickname",caption:"\u0418\u043c\u044f","class":"col-xs-3 col-md-3"},{name:"userComment",caption:"\u041a\u043e\u043c\u043c\u0435\u043d\u0442\u0430\u0440\u0438\u0439","class":"col-xs-7 col-md-7"}];b.data={};b.data.organizations=[];b.data.clients=[];b.data.users=[];b.data.currentUser={};b.data.currentClient={};var h=function(){d.get(b.ctrlSettings.subscrUrl+b.ctrlSettings.userUrlSuffix).then(function(a){a.data.forEach(function(a){if(!angular.isArray(a.subscrRoles))return a.userName+
" is have not the subscrRoles.";a.subscrRoles.some(function(b){"ROLE_SUBSCR_ADMIN"==b.roleName&&(a.isAdmin=!0);"ROLE_SUBSCR_READONLY"==b.roleName&&(a.isReadonly=!0)})});b.data.users=a.data},function(a){console.log(a)})};(function(){d.get(b.ctrlSettings.orgUrl).then(function(a){b.data.organizations=a.data;h()},function(a){console.log(a)})})();b.selectedItem=function(a){a=angular.copy(a);b.data.currentUser=a};b.addUser=function(){b.data.currentUser={};b.data.currentUser.id=null;b.data.currentUser.isAdmin=
!1;b.data.currentUser.isReadonly=!1;$("#showUserOptionModal").modal()};var p=function(a,b){g.success();$("#deleteUserModal").modal("hide");$("#showUserOptionModal").modal("hide");h()},m=function(a){a=k.errorCallbackHandler(a);g.errorInfo(a.caption,a.description)};b.sendUserToServer=function(a){if(0==b.checkForm(a))return!1;var d=b.ctrlSettings.subscrUrl+b.ctrlSettings.userUrlSuffix;angular.isDefined(a.id)&&null!=a.id?b.updateObject(d,a):b.addObject(d,a)};b.addObject=function(a,b){a+="/?isAdmin="+
b.isAdmin;angular.isDefined(b.password)&&null!=b.password&&""!=b.password&&(a+="&newPassword="+b.password);angular.isDefined(b.isReadonly)&&null!=b.isReadonly&&(a+="&isReadonly="+b.isReadonly);l(a).save(b,p,m)};b.deleteObject=function(a){l(b.ctrlSettings.subscrUrl+b.ctrlSettings.userUrlSuffix)["delete"]({id:a[b.extraProps.idColumnName]},p,m)};b.updateObject=function(a,d){var c={id:d[b.extraProps.idColumnName]};angular.isDefined(d.isAdmin)&&null!=d.isAdmin&&(c.isAdmin=d.isAdmin);angular.isDefined(d.password)&&
null!=d.password&&""!=d.password&&(c.oldPassword=d.curpassword,c.newPassword=d.password);angular.isDefined(d.isReadonly)&&null!=d.isReadonly&&(c.isReadonly=d.isReadonly);l(a).update(c,d,p,m)};b.deleteObjectInit=function(a){b.selectedItem(a);b.confirmCode=null;a=k.getConfirmCode();b.confirmLabel=a.label;b.sumNums=a.result};b.changeClient=function(){h()};b.emptyString=function(a){return k.checkUndefinedEmptyNullValue(a)};b.checkPassword=function(){return!(null==b.data.currentUser.id&&b.emptyString(b.data.currentUser.password)||
b.data.currentUser.password!=b.data.currentUser.passwordConfirm)};b.checkForm=function(a){var d=!0;b.emptyString(a.userNickname)&&(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e \u0438\u043c\u044f \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f!"),d=!1);b.emptyString(a.userName)&&(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043b\u043e\u0433\u0438\u043d \u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044f!"),
d=!1);b.checkPassword()||(g.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430","\u041d\u0435 \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043f\u0430\u0440\u043e\u043b\u044c!"),d=!1);return d};$(document).ready(function(){$("#inputUserName").inputmask({mask:"a[*{1,20}]",greedy:!1,definitions:{"*":{validator:"[0-9a-z!_-]",cardinality:1,casing:"lower"}}})});b.isAdmin=function(){return k.isAdmin()};b.isReadonly=function(){return k.isReadonly()};b.isROfield=function(){return b.isReadonly()||
!b.isAdmin()};b.isCabinetsEnabled=function(){return!0};b.isSystemViewInfo=function(){return k.getViewSystemInfo()};$("#showUserOptionModal").on("shown.bs.modal",function(){$("#inputFirstName").focus()})}]);app=angular.module("portalNMC");
app.controller("TariffsCtrl",["$scope","$rootScope","$resource","crudGridDataFactory","notificationFactory","objectSvc","mainSvc",function(a,b,d,g,l,k,h){b.ctxId="tariffs_page";a.ctrlSettings={};a.ctrlSettings.dateFormat="DD.MM.YYYY";a.ctrlSettings.selectedAll=!1;var p=36E5*h.getServerTimeZone();a.crudTableName="../api/subscr/tariff";a.groupUrl="../api/subscr/contGroup";a.columns=[{name:"tariffPlanName",header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-xs-3"},
{name:"tariffTypeName",header:"\u0412\u0438\u0434 \u0443\u0441\u043b\u0443\u0433\u0438","class":"col-xs-1"},{name:"tariffRsoOrganizationName",header:"\u0420\u0421\u041e","class":"col-xs-3"},{name:"tariffIntervalCaption",header:"\u0421\u0440\u043e\u043a \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f","class":"col-xs-3"},{name:"tariffPlanValue",header:"\u0421\u0442\u043e\u0438\u043c\u043e\u0441\u0442\u044c, \u0440\u0443\u0431","class":"col-xs-1"}];a.extraProps={idColumnName:"id",defaultOrderBy:"tariffPlanName",
deleteConfirmationProp:"tariffPlanName"};a.objects=[];a.rsos=[];a.tariffTypes=[];a.tariffOptions=[];a.startDateFormat=null;a.endDateFormat=null;a.object={};a.currentObject={};a.addMode=!1;a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.filter="";a.headers={};a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b";a.toggleAddMode=function(){a.addMode=!a.addMode;a.object={};a.addMode&&a.newIdProperty&&a.newIdValue&&(a.object[a.newIdProperty]=
a.newIdValue)};a.toggleEditMode=function(a){a.editMode=!a.editMode};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b;a.startDateFormat=null==a.currentObject.startDate?null:new Date(a.currentObject.startDate);a.endDateFormat=null==a.currentObject.endDate?null:new Date(a.currentObject.endDate);a.paramsetStartDateFormat=new Date(a.currentObject.startDate);a.psStartDateFormatted=null!==a.currentObject.startDate?moment.utc(a.currentObject.startDate+p).format(a.ctrlSettings.dateFormat):"";
a.paramsetEndDateFormat=new Date(a.currentObject.endDate);a.psEndDateFormatted=null!==a.currentObject.startDate?moment.utc(a.currentObject.endDate+p).format(a.ctrlSettings.dateFormat):""};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};var m=function(b,c){l.success();$("#deleteObjectModal").modal("hide");a.getTariffs(c)},n=function(a){m(a,function(){$("#editTariffModal").modal("hide")})};$("#editTariffModal").on("hide",function(b){a.currentObject={}});var e=
function(a){console.log(a);var b="-1";if(h.checkUndefinedNull(a)||h.checkUndefinedNull(a.data))b="ERR_CONNECTION";h.checkUndefinedNull(a)||h.checkUndefinedNull(a.resultCode)&&(h.checkUndefinedNull(a.data)||h.checkUndefinedNull(a.data.resultCode))||(b=a.resultCode||a.data.resultCode);a=h.getServerErrorByResultCode(b);l.errorInfo(a.caption,a.description)};a.addObject=function(){g(a.crudTableName).save(a.object,n,e)};a.deleteObject=function(b){g(a.crudTableName)["delete"]({id:b[a.extraProps.idColumnName]},
m,e)};a.getTariffs=function(b){g(a.crudTableName+"/default").query(function(c){a.objects=c;0<a.tariffOptions.length&&a.objects.forEach(function(b){a.tariffOptions.some(function(a){if(b.tariffOptionKeyname===a.keyname)return b.tariffOptionCaption=a.tariffOptionName,!0})});a.objects.forEach(function(b){b.tariffTypeName=b.tariffType.tariffTypeName;b.tariffRsoOrganizationName=b.rso.organizationName;b.tariffStartDateFormatted=null!==b.startDate?moment.utc(b.startDate+p).format(a.ctrlSettings.dateFormat):
"";b.tariffEndDateFormatted=null!==b.endDate?moment.utc(b.endDate+p).format(a.ctrlSettings.dateFormat):"";b.tariffIntervalCaption="\u0441 "+b.tariffStartDateFormatted+" \u043f\u043e "+b.tariffEndDateFormatted});b&&b()})};a.getRSOs=function(){g(a.crudTableName+"/rso").query(function(b){a.rsos=b})};a.getTariffTypes=function(){g(a.crudTableName+"/type").query(function(b){a.tariffTypes=b})};a.getTariffOptions=function(){g(a.crudTableName+"/option").query(function(b){a.tariffOptions=b;a.getTariffs()})};
a.getRSOs();a.getTariffTypes();a.getTariffOptions();a.saveObject=function(b){h.checkUndefinedNull(b.tariffOption)||(b.tariffOptionKey=b.tariffOption.keyname);var c=(new Date(moment(a.psStartDateFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD"))).getTime();b.startDate=isNaN(c)?null:c-p;c=(new Date(moment(a.psEndDateFormatted,a.ctrlSettings.dateFormat).format("YYYY-MM-DD"))).getTime();b.endDate=isNaN(c)?null:c-p;c=a.selectedObjects.map(function(a){return a.id});null!=b.id&&"undefined"!=typeof b.id?
g(a.crudTableName).update({rsoOrganizationId:b.rso.id,tariffTypeId:b.tariffType.id,contObjectIds:c},b,n,e):d(a.crudTableName,{},{save:{method:"POST",params:{rsoOrganizationId:b.rso.id,tariffTypeId:b.tariffType.id}}}).save({contObjectIds:c},b,n,e)};a.saveObjectAsNew=function(b){b=angular.copy(b);b.id=null;a.saveObject(b)};var c=function(){$("#main_properties_tab").addClass("active");$("#set_of_objects_tab").removeClass("active");$("#editTariffModal").modal()};a.prepareObjectsList=function(){a.availableObjectGroups.forEach(function(a){a.selected=
!1});a.ctrlSettings.selectedAll=!1};a.addTariff=function(){a.availableObjects=[];a.selectedObjects=[];a.currentObject={};a.currentObject.isDefault=!1;a.startDateFormat=null;a.endDateFormat=null;a.psStartDateFormatted=moment().format(a.ctrlSettings.dateFormat);a.psEndDateFormatted=moment().format(a.ctrlSettings.dateFormat);a.getAvailableObjects(0);a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;c()};a.editTariff=function(b){a.selectedItem(b);a.getAvailableObjects(b.id);a.getSelectedObjects();
a.set_of_objects_flag=!1;a.showAvailableObjects_flag=!1;c()};a.checkRequiredFields=function(){return h.checkUndefinedNull(a.currentObject.rso)||h.checkUndefinedNull(a.currentObject.tariffType)?!1:!(null==a.psStartDateFormatted||""==a.psStartDateFormatted||null==a.currentObject.rso.id||null==a.currentObject.tariffType.id)&&a.checkPositiveNumberValue(a.currentObject.tariffPlanValue)&&a.checkDateIntervalWithRightNull(a.psStartDateFormatted,a.psEndDateFormatted)};a.availableObjects=[];a.availableObjectGroups=
[];a.selectedObjects=[];a.getAvailableObjects=function(b){g(a.crudTableName+"/"+b+"/contObject/available").query(function(b){a.availableObjects=b;k.sortObjectsByFullName(a.availableObjects)})};a.getSelectedObjects=function(){g(a.crudTableName+"/"+a.currentObject.id+"/contObject").query(function(b){a.selectedObjects=b;k.sortObjectsByFullName(a.selectedObjects)})};a.getGroupObjects=function(b){g(a.groupUrl+"/"+b.id+"/contObject").query(function(a){b.objects=a})};a.getAvailableObjectGroups=function(){g(a.groupUrl).query(function(b){b.forEach(function(b){a.getGroupObjects(b)});
a.availableObjectGroups=b})};a.getAvailableObjectGroups();a.viewAvailableObjects=function(b){a.showAvailableObjects_flag=!a.showAvailableObjects_flag;(a.showAvailableObjectGroups_flag=b)?(a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u0433\u0440\u0443\u043f\u043f\u044b \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",a.availableEntities=a.availableObjectGroups):(a.headers.addObjects="\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b",
a.availableEntities=a.availableObjects)};var f=function(b,c){var d={},e=[],f=[],g=[],h;a.addObject_flag?(e=a.availableObjects,g=f=a.selectedObjects):(f=a.availableObjects,g=e=a.selectedObjects);for(h=0;h<e.length;h+=1)if(e[h].id==a.currentObjectId){d=angular.copy(e[h]);d.selected=!1;e.splice(h,1);break}f.push(d);return g.map(function(a){return a.id})};a.getResource=function(a,b){return d(a,{},{update:{method:"PUT",params:{reportParamsetId:b}},addObject:{method:"POST",params:{contObjectId:b}},removeObject:{method:"DELETE"}})};
a.addObject=function(b){a.addObject_flag=!0;a.currentObjectId=b.id;f(!0,b.id)};a.removeObject=function(b){a.addObject_flag=!1;a.currentObjectId=b.id;f(!1,b.id)};a.removeSelectedObject=function(b){a.availableObjects.push(b);a.selectedObjects.splice(a.selectedObjects.indexOf(b),1);k.sortObjectsByFullName(a.availableObjects)};a.joinObjectsFromSelectedGroups=function(a){var b=[];a.forEach(function(a){a.selected&&Array.prototype.push.apply(b,a.objects)});return b};a.deleteDoublesObjects=function(a){for(var b=
a.length;2<=b;)--b,a[b].fullName===a[b-1].fullName&&a.splice(b,1)};a.addUniqueObjectsFromGroupsToSelectedObjects=function(a,b){var c,d;for(c=0;c<a.length;c+=1){var e=!0;for(d=0;d<b.length;d+=1)if(a[c].fullName===b[d].fullName){e=!1;break}e&&b.push(a[c])}};a.removeGroupObjectsFromAvailableObjects=function(a,b){var c,d;for(d=0;d<a.length;d+=1){var e=-1;for(c=0;c<b.length;c+=1)if(a[d].fullName===b[c].fullName){e=c;break}0<=e&&b.splice(e,1)}};a.selectAllAvailableEntities=function(){var b;for(b=0;b<a.availableEntities.length;b+=
1)a.availableEntities[b].selected=a.ctrlSettings.selectedAll};a.addSelectedEntities=function(){var b;a.showAvailableObjectGroups_flag&&(b=a.joinObjectsFromSelectedGroups(a.availableEntities),k.sortObjectsByFullName(b),a.deleteDoublesObjects(b),a.addUniqueObjectsFromGroupsToSelectedObjects(b,a.selectedObjects),a.removeGroupObjectsFromAvailableObjects(b,a.availableObjects));var c=angular.copy(a.availableObjects);for(b=0;b<a.availableObjects.length;b+=1){var d=a.availableObjects[b];if(d.selected){var e=
angular.copy(d);e.selected=null;var f=-1;c.some(function(a,b,c){return a.fullName===d.fullName?(f=b,!0):!1});c.splice(f,1);a.selectedObjects.push(e);d.selected=null}}a.availableObjects=c;k.sortObjectsByFullName(a.selectedObjects);a.showAvailableObjects_flag=!1};a.isSystemuser=function(){return h.isSystemuser()};a.isAdmin=function(){return h.isAdmin()};a.isSystemViewInfo=function(){return h.getViewSystemInfo()};a.showAddObjectButton=function(){return!a.showAvailableObjects_flag&&a.set_of_objects_flag};
a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:a.ctrlSettings.dateFormat};$(document).ready(function(){$("#inputSingleDateStart").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});
$("#inputSingleDateEnd").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#inputStartDate").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,
dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})});a.checkEmptyNullValue=function(a){return""===a||null==a?!0:!1};a.checkNumericValue=function(b){return a.checkEmptyNullValue(b)?!0:isNaN(parseFloat(b))||!isFinite(b)?!1:!0};a.checkPositiveNumberValue=
function(b){var c;c=a.checkNumericValue(b);return c?c=0<=parseInt(b,10)?!0:!1:c};a.checkDateIntervalWithRightNull=function(b,c){if(null==b||""==b||!h.checkStrForDate(b))return!1;if(null==c||""==c)return!0;if(!h.checkStrForDate(c))return!1;var d=h.strDateToUTC(b,a.ctrlSettings.dateFormat),d=null!=d?new Date(d):null,e=h.strDateToUTC(c,a.ctrlSettings.dateFormat),e=null!=e?new Date(e):null;return null==d||null==e?!1:e>=d};a.isAdmin=function(){return h.isAdmin()};a.isReadonly=function(){return h.isReadonly()};
a.isROfield=function(){return a.isReadonly()}}]);angular.module("portalNMC").controller("testCtrl",function(a){a.shouldShow=!0;a.options={};a.addWidget=function(b,d){var g;for(g=0;g<d;g+=1)a.options.widgetNumber=g,a.widgets&&a.widgets.length?a.widgets.push({id:a.widgets[a.widgets.length-1].id+1,src:b}):a.widgets=[{id:0,src:"test"}],a.options.widgetCount=a.widgets.length}});angular.module("portalNMC").controller("UserinfoCtrl",function(a,b){});angular.module("portalNMC").controller("widgetContainer",["$scope",function(a){a.isLoading=!0;a.$on("exportPropertiesUpdated",function(b,d){angular.isDefined(d)&&angular.isDefined(d.title)&&(a.title=d.title);angular.isDefined(d)&&angular.isDefined(d.contObjectId)&&angular.isDefined(d.contZpointId)&&angular.isDefined(d.action)&&"openIndicators"===d.action&&angular.isDefined(a.getIndicators)&&a.getIndicators(Number(d.contObjectId),Number(d.contZpointId));angular.isDefined(d)&&angular.isDefined(d.contObjectId)&&
angular.isDefined(d.action)&&"openNotices"===d.action&&angular.isDefined(a.openNotices)&&a.openNotices(Number(d.contObjectId))});a.$on("requestToGetIndicators",function(b,d){angular.isDefined(a.getIndicators)&&a.getIndicators(d.contObjectId,d.contZpointId)});a.$on("widgetLoaded",function(){a.isLoading=!1;a.isError=!1});a.$on("widgetError",function(){a.isLoading=!1;a.isError=!0});a.reload=function(){a.isLoading=!0;a.isError=!1;a.$broadcast("reloadWidget")}}]);angular.module("portalNMC").factory("crudGridDataFactory",["$http","$resource",function(a,b){return function(a){return b(a+"/:id",{id:"@id"},{update:{method:"PUT"},query:{method:"GET",isArray:!0},get:{method:"GET"},"delete":{method:"DELETE"}})}}]);
angular.module("portalNMC").factory("crudGridDataFactoryWithCanceler",["$http","$resource",function(a,b){return function(a,g){return b(a+"/:id",{id:"@id"},{update:{method:"PUT"},query:{method:"GET",isArray:!0,timeout:g.promise},get:{method:"GET",timeout:g.promise},"delete":{method:"DELETE"}})}}]);angular.module("portalNMC").directive("crudGridDirectories",function(){return{restrict:"A",replace:!1,scope:{crudTableName:"=table",newIdValue:"=",newIdProperty:"="},templateUrl:"scripts/directives/templates/crud-grid-directive-directories-template.html",link:function(a,b,d){},controller:["$scope","$element","$attrs","$routeParams","$resource","crudGridDataFactory","notificationFactory",function(a,b,d,g,l,k,h){a.objects=angular.fromJson(d.datasource);a.lookups=[];a.object={};a.columns=angular.fromJson(d.columns);
a.captions=angular.fromJson(d.captions);a.extraProps=angular.fromJson(d.exprops);a.addMode=!1;a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.loading=!0;a.filter="";a.filterType="";a.bGroupByObject=angular.fromJson(d.bgroup)||!1;a.bExtraMenu=angular.fromJson(d.bextramenu)||!1;a.bObject=angular.fromJson(d.bobject)||!1;angular.element(document).scope();a.setLookupData=function(){for(var b=0;b<a.columns.length;b++){var c=a.columns[b];c.lookup&&!a.hasLookupData(c.lookup.table)&&a.initLookupData(c.lookup.table)}};
a.resetLookupData=function(b){a.setIndividualLookupData(b,{});a.setLookupData()};a.getLookupData=function(b){return"undefined"==typeof b?null:a.lookups[b.toLowerCase()]};a.setIndividualLookupData=function(b,c){a.lookups[b.toLowerCase()]=c};a.hasLookupData=function(b){return!$.isEmptyObject(a.getLookupData(b))};a.getLookupValue=function(b,c){var d=a.getLookupData(b.table);if("undefined"!=typeof d)for(var e=0;e<d.length;e++)if(d[e][b.key]===c)return d[e][b.value];return""};a.toggleAddMode=function(){a.addMode=
!a.addMode;a.object={};a.addMode&&a.newIdProperty&&a.newIdValue&&(a.object[a.newIdProperty]=a.newIdValue)};a.toggleEditMode=function(a){a.editMode=!a.editMode};var p=function(b,c){h.success();$("#deleteObjectModal").modal("hide");$("#showDirectoryStructModal").modal("hide");a.currentObject={};a.getData(c)},m=function(b){p(b,function(){a.toggleAddMode()})};a.$on("lookupDataChange",function(b,c){a.resetLookupData(c[0])});var n=function(a){h.error(a.data.ExceptionMessage)};a.addObject=function(){k(a.crudTableName).save(a.object,
m,n)};a.addParam=function(){k(a.crudTableName+"/"+a.currentObject.id+"/param").save(a.object,m,n)};a.deleteObject=function(b){k(a.crudTableName)["delete"]({id:b[a.extraProps.idColumnName]},p,n)};a.deleteObject=function(a,b){k(a)["delete"]({id:b},p,n)};a.updateObject=function(b){k(a.crudTableName).update({id:b[a.extraProps.idColumnName]},b,p,n)};a.updateObject=function(b,c){var d=a.crudTableName+"/"+String(a.currentObject.id)+"/node";"undefined"==typeof b||null==b?k(d).save(c,p,n):k(d).update({id:b},
c,p,n)};a.getData=function(b){k(a.crudTableName).query(function(c){a.objects=c;b&&b()})};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};a.getData(function(){a.setLookupData();a.loading=!1});a.initLookupData=function(b){k(b).query(function(c){a.setIndividualLookupData(b,c)})};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b};a.bGroupByObject=!1;a.oldObjects=a.objects;a.oldColumns=a.columns;a.oldCaptions=a.captions;a.oldExtraProps=a.extraProps;
a.cancelGroup=function(){a.objects=a.oldObjects;a.columns=a.oldColumns;a.captions=a.oldCaptions;a.extraProps=a.oldExtraProps;a.bGroupByObject=!1};a.groupByObject=function(){a.bGroupByObject=!0;a.oldObjects=a.objects;a.oldColumns=a.columns;a.oldCaptions=a.captions;a.oldExtraProps=a.extraProps;a.objectGroups=[];for(var b=a.groupsCount=0;b<a.objects.length;b++)if(a.objectGroup={name:"",commonCount:0,critCount:0,warnCount:0,infoCount:0},0==a.objectGroups.length){a.objectGroup.name=a.objects[b].noticeObject;
a.objectGroup.commonCount=1;switch(a.objects[b].noticeCat){case "\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f":a.objectGroup.critCount=1;break;case "\u041f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435":a.objectGroup.warnCount=1;break;case "\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f":a.objectGroup.infoCount=1}a.objectGroups[a.groupsCount]=a.objectGroup;a.groupsCount+=1}else{a.bNewGroup=!1;for(var c=0;c<a.objectGroups.length;c++)if(a.objectGroups[c].name==
a.objects[b].noticeObject){a.objectGroups[c].commonCount+=1;switch(a.objects[b].noticeCat){case "\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f":a.objectGroups[c].critCount+=1;break;case "\u041f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435":a.objectGroups[c].warnCount+=1;break;case "\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f":a.objectGroups[c].infoCount+=1}a.bNewGroup=!1;break}else a.bNewGroup=!0;if(a.bNewGroup){a.objectGroup.name=
a.objects[b].noticeObject;a.objectGroup.commonCount=1;switch(a.objects[b].noticeCat){case "\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0430\u044f":a.objectGroup.critCount=1;break;case "\u041f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0435":a.objectGroup.warnCount=1;break;case "\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0446\u0438\u044f":a.objectGroup.infoCount=1}a.objectGroups[a.groupsCount]=a.objectGroup;a.groupsCount+=1}}console.log(a.groupsCount);a.columns=
[{name:"name",header:"\u041e\u0431\u044a\u0435\u043a\u0442","class":"col-md-3"},{name:"commonCount",header:"\u0412\u0441\u0435\u0433\u043e \u0443\u0432\u0435\u0434\u043e\u043c\u043b\u0435\u043d\u0438\u0439","class":"col-md-2"},{name:"critCount",header:"\u041a\u0440\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435","class":"col-md-1"},{name:"warnCount",header:"\u041f\u0440\u0435\u0434\u0443\u043f\u0440\u0435\u0436\u0434\u0435\u043d\u0438\u0439","class":"col-md-1"},{name:"infoCount",header:"\u0418\u043d\u0444\u043e\u0440\u043c\u0430\u0442\u0438\u0432\u043d\u044b\u0445",
"class":"col-md-1"}];a.objects=a.objectGroups};a.toogleShowGroupDetails=function(b){for(var c=0;c<a.objects.length;c++)a.objects[c]!=b&&1==a.objects[c].showGroupDetails&&(a.objects[c].showGroupDetails=!1);b.showGroupDetails=!b.showGroupDetails};a.zPointsByObject=[];a.getZpointsDataByObject=function(b){console.log(b);k(b).query(function(b){a.zPointsByObject=b;console.log("Data:");console.log(a.zPointsByObject);for(b=0;b<a.zPointsByObject.length;b++){var c={};c.zpointType=a.zPointsByObject[b].contServiceType.keyname;
c.zpointName=a.zPointsByObject[b].customServiceName;c.zpointModel=a.zPointsByObject[b].deviceObjects[0].deviceModel.modelName;c.zpointNumber=a.zPointsByObject[b].deviceObjects[0].number;c.zpointLastDataDate="27.02.2015";a.oldObjects[b]=c;console.log("Device: "+a.oldObjects[b].zpointType+"; "+a.oldObjects[b].zpointName+"; "+a.oldObjects[b].zpointModel+"; "+a.oldObjects[b].zpointNumber+";")}})};a.paramsTableName="table";a.addParamMode=!1;a.bdirectories=angular.fromJson(d.bdirectories)||!1;a.getParams=
function(b){a.oldObjects=[];k(b).query(function(b){a.oldObjects=b})};a.getCurDirNodes=function(){a.list=[];a.crudGridDir(a.crudTableName+"/"+a.currentObject.id+"/node").query(function(b){a.list[0]=b});0==a.list.length&&(a.list[0]={nodeName:a.currentObject.directoryName,childNodes:[]})};a.typesArray=["BOOLEAN","STRING","NUMBER"];a.getCurDirParams=function(){a.oldObjects=angular.fromJson(a.currentObject.directParams);a.getParams(a.crudTableName+"/"+a.currentObject.id+"/param");a.oldColumns=[{name:"paramName",
header:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435","class":"col-md-3"},{name:"paramType",lookup:{table:"rest/types",key:"typeId",value:"typeKeyname",orderBy:{field:"typeKeyname",asc:"true"}},header:"\u0422\u0438\u043f","class":"col-md-3"},{name:"paramDescription",header:"\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435","class":"col-md-4"}]};a.toggleAddParamMode=function(){a.addParamMode=!a.addParamMode;a.object={};a.addParamMode&&a.newIdProperty&&a.newIdValue&&(a.object[a.newIdProperty]=
a.newIdValue)};a.setCurObjToDel=function(b,c,d){a.extraProp={};a.currentObjectToDel=b;a.extraProp.idColumnName=c;a.extraProp.deleteConfirmationProp=d;a.targetTableName=a.crudTableName+"/"};a.list=[{id:1,nodeName:"\u0417\u0430\u0432\u043e\u0434\u044b",childNodes:[]},{id:2,nodeName:"\u0428\u043a\u043e\u043b\u044b",childNodes:[{id:21,nodeName:"\u0428\u043a\u043e\u043b\u0430 \u21161",childNodes:[{id:211,nodeName:"\u041a\u043e\u0440\u043f\u0443\u0441 1",childNodes:[]},{id:212,nodeName:"\u041a\u043e\u0440\u043f\u0443\u0441 2",
childNodes:[]}]},{id:22,nodeName:"\u0428\u043a\u043e\u043b\u0430 \u21162",childNodes:[]}]},{id:3,nodeName:"3. unicorn-zapper",childNodes:[]},{id:4,nodeName:"4. romantic-transclusion",childNodes:[]}];a.showDetails=function(b){a.currentObject=b;$("#showDirectoryStructModal").modal()};a.test=function(){$("#editDirValueModal").modal()};a.selItem={};a.options={};a.remove=function(a){a.remove()};a.toggle=function(a){a.toggle()};a.moveLastToTheBegginig=function(){var b=a.data.pop();a.data.splice(0,0,b)};
a.newSubItem=function(a){a=a.$modelValue;a.childNodes.push({nodeName:a.nodeName+"."+(a.childNodes.length+1),childNodes:[]})};a.collapseAll=function(){angular.element(document.getElementById("tree-root")).scope().collapseAll()};a.expandAll=function(){angular.element(document.getElementById("tree-root")).scope().expandAll()};a.currentParent={};a.openNode=function(b){a.currentNode=b.$modelValue;a.currentNodeScope=b.$modelValue.$nodeScope;a.treeScope=b;a.tree={};a.tree.nodes=b.$nodes;a.currentParentScope=
a.currentNode.$parentNodeScope;a.tree.element=b.$element;$("#editDirValueModal").modal()};a.showContextMenu=function(){$(".dropdown-toggle").dropdown()};a.crudGridDir=function(a){return l(a+"/:id",{id:"@id"},{query:{method:"GET",isArray:!1}})};a.newNode=function(){if(0==a.list.length)a.list.push({nodeName:a.currentObject.directoryName,childNodes:[]});else{var b=a.list[0];b.childNodes.push({nodeName:b.nodeName+"."+(b.childNodes.length+1),childNodes:[]})}};a.removeTree=function(){a.list=[]}}]}});app=angular.module("portalNMC");
app.directive("crudGridObjects",function(){return{restrict:"A",replace:!1,scope:{crudTableName:"=table",newIdValue:"=",newIdProperty:"=",reportStart:"=",reportEnd:"="},templateUrl:"scripts/directives/templates/crud-grid-directive-objects-template.html",controller:["$scope","$rootScope","$element","$attrs","$routeParams","$resource","$cookies","$compile","$parse","$timeout","crudGridDataFactory","notificationFactory","$http","objectSvc","mainSvc","reportSvc","indicatorSvc","monitorSvc","$location",
function(a,b,d,g,l,k,h,p,m,n,e,c,f,r,q,v,t,u,w){function x(a){$("#objState"+a).qtip({content:{text:function(b,c){u.loadMonitorEventsForObject(a).then(function(a){var b;q.checkUndefinedNull(a)||q.checkUndefinedNull(a.data)||!angular.isArray(a.data)?(b="\u041d\u0435\u043f\u043e\u043d\u044f\u0442\u043d\u044b\u0439 \u043e\u0442\u0432\u0435\u0442 \u043e\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u0421\u043c\u043e\u0442\u0440\u0438 \u043a\u043e\u043d\u0441\u043e\u043b\u044c \u0431\u0440\u0430\u0443\u0437\u0435\u0440\u0430.",
console.log(a)):b=u.prepareEventMessage(a.data);c.set("content.text",b)},function(a){c.set("content.text",a.status+": "+a.data)});return"\u0417\u0430\u0433\u0440\u0443\u0436\u0430\u044e\u0442\u0441\u044f \u0441\u043e\u043e\u0431\u044b\u0442\u0438\u044f..."}},style:{classes:"qtip-bootstrap qtip-nmc-monitor-tooltip"}})}function E(b){var c=[],d=[],e=null;a.data.buildingCategories.forEach(function(a){a.buildingType===b&&c.push(angular.copy(a))});c.forEach(function(b){a.data.buildingCategories.forEach(function(a){a.parentCategory===
b.keyname&&(e=angular.copy(a),e.parentCategoryCaption=b.caption,d.push(e))})});a.data.preparedBuildingCategoryList=d}function G(){var b=null;a.data.preparedBuildingCategoryList.some(function(c){if(c.keyname===a.currentObject.buildingTypeCategory)return b=c,!0});null!==b&&50<=b.caption.length?($("#inputBuildingCategory").removeClass("nmc-select-form"),$("#inputBuildingCategory").addClass("nmc-select-form-high")):($("#inputBuildingCategory").removeClass("nmc-select-form-high"),$("#inputBuildingCategory").addClass("nmc-select-form"));
if(q.checkUndefinedNull(a.currentObject.buildingTypeCategory))return!1}function C(b,c){a.indicatorModes=[];a.currentIndicatorMode={};if(q.checkUndefinedNull("../api/subscr/vcookie")||q.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES"))return console.log("Request required params is null!"),a.$broadcast("objectList:loadedModePrefs",{contObject:c}),!1;f.get("../api/subscr/vcookie?vcMode=OBJECT_INDICATOR_PREFERENCES").then(function(d){var e;if(q.checkUndefinedNull(d)||q.checkUndefinedNull(d.data)||!angular.isArray(d.data)||
0===d.data.length)return console.log("objectList: incorrect mode preferences!"),a.$broadcast("objectList:loadedModePrefs",{contObject:c}),!1;angular.copy(d.data).forEach(function(b){if(null===b.vcValue)return!1;e=JSON.parse(b.vcValue);b.caption=e.caption;b.vv=e;a.indicatorModes.push(b)});a.currentIndicatorMode=null;q.checkUndefinedNull(b)||a.indicatorModes.some(function(d){if(d.vcKey===b)return a.currentIndicatorMode=d,q.checkUndefinedNull(d.vv.widgets)||(c.widgets=d.vv.widgets),!0});q.checkUndefinedNull(a.currentIndicatorMode)&&
console.log("Current view mode is undefined or null!");a.$broadcast("objectList:loadedModePrefs",{contObject:c})},M)}function A(b){b.widgets=a.objectCtrlSettings.widgetSettings;var c=b.id;if(q.checkUndefinedNull("../api/subscr/vcookie/user")||q.checkUndefinedNull("OBJECT_INDICATOR_PREFERENCES")||q.checkUndefinedNull(c))return console.log("Request required params is null!"),a.$broadcast("objectList:loadedModePrefs",{contObject:b}),!1;f.get("../api/subscr/vcookie/user?vcMode=OBJECT_INDICATOR_PREFERENCES&vcKey=OIP_"+
c).then(function(a){var c;q.checkUndefinedNull(a)||q.checkUndefinedNull(a.data)||0===a.data.length||(c=JSON.parse(a.data[0].vcValue));C(c,b)},M)}function z(a){a.forEach(function(a){if(1==a.showGroupDetailsFlag){var b=document.getElementById("obj"+a.id);q.checkUndefinedNull(b)||(b.getElementsByClassName("nmc-tr-zpoint")[0].innerHTML="",b=document.getElementById("btnDetail"+a.id),b.classList.remove("glyphicon-chevron-down"),b.classList.add("glyphicon-chevron-right"))}a.showGroupDetailsFlag=!1})}function H(){var b=
a.currentObject.contManagementId,c=!1;a.data.cmOrganizations.some(function(a){if(a.id==b)return c=!0});0==c&&r.getCmOrganizationsWithId(b).then(function(b){a.data.cmOrganizations=b.data;q.sortOrganizationsByName(a.data.cmOrganizations)},function(a){console.log(a)})}function D(b){var c=document.getElementById("zpointRefRange"+b.id);if(angular.isUndefined(c)||null==c)return!1;switch(b.zpointRefRangeAuto){case "auto":c.innerHTML='<div class="progress progress-striped noMargin"><div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"><strong>'+
b.zpointRefRange+"</strong></div></div>";break;case "manual":c.innerHTML='<div class="progress progress-striped noMargin"><div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"><strong>'+b.zpointRefRange+"</strong></div></div>";break;default:c.innerHTML=b.zpointRefRange}p(c)(a)}function I(b,c){r.getRefRangeByObjectAndZpoint(b,c).success(function(b){if(null!=b[0]){var d=a.dateFormat(b[0].periodBeginDate),e=a.dateFormat(b[0].periodEndDate);
c.zpointRefRange="c "+d+" \u043f\u043e "+e;c.zpointRefRangeAuto=b[0].isAuto?"auto":"manual"}else c.zpointRefRange="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d",c.zpointRefRangeAuto="notSet";D(c)}).error(function(a){console.log(a)})}function B(b){var c=document.getElementById("obj"+b.id),d,e;d="";if(!angular.isUndefined(c)&&null!==c){var c=c.getElementsByClassName("nmc-tr-zpoint")[0],f="",f=f+('<td class="nmc-td-for-buttons-in-object-page" ng-hide="!objectCtrlSettings.extendedInterfaceFlag"></td><td></td><td style="padding-top: 2px !important;"><table id="zpointTable'+
b.id+'" class="crud-grid table table-lighter table-bordered table-condensed table-hover nmc-table-hover nmc-child-object-table" style=\'background-color: #ddd;\'>'),f=f+"<tr><td>";b.zpoints.forEach(function(c,g){d=b.widgets[c.zpointType];a.oldColumns.forEach(function(a){switch(a.name){case "zpointName":e=c.zpointName}});if(0===g||0===g%2)f+="<div class = 'row marginBottom10'>";f+="<div class='col-xs-6'>";f+="<div ng-controller='widgetContainer'><span ng-show='title' ng-bind='title'></span><div ng-show='isLoading'>\u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430...</div><div ng-show='isError'>\u041e\u0448\u0438\u0431\u043a\u0430... <button ng-click='reload()'>\u041f\u0435\u0440\u0435\u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0430</button></div><ng-widget src=\"'"+
d+"'\" options=\"{'zpointName' : '"+e+"', 'contZpointId': '"+c.id+"', 'zpointModel': '"+encodeURIComponent(c.zpointModel)+"', 'zpointNumber': '"+c.zpointNumber+"', 'zpointType': '"+c.zpointType+"', 'measureUnitCaption': '"+c.measureUnitCaption+"', 'contObjectId': '"+b.id+"', 'contObjectFullName': '"+encodeURIComponent(b.fullName)+"', 'isImpulse': '"+c.isImpulse+"', 'isManualLoading': '"+c.isManualLoading+'\' }" ng-show="!isLoading && !isError"></ng-widget></div>';f+="</div>";0!==g%2&&(f+="</div>")});
f+="</td></tr>";f+="</table></td>";c.innerHTML=f;p(c)(a)}}function O(){!1===a.objectCtrlSettings.isTreeView?r.getPromise().then(U):(a.data.currentGroupId=null,u.setMonitorSettings({contGroupId:null}),r.loadDefaultTreeSetting().then(fa,M))}function Q(a){var b=[];a.forEach(function(a){1==a.isVisible&&b.push(a.fieldName)});return b}function N(a,b,c){c=Q(c);if(0<c.length){var d=new Date,d=new Date(d.getFullYear()+10,d.getMonth(),d.getDate());document.cookie="indicator"+b+a.id+"="+c+";expires="+d.toUTCString()}else h["indicator"+
b+a.id]=null}function L(a,b){var c=h["indicator"+b+a.id];return q.checkUndefinedNull(c)?null:c.split(",")}function R(a,b){var c=a.length,d=b.length,e=0,f=[],g;for(g=0;g<c;g+=1){for(var h=0,k=0;b[h]!==a[g]&&h<d;)h+=1;for(;f[k]!==a[g]&&k<e;)k+=1;h!=d&&k==e&&(f[e++]=a[g])}return f}function Y(a,b){var c=b.length;return a==c-2?R(b[c-2],b[c-1]):R(b[a],Y(a+1,b))}function X(){var b=!0,d=Q(a.data.waterColumns);0==Q(a.data.electricityColumns).length&&0==d.length&&(c.errorInfo("\u041e\u0448\u0438\u0431\u043a\u0430",
"\u0412\u044b\u0431\u0435\u0440\u0435\u0442\u0435 \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u043d\u0443 \u043a\u043e\u043b\u043e\u043d\u043a\u0443."),b=!1);return b}function da(b){a.objectCtrlSettings.objectModalWindowTabs.forEach(function(a){var c,d;c=document.getElementById(a.name)||null;d=document.getElementById(a.tabpanel)||null;0!==a.name.localeCompare(b)?(c.classList.remove("active"),d.classList.remove("active")):(c.classList.add("active"),d.classList.add("in"),d.classList.add("active"))})}
console.time("crudGridObjects loading");var F=null;b.monitorStart=w.search().fromDate||u.getMonitorSettings().fromDate||moment().subtract(6,"days").startOf("day").format("YYYY-MM-DD");b.monitorEnd=w.search().toDate||u.getMonitorSettings().toDate||moment().endOf("day").format("YYYY-MM-DD");a.messages={};a.messages.setSelectedInWinterMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u0437\u0438\u043c\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";
a.messages.setSelectedInSummerMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u044b\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043b\u0435\u0442\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";a.messages.setAllInWinterMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u0441\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u0437\u0438\u043c\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";
a.messages.setAllInSummerMode="\u041f\u0435\u0440\u0435\u0432\u0435\u0441\u0442\u0438 \u0432\u0441\u0435 \u043e\u0431\u044a\u0435\u043a\u0442\u044b \u043d\u0430 \u043b\u0435\u0442\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c";a.messages.markAllOn="\u0412\u044b\u0431\u0440\u0430\u0442\u044c \u0432\u0441\u0435";a.messages.markAllOff="\u041e\u0442\u043c\u0435\u043d\u0438\u0442\u044c \u0432\u0441\u0435";a.messages.noObjects="\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";a.messages.groupMenuHeader=
"\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";a.messages.setIndicatorInterface="\u041d\u0430\u0441\u0442\u0440\u043e\u0439\u043a\u0430 \u0438\u043d\u0442\u0435\u0440\u0444\u0435\u0439\u0441\u0430 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0430 \u043f\u043e\u043a\u0430\u0437\u0430\u043d\u0438\u0439";a.objectCtrlSettings={};a.objectCtrlSettings.isCtrlEnd=!1;a.objectCtrlSettings.allSelected=!1;a.objectCtrlSettings.objectsPerScroll=
r.OBJECT_PER_SCROLL;a.objectCtrlSettings.objectsOnPage=r.OBJECT_PER_SCROLL;a.objectCtrlSettings.loadingObjectCount=0;a.objectCtrlSettings.vzletSystemList=[];a.objectCtrlSettings.extendedInterfaceFlag=!1;a.objectCtrlSettings.serverTimeZone=3;a.objectCtrlSettings.dateFormat="DD.MM.YYYY";a.objectCtrlSettings.mapAccess=!1;a.objectCtrlSettings.mapCtxId="object_map_2nd_menu_item";a.objectCtrlSettings.htmlLoading=q.getHtmlLoading();a.objectCtrlSettings.widgetSettings={cw:"zpointCw",el:"zpointEl",heat:"zpointHeat",
hw:"zpointHw"};var T=function(){q.getContextIds().forEach(function(a){var b=document.getElementById(a.permissionTagId);angular.isUndefined(b)||null===b||$("#"+a.permissionTagId).removeClass("nmc-hide")})};T();b.$on("servicePermissions:loaded",function(){T()});window.setTimeout(function(){T()},500);a.object={};a.objects=[];a.objectsOnPage=[];a.data={};a.data.currentGroupId=null;var M=function(b){a.treeLoading=!1;b=q.errorCallbackHandler(b);c.errorInfo(b.caption,b.description)};a.$on("monitorObjects:getObjectEvents",
function(a,b){var c=b.obj;$("#objState"+c.id).qtip({content:{text:c.monitorEvents},style:{classes:"qtip-bootstrap qtip-nmc-monitor-tooltip"}})});a.data.buildingTypes=[];a.data.buildingCategories=[];a.data.preparedBuildingCategoryList=[];a.data.buildingCategories=r.getBuildingCategories();a.data.buildingTypes=r.getBuildingTypes();a.$on(r.BROADCASTS.BUILDING_TYPES_LOADED,function(){a.data.buildingTypes=r.getBuildingTypes()});a.$on(r.BROADCASTS.BUILDING_CATEGORIES_LOADED,function(){a.data.buildingCategories=
r.getBuildingCategories()});a.changeBuildingType=function(b){a.currentObject.buildingTypeCategory=null;h.recentBuildingTypeCategory=a.currentObject.buildingTypeCategory;$("#inputBuildingCategory").removeClass("nmc-select-form-high");$("#inputBuildingCategory").addClass("nmc-select-form");if(q.checkUndefinedNull(b))return!1;h.recentBuildingType=b;E(b)};a.changeBuildingCategory=function(){G();h.recentBuildingTypeCategory=a.currentObject.buildingTypeCategory};a.$on("objectList:loadedModePrefs",function(a,
b){q.checkUndefinedNull(b.contObject)||B(b.contObject)});(function(){r.getCmOrganizations().then(function(b){a.data.cmOrganizations=b.data;q.sortOrganizationsByName(a.data.cmOrganizations)})})();var U=function(c){console.time("Object perform");a.messages.noObjects="\u041e\u0431\u044a\u0435\u043a\u0442\u043e\u0432 \u043d\u0435\u0442.";var d=c.data;if(q.checkUndefinedNull(d)||!angular.isArray(d)||0===d.length)return a.loading=!1,b.$broadcast("objectSvc:loaded"),!1;d.forEach(function(b){b.imgsrc="images/object-mode-"+
b.currentSettingMode+".png";b.currentSettingMode===a.cont_zpoint_setting_mode_check[0].keyname?b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[0].caption:b.currentSettingMode===a.cont_zpoint_setting_mode_check[1].keyname&&(b.currentSettingModeTitle=a.cont_zpoint_setting_mode_check[1].caption);angular.isDefined(b._activeContManagement)&&null!==b._activeContManagement&&(b.contManagementId=b._activeContManagement.organizationId)});a.objects=c.data;r.sortObjectsByFullName(a.objects);d=a.objects.slice(0,
a.objectCtrlSettings.objectsPerScroll);a.loading=!1;a.objectsOnPage=d;d.forEach(function(a){"RED"===a.contObjectStats.contEventLevelColor||"YELLOW"===a.contObjectStats.contEventLevelColor?n(function(){x(a.id)},10):(a.monitorEvents="\u041d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043d\u0435\u0442 \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439",b.$broadcast("monitorObjects:getObjectEvents",{obj:a}))});angular.isDefined(h.contObject)&&
"null"!==h.contObject&&(c=r.findObjectById(Number(h.contObject),a.objects),null!==c&&(c=a.objects.indexOf(c),c>a.objectCtrlSettings.objectsOnPage&&(d=a.objects.slice(a.objectCtrlSettings.objectsOnPage,c+1),Array.prototype.push.apply(a.objectsOnPage,d),a.objectCtrlSettings.objectsOnPage=c+1,a.objectCtrlSettings.tmpCurContObj=h.contObject,n(function(){var b=document.getElementById("obj"+a.objectCtrlSettings.tmpCurContObj);q.checkUndefinedNull(b)||b.scrollIntoView();a.objectCtrlSettings.tmpCurContObj=
null},50)),a.toggleShowGroupDetails(Number(h.contObject))),h.contObject=null);b.$broadcast("objectSvc:loaded");console.timeEnd("Object loading");console.timeEnd("Object perform")};a.refreshObjectsData=function(){b.$broadcast("objectSvc:requestReloadData",{contGroupId:a.data.currentGroupId,onlySubscrList:!0});a.loading=!0;b.$broadcast("monitor:updateObjectsRequest");r.getPromise().then(U)};a.objectsDataFilteredByGroup=function(b){z(a.objectsOnPage);a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;
q.checkUndefinedNull(b)?(a.messages.groupMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432",a.data.currentGroupId=null,u.setMonitorSettings({contGroupId:null})):(a.messages.groupMenuHeader=b.contGroupName,a.data.currentGroupId=b.id,u.setMonitorSettings({contGroupId:b.id}));a.refreshObjectsData()};a.viewFullObjectList=function(){a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll;a.objectCtrlSettings.isFullObjectView=
!0;a.messages.treeMenuHeader="\u041f\u043e\u043b\u043d\u044b\u0439 \u0441\u043f\u0438\u0441\u043e\u043a \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432";a.data.currentGroupId=null;u.setMonitorSettings({contGroupId:null});u.setMonitorSettings({curTreeId:null,curTreeNodeId:null,isFullObjectView:!0});u.setMonitorSettings({currentTree:null,currentTreeNode:null});a.refreshObjectsData()};a.loading=r.getLoadingStatus();a.treeLoading=!0;a.columns=angular.fromJson(g.columns);a.captions=angular.fromJson(g.captions);
a.extraProps=angular.fromJson(g.exprops);a.addMode=!1;a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.filter="";a.filterType="";a.bGroupByObject=angular.fromJson(g.bgroup)||!1;a.bObject=angular.fromJson(g.bobject)||!1;a.bList=angular.fromJson(g.blist);a.oldColumns=angular.fromJson(g.zpointcolumns);a.refRange={};a.urlRefRange="../api/subscr/contObjects/";a.cont_zpoint_setting_mode_check=[{keyname:"summer",caption:"\u041b\u0435\u0442\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"},{keyname:"winter",
caption:"\u0417\u0438\u043c\u043d\u0438\u0439 \u0440\u0435\u0436\u0438\u043c"}];a.toggleAddMode=function(){a.addMode=!a.addMode;a.object={};a.addMode&&a.newIdProperty&&a.newIdValue&&(a.object[a.newIdProperty]=a.newIdValue)};a.toggleEditMode=function(a){a.editMode=!a.editMode};var V=function(b){c.success();var d=-1;a.currentObject.zpoints.some(function(b,c){if(b.id===a.zpointSettings.id)return d=c,!0});if(-1<d){b=!1;a.currentObject.zpoints[d].zpointName!==a.zpointSettings.customServiceName&&(b=!0);
var e=-1;a.objects.some(function(b,c){a.currentObject.id===b.id&&(e=c)});-1<e&&(a.objects[e].zpoints[d].customServiceName=a.zpointSettings.customServiceName,a.objectsOnPage[e].zpoints[d].zpointName=a.zpointSettings.customServiceName,a.objects[e].zpoints[d].isManualLoading=a.zpointSettings.isManualLoading,a.objectsOnPage[e].zpoints[d].isManualLoading=a.zpointSettings.isManualLoading);b&&B(a.objectsOnPage[e])}a.zpointSettings={}},aa=function(b){c.success();a.objectCtrlSettings.allSelected=!1;a.objects.forEach(function(b){!0===
b.selected&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png");b.selected=!1});a.objectsOnPage.forEach(function(b){!0===b.selected&&(b.currentSettingMode=a.settedMode,b.imgsrc="images/object-mode-"+b.currentSettingMode+".png");b.selected=!1})},W=function(b,d){c.success();$("#deleteObjectModal").modal("hide");$("#showObjOptionModalView").modal("hide");var e=-1;angular.isDefined(a.currentObject)&&a.currentObject!=={}&&(a.objects.some(function(b,c){if(b.id==
a.currentObject.id)return e=c,!0}),-1!=e&&(a.objects[e]=a.currentObject,a.objects[e].imgsrc="images/object-mode-"+a.currentObject.currentSettingMode+".png",a.objectsOnPage[e]=a.currentObject,a.objectsOnPage[e].imgsrc="images/object-mode-"+a.currentObject.currentSettingMode+".png"),a.currentObject={})},K=function(c){b.$broadcast("objectSvc:requestReloadData");a.currentObject._activeContManagement=c._activeContManagement;W(c,null)},ga=function(b){W(b,function(){a.toggleAddMode()})};a.addObject=function(){e(a.crudTableName).save(a.object,
ga,M)};a.deleteObject=function(b){e(a.crudTableName)["delete"]({id:b[a.extraProps.idColumnName]},W,M)};a.deleteObject=function(a,b){e(a)["delete"]({id:b},W,M)};a.updateObject=function(b){var c={id:b[a.extraProps.idColumnName]};angular.isDefined(b.contManagementId)&&null!=b.contManagementId&&(c={id:b[a.extraProps.idColumnName],cmOrganizationId:b.contManagementId});e(a.crudTableName).update(c,b,K,M)};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};a.selectedObjectBy=
function(b){b=angular.copy(b);a.currentObject=b;r.setCurrentObject(a.currentObject)};a.selectedObject=function(b){b=Number(b);a.currentObject=r.findObjectById(b,a.objects);q.checkUndefinedNull(a.currentObject)||q.checkUndefinedNull(a.currentObject.buildingType)||(E(a.currentObject.buildingType),G())};a.markObject=function(b){q.checkUndefinedNull(a.markedObject)||(a.markedObject.isMarked=!1);b.isMarked=!0;a.markedObject=b};a.markZpoint=function(b,c){q.checkUndefinedNull(a.currentObject)||a.selectedObject(b);
q.checkUndefinedNull(a.markedZpoint)||(a.markedZpoint.isMarked=!1,$("#trZpoint"+a.markedZpoint.id).removeClass("nmc-bg-distinguish"));var d=null;a.currentObject.zpoints.some(function(a){if(a.id===c)return d=a,!0});d.isMarked=!0;a.markedZpoint=d;$("#trZpoint"+a.markedZpoint.id).addClass("nmc-bg-distinguish")};a.selectedObjectEx=function(b){a.selectedObject(b);angular.isArray(a.data.cmOrganizations)&&H()};a.selectedZpoint=function(b,c){a.selectedObject(b);c=Number(c);var d=null;a.currentObject.zpoints.some(function(a){if(a.id===
c)return d=angular.copy(a),!0});a.currentZpoint=d};a.toggleShowGroupDetails=function(b){var c=r.findObjectById(b,a.objects);null!=c&&(b=document.getElementById("zpointTable"+c.id),c.showGroupDetails=1==c.showGroupDetails&&null==b?!0:!c.showGroupDetails,!0===c.showGroupDetails?r.getZpointsDataByObject(c,"/vo").then(function(a){if(q.checkUndefinedNull(a)||q.checkUndefinedNull(a.data))return console.log("Zpoint data for contObject "+c.id+"is empty!"),!1;var b=[],d=b=a.data;a=[];var e;for(e=0;e<d.length;e+=
1){var f={};f.id=d[e].id;f.zpointOrder=""+d[e].contServiceType.serviceOrder+d[e].customServiceName;f.zpointType=d[e].contServiceType.keyname;f.zpointTypeCaption=d[e].contServiceType.caption;f.isManualLoading=d[e].isManualLoading;f.customServiceName=d[e].customServiceName;f.zpointName=d[e].customServiceName;f.zpointRSO="undefined"!=typeof d[e].rso&&null!=d[e].rso?d[e].rso.organizationFullName||d[e].rso.organizationName:"\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e";f.checkoutTime=d[e].checkoutTime;
f.checkoutDay=d[e].checkoutDay;"undefined"==typeof d[e].doublePipe?f.piped=!1:(f.piped=!0,f.doublePipe=null===d[e].doublePipe?!1:d[e].doublePipe,f.singlePipe=!f.doublePipe);"undefined"!=typeof d[e].deviceObjects&&0<d[e].deviceObjects.length&&(d[e].deviceObjects[0].hasOwnProperty("deviceModel")?(f.zpointModel=d[e].deviceObjects[0].deviceModel.modelName,f.isImpulse=d[e].deviceObjects[0].isImpulse,!0===f.isImpulse&&(q.checkUndefinedNull(F)||F.all.some(function(a){a.keyname===d[e].deviceObjects[0].impulseMu&&
(f.measureUnitCaption=a.caption)}))):f.zpointModel="\u041d\u0435 \u0437\u0430\u0434\u0430\u043d\u043e",f.zpointNumber=d[e].deviceObjects[0].number);f.zpointLastDataDate=d[e].lastDataDate;I(c,f);a[e]=f}q.sortItemsBy(a,"zpointOrder");c.zpoints=a;A(c);a=document.getElementById("btnDetail"+c.id);angular.isDefined(a)&&null!=a&&(a.classList.remove("glyphicon-chevron-right"),a.classList.add("glyphicon-chevron-down"));c.showGroupDetailsFlag=!c.showGroupDetailsFlag}):(document.getElementById("obj"+c.id).getElementsByClassName("nmc-tr-zpoint")[0].innerHTML=
"",b=document.getElementById("btnDetail"+c.id),b.classList.remove("glyphicon-chevron-down"),b.classList.add("glyphicon-chevron-right")))};a.dateFormat=function(b){b=new Date(b+Math.round(36E5*a.objectCtrlSettings.serverTimeZone));return null==b?"":moment([b.getUTCFullYear(),b.getUTCMonth(),b.getUTCDate()]).format(a.objectCtrlSettings.dateFormat)};a.onlyNoRead=!1;a.showRow=function(b){return"undefined"!=typeof b.isRead||a.onlyNoRead?a.onlyNoRead&&a.onlyNoRead!=!b.isRead?!1:!0:!0};a.showDetails=function(b){a.bdirectories&&
(a.currentObject=b,$("#showDirectoryStructModal").modal())};a.getIndicators=function(b,c){a.setIndicatorsParams(b,c);var d="#/objects",d=!0===a.currentZpoint.isImpulse?d+"/impulse-indicators":"el"===a.currentZpoint.zpointType?d+"/indicator-electricity":d+"/indicators",d=d+("/?objectId="+encodeURIComponent(b)+"&zpointId="+encodeURIComponent(c)+"&objectName="+encodeURIComponent(a.currentObject.fullName)+"&zpointName="+encodeURIComponent(a.currentZpoint.zpointName)),d=d+("&deviceModel="+encodeURIComponent(a.currentZpoint.zpointModel)),
d=d+("&deviceSN="+encodeURIComponent(a.currentZpoint.zpointNumber));q.checkUndefinedNull(a.currentZpoint.measureUnitCaption)||(d+="&mu="+encodeURIComponent(a.currentZpoint.measureUnitCaption));q.checkUndefinedNull(a.currentZpoint.isManualLoading)||(d+="&isManualLoading="+encodeURIComponent(a.currentZpoint.isManualLoading));window.open(d,"_blank")};a.setIndicatorsParams=function(c,d){a.selectedZpoint(c,d);h.contZPoint=a.currentZpoint.id;h.contObject=a.currentObject.id;h.contZPointName=a.currentZpoint.zpointName;
h.contObjectName=a.currentObject.fullName;h.deviceModel=a.currentZpoint.zpointModel;h.deviceSN=a.currentZpoint.zpointNumber;if(angular.isUndefined(h.timeDetailType)||"undefined"==h.timeDetailType||"null"==h.timeDetailType)h.timeDetailType="24h";h.isManualLoading=(null===a.currentZpoint.isManualLoading?!1:a.currentZpoint.isManualLoading)||!1;b.reportStart=moment().subtract(6,"days").startOf("day").format("YYYY-MM-DD");b.reportEnd=moment().endOf("day").format("YYYY-MM-DD")};a.zpointSettings={};a.getZpointSettings=
function(b,c){a.selectedZpoint(b,c);var d=a.currentZpoint,e={};e.id=d.id;e.isManualLoading=d.isManualLoading;e.customServiceName=d.customServiceName;e.zpointTypeCaption=d.zpointTypeCaption;e.zpointName=d.zpointName;switch(d.zpointType){case "heat":e.zpointType="\u0422\u0421";break;case "hw":e.zpointType="\u0413\u0412\u0421";break;case "cw":e.zpointType="\u0425\u0412";break;default:e.zpointType=d.zpointType}e.piped=d.piped;e.singlePipe=d.singlePipe;e.doublePipe=d.doublePipe;e.zpointModel=d.zpointModel;
e.zpointRSO=d.zpointRSO;e.checkoutTime=d.checkoutTime;e.checkoutDay=d.checkoutDay;e.winter={};e.summer={};a.zpointSettings=e;a.prepareRefRange()};a.getZpointSettingsExpl=function(b,c){a.getZpointSettings(b,c);var d={},f={};e(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").query(function(b){var c;for(c=0;c<b.length;c+=1)"winter"==b[c].settingMode?d=b[c]:"summer"==b[c].settingMode&&(f=b[c]);a.zpointSettings.winter=d;a.zpointSettings.summer=f})};var ha=function(b,
d){f.get(a.urlRefRange+"/"+b+"/zpoints/"+d+"/referencePeriod").success(function(b){null!=b[0]?(a.refRange=b[0],a.refRange.cont_zpoint_id=d,a.beginDate=a.dateFormat(a.refRange.periodBeginDate),a.endDate=a.dateFormat(a.refRange.periodEndDate),0==a.refRange.isAuto?(document.getElementById("spn_if_manual").style.display="block",document.getElementById("spn_if_auto").style.display="none"):(document.getElementById("spn_if_manual").style.display="none",document.getElementById("spn_if_auto").style.display=
"block")):(a.refRange={},a.refRange.cont_zpoint_id=d,a.beginDate="",a.endDate="",document.getElementById("spn_if_manual").style.display="none",document.getElementById("spn_if_auto").style.display="none")}).error(function(a){c.errorInfo(a.statusText,a.description)})};a.prepareRefRange=function(){ha(a.currentObject.id,a.zpointSettings.id);a.editRefRangeOff()};a.editRefRangeOn=function(){a.toggleFlag=!0;document.getElementById("i_ref_range_save").style.display="block";document.getElementById("i_ref_range_add").style.display=
"none";document.getElementById("inp_ref_range_start").disabled=!1;document.getElementById("inp_ref_range_end").disabled=!1};a.editRefRangeOff=function(){a.toggleFlag=!1;document.getElementById("i_ref_range_save").style.display="none";document.getElementById("i_ref_range_add").style.display="block";document.getElementById("inp_ref_range_start").disabled=!0;document.getElementById("inp_ref_range_end").disabled=!0};a.addRefRange=function(){var b=a.urlRefRange+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+
"/referencePeriod";a.refRange.id="";var d=new Date(moment(a.beginDate,a.objectCtrlSettings.dateFormat).format("YYYY-MM-DD")),d=Date.UTC(d.getFullYear(),d.getMonth(),d.getDate());a.refRange.periodBeginDate=isNaN(d)?null:(new Date(d)).getTime();d=new Date(moment(a.endDate,a.objectCtrlSettings.dateFormat).format("YYYY-MM-DD"));d=Date.UTC(d.getFullYear(),d.getMonth(),d.getDate());a.refRange.periodEndDate=isNaN(d)?null:(new Date(d)).getTime();f.post(b,a.refRange).success(function(b){a.editRefRangeOff();
a.refRange=b;document.getElementById("zpointRefRange"+a.currentZpoint.id);a.beginDate=a.dateFormat(a.refRange.periodBeginDate);a.endDate=a.dateFormat(a.refRange.periodEndDate);a.currentZpoint.zpointRefRange="c "+a.beginDate+" \u043f\u043e "+a.endDate;a.currentZpoint.zpointRefRangeAuto=a.refRange.isAuto?"auto":"manual";D(a.currentZpoint)}).error(function(a){c.errorInfo(a.statusText,a.description)})};var ba=function(b){c.success();a.zpointSettings={}},ca=function(b){c.success();e(a.crudTableName+"/"+
a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").update({id:a.zpointSettings.winter.id},a.zpointSettings.winter,ba,M)};a.updateZpointCommonSettings=function(){f({url:a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id,method:"PUT",data:a.zpointSettings}).then(V,M)};a.updateZpointModeSettings=function(){e(a.crudTableName+"/"+a.currentObject.id+"/zpoints/"+a.zpointSettings.id+"/settingMode").update({id:a.zpointSettings.summer.id},a.zpointSettings.summer,ca,M)};a.searchObjects=
function(c){if(!(0>=a.objects.length)){z(a.objectsOnPage);var d=[];angular.isUndefined(c)||""===c?(a.objectCtrlSettings.objectsOnPage=a.objectCtrlSettings.objectsPerScroll,d=a.objects.slice(0,a.objectCtrlSettings.objectsPerScroll)):a.objects.forEach(function(a){-1!=a.fullName.toUpperCase().indexOf(c.toUpperCase())&&d.push(a)});d.forEach(function(a){"RED"===a.contObjectStats.contEventLevelColor||"YELLOW"===a.contObjectStats.contEventLevelColor?n(function(){x(a.id)},10):(a.monitorEvents="\u041d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043d\u0435\u0442 \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439",
b.$broadcast("monitorObjects:getObjectEvents",{obj:a}))});a.objectsOnPage=d}};a.$on("$destroy",function(){window.onkeydown=void 0});window.onkeydown=function(c){var d=null;38==c.keyCode?(d=document.getElementById("divWithObjectListTable"),d.scrollTop-=20):40==c.keyCode?(d=document.getElementById("divWithObjectListTable"),d.scrollTop+=20):34==c.keyCode?(d=document.getElementById("divWithObjectListTable"),d.scrollTop+=10*a.objectCtrlSettings.objectsPerScroll):33==c.keyCode?(d=document.getElementById("divWithObjectListTable"),
d.scrollTop-=10*a.objectCtrlSettings.objectsPerScroll):c.ctrlKey&&36==c.keyCode?(d=document.getElementById("divWithObjectListTable"),d.scrollTop=0):c.ctrlKey&&35==c.keyCode&&(a.objectCtrlSettings.objectsOnPage<a.objects.length&&(a.objectCtrlSettings.loadingObjectCount+=1,n(function(){--a.objectCtrlSettings.loadingObjectCount},1500)),c=a.objects.slice(a.objectCtrlSettings.objectsOnPage,a.objects.length),Array.prototype.push.apply(a.objectsOnPage,c),c.forEach(function(a){"RED"===a.contObjectStats.contEventLevelColor||
"YELLOW"===a.contObjectStats.contEventLevelColor?n(function(){x(a.id)},10):(a.monitorEvents="\u041d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043d\u0435\u0442 \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439",b.$broadcast("monitorObjects:getObjectEvents",{obj:a}))}),a.objectCtrlSettings.objectsOnPage+=a.objects.length,a.$apply(),d=document.getElementById("divWithObjectListTable"),d.scrollTop=d.scrollHeight)};a.addMoreObjects=function(){if(!(0>=
a.objects.length)){var c=a.objectCtrlSettings.objectsOnPage+Math.round(a.objectCtrlSettings.objectsPerScroll/5);c>=a.objects.length&&(c=a.objects.length);var d=a.objects.slice(a.objectCtrlSettings.objectsOnPage,c);Array.prototype.push.apply(a.objectsOnPage,d);d.forEach(function(a){"RED"===a.contObjectStats.contEventLevelColor||"YELLOW"===a.contObjectStats.contEventLevelColor?n(function(){x(a.id)},10):(a.monitorEvents="\u041d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043d\u0435\u0442 \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439",
b.$broadcast("monitorObjects:getObjectEvents",{obj:a}))});c>=a.objects.length?a.objectCtrlSettings.objectsOnPage=a.objects.length:(a.objectCtrlSettings.objectsOnPage+=Math.round(a.objectCtrlSettings.objectsPerScroll/5),a.objectCtrlSettings.loadingObjectCount+=0,n(function(){a.objectCtrlSettings.loadingObjectCount-=0},300))}};a.isSystemuser=function(){var c=!1;a.userInfo=b.userInfo;angular.isDefined(a.userInfo)&&(c=a.userInfo._system);return c};a.toggleObjects=function(b){a.objects.forEach(function(a){a.selected=
b});a.objectsOnPage.forEach(function(a){a.selected=b})};a.setModeForObjects=function(b){a.settedMode=b;var c=[];!0===a.objectCtrlSettings.allSelected?c=a.objects.map(function(a){return a.id}):a.objectsOnPage.forEach(function(a){!0===a.selected&&c.push(a.id)});var d=r.getObjectsUrl()+"/settingModeType";f({url:d,method:"PUT",params:{contObjectIds:c,currentSettingMode:b},data:null}).then(aa,M)};a.getVzletSystemList=function(){var b=r.getVzletSystemList();0===b.length?r.getDeviceMetaDataVzletSystemList().then(function(b){a.objectCtrlSettings.vzletSystemList=
b.data},function(a){c.errorInfo(a.statusText,a.description)}):a.objectCtrlSettings.vzletSystemList=b};a.getVzletSystemList();a.getDevices=function(a){r.getDevicesByObject(a).then(function(b){var c=[];b.data.forEach(function(a){!0===a.metaVzletExpected&&c.push(a)});a.devices=c},function(a){c.errorInfo(a.statusText,a.description)})};a.getDeviceMetaDataVzlet=function(b,d){r.getDeviceMetaDataVzlet(b,d).then(function(b){d.metaData=b.data;a.currentDevice=d;$("#metaDataEditorModal").modal()},function(a){c.errorInfo(a.statusText,
a.description)})};a.updateDeviceMetaData=function(b){var d="",d=angular.isDefined(b.metaData.id)&&null!==b.metaData.id?"PUT":"POST";f({url:"../api/subscr/contObjects/"+b.contObject.id+"/deviceObjects/"+b.id+"/metaVzlet",method:d,data:b.metaData}).then(function(b){a.currentDevice={};$("#metaDataEditorModal").modal("hide")},function(a){console.log(a);c.errorInfo(a.statusText,a.description)})};a.invokeHelp=function(){alert("This is SPRAVKA!!!111")};a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),
firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},singleDatePicker:!0,format:"dd.mm.yy"};$(document).ready(function(){$("#inp_ref_range_start").datepicker({dateFormat:a.dateOptsParamsetRu.format,
firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames});$("#inp_ref_range_end").datepicker({dateFormat:a.dateOptsParamsetRu.format,firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames});$("#divWithObjectListTable").scroll(function(){if(angular.isUndefined(a.filter)||""==a.filter)a.addMoreObjects(),a.$apply()});$("#inputAddress").suggestions({serviceUrl:"https://dadata.ru/api/v2",
token:"f9879c8518e9c9e794ff06a6e81eebff263f97d5",type:"ADDRESS",count:5,onSelect:function(b){console.log(b);a.currentObject.fullAddress=b.value;a.$apply()}})});a.checkEmptyNullValue=function(a){return""===a||null==a?!0:!1};a.checkNumericValue=function(b){return a.checkEmptyNullValue(b)?!0:isNaN(parseFloat(b))||!isFinite(b)?!1:!0};a.checkPositiveNumberValue=function(a){return q.checkPositiveNumberValue(a)};a.checkNumericInterval=function(b,c){return a.checkEmptyNullValue(b)||a.checkEmptyNullValue(c)||
!a.checkNumericValue(b)||!a.checkNumericValue(c)?!1:parseInt(c,10)>=parseInt(b,10)?!0:!1};a.checkHHmm=function(a){return q.checkHHmm(a)};a.checkZpointSettingsFrom=function(b){return null!=b&&b.hasOwnProperty("summer")&&b.hasOwnProperty("winter")?a.checkPositiveNumberValue(b.summer.ov_BalanceM_ctrl)&&a.checkPositiveNumberValue(b.winter.ov_BalanceM_ctrl)&&a.checkHHmm(b.summer.ov_Worktime)&&a.checkHHmm(b.winter.ov_Worktime)&&a.checkPositiveNumberValue(b.summer.leak_Gush)&&a.checkPositiveNumberValue(b.winter.leak_Gush)&&
a.checkPositiveNumberValue(b.summer.leak_Night)&&a.checkPositiveNumberValue(b.winter.leak_Night)&&a.checkNumericInterval(b.summer.wm_deltaT_min,b.summer.wm_deltaT_max)&&a.checkNumericInterval(b.summer.wm_deltaQ_min,b.summer.wm_deltaQ_max)&&a.checkNumericInterval(b.winter.wm_deltaT_min,b.winter.wm_deltaT_max)&&a.checkNumericInterval(b.winter.wm_deltaQ_min,b.winter.wm_deltaQ_max)&&a.checkNumericInterval(b.summer.wm_P2_min,b.summer.wm_P2_max)&&a.checkNumericInterval(b.summer.wm_P1_min,b.summer.wm_P1_max)&&
a.checkNumericInterval(b.winter.wm_P2_min,b.winter.wm_P2_max)&&a.checkNumericInterval(b.winter.wm_P1_min,b.winter.wm_P1_max)&&a.checkNumericInterval(b.summer.wm_T2_min,b.summer.wm_T2_max)&&a.checkNumericInterval(b.summer.wm_T1_min,b.summer.wm_T1_max)&&a.checkNumericInterval(b.winter.wm_T2_min,b.winter.wm_T2_max)&&a.checkNumericInterval(b.winter.wm_T1_min,b.winter.wm_T1_max)&&a.checkNumericInterval(b.summer.wm_M2_min,b.summer.wm_M2_max)&&a.checkNumericInterval(b.summer.wm_M1_min,b.summer.wm_M1_max)&&
a.checkNumericInterval(b.winter.wm_M2_min,b.winter.wm_M2_max)&&a.checkNumericInterval(b.winter.wm_M1_min,b.winter.wm_M1_max):!0};a.checkObjectPropertiesForm=function(b){return null!=b&&b.hasOwnProperty("cwTemp")&&b.hasOwnProperty("heatArea")?a.checkNumericValue(b.cwTemp)&&a.checkNumericValue(b.heatArea):!0};a.isAdmin=function(){return q.isAdmin()};a.isReadonly=function(){return q.isReadonly()};a.isROfield=function(){return a.isReadonly()||!a.isAdmin()};a.isCabinet=function(){return q.isCabinet()};
a.isTestMode=function(){return q.isTestMode()};a.isRma=function(){return q.isRma()};a.objectCtrlSettings.isTreeView=!q.isCabinet();a.objectCtrlSettings.isFullObjectView=!1;a.data.currentTree={};a.data.newTree={};a.data.defaultTree=null;a.selectNode=function(c){var d=a.data.currentTree,e=a.data.selectedNode;if(!q.checkUndefinedNull(e)){if(e.id==c.id||e.type==c.type=="root")return;d=q.findNodeInTree(e,d);q.checkUndefinedNull(d)||(d.isSelected=!1)}c.isSelected=!0;a.data.selectedNode=angular.copy(c);
a.loading=!0;"root"===c.type?r.loadSubscrFreeObjectsByTree(a.data.currentTree.id).then(U):(u.setMonitorSettings({loadingFlag:!0,curTreeId:a.data.currentTree.id,curTreeNodeId:c.id}),u.setMonitorSettings({currentTree:angular.copy(a.data.currentTree),currentTreeNode:angular.copy(c)}),b.$broadcast("monitor:updateObjectsRequest"),r.loadSubscrObjectsByTreeNode(a.data.currentTree.id,c.id).then(U))};a.data.trees=[];a.loadTree=function(c,d){a.loading=!0;a.treeLoading=!0;r.loadSubscrTree(c.id).then(function(d){a.treeLoading=
!1;a.messages.treeMenuHeader=c.objectName||c.id;d=angular.copy(d.data);q.sortTreeNodesBy(d,"objectName");a.data.currentTree=d;a.objects=[];a.objectsOnPage=[];a.loading=!1;b.$broadcast("objectSvc:loaded");u.setMonitorSettings({isFullObjectView:!1});u.setMonitorSettings({currentTreeNode:null,curTreeNodeId:null});b.$broadcast("monitor:updateObjectsRequest");a.messages.noObjects=""},M)};var ea=function(b){a.treeLoading=!0;r.loadSubscrTrees().then(function(c){a.treeLoading=!1;q.sortItemsBy(c.data,"objectName");
a.data.trees=angular.copy(c.data);q.checkUndefinedNull(b)||1!=b.isActive||(a.data.defaultTree=q.findItemBy(a.data.trees,"id",Number(b.value)));if(!angular.isArray(a.data.trees)||0>=a.data.trees.length||q.checkUndefinedNull(a.data.defaultTree))return a.viewFullObjectList(),"View full object list!";u.setMonitorSettings({currentTree:a.data.defaultTree,curTreeId:a.data.defaultTree.id});a.loadTree(a.data.defaultTree)},M)},fa=function(b){a.objectCtrlSettings.isTreeView=b.data.isActive;ea(b.data)};a.toggleTreeView=
function(){a.objectCtrlSettings.isTreeView=!a.objectCtrlSettings.isTreeView;O()};var Z=t.getWaterColumns();a.data.waterColumns=angular.copy(Z);var P=t.getElectricityColumns();a.data.electricityColumns=angular.copy(P);a.selectAllWaterColumns=function(){a.data.waterColumns.forEach(function(b){b.isVisible=a.selectAllWaterColumnFlag})};a.selectAllElectricityColumns=function(){a.data.electricityColumns.forEach(function(b){b.isVisible=a.selectAllElectricityColumnFlag})};a.initIndicatorColumnsPref=function(){a.data.waterColumns=
angular.copy(Z);a.data.electricityColumns=angular.copy(P);var b=[],c=[];a.selectAllWaterColumnFlag=!1;a.selectAllElectricityColumnFlag=!1;a.objectsOnPage.forEach(function(a){if(!0===a.selected){var d=L(a,"hw");q.checkUndefinedNull(d)||b.push(d);d=L(a,"el");q.checkUndefinedNull(d)||c.push(d)}});1==b.length?b=b[0]:1<b.length&&(b=Y(0,b));0!=b.length?b.forEach(function(b){a.data.waterColumns.some(function(a){if(a.fieldName==b)return a.isVisible=!0})}):(a.selectAllWaterColumnFlag=!0,a.data.waterColumns.forEach(function(a){a.isVisible=
!0}));1==c.length?c=c[0]:1<c.length&&(c=Y(0,c));0!=c.length?c.forEach(function(b){a.data.electricityColumns.some(function(a){if(a.fieldName==b)return a.isVisible=!0})}):(a.selectAllElectricityColumnFlag=!0,a.data.electricityColumns.forEach(function(a){a.isVisible=!0}));$("#columnSettingsModal").modal()};a.setIndicatorColumnsPref=function(){if(0==X())return"Columns are not tested.";a.objectsOnPage.forEach(function(b){!0===b.selected&&(N(b,"hw",a.data.waterColumns),N(b,"el",a.data.electricityColumns))});
$("#columnSettingsModal").modal("hide")};a.data.selectedWaterColumns=[];a.data.selectedElectricityColumns=[];a.setNoticeFilterByObject=function(c){b.monitor={};a.monitorStart=moment().subtract(6,"days").startOf("day").format("YYYY-MM-DD");a.monitorEnd=moment().endOf("day").format("YYYY-MM-DD");u.setMonitorSettings({objectMonitorId:c});b.reportStart=b.monitorStart;b.reportEnd=b.monitorEnd};a.openNotices=function(b){a.setNoticeFilterByObject(b);window.open("#/notices/list/?objectMonitorId="+(b+"&monitorFlag=true&fromDate="+
a.monitorStart+"&toDate="+a.monitorEnd),"_blank")};a.$on("objectSvc:deviceMetadataMeasuresLoaded",function(){F=r.getDeviceMetadataMeasures()});$("#showObjOptionModalView").on("shown.bs.modal",function(){$("#inputContObjectName").focus();$("#inputNumOfStories").inputmask("integer",{min:1,max:200})});a.objectCtrlSettings.objectModalWindowTabs=[{name:"view_main_object_properties_tab",tabpanel:"view_main_object_properties"},{name:"view_extra_object_properties_tab",tabpanel:"view_extra_object_properties"}];
$("#showObjOptionModalView").on("hidden.bs.modal",function(){da("view_main_object_properties_tab")});(function(){f.get("../api/subscr/vcookie/widgets/list").then(function(b){var c=[],d,e={};if(!angular.isArray(b.data))return!1;b.data.forEach(function(a){angular.isArray(c[a.contServiceType])||(c[a.contServiceType]=[]);c[a.contServiceType].push(a)});for(d in c)0<c[d].length&&(e[d]=c[d][0].widgetName,c[d].some(function(a){if(!0===a.isDefault)return e[d]=a.widgetName,!0}));a.objectCtrlSettings.widgetSettings=
e},M)})();F=r.getDeviceMetadataMeasures();O();console.timeEnd("crudGridObjects loading")}]}});app.directive("crudGrid",function(){return{restrict:"A",replace:!1,scope:{crudTableName:"=table",newIdValue:"=",newIdProperty:"="},templateUrl:"scripts/directives/templates/crud-grid-directive-template.html",link:function(a,b,d){},controller:["$scope","$element","$attrs","$routeParams","crudGridDataFactory","notificationFactory",function(a,b,d,g,l,k){a.objects=[];a.lookups=[];a.object={};a.columns=angular.fromJson(d.columns);a.captions=angular.fromJson(d.captions);a.extraProps=angular.fromJson(d.exprops);
a.addMode=!1;a.orderBy={field:a.extraProps.defaultOrderBy,asc:!0};a.loading=!0;a.filter="";var h=angular.element(document).scope();a.setLookupData=function(){for(var b=0;b<a.columns.length;b++){var c=a.columns[b];c.lookup&&!a.hasLookupData(c.lookup.table)&&a.initLookupData(c.lookup.table)}};a.resetLookupData=function(b){a.setIndividualLookupData(b,{});a.setLookupData()};a.getLookupData=function(b){return"undefined"==typeof b?null:a.lookups[b.toLowerCase()]};a.setIndividualLookupData=function(b,c){a.lookups[b.toLowerCase()]=
c};a.hasLookupData=function(b){return!$.isEmptyObject(a.getLookupData(b))};a.getLookupValue=function(b,c){var d=a.getLookupData(b.table);if("undefined"!=typeof d)for(var e=0;e<d.length;e++)if(d[e][b.key]===c)return d[e][b.value];return""};a.toggleAddMode=function(){a.addMode=!a.addMode;a.object={};a.addMode&&a.newIdProperty&&a.newIdValue&&(a.object[a.newIdProperty]=a.newIdValue)};a.toggleEditMode=function(a){a.editMode=!a.editMode};var p=function(b,c){k.success();$("#deleteObjectModal").modal("hide");
a.currentObject={};h.$broadcast("lookupDataChange",[d.table]);a.getData(c)},m=function(b){p(b,function(){a.toggleAddMode()})};a.$on("lookupDataChange",function(b,c){a.resetLookupData(c[0])});var n=function(a){k.error(a.data.ExceptionMessage)};a.addObject=function(){l(a.crudTableName).save(a.object,m,n)};a.deleteObject=function(b){l(a.crudTableName)["delete"]({id:b[a.extraProps.idColumnName]},p,n)};a.updateObject=function(b){l(a.crudTableName).update({id:b[a.extraProps.idColumnName]},b,p,n)};a.getData=
function(b){l(a.crudTableName).query(function(c){a.objects=c;b&&b()})};a.setOrderBy=function(b){a.orderBy={field:b,asc:a.orderBy.field===b?!a.orderBy.asc:!0}};a.getData(function(){a.setLookupData();a.loading=!1});a.initLookupData=function(b){l(b).query(function(c){a.setIndividualLookupData(b,c)})};a.selectedItem=function(b){b=angular.copy(b);a.currentObject=b}}]}});angular.module("portalNMC").directive("metaDataEditorModal",function(){return{restrict:"AE",replace:!0,scope:{currentZpoint:"=",readOnly:"@",showOkButton:"@",btnClick:"&"},templateUrl:"scripts/directives/templates/meta-data-editor-modal.html",controller:["$scope","mainSvc",function(a,b){function d(){a.currentZpoint.metaData.metaData.forEach(function(d){var g=null,k="";a.currentZpoint.metaData.srcProp.some(function(a){if(d.srcProp===a.columnName)return g=a,!0});if(b.checkUndefinedNull(g)||b.checkUndefinedNull(g.deviceMapping)||
b.checkUndefinedNull(g.deviceMappingInfo))return!1;d.haveToolTip=!0;var k=k+("<b>\u042f\u0447\u0435\u0439\u043a\u0430 \u043f\u0430\u043c\u044f\u0442\u0438 \u043f\u0440\u0438\u0431\u043e\u0440\u0430:</b> "+g.deviceMapping+"<br><br>"),k=k+("<b>\u041d\u0430\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435:</b> <br> "+g.deviceMappingInfo),h="#srcHelpBtn"+d.metaOrder+"srcProp";b.setToolTip("\u041e\u043f\u0438\u0441\u0430\u043d\u0438\u0435 \u043f\u043e\u043b\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430",
k,h,h,10,500)})}a.zpointMetadataIntegratorsFlag=!1;a.data={};a.data.metadataSchema=[{header:"\u041f\u043e\u043b\u0435 \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a",headClass:"col-xs-3 col-md-3",name:"srcProp",type:"select_src_field"},{header:"\u0414\u0435\u043b\u0438\u0442\u0435\u043b\u044c",headClass:"col-xs-1 col-md-1",name:"srcPropDivision",type:"input/text",disabled:!1},{header:"\u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f \u0438\u0441\u0442\u043e\u0447\u043d\u0438\u043a\u0430",
headClass:"col-xs-1 col-md-1",name:"srcMeasureUnit",type:"select_measure_units",disabled:!1},{header:"\u0415\u0434\u0438\u043d\u0438\u0446\u044b \u0438\u0437\u043c\u0435\u0440\u0435\u043d\u0438\u044f \u043f\u0440\u0438\u0435\u043c\u043d\u0438\u043a\u0430",headClass:"col-xs-1 col-md-1",name:"destMeasureUnit",type:"select_measure_units",disabled:!1},{header:"\u041f\u043e\u043b\u0435 \u043f\u0440\u0438\u0435\u043c\u043d\u0438\u043a",headClass:"col-xs-1 col-md-1",name:"destProp",type:"input/text",disabled:!0},
{header:"\u0424\u0443\u043d\u043a\u0446\u0438\u044f",headClass:"col-xs-1 col-md-1",name:"propFunc",type:"input/text",disabled:!0}];a.isDisabled=function(){return a.readOnly};a.changeMetaToolTips=function(){d()};$("#metaDataEditorModal").on("shown.bs.modal",function(){d()})}]}});angular.module("portalNMC").directive("ngRightClick",["$parse",function(a){return function(b,d,g){var l=a(g.ngRightClick);d.bind("contextmenu",function(a){b.$apply(function(){a.preventDefault();l(b,{$event:a})})})}}]);angular.module("portalNMC").directive("nmcCreationReportModal",function(){return{replace:!0,templateUrl:"scripts/directives/templates/nmc-creation-report-modal.html",controller:["$scope","mainSvc",function(a,b){$("#creationReportModal").on("hidden.bs.modal",function(){a.createReportWithParamsRequestCancel();a.createReportWithParamsInProgress=!1;a.createReportProgress=!1})}]}});app=angular.module("portalNMC");
app.directive("nmcParamsetModal",function(){return{replace:!0,templateUrl:"scripts/directives/templates/nmc-paramset-modal.html",controller:["$scope","mainSvc",function(a,b){function d(){a.currentParamSpecialList.forEach(function(b){if("SPECIAL_DATE"!==b.paramSpecialTypeKeyname)return!0;$("#inputSpecialDate"+b.reportMetaParamSpecialId).datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,
beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})})}var g=function(){$("#inputReportSettlementMonth").datepicker({dateFormat:"MM, yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,monthNamesShort:"\u042f\u043d\u0432 \u0424\u0435\u0432 \u041c\u0430\u0440 \u0410\u043f\u0440 \u041c\u0430\u0439 \u0418\u044e\u043d \u0418\u044e\u043b \u0410\u0432\u0433 \u0421\u0435\u043d \u041e\u043a\u0442 \u041d\u043e\u044f \u0414\u0435\u043a".split(" "),
changeMonth:!0,changeYear:!0,showButtonPanel:!0,closeText:"\u041e\u043a",currentText:"",onClose:function(b,d){$(this).datepicker("setDate",new Date(d.selectedYear,d.selectedMonth,1));a.currentObject.settlementMonth=d.selectedMonth+1;a.currentObject.settlementYear=d.selectedYear;setTimeout(function(){$(".ui-datepicker-calendar").addClass("nmc-hide")},1)},beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").addClass("nmc-hide");$(".ui-datepicker-current").addClass("nmc-hide")},1)},
onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-current").addClass("nmc-hide");$(".ui-datepicker-calendar").addClass("nmc-hide")},1)}});$("#inputReportSettlementMonth").datepicker("setDate",new Date(a.currentObject.settlementYear,a.currentObject.settlementMonth-1,1))},l=function(){$("#inputSingleDateStart").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,
beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})},k=function(){$("#inputSingleDateEnd").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display",
"table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}})},h=function(){$("#inputStartDate").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display",
"table")},1)}})};$("#editParamsetModal").on("shown.bs.modal",function(){3<Number(a.currentObject.settlementDay)&&9>=Number(a.currentObject.settlementDay)&&(a.currentObject.settlementDay="0"+a.currentObject.settlementDay,a.$apply());$("#inputFileTemplate").inputmask("Regex",{regex:"[a-zA-Z0-9]+"});$("#inputReportSettlementDay").inputmask("d",{placeholder:""});g();l();k();h();d()});$("#editParamsetModal").on("hidden.bs.modal",function(){a.createReportWithParamsRequestCancel();a.createReportWithParamsInProgress=
!1});a.$watch("currentObject.reportPeriodKey",function(d){if(b.checkUndefinedNull(a.reportPeriods))return console.log(a.reportPeriods),"reportPeriods is undefined or null.";var h;for(h=0;h<a.reportPeriods.length;h+=1)d==a.reportPeriods[h].keyname&&(a.currentSign=a.reportPeriods[h].sign,a.currentReportPeriod=a.reportPeriods[h],null==a.currentSign||"undefined"==typeof a.currentSign)&&(a.paramsetStartDateFormat=null==a.currentObject.paramsetStartDate?null:new Date(a.currentObject.paramsetStartDate),
a.paramsetEndDateFormat=null==a.currentObject.paramsetEndDate?null:new Date(a.currentObject.paramsetEndDate));b.checkUndefinedNull(a.currentReportPeriod)||1!=a.currentReportPeriod.isSettlementMonth||g()},!1);$("#creationReportWindow").on("hidden.bs.modal",function(){a.createReportWithParamsRequestCancel();a.createReportWithParamsInProgress=!1})}]}});app=angular.module("portalNMC");app.directive("nmcProgressModal",function(){return{replace:!0,templateUrl:"scripts/directives/templates/nmc-progress-modal.html",controller:["$scope","mainSvc",function(a,b){$("#progressModal").on("hidden.bs.modal",function(){a.createReportWithParamsRequestCancel();a.createReportWithParamsInProgress=!1;a.createReportProgress=!1})}]}});angular.module("portalNMC").directive("uploadFilesModal",function(){return{replace:!0,restrict:"AEC",scope:!0,templateUrl:"scripts/directives/templates/nmc-upload-files-template.html",controller:["$scope","FileUploader","mainSvc","notificationFactory","$timeout",function(a,b,d,g,l){a.serverUrl="../api/subscr/service/datahwater/contObjects/importData";a.messages=[];a.initFileUploader=function(){a.uploader=new b({url:a.serverUrl,alias:"files"});a.uploader.onErrorItem=function(b,g,l,m){console.info("onErrorItem",
l,g);console.log(g);!d.checkUndefinedNull(g)&&angular.isArray(g.descriptionLines)&&a.messages.push(g.descriptionLines[0]);a.successOnUpload=!1;a.errorOnUpload=!0};a.uploader.onSuccessItem=function(a,b,d,g){};a.uploader.onCompleteAll=function(){a.onUploadAll=!0};$("#upLoadFilesModal").on("shown.bs.modal",function(){});l(function(){$("#upLoadFilesModal").on("hidden.bs.modal",function(){a.uploader.clearQueue();a.uploadFlag=!1;a.successOnUpload=!1;a.errorOnUpload=!1;a.onUploadAll=!1;a.messages=[];a.$apply()})},
10)};a.uploadFiles=function(){a.uploadFlag=!0;a.uploader.uploadAll()};a.initFileUploader()}]}});angular.module("portalNMC").directive("uploadFilesModal",function(){return{replace:!0,restrict:"AEC",scope:!0,templateUrl:"scripts/directives/templates/nmc-upload-files-template.html",controller:["$scope","FileUploader","mainSvc","notificationFactory","$timeout",function(a,b,d,g,l){a.serverUrl="../api/subscr/service/datahwater/contObjects/importData";a.messages=[];a.initFileUploader=function(){a.uploader=new b({url:a.serverUrl,alias:"files"});a.uploader.onErrorItem=function(b,g,l,m){console.info("onErrorItem",
l,g);console.log(g);!d.checkUndefinedNull(g)&&angular.isArray(g.descriptionLines)&&a.messages.push(g.descriptionLines[0]);a.successOnUpload=!1;a.errorOnUpload=!0};a.uploader.onSuccessItem=function(a,b,d,g){};a.uploader.onCompleteAll=function(){a.onUploadAll=!0};$("#upLoadFilesModal").on("shown.bs.modal",function(){});l(function(){$("#upLoadFilesModal").on("hidden.bs.modal",function(){a.uploader.clearQueue();a.uploadFlag=!1;a.successOnUpload=!1;a.errorOnUpload=!1;a.onUploadAll=!1;a.messages=[];a.$apply()})},
10)};a.uploadFiles=function(){a.uploadFlag=!0;a.uploader.uploadAll()};a.initFileUploader()}]}});app=angular.module("portalNMC");app.directive("nmcViewDeleteModalWindow",function(){return{restrict:"AE",replace:!1,templateUrl:"scripts/directives/templates/nmc-view-delete-modal-window.html",scope:{message:"@",confirmLabel:"@",controlCode:"@",deleteItemClick:"&",isSystemuser:"&"},controller:["$scope",function(a){a.confirmCode=null;$("#deleteWindowModal").on("shown.bs.modal",function(){});$("#deleteWindowModal").on("hidden.bs.modal",function(){a.confirmCode=null})}]}});angular.module("portalNMC").directive("nmcViewDeviceScheduler",[function(){return{restrict:"AE",replace:!0,templateUrl:"scripts/directives/templates/nmc-view-device-scheduler.html",scope:{currentDevice:"=",currentScheduler:"=",showOkButton:"@",btnOkClick:"&",btnOkCaption:"@",readOnly:"@"},controller:["$scope","mainSvc",function(a,b){a.checkHHmm=function(a){return b.checkHHmm(a)};a.checkPositiveNumberValue=function(a){return b.checkPositiveNumberValue(a)};a.checkScheduler=function(b){return a.checkHHmm(b.loadingInterval)&&
a.checkHHmm(b.loadingRetryInterval)&&a.checkPositiveNumberValue(b.loadingAttempts)};a.checkAutoLoadingDisabled=function(){return b.checkUndefinedNull(a.currentDevice)||b.checkUndefinedNull(a.currentDevice.activeDataSource)||b.checkUndefinedNull(a.currentDevice.activeDataSource.subscrDataSource)?!1:"CLIENT"===a.currentDevice.activeDataSource.subscrDataSource.rawConnectionType&&!0!==a.currentDevice.activeDataSource.subscrDataSource.rawModemDialEnable};a.isDisabled=function(){return a.readOnly};$("#scheduleEditorModal").on("shown.bs.modal",
function(){})}]}}]);app=angular.module("portalNMC");
app.directive("nmcViewElectricity",function(){return{restrict:"EA",scope:{dataUrl:"=url",columns:"=columns",type:"=type",chartFlag:"=chart"},templateUrl:"scripts/directives/templates/nmc-view-electricity.html",controller:["$scope, $element, $attrs, $http, notificationFactory, mainSvc, $timeout, $window",function(a,b,d,g,l,k,h,p){function m(a,b){return"<div style='font-size:8pt; text-align:center; padding:2px; color:black;'>"+a+"</div>"}a.dirSettings={};a.dirSettings.userFormat="DD.MM.YYYY";a.dirSettings.requestFormat=
"YYYY-MM-DD";a.dirSettings.dataDate=moment().endOf("day").format(a.dirSettings.userFormat);a.dateOptsParamsetRu={locale:{daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},
singleDatePicker:!0,format:a.dirSettings.dateFormat};var n=function(b){b=angular.copy(b.data);b.forEach(function(b){for(var c in a.columns)null!=b[a.columns[c].fieldName]&&"string"!==a.columns[c].type&&(b[a.columns[c].fieldName]=b[a.columns[c].fieldName].toFixed(3))});a.data=b;a.runChart()},e=function(a){a=k.errorCallbackHandler(a);l.errorInfo(a.caption,a.description)};a.refreshData=function(){var b=moment(a.dirSettings.dataDate,a.dirSettings.userFormat).format(a.dirSettings.requestFormat);if(0==
b.localeCompare("Invalid date")||"2000-01-01">b)return"requestDate is Invalid date.";var b=a.dataUrl+"/?beginDate="+b+"&endDate="+b,d;0<=b.indexOf("undefined")?(e({statusText:"\u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u044b\u0439 \u0437\u0430\u043f\u0440\u043e\u0441",data:{request:b,description:"\u0417\u0430\u043f\u0440\u043e\u0441 \u0441\u043e\u0434\u0435\u0440\u0436\u0438\u0442 \u043d\u0435\u043e\u043f\u0440\u0435\u0434\u0435\u043b\u0435\u043d\u043d\u044b\u0435 \u0437\u0430\u043d\u0447\u0435\u043d\u0438\u044f.\n \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b"}}),
d=!1):d=!0;d&&g.get(b).then(n,e)};a.refreshData();h(function(){$("#input"+a.type+"Date").datepicker({dateFormat:"dd.mm.yy",firstDay:a.dateOptsParamsetRu.locale.firstDay,dayNamesMin:a.dateOptsParamsetRu.locale.daysOfWeek,monthNames:a.dateOptsParamsetRu.locale.monthNames,beforeShow:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)},onChangeMonthYear:function(){setTimeout(function(){$(".ui-datepicker-calendar").css("display","table")},1)}});$("#"+a.type+"Chart-view").bootstrapToggle({on:"\u0434\u0430",
off:"\u043d\u0435\u0442"});$("#"+a.type+"Chart-view").change(function(){a.chartFlag=!!$(this).prop("checked");a.$apply()})},10);a.isSystemuser=function(){return k.isSystemuser()};a.runChart=function(){var b=[];a.columns.forEach(function(a){a.graph&&b.push(a)});var d=[],e=b.length,g;for(g=0;g<e;g+=1){var h=a.data.length,k=[],l;for(l=0;l<h;l+=1)k[l]=[a.data[l].dataDate+108E5,Number(a.data[l][b[g].fieldName])];d.push({label:b[g].header,data:k})}$(".nmc-el-view-main-div").width();$.plot("#"+a.type+"Chart-area",
d,{series:{lines:{show:!0},points:{show:!0}},legend:{show:!0,labelFormatter:m,position:"se",margin:[-100,0]},xaxis:{mode:"time"},yaxis:{}})}}]}});app=angular.module("portalNMC");app.directive("nmcViewMessageForUser",function(){return{restrict:"AE",replace:!0,templateUrl:"scripts/directives/templates/nmc-view-message-for-user.html",scope:{messageForUser:"@",btnClick:"&",btnOkCaption:"@",showOkButton:"@",btnCancelCaption:"@",showCancelButton:"@"},controller:["$scope",function(a){$("#messageForUserModal").on("shown.bs.modal",function(){})}]}});app=angular.module("portalNMC");app.directive("nmcViewMeterPeriodsModal",function(){return{restrict:"AE",replace:!0,templateUrl:"scripts/directives/templates/nmc-view-meter-periods-modal.html",scope:{contObjectName:"@",meterPeriodList:"=",resourceSystemList:"=",btnClick:"&",btnOkCaption:"@",showOkButton:"@",btnCancelCaption:"@",showCancelButton:"@"},controller:["$scope",function(a){$("#nmcMeterPeriodsModal").on("shown.bs.modal",function(){})}]}});app=angular.module("portalNMC");
app.directive("showDatasourceModal",function(){return{restrict:"AE",replace:!0,scope:{currentDatasource:"=",dsourceTypes:"=",showOkButton:"@",btnClick:"&",readOnly:"@"},templateUrl:"scripts/directives/templates/show-datasource-modal.html",controller:["$scope","$http","mainSvc",function(a,b,d){function g(b){if(0===a.rawModemModels.length)return null;var d=null;a.rawModemModels.some(function(a){if(a.id===b)return d=a,!0});return d}(function(){b.get("../api/rma/dataSources/rawModemModels").then(function(b){a.rawModemModels=b.data},
function(a){console.log(a)})})();a.DEVICE_MODES=[{caption:"\u0421\u0435\u0440\u0432\u0435\u0440",keyname:"SERVER"},{caption:"\u041a\u043b\u0438\u0435\u043d\u0442",keyname:"CLIENT"}];a.changeModemModel=function(){var b=g(a.currentDatasource.rawModemModelId);a.currentDatasource.rawModemIdentity=b.rawModemModelIdentity;a.currentDatasource.rawModemDialupAvailable=b.isDialup};a.checkPositiveNumberValue=function(a){return d.checkPositiveNumberValue(a)};a.isDisabled=function(){return a.readOnly};$("#showDatasourceModal").on("shown.bs.modal",
function(){$("#inputDataSourceMode").focus();$("#inputDSTimeout").inputmask();$("#inputDSCheckInterval").inputmask();$("#inputDSRepeatCount").inputmask();$("#inputDSReconnectionCount").inputmask();$("#inputDSReconnectionInterval").inputmask();d.checkUndefinedNull(a.currentDatasource.rawTimeout)&&(a.currentDatasource.rawTimeout=25);d.checkUndefinedNull(a.currentDatasource.rawSleepTime)&&(a.currentDatasource.rawSleepTime=250);d.checkUndefinedNull(a.currentDatasource.rawResendAttempts)&&(a.currentDatasource.rawResendAttempts=
3);d.checkUndefinedNull(a.currentDatasource.rawReconnectAttempts)&&(a.currentDatasource.rawReconnectAttempts=1);d.checkUndefinedNull(a.currentDatasource.rawReconnectTimeout)&&(a.currentDatasource.rawReconnectTimeout=60);if(d.checkUndefinedNull(a.currentDatasource.rawModemIdentity)&&!d.checkUndefinedNull(a.currentDatasource.rawModemModelId)){var b=g(a.currentDatasource.rawModemModelId);a.currentDatasource.rawModemIdentity=b.rawModemModelIdentity;a.currentDatasource.rawModemDialupAvailable=b.isDialup}a.$apply()})}]}});app=angular.module("portalNMC");
app.directive("nmcShowDeviceModal",function(){return{restrict:"AE",replace:!1,scope:{currentDevice:"=",deviceSources:"=",deviceModels:"=",contObjects:"=",readOnly:"@",btnClick:"&",btnOkCaption:"@",showOkButton:"@"},templateUrl:"scripts/directives/templates/show-device-modal.html",controller:["$scope","mainSvc","$cookies",function(a,b,d){a.isDeviceDisabled=function(b){return a.readOnly||"VZLET"===b.exSystemKeyname||"LERS"===b.exSystemKeyname||!0===b.isSaving};a.isDeviceDataSourceHide=function(a){return"VZLET"===
a.exSystemKeyname||"LERS"===a.exSystemKeyname||!0===a.isSaving};a.isDeviceProtoLoaded=function(a){return"VZLET"===a.exSystemKeyname||"LERS"===a.exSystemKeyname};a.changeDeviceModel=function(){b.checkUndefinedNull(a.currentDevice.deviceModelId)||(d.recentDeviceModelId=a.currentDevice.deviceModelId)};a.deviceDatasourceChange=function(){a.currentDevice.dataSourceTable1h=null;a.currentDevice.dataSourceTable24h=null;var g=a.currentDevice.subscrDataSourceAddr=null;a.deviceSources.some(function(b){if(b.id===
a.currentDevice.subscrDataSourceId)return g=b,!0});a.currentDevice.curDatasource=g;b.checkUndefinedNull(a.currentDevice.subscrDataSourceId)||(d.recentDataSourceId=a.currentDevice.subscrDataSourceId)};a.isAvailableConPropertiesTab=function(){return b.checkUndefinedNull(a.currentDevice)||b.checkUndefinedNull(a.currentDevice.curDatasource)?!1:!0===a.currentDevice.curDatasource.dataSourceType.isRaw||!0===a.currentDevice.curDatasource.dataSourceType.isDbTablePair||"VZLET"===a.currentDevice.exSystemKeyname};
$("#showDeviceModal").on("shown.bs.modal",function(){})}]}});app=angular.module("portalNMC");
app.service("logSvc",["$rootScope","$http","$interval","mainSvc","$q",function(a,b,d,g,l){function k(a){return g.checkUndefinedNull(a)||!angular.isArray(a)||0==a.length?null:a.map(function(a){var b={};b.id=a.id;g.checkUndefinedNull(a.dataSourceInfo)||(b.dataSource=a.dataSourceInfo.caption||a.dataSourceInfo.dataSourceName);g.checkUndefinedNull(a.deviceObjectInfo)||(b.deviceModel=a.deviceObjectInfo.deviceModelName,b.deviceNumber=a.deviceObjectInfo.number);b.startDate=a.sessionDateStr;b.endDate=a.sessionEndDateStr;
g.checkUndefinedNull(a.authorInfo)||(b.author=a.authorInfo.authorName);b.currentStatus=a.sessionStatus;b.statusMessage=a.statusMessage;b.sessionMessage=a.sessionMessage;b.sessionUuid=a.sessionUuid;b.masterSessionUuid=a.masterSessionUuid;e.some(function(c){if(c.keyname==a.sessionStatus)return b.currentStatusColor=c.color,!0});return b})}function h(){if(!g.checkUndefinedNull(c)&&angular.isArray(c)&&0!=c.length){var a=[],b=[];angular.copy(c).forEach(function(c){g.checkUndefinedNull(c.masterSessionUuid)?
a.push(c):(g.checkUndefinedNull(b[c.masterSessionUuid])&&(b[c.masterSessionUuid]=[]),b[c.masterSessionUuid].push(angular.copy(c)))});for(var d in b)a.some(function(a){if(d==a.sessionUuid)return a.childs=b[d],!0});return a}}function p(b){if(g.checkUndefinedNull(b.data)||!angular.isArray(b.data)||0==b.data.length)c=[];else if(c=k(angular.copy(b.data)),g.checkUndefinedNull(f.contObjectIds)||0>=f.contObjectIds.length)c=h();a.$broadcast("logSvc:sessionsLoaded")}function m(a){console.log(a)}function n(){b({method:"GET",
url:"../api/rma/logSessions",params:f}).then(p,m)}var e=[{keyname:"LOADING",color:"YELLOW"},{keyname:"PARSING",color:"YELLOW"},{keyname:"DB INSERTING",color:"YELLOW"},{keyname:"COMPLETE",color:"GREEN"},{keyname:"COMPLETE WITH ERROR",color:"RED"},{keyname:"FAILURE",color:"RED"}],c=null,f={},r={startDate:moment().startOf("day"),endDate:moment().endOf("day")};f.fromDate=r.startDate.format("YYYY-MM-DD");f.toDate=r.endDate.format("YYYY-MM-DD");var q=null,v=null;a.$on("logSvc:requestSessionsLoading",function(a,
b){null!=q&&(d.cancel(q),q=null);f=b.params;r={startDate:f.fromDate,endDate:f.toDate};n();q=d(n,6E4)});a.$on("logSvc:cancelInterval",function(){null!=q&&(d.cancel(q),q=null)});v=l.defer();f.timeout=v.promise;return{getRequestCanceler:function(){return v},getSessions:function(){return c},getSessionsLogDaterange:function(){return r},serverDataParser:k,setSessionsLogDaterange:function(a){r=a}}}]);app=angular.module("portalNMC");
app.service("mainSvc",["$cookies","$http","$rootScope","$log","objectSvc","monitorSvc","$q","$timeout",function(a,b,d,g,l,k,h,p){function m(a){var b=!1;if(angular.isUndefined(a)||null==a)b=!0;return b}function n(a){return 0===Object.keys(a).length&&a.constructor===Object}function e(a){console.log(a)}function c(a,b){var c="";0<a&&(10>a&&(c+="0"),c+=a+b);return c}function f(a,c,f){b.get(u+"?subscrPrefKeyname="+a,E).then(function(a){t.mapSettings[c]=a.data.value;m(f)||d.$broadcast(f)},e)}function r(a){return!isNaN(parseFloat(a))&&
isFinite(a)}function q(a,b){if(!angular.isArray(a))return"Input value is no array.";if(m(b))return"Field for sort is undefined or null.";a.sort(function(a,c){return m(a[b])&&m(c[b])?0:m(a[b])?-1:m(c[b])||a[b].toUpperCase()>c[b].toUpperCase()?1:a[b].toUpperCase()<c[b].toUpperCase()?-1:0})}function v(a){var b=Q;if(I(a))return b;N.some(function(c){if(c.resultCode==a)return b=c,!0});return b}var t={subscrUrl:"../api/subscr"};t.servicePermissionUrl=t.subscrUrl+"/manage/service/permissions";t.loadingServicePermissionFlag=
!1;t.serverTimeZone=3;t.mapSettings={};var u=t.subscrUrl+"/subscrPrefValue",w=[],x=null,E=null,G={zoom:null,lat:null,lng:null},C={zoom:null,lat:null,lng:null},A={locale:{applyClass:"btn-green",applyLabel:"\u041f\u0440\u0438\u043c\u0435\u043d\u0438\u0442\u044c",fromLabel:"\u0441",toLabel:"\u043f\u043e",cancelLabel:"\u041e\u0442\u043c\u0435\u043d\u0430",customRangeLabel:"\u041f\u0435\u0440\u0438\u043e\u0434",daysOfWeek:"\u0412\u0441 \u041f\u043d \u0412\u0442 \u0421\u0440 \u0427\u0442 \u041f\u0442 \u0421\u0431".split(" "),
firstDay:1,monthNames:"\u042f\u043d\u0432\u0430\u0440\u044c \u0424\u0435\u0432\u0440\u0430\u043b\u044c \u041c\u0430\u0440\u0442 \u0410\u043f\u0440\u0435\u043b\u044c \u041c\u0430\u0439 \u0418\u044e\u043d\u044c \u0418\u044e\u043b\u044c \u0410\u0432\u0433\u0443\u0441\u0442 \u0421\u0435\u043d\u0442\u044f\u0431\u0440\u044c \u041e\u043a\u0442\u044f\u0431\u0440\u044c \u041d\u043e\u044f\u0431\u0440\u044c \u0414\u0435\u043a\u0430\u0431\u0440\u044c".split(" ")},ranges:{"\u0422\u0435\u043a\u0443\u0449\u0438\u0439 \u0434\u0435\u043d\u044c":[moment().startOf("day"),
moment().endOf("day")],"\u041f\u043e\u0441\u043b 7 \u0434\u043d\u0435\u0439":[moment().subtract(6,"days").startOf("day"),moment().endOf("day")],"\u041f\u043e\u0441\u043b 30 \u0434\u043d\u0435\u0439":[moment().subtract(29,"days").startOf("day"),moment().endOf("day")]},startDate:moment(a.fromDate)||moment().subtract(6,"days").startOf("day"),endDate:moment(a.toDate)||moment().endOf("day"),format:"DD.MM.YYYY",separator:" \u043f\u043e "};A.startDate=moment().subtract(6,"days").startOf("day");A.endDate=
moment().endOf("day");A.maxDate=moment().endOf("day");b.get("../api/systemInfo/fullUserInfo",E).success(function(a,b,c,e){a=angular.copy(a);a.userNameCaption=10<a.userName.length?a.userName.substring(0,10)+"...":a.userName;a.userSubscrCaption=15<a.subscriber.subscriberName.length?a.subscriber.subscriberName.substring(0,15)+"...":a.subscriber.subscriberName;d.userInfo=a}).error(function(a){console.log(a)});d.$on("mainSvc:loadMapCenterLat",function(){f("SUBSCR_LAT_MAP_PREF","mapCenterLat","mainSvc:loadMapCenterLng")});
d.$on("mainSvc:loadMapCenterLng",function(){f("SUBSCR_LNG_MAP_PREF","mapCenterLng","mainSvc:loadMapZoom")});d.$on("mainSvc:loadMapZoom",function(){f("SUBSCR_ZOOM_MAP_PREF","mapZoom","mainSvc:setMapSettingsInServices")});d.$on("mainSvc:setMapSettingsInServices",function(){n(t.mapSettings)||(l.setObjectSettings(t.mapSettings),k.setMonitorSettings(t.mapSettings))});var z=function(a,b){var c=!1;angular.isDefined(a)&&(c=a[b]);return c},H=function(){return z(d.userInfo,"isCabinet")},D=[{keyname:"WEB_ALLOW_SETTING_MAIN_MENU_ITEM",
permissionTagId:"setting_main_menu_item",priority:100},{keyname:"WEB_ALLOW_REPORT_MAIN_MENU_ITEM",permissionTagId:"report_main_menu_item",priority:100}],I=function(a){var b=!1;if(angular.isUndefined(a)||null==a||""===a)b=!0;return b},B=function(a){return""===a||null==a?!0:r(a)?!0:!1},O=function(a){var b;b=B(a);return b?b=0<=parseInt(a,10)?!0:!1:b},Q={resultCode:"ERR_DEFAULT",caption:"\u041d\u0435\u043f\u0440\u0435\u0434\u0432\u0438\u0434\u0435\u043d\u043d\u0430\u044f \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u044f",
description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},N=[{resultCode:"ERR_UNCKNOWN",caption:"\u041d\u0435\u0438\u0437\u0432\u0435\u0441\u0442\u043d\u0430\u044f \u043e\u0448\u0438\u0431\u043a\u0430",description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},
{resultCode:"ERR_ACCESS_DENIED",caption:"\u041e\u0442\u043a\u0430\u0437\u0430\u043d\u043e \u0432 \u0434\u043e\u0441\u0442\u0443\u043f\u0435",description:"\u0423 \u0432\u0430\u0441 \u043d\u0435\u0442 \u043f\u0440\u0430\u0432 \u0434\u043e\u0441\u0442\u0443\u043f\u0430. \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},{resultCode:"ERR_UNPROCESSABLE_TRANSACTION",
caption:"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0442\u0440\u0430\u043d\u0437\u0430\u043a\u0446\u0438\u044e",description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},{resultCode:"ERR_DATABASE_ERROR",caption:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0431\u0430\u0437\u044b \u0434\u0430\u043d\u043d\u044b\u0445",
description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},{resultCode:"ERR_BRM_VALIDATION",caption:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438 \u0431\u0438\u0437\u043d\u0435\u0441-\u043f\u0440\u0430\u0432\u0438\u043b",description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},
{resultCode:"ERR_VALIDATION",caption:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0432\u0430\u043b\u0438\u0434\u0430\u0446\u0438\u0438",description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},{resultCode:"ERR_INTERNAL",caption:"\u0412\u043d\u0443\u0442\u0440\u0435\u043d\u043d\u044f\u044f \u043e\u0448\u0438\u0431\u043a\u0430 \u0441\u0435\u0440\u0432\u0435\u0440\u0430",
description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},{resultCode:"ERR_INVALID_STATE",caption:"\u041e\u0448\u0438\u0431\u043a\u0430 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u044f",description:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435\u0441\u044c \u043a \u0430\u0434\u043c\u0438\u043d\u0438\u0441\u0442\u0440\u0430\u0442\u043e\u0440\u0443 \u0441\u0438\u0441\u0442\u0435\u043c\u044b."},
{resultCode:"ERR_USER_ALREADY_EXISTS",caption:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442",description:"\u041f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u0435\u043b\u044c \u0441 \u0442\u0430\u043a\u0438\u043c \u043b\u043e\u0433\u0438\u043d\u043e\u043c \u0443\u0436\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u043f\u0440\u0430\u0432\u0438\u043b\u044c\u043d\u043e\u0441\u0442\u044c \u043d\u0430\u0431\u043e\u0440\u0430."},
{resultCode:"ERR_CONNECTION",caption:"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u0434\u043a\u043b\u044e\u0447\u0435\u043d\u0438\u044f",description:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u043e\u0442 \u0441\u0435\u0440\u0432\u0435\u0440\u0430. \u041f\u0440\u043e\u0432\u0435\u0440\u044c\u0442\u0435 \u0441\u043e\u0435\u0434\u0438\u043d\u0435\u043d\u0438\u0435 \u0441 \u0441\u0435\u0440\u0432\u0435\u0440\u043e\u043c."}],
L=function(a,b){var c=null;if(!angular.isArray(b.childObjectList))return c;b.childObjectList.some(function(b){if(a.id==b.id&&a.objectName==b.objectName)return c=b,!0;c=L(a,b);return null!=c});return c},R=function(a,b){!m(a.childObjectList)&&angular.isArray(a.childObjectList)&&(q(a.childObjectList,b),a.childObjectList.forEach(function(a){R(a,b)}))},x=h.defer(),E={timeout:x.promise};(function(){b.get(u+"?subscrPrefKeyname=SUBSCR_MAP_PREF",E).then(function(a){!0===a.data.isActive&&d.$broadcast("mainSvc:loadMapCenterLat")},
e)})();return{checkContext:function(a){var b=!1;w.some(function(c){if(0===c.permissionTagId.localeCompare(a))return b=!0});return b},checkEmptyObject:n,checkHHmm:function(a){return/(0[0-9]|1[0-9]|2[0-3]){1,2}:([0-5][0-9]){1}/.test(a)?!0:!1},checkNumericValue:B,checkPositiveNumberValue:O,checkStrForDate:function(a){return/(0[1-9]|[12][0-9]|3[01])[\- \/.](0[1-9]|1[012])[\- \/.](19|20)\d\d/.test(a)?!0:!1},checkUndefinedEmptyNullValue:I,checkUndefinedNull:m,dateFormating:function(a,b){var c=new Date(a+
Math.round(36E5*t.serverTimeZone));return null===c?"":moment([c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes()]).format(b)},errorCallbackHandler:function(a){console.log(a);var b="-1";if(m(a)||m(a.data))b="ERR_CONNECTION";m(a)||m(a.resultCode)&&(m(a.data)||m(a.data.resultCode))||(b=a.resultCode||a.data.resultCode);return v(b)},findItemBy:function(a,b,c){var d=null;if(!angular.isArray(a))return console.log("Input value is no array."),d;if(m(c))return console.log("value for search is undefined or null."),
d;m(b)?a.some(function(a){if(a==c)return d=a,!0}):a.some(function(a){if(a[b]==c)return d=a,!0});return d},findNodeInTree:L,getConfirmCode:function(a){var b=10*Math.random(),c=100*Math.random();m(a)||!0!==a||(b=1E3*Math.random()+100,c=1E3*Math.random()+100);a=Math.round(b);c=Math.round(c);return{label:a+" + "+c+" = ",result:a+c}},getContextIds:function(){return w},getHtmlLoading:function(){return'<head><meta charset="utf-8"><link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css"/></head><body><div  ng-show="loading" class="nmc-loading"><i class="fa fa-spinner fa-spin"></i> \u0417\u0430\u0433\u0440\u0443\u0437\u043a\u0430 ... </div></body>'},
getLoadingServicePermissionFlag:function(){return t.loadingServicePermissionFlag},getLoadedServicePermission:function(){return t.loadedServicePermission},getMonitorMapSettings:function(){return C},getObjectMapSettings:function(){return G},getDateRangeOptions:function(b,c){var e=null;switch(b){case "ru":e=A;break;case "monitor-ru":e=A;break;case "indicator-ru":e=angular.copy(A),e.startDate=angular.isDefined(a.fromDate)&&null!=a.fromDate?moment(a.fromDate).startOf("day"):moment(d.reportStart).startOf("day"),
e.endDate=angular.isDefined(a.toDate)&&null!=a.toDate?moment(a.toDate).startOf("day"):moment(d.reportEnd).startOf("day"),m(c)||m(c.minDate)||(e.minDate=c.minDate)}return e},getRequestCanceler:function(){return x},getServerTimeZone:function(){return t.serverTimeZone},getServerErrorByResultCode:v,getUseColorHighlightIndicatorData:function(){return!0},getUserServicesPermissions:function(){t.loadingServicePermissionFlag=!0;t.loadedServicePermission=b.get(t.servicePermissionUrl,E).then(function(a){w=a.data;
H()||w.push(D[0],D[1]);t.loadingServicePermissionFlag=!1;d.$broadcast("servicePermissions:loaded")},function(a){console.log(a);t.loadingServicePermissionFlag=!1})},getUseTest:function(){return!0},getViewSystemInfo:function(){return!0},isAdmin:function(){var a=!1,b=d.userInfo;angular.isDefined(b)&&(a=b.isAdmin);return a},isCabinet:H,isNumeric:r,isPositiveNumberValue:function(a){return m(a)?!1:O(a)},isRma:function(){var a=!1,b=d.userInfo;angular.isDefined(b)&&(a=b.isRma);return a},isReadonly:function(){var a=
!1,b=d.userInfo;angular.isDefined(b)&&(a=b.isReadonly);return a},isSystemuser:function(){var a=!1,b=d.userInfo;angular.isDefined(b)&&(a=b._system);return a},isTestMode:function(){var a=!0;m(d.userInfo)||(a="TEST_CERTIFICATE"===z(d.userInfo,"subscrType"));return a},prepareTimeOffset:function(a){var b=null;m(a)||(b=1===a.timeDeltaSign?"+":"-",b+=c(a.years,"\u0433 "),b+=c(a.mons,"\u041c "),b+=c(a.days,"\u0434 "),b+=c(a.hh,"\u0447 "),b+=c(a.mm,"\u043c "),b+=c(a.ss,"\u0441 "));return b},setMonitorMapSettings:function(a){C=
a},setObjectMapSettings:function(a){G=a},setToolTip:function(a,b,c,d,e,f,g,h,k){var l=1;m(e)||(l=e);var B=1E3;m(f)||(B=f);var n="top right";m(g)||(n=g);var q="bottom right";m(h)||(q=h);var r="qtip-nmc-indicator-tooltip";m(k)||(r=k);p(function(){$(c).qtip({suppress:!1,content:{text:b,title:a,button:!0},show:{event:"click"},style:{classes:r,width:B},hide:{event:"unfocus"},position:{my:n,at:q,target:$(d)}})},l)},sortItemsBy:q,sortNumericItemsBy:function(a,b){if(!angular.isArray(a))return"Input value is no array.";
if(m(b))return"Field for sort is undefined or null.";a.sort(function(a,c){return m(a[b])&&m(c[b])?0:m(a[b])?-1:m(c[b])||a[b]>c[b]?1:a[b]<c[b]?-1:0})},sortOrganizationsByName:function(a){if(!angular.isArray(a))return"Param is no array.";q(a,"organizationName")},sortTreeNodesBy:R,strDateToUTC:function(a,b){var c=new Date(moment(a,b).format("YYYY-MM-DD"));return isNaN(c.getTime())?null:Date.UTC(c.getFullYear(),c.getMonth(),c.getDate())}}}]);angular.module("portalNMC").service("meterPeriodsSvc",["$http","$cookies","$interval","$rootScope","$q",function(a,b,d,g,l){return{loadMeterPeriods:function(){return a.get("../api/subscr/meter-period-settings")},saveMeterPeriod:function(b,d){return a({method:b,url:"../api/subscr/meter-period-settings",data:d})},deleteMeterPeriod:function(b){a["delete"]("../api/subscr/meter-period-settings/"+b)}}}]);app=angular.module("portalNMC");
app.service("monitorSvc",["$rootScope","$http","$interval","$cookies","$location","objectSvc","$q",function(a,b,d,g,l,k,h){function p(){return x(u)||x(w)}function m(a){console.log(a)}function n(a){if(angular.isUndefined(a)||null==a||!angular.isArray(a))return!1;var b=[];a.forEach(function(a){a.contEventNotificationStatuses.forEach(function(a){b.push(a)})});return b}function e(a){var b="";a.forEach(function(a){var c=new Date(a.contEventTime),d="";"RED"===a.contEventLevelColorKeyname&&(d="color: red;");
a="<p style='"+d+"'>"+c.toLocaleString()+", "+a.contEventType.name+"</p>";b+=a});return b}function c(){}function f(){angular.isDefined(C)&&(d.cancel(C),C=void 0)}var r=null,q=[],v=[],t={refreshPeriod:"300",loadingFlag:!0,noGreenObjectsFlag:!1};t.fromDate=moment().subtract(6,"days").startOf("day").format("YYYY-MM-DD");t.toDate=moment().endOf("day").format("YYYY-MM-DD");var u=null,w=null,x=function(a){var b=!1;if(angular.isUndefined(a)||null==a)b=!0;return b},E=function(b){console.log(b);v=[];q=[];
t.loadingFlag=!1;a.$broadcast("monitorObjects:updated")},G=function(c,d){if(x(c))return 400;d.loadingFlag=!0;var e=c+"/?fromDate="+d.fromDate+"&toDate="+d.toDate+"&noGreenColor="+d.noGreenObjectsFlag;x(d.contGroupId)||(e+="&contGroupId="+d.contGroupId);if(!0===p())return null;b.get(e,w).success(function(b){v=b;q=n(b);k.sortObjectsByConObjectFullName(q);d.loadingFlag=!1;a.$broadcast("monitorObjects:updated")}).error(E)},C;a.$on("monitor:periodChanged",function(){f();C=d(c,1E3*Number(t.refreshPeriod))},
!1);C=d(c,1E3*Number(t.refreshPeriod));var A=function(){return!0===p()?null:b.get("../api/subscr/subscrPrefValue?subscrPrefKeyname=SUBSCR_OBJECT_TREE_CONT_OBJECTS",w)},z=function(){A().then(function(b){t.isTreeView=b.data.isActive;!0===t.isTreeView&&!0!==t.isFullObjectView?(t.defaultTreeId=Number(b.data.value),x(t.curTreeId)&&(t.curTreeId=t.defaultTreeId),x(t.curTreeNodeId)?(v=[],q=[],t.loadingFlag=!1,a.$broadcast("monitorObjects:updated")):(r="../api/subscr/subscrObjectTree/contObjectTreeType1/"+
t.curTreeId+"/node/"+t.curTreeNodeId+"/contObjects/cityStatusCollapseV2",G(r,t))):(r=angular.copy("../api/subscr/contEvent/notifications/contObject/cityStatusCollapseV2"),G(r,t))},E)};a.$on("monitor:updateObjectsRequest",function(){z()});a.$on("$destroy",function(){alert("MonitorSvc destroy");f()});u=h.defer();w={timeout:u.promise};return{checkUndefinedNull:x,getAllMonitorObjects:function(){return q},getAllMonitorCities:function(){return v},getLoadingStatus:function(){return t.loadingFlag},getMonitorEventsByObject:function(c){var d=
"../api/subscr/contEvent/notifications/contObject/"+c.contObject.id+"/monitorEvents";if(!0===p())return null;b.get(d,w).success(function(b){if(b.hasOwnProperty("length")&&0!=b.length){var d="";b.forEach(function(a){var b=new Date(a.contEventTime),c="";"RED"===a.contEventLevelColorKey&&(c="color: red;");a="<p style='"+c+"'>"+b.toLocaleString()+", "+a.contEventType.name+"</p>";d+=a});if("YELLOW"===c.statusColor)c.monitorEvents="\u041d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043d\u0435\u0442 \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439";
else if("RED"===c.statusColor||"ORANGE"===c.statusColor)c.monitorEvents=d,c.monitorEventsForMap=b;a.$broadcast("monitorObjects:getObjectEvents",{obj:c})}else"YELLOW"===c.statusColor&&(c.monitorEvents="\u041d\u0430 \u043e\u0431\u044a\u0435\u043a\u0442\u0435 \u043d\u0435\u0442 \u043d\u0435\u0448\u0442\u0430\u0442\u043d\u044b\u0445 \u0441\u0438\u0442\u0443\u0430\u0446\u0438\u0439",a.$broadcast("monitorObjects:getObjectEvents",{obj:c}))}).error(m)},getMonitorEventsByObjectForMap:function(a){var c="../api/subscr/contEvent/notifications/contObject/"+
a.contObject.id+"/monitorEventsV2";if(!0===p())return null;b.get(c,w).success(function(b){!b.hasOwnProperty("length")||0===b.length||"RED"!==a.contEventLevelColorKey&&"YELLOW"!==a.contEventLevelColorKey||(a.monitorEventsForMap=b)}).error(m)},getMonitorEventsForObject:function(c){var d="../api/subscr/contEvent/notifications/contObject/"+c.id+"/monitorEventsV2";if(!0===p())return null;b.get(d,w).success(function(b){if(b.hasOwnProperty("length")&&0!==b.length){if("RED"===c.contObjectStats.contEventLevelColor||
"YELLOW"===c.contObjectStats.contEventLevelColor)c.monitorEvents=e(b),c.monitorEventsForMap=b;a.$broadcast("monitorObjects:getObjectEvents",{obj:c})}}).error(m)},getMonitorSettings:function(){return t},getRequestCanceler:function(){return u},loadDefaultMonitorTreeSetting:A,loadMonitorEventsForObject:function(a){a="../api/subscr/contEvent/notifications/contObject/"+a+"/monitorEventsV2";return!0===p()?null:b.get(a,w)},prepareEventMessage:e,setMonitorSettings:function(a){for(var b in a)t[b]=a[b]}}}]);angular.module("portalNMC").factory("notificationFactory",function(){return{success:function(){toastr.success("\u0423\u0441\u043f\u0435\u0448\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0435\u043d\u043e.")},successInfo:function(a){toastr.success(a)},info:function(a){toastr.success(a)},error:function(a){toastr.error(a,"\u041e\u0448\u0438\u0431\u043a\u0430!")},errorInfo:function(a,b){toastr.error(b,a)},warning:function(a){toastr.warning(a)}}});app=angular.module("portalNMC");
app.service("objectSvc",["$http","$cookies","$interval","$rootScope","$q",function(a,b,d,g,l){function k(){return u(v)||u(t)}function h(a){z(a,"fullName")}var p={BUILDING_TYPES_LOADED:"objectSvc:buildingTypesLoaded",BUILDING_CATEGORIES_LOADED:"objectSvc:buildingCategoriesLoaded"},m=[],n={},e={},c=null,f={},r=[],q=[],v=null,t=null,u=function(a){var b=!1;if(angular.isUndefined(a)||null===a)b=!0;return b},w=function(){return!0===k()?null:a.get("../api/rma/contObjects/rsoOrganizations",t)},x=function(){return!0===
k()?null:a.get("../api/rma/contObjects/cmOrganizations",t)},E=function(b,c,d){b=b+"?measureUnit="+d.all[c].keyname;if(!0===k())return null;a.get(b,t).then(function(a){d[d.all[c].keyname]=a.data},function(a){console.log(a)})},G=function(){return!0===k()?null:a.get("../api/subscr/deviceObjects/metaVzlet/system",t)},C=[],A=function(b){var c="../api/rma/contObjects";u(b)||(c+="?contGroupId="+b);return!0===k()?null:a.get(c,t)},z=function(a,b){if(!angular.isArray(a))return"Input value is no array.";if(u(b))return"Field for sort is undefined or null.";
a.sort(function(a,c){return u(a[b])&&u(c[b])?0:u(a[b])?-1:u(c[b])||a[b].toUpperCase()>c[b].toUpperCase()?1:a[b].toUpperCase()<c[b].toUpperCase()?-1:0})},H=null,D=null,I=function(b,c){console.time("Object loading");var d="../api/subscr/contObjects";u(b)||(d+="?contGroupId="+b);H=!0===k()?null:a.get(d,t);if(u(c)||!0!==c)D=A(b)};g.$on("objectSvc:requestReloadData",function(a,b){var c=null,d=!1;u(b)||u(b.contGroupId)||(c=b.contGroupId);u(b)||u(b.onlySubscrList)||(d=!!b.onlySubscrList);I(c,d)});b=function(b){a.get(b).then(function(a){m=
angular.copy(a.data)},function(a){console.log(a)})};v=l.defer();t={timeout:v.promise};(function(){G().then(function(a){C=a.data},function(a){console.log(a)})})();(function(){if(!0===k())return null;a.get("../api/rma/contObjects/deviceObjects/metadata/measureUnits",t).then(function(a){n.all=a.data;n.all.forEach(function(a,b){E("../api/rma/contObjects/deviceObjects/metadata/measureUnits",b,n)});g.$broadcast("objectSvc:deviceMetadataMeasuresLoaded")},function(a){console.log(a)})})();(function(){a.get("../api/subscr/service/buildingType/list").then(function(a){g.$broadcast(p.BUILDING_TYPES_LOADED);
if(u(a)||u(a.data)||!angular.isArray(a.data))return console.log("Building type list is empty!"),!1;r=angular.copy(a.data)},function(a){console.log(a)})})();(function(){a.get("../api/subscr/service/buildingType/category/list").then(function(a){g.$broadcast(p.BUILDING_CATEGORIES_LOADED);if(u(a)||u(a.data)||!angular.isArray(a.data))return console.log("Building category list is empty!"),!1;q=angular.copy(a.data)},function(a){console.log(a)})})();b("../api/subscr/subscrObjectTreeTemplates");I();return{BROADCASTS:p,
OBJECT_PER_SCROLL:42,createTree:function(b){return a.post("../api/subscr/subscrObjectTree/contObjectTreeType1",b)},deleteTree:function(b){return a["delete"]("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b)},deleteTreeNode:function(b,c){return a["delete"]("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+c)},getAllDevices:function(){return!0===k()?null:a.get("../api/rma/contObjects/deviceObjects",t)},getBuildingCategories:function(){return q},getBuildingTypes:function(){return r},
getCityConsumingData:function(b,c){var d="../api/subscr/service/hwater/contObjects/serviceTypeInfo/city/?dateFrom="+c.dateFrom+"&dateTo="+c.dateTo+"&cityFias="+b;return!0===k()?null:a.get(d,t)},getCitiesConsumingData:function(b){b="../api/subscr/service/hwater/contObjects/serviceTypeInfo/?dateFrom="+b.dateFrom+"&dateTo="+b.dateTo;return!0===k()?null:a.get(b,t)},getCmOrganizations:x,getCmOrganizationsWithId:function(b){if(u(b))return x();b="../api/rma/contObjects/cmOrganizations?organizationId="+b;
return!0===k()?null:a.get(b,t)},getCurrentObject:function(){return c},getDatasourcesUrl:function(){return"../api/rma/dataSources"},getDeviceModels:function(){return!0===k()?null:a.get("../api/rma/deviceObjects/deviceModels",t)},getDeviceSchedulerSettings:function(b,c){var d="../api/subscr/contObjects/"+b+"/deviceObjects/"+c+"/subscrDataSource/loadingSettings";return!0===k()?null:a.get(d,t)},getImpulseCounterTypes:function(){return!0===k()?null:a.get("../api/rma/deviceObjects/impulseCounterTypes",
t)},getMeterPeriodByObject:function(b){return a.get("../api/subscr/contObjects/"+b+"/meterPeriodSettings")},getObject:function(b){return angular.isUndefined(b)||null===b?"Object id is null or undefined":!0===k()?null:a.get("../api/subscr/contObjects/"+b,t)},getObjectConsumingData:function(b,c){var d="../api/subscr/service/hwater/contObjects/serviceTypeInfo/"+c+"/?dateFrom="+b.dateFrom+"&dateTo="+b.dateTo;return!0===k()?null:a.get(d,t)},getObjectSettings:function(){return f},getDevicesByObject:function(b){b=
"../api/subscr/contObjects/"+b.id+"/deviceObjects";return!0===k()?null:a.get(b,t)},getRequestCanceler:function(){return v},getRmaDeviceMetadata:function(b,c){var d="../api/rma/contObjects/"+b+"/deviceObjects/"+c+"/metadata";return!0===k()?null:a.get(d,t)},getDeviceDatasources:function(b,c){var d="../api/rma/contObjects/"+b+"/deviceObjects/"+c+"/subscrDataSource";return!0===k()?null:a.get(d,t)},getDeviceMetadataMeasures:function(){return n},getDeviceMetaDataVzlet:function(b,c){var d="../api/subscr/contObjects/"+
b.id+"/deviceObjects/"+c.id+"/metaVzlet";return!0===k()?null:a.get(d,t)},getDeviceMetaDataVzletSystemList:G,getLoadingStatus:function(){return!0},getObjectsUrl:function(){return"../api/subscr/contObjects"},getPromise:function(){return H},getRmaDeviceMetaDataVzlet:function(b,c){var d="../api/rma/contObjects/"+b+"/deviceObjects/"+c.id+"/metaVzlet";return!0===k()?null:a.get(d,t)},getRmaMetadataMeasureUnit:E,getRmaObject:function(b){return angular.isUndefined(b)||null===b?"Object id is null or undefined":
!0===k()?null:a.get("../api/rma/contObjects/"+b,t)},getRmaObjectsData:A,getRmaObjectSubscribers:function(b){b="../api/rma/contObjects/"+b+"/subscribers";return!0===k()?null:a.get(b,t)},getRmaObjectsUrl:function(){return"../api/rma/contObjects"},getRmaPromise:function(){return D},getRefRangeByObjectAndZpoint:function(b,c){var d="../api/subscr/contObjects/"+b.id+"/zpoints/"+c.id+"/referencePeriod";return!0===k()?null:a.get(d,t)},getRsoOrganizations:w,getRsoOrganizationsWithId:function(b){if(u(b))return w();
b="../api/rma/contObjects/rsoOrganizations?organizationId="+b;return!0===k()?null:a.get(b,t)},getServiceTypes:function(){return!0===k()?null:a.get("../api/rma/contObjects/contServiceTypes",t)},getSubscrUrl:function(){return"../api/subscr"},getTimezones:function(){var b;b=!0===k()?null:a.get("../api/timezoneDef/all",t);return b},getRmaTreeTemplates:function(){return m},getVzletSystemList:function(){return C},getZpointMetaDestProp:function(b,c){var d;d="../api/subscr/contObjects"+("/"+b+"/zpoints/"+
c+"/metadata/destDb");return!0===k()?null:a.get(d,t)},getZpointMetadataMeasures:function(){return e},getZpointMetaMeasureUnits:function(b,c){var d="../api/subscr/contObjects",d=d+("/"+b+"/zpoints/"+c+"/metadata/measureUnits");return!0===k()?null:a.get(d,t).then(function(a){e={};e.all=a.data;e.all.forEach(function(a,b){E(d,b,e)});g.$broadcast("objectSvc:zpointMetadataMeasuresLoaded")},function(a){console.log(a)})},getZpointMetaSrcProp:function(b,c){var d;d="../api/subscr/contObjects"+("/"+b+"/zpoints/"+
c+"/metadata/srcProp");return!0===k()?null:a.get(d,t)},getZpointMetadata:function(b,c){var d;d="../api/subscr/contObjects"+("/"+b+"/zpoints/"+c+"/metadata");return!0===k()?null:a.get(d,t)},getZpointsDataByObject:function(b,c){b.zpoints=[];var d="../api/subscr/contObjects/"+b.id+"/contZPoints"+c;return!0===k()?null:a.get(d,t)},findObjectById:function(a,b){var c=null;if(!angular.isArray(b)||!angular.isNumber(a))return c;b.some(function(b){if(b.id===a)return c=b,!0});return c},isDirectDevice:function(a){var b=
!1;angular.isDefined(a.activeDataSource)&&null!=a.activeDataSource&&angular.isDefined(a.activeDataSource.subscrDataSource)&&null!=a.activeDataSource.subscrDataSource&&"DEVICE"==a.activeDataSource.subscrDataSource.dataSourceTypeKey&&(b=!0);return b},loadDefaultTreeSetting:function(){return a.get("../api/subscr/subscrPrefValue?subscrPrefKeyname=SUBSCR_OBJECT_TREE_CONT_OBJECTS")},loadFreeObjectsByTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/contObjects/free")},
loadObjectsByTreeNode:function(b,c){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+c+"/contObjects")},loading:!0,loadObjectMeterPeriods:function(){return a.get("../api/subscr/contObjects/meterPeriodSettings")},loadTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b)},loadTrees:function(){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1")},loadTreeTemplateItems:function(b){return a.get("../api/subscr/subscrObjectTreeTemplates/"+
b+"/items")},loadTreeTemplates:b,loadSubscrFreeObjectsByTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/contObjects/free")},loadSubscrObjectsByTreeNode:function(b,c){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+c+"/contObjects")},loadSubscrTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b)},loadSubscrTrees:function(){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1")},promise:H,
putDeviceMetaDataVzlet:function(b){return a.put("../api/subscr/contObjects/"+b.contObject.id+"/deviceObjects/"+b.id+"/metaVzlet",b.metaData)},putDeviceSchedulerSettings:function(b,c,d){return a.put("../api/rma/contObjects/"+b+"/deviceObjects/"+c+"/subscrDataSource/loadingSettings",d)},putObjectsToTreeNode:function(b,c,d){return a.put("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+c+"/contObjects/add",d)},releaseObjectsFromTreeNode:function(b,c,d){return a.put("../api/subscr/subscrObjectTree/contObjectTreeType1/"+
b+"/node/"+c+"/contObjects/remove",d)},rmaPromise:D,saveZpointMetadata:function(b,c,d){return a.put("../api/rma/contObjects/"+b+"/zpoints/"+c+"/metadata",d)},sendDeviceToServer:function(b){var c={};angular.isDefined(b.subscrDataSourceAddr)&&null!==b.subscrDataSourceAddr&&(c.subscrDataSourceAddr=b.subscrDataSourceAddr);angular.isDefined(b.dataSourceTable)&&null!==b.dataSourceTable&&(c.dataSourceTable=b.dataSourceTable);angular.isDefined(b.dataSourceTable1h)&&null!==b.dataSourceTable1h&&(c.dataSourceTable1h=
b.dataSourceTable1h);angular.isDefined(b.dataSourceTable24h)&&null!==b.dataSourceTable24h&&(c.dataSourceTable24h=b.dataSourceTable24h);var d="../api/rma/contObjects/"+b.contObjectId+"/deviceObjects";angular.isDefined(b.id)&&null!==b.id&&(d=d+"/"+b.id);c.subscrDataSourceId=b.subscrDataSourceId;b.editDataSourceInfo=c;return angular.isDefined(b.id)&&null!==b.id?a.put(d,b):a.post(d,b)},setCurrentObject:function(a){c=a},setMeterPeriodForObject:function(b){return a.put("../api/subscr/contObjects/"+b.contObjectId+
"/meterPeriodSettings",b)},setMeterPeriods:function(b){return a.put("../api/subscr/contObjects/meterPeriodSettings",b)},setObjectSettings:function(a){for(var b in a)f[b]=a[b]},sortObjectsByFullName:h,sortObjectsByFullNameEx:function(a){if(angular.isUndefined(a)||null===a||!angular.isArray(a))return!1;var b=[],c=[];a.forEach(function(a){u(a.fullName)?c.push(a):b.push(a)});if(0===b.length)return"No objects with fullName";h(b);Array.prototype.push.apply(c,b);return c},sortObjectsByConObjectFullName:function(a){if(angular.isUndefined(a)||
null===a||!angular.isArray(a))return!1;a.sort(function(a,b){return(u(a.contObject)||u(a.contObject.fullName))&&(u(b.contObject)||u(b.contObject.fullName))?0:u(a.contObject)||u(a.contObject.fullName)?-1:u(b.contObject)||u(b.contObject.fullName)||a.contObject.fullName.toUpperCase()>b.contObject.fullName.toUpperCase()?1:a.contObject.fullName.toUpperCase()<b.contObject.fullName.toUpperCase()?-1:0})},updateTree:function(b){return a.put("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b.id,b)}}}]);app=angular.module("portalNMC");
app.service("reportSvc",["$http","$cookies","$interval","$rootScope","crudGridDataFactoryWithCanceler","mainSvc","$q",function(a,b,d,g,l,k,h){function p(a){a.forEach(function(a){var b=!1;q.some(function(c){if(c.keyname===a.keyname)return b=!0});!1===b&&q.push(angular.copy(a))})}function m(a){if(angular.isArray(a)&&0!==a.length){k.sortNumericItemsBy(a,"serviceOrder");var b=a.map(function(a){return a.keyname}).join(","),c=a.map(function(a){return a.captionShort}).join(", ");a.push({keyname:b,captionShort:c,
isGroup:!0})}}var n={keyname:"WITHOUT",caption:"\u0411\u0435\u0437 \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0438 \u043a \u0442\u0438\u043f\u0443 \u0440\u0435\u0441\u0443\u0440\u0441\u0430",captionShort:"\u0411\u0435\u0437 \u043f\u0440\u0438\u0432\u044f\u0437\u043a\u0438 \u043a \u0442\u0438\u043f\u0443 \u0440\u0435\u0441\u0443\u0440\u0441\u0430","class":"active"},e=!1,c=!1,f=[{name:"METROLOGICAL",caption:"\u041c\u0435\u0442\u0440\u043e\u043b\u043e\u0433\u0438\u044f",prefix:"\u041c","class":"active",
reportTypes:[]},{name:"QUALITY_MONITOR",caption:"\u041c\u043e\u043d\u0438\u0442\u043e\u0440\u0438\u043d\u0433 \u043a\u0430\u0447\u0435\u0441\u0442\u0432\u0430",prefix:"\u041a",reportTypes:[]},{name:"FAULT_DIAGNOSIS",caption:"\u0414\u0438\u0430\u0433\u043d\u043e\u0441\u0442\u0438\u043a\u0430 \u043d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u043e\u0441\u0442\u0435\u0439",prefix:"\u0414",reportTypes:[]},{name:"ANALYTICS",caption:"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u043a\u0430",prefix:"C",
reportTypes:[]},{name:"SERVICE",caption:"\u0421\u043b\u0443\u0436\u0435\u0431\u043d\u044b\u0435",prefix:"C",reportTypes:[]},{name:"OPERATE",caption:"\u041e\u043f\u0435\u0440\u0430\u0442\u0438\u0432\u043d\u044b\u0435",prefix:"\u042d",reportTypes:[]},{name:"ANALITIC",caption:"\u0410\u043d\u0430\u043b\u0438\u0442\u0438\u0447\u0435\u0441\u043a\u0438\u0435",prefix:"\u0410",reportTypes:[]}],r=[{name:"ALL",caption:"\u041f\u043e \u0432\u0441\u0435\u043c \u044d\u043d\u0435\u0440\u0433\u043e\u0440\u0435\u0441\u0443\u0440\u0441\u0430\u043c",
isDefault:!0,isAll:!0},{name:"ELECTRICITY",caption:"\u042d\u043b\u0435\u043a\u0442\u0440\u0438\u0447\u0435\u0441\u0442\u0432\u043e"},{name:"WATER",caption:"\u041e\u0442\u043e\u043f\u043b\u0435\u043d\u0438\u0435, \u0413\u0412\u0421, \u0425\u0412\u0421"}],q=[],v=null,t=null,u=[],w=[],x=function(a,b){if(null===v)return null;l(a,v).query(function(a){k.sortItemsBy(a,"name");b.paramsets=a;b.paramsetsCount=a.length})},E=function(a,b){if(!a.hasOwnProperty("reportPeriodKey")||!a.hasOwnProperty("reportTemplate"))return!1;
var c=!0,d=!1;k.checkUndefinedNull(a.currentReportPeriod)||k.checkUndefinedNull(a.currentReportPeriod.isSettlementMonth)||!0!==a.currentReportPeriod.isSettlementMonth&&!0!==a.currentReportPeriod.isSettlementDay||(d=!0);null===b&&!d&&(c=k.strDateToUTC(a.psStartDateFormatted,"DD.MM.YYYY"),c=new Date(c),d=k.strDateToUTC(a.psEndDateFormatted,"DD.MM.YYYY"),d=new Date(d),c=!isNaN(c.getTime())&&!isNaN(d.getTime()))&&(d=a.psStartDateFormatted,c=a.psEndDateFormatted,k.checkStrForDate(d)&&k.checkStrForDate(c)?
null==d||null==c||""==d||""==c?(console.log("1"),c=!1):(d=k.strDateToUTC(d,"DD.MM.YYYY"),d=null!=d?new Date(d):null,c=k.strDateToUTC(c,"DD.MM.YYYY"),c=null!=c?new Date(c):null,c=null==d||null==c?!1:c>=d):c=!1);return!(null===a.reportPeriodKey||null===a.reportTemplate.id)&&c},v=h.defer(),t={timeout:v.promise};(function(){c=!1;if(null===v)return null;l("../api/reportSettings/reportPeriod",v).query(function(a){w=a;c=!0;g.$broadcast("reportSvc:reportPeriodsIsLoaded")})})();(function(){e=!1;if(null===
v)return null;l("../api/reportSettings/reportType",v).query(function(a){k.sortItemsBy(a,"caption");u=a;f.forEach(function(a){a.reportTypes=[]});var b=[],c={},d,h;for(d=0;d<a.length;d+=1)if(a[d]._enabled&&(k.isSystemuser()||!a[d].isDevMode)){c={};c.reportType=a[d].keyname;c.reportTypeName=a[d].caption;c.reportCategory=a[d].reportCategory;c.resourceCategory=a[d].resourceCategory;c.contServiceTypes=a[d].contServiceTypes;c.previewUrl=a[d].previewUrl;m(c.contServiceTypes);p(c.contServiceTypes);c.suffix=
a[d].suffix;c.reportMetaParamSpecialList=a[d].reportMetaParamSpecialList;c.reportMetaParamCommon=a[d].reportMetaParamCommon;c.reportMetaParamSpecialList_flag=0<a[d].reportMetaParamSpecialList.length?!0:!1;for(h=0;h<f.length;h+=1)0===c.reportCategory.localeCompare(f[h].name)&&f[h].reportTypes.push(c);b.push(c)}u=b;k.sortItemsBy(q,"captionShort");q.push(n);g.$broadcast("reportSvc:reportTypesIsLoaded");e=!0})})();return{checkPSRequiredFieldsOnSave:function(a,b,c,d){var e;if(k.checkUndefinedNull(a))return console.log("Report type = "+
a),e="\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u043f\u0440\u043e\u0432\u0435\u0440\u0438\u0442\u044c \u0442\u0438\u043f \u043e\u0442\u0447\u0435\u0442\u0430.\n",!1;if(!a.hasOwnProperty("reportMetaParamCommon"))return!0;var f=!0;e="\u041d\u0435 \u0432\u0441\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430 \u043e\u0442\u0447\u0435\u0442\u0430 \u0437\u0430\u0434\u0430\u043d\u044b:\n";k.checkUndefinedEmptyNullValue(b.outputFileType)&&
(e+="\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430: \n",e+="\u2022 \u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u0442\u0438\u043f \u0444\u0430\u0439\u043b\u0430\n",f=!1);var g=!1;k.checkUndefinedNull(b.currentReportPeriod)||k.checkUndefinedNull(b.currentReportPeriod.isSettlementMonth)||!0!==b.currentReportPeriod.isSettlementMonth&&!0!==b.currentReportPeriod.isSettlementDay||(g=!0);if(null==c&&!g){var g=k.strDateToUTC(b.psStartDateFormatted,"DD.MM.YYYY"),
h=new Date(g),l=k.strDateToUTC(b.psEndDateFormatted,"DD.MM.YYYY"),m=new Date(l);!a.reportMetaParamCommon.startDateRequired||!isNaN(h.getTime())&&k.checkStrForDate(b.psStartDateFormatted)||(f&&(e+="\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430: \n"),e+="\u2022 \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u043e \u043d\u0430\u0447\u0430\u043b\u043e \u043f\u0435\u0440\u0438\u043e\u0434\u0430\n",f=
!1);!a.reportMetaParamCommon.startDateRequired||!isNaN(m.getTime())&&k.checkStrForDate(b.psEndDateFormatted)||(f&&(e+="\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430: \n"),e+="\u2022 \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d \u043a\u043e\u043d\u0435\u0446 \u043f\u0435\u0440\u0438\u043e\u0434\u0430\n",f=!1);a.reportMetaParamCommon.startDateRequired&&!isNaN(m.getTime())&&!isNaN(h.getTime())&&g>
l&&(f&&(e+="\u041e\u0441\u043d\u043e\u0432\u043d\u044b\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430: \n"),e+="\u2022 \u041d\u0435\u043a\u043e\u0440\u0440\u0435\u043a\u0442\u043d\u043e \u0437\u0430\u0434\u0430\u043d\u044b \u0433\u0440\u0430\u043d\u0438\u0446\u044b \u043f\u0435\u0440\u0438\u043e\u0434\u0430\n",f=!1)}a.reportMetaParamCommon.oneContObjectRequired&&0===b.selectedObjects.length&&a.reportMetaParamCommon.manyContObjectsRequired&&(e+="\u2022 \u0414\u043e\u043b\u0436\u0435\u043d \u0431\u044b\u0442\u044c \u0432\u044b\u0431\u0440\u0430\u043d \u0445\u043e\u0442\u044f \u0431\u044b \u043e\u0434\u0438\u043d \u043e\u0431\u044a\u0435\u043a\u0442\n",
f=!1);a.reportMetaParamCommon.oneContObjectRequired&&0===b.selectedObjects.length&&!a.reportMetaParamCommon.manyContObjectsRequired&&(e+="\u2022 \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u043e\u0434\u0438\u043d \u043e\u0431\u044a\u0435\u043a\u0442\n",f=!1);!0===a.reportMetaParamCommon.manyContObjectsRequired&&1>=b.selectedObjects.length&&(e+="\u2022 \u041d\u0435\u043e\u0431\u0445\u043e\u0434\u0438\u043c\u043e \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u043d\u0435\u0441\u043a\u043e\u043b\u044c\u043a\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u043e\u0432\n",
f=!1);!a.reportMetaParamCommon.manyContObjectsRequired&&1<b.selectedObjects.length&&a.reportMetaParamCommon.oneContObjectRequired&&(e+="\u2022 \u041d\u0435\u043b\u044c\u0437\u044f \u0432\u044b\u0431\u0440\u0430\u0442\u044c \u0431\u043e\u043b\u0435\u0435 \u043e\u0434\u043d\u043e\u0433\u043e \u043e\u0431\u044a\u0435\u043a\u0442\u0430\n",f=!1);a.reportMetaParamCommon.manyContObjectsZipOnly&&(1<b.selectedObjects.length||0===b.selectedObjects.length)&&(b.outputFileZipped=!0);var n=!0;k.checkUndefinedNull(b.currentParamSpecialList)||
b.currentParamSpecialList.forEach(function(a,b,c){!a.paramSpecialRequired||a.textValue||a.numericValue||a.oneDateValue||a.oneDateValueFormatted||a.startDateValue||a.endDateValue||a.directoryValue||(n&&(e+="\u0414\u043e\u043f\u043e\u043b\u043d\u0438\u0442\u0435\u043b\u044c\u043d\u044b\u0435 \u0441\u0432\u043e\u0439\u0441\u0442\u0432\u0430: \n"),e+='\u2022 \u041d\u0435 \u0437\u0430\u0434\u0430\u043d \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440 "'+a.paramSpecialCaption+'" \n',n=f=!1)});"\u041d\u0435 \u0432\u0441\u0435 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u044b \u0432\u0430\u0440\u0438\u0430\u043d\u0442\u0430 \u043e\u0442\u0447\u0435\u0442\u0430 \u0437\u0430\u0434\u0430\u043d\u044b:\n"!=
e&&(0===d.toUpperCase().localeCompare("CREATE")&&(e+="\n \u042d\u0442\u043e\u0442 \u0432\u0430\u0440\u0438\u0430\u043d\u0442 \u043e\u0442\u0447\u0435\u0442\u0430 \u043d\u0435\u043b\u044c\u0437\u044f \u0437\u0430\u043f\u0443\u0441\u0442\u0438\u0442\u044c \u0431\u0435\u0437 \u0443\u0442\u043e\u0447\u043d\u0435\u043d\u0438\u044f \u0438\u043b\u0438 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0432 \u0440\u0430\u0441\u0441\u044b\u043b\u043a\u0435, \u043d\u0435 \u0437\u0430\u0434\u0430\u0432 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u044b\u0445 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u043e\u0432. \u041f\u0440\u043e\u0434\u043e\u043b\u0436\u0438\u0442\u044c?"),
f=!1);f=f&&E(b,c);f||(b.showParamsBeforeRunReport=!0);return{flag:f,message:e}},getContServiceTypes:function(){return q},getDefaultResourceCategory:function(){var a=null;r.some(function(b){if(!0===b.isDefault)return a=b,!0});return a},getParamsetsForTypes:function(a,b){var c;if(0!==a.length)for(c=0;c<a.length;c+=1)"undefined"!==typeof a[c].suffix&&x("../api/reportParamset"+b+a[c].suffix,a[c])},getReportCategories:function(){return f},getReportPeriods:function(){return w},getReportPeriodsIsLoaded:function(){return c},
getReportTypes:function(){return u},getReportTypesIsLoaded:function(){return e},getRequestCanceler:function(){return v},getResourceCategories:function(){return r},loadReportsContextLaunch:function(){return!0===(k.checkUndefinedNull(v)||k.checkUndefinedNull(t))?null:a.get("../api/reportParamset/menu/contextLaunch",t)}}}]);app.filter("resourceCategoryFilter",function(){return function(a,b){if(!0===b.isAll)return a;var d=[];a.forEach(function(a){a.resourceCategory===b.name&&d.push(a)});return d}});
app.filter("serviceTypesFilter",function(){return function(a,b){if("ALL"===b.keyname)return a;var d=[];a.forEach(function(a){angular.isArray(a.contServiceTypes)&&(!angular.isUndefined(a.contServiceTypes)&&0!==a.contServiceTypes.length||"WITHOUT"!==b.keyname||d.push(a),a.contServiceTypes.some(function(g){if(angular.isUndefined(g)||angular.isUndefined(b)||!0!==g.isGroup)return!1;if(g.keyname===b.keyname)return d.push(a),!0}))});return d}});
app.filter("reportTypesCountInCategoryByServiceType",["$filter",function(a){return function(b,d){return a("serviceTypesFilter")(d.reportTypes,b).length||0}}]);app.filter("notEmptyContServiceTypesByReportTypes",["$filter",function(a){return function(b,d){var g=[];angular.isArray(b)?b.forEach(function(b){var k=[];angular.isDefined(d)&&(k=a("serviceTypesFilter")(d.reportTypes,b));0!==k.length&&g.push(b)}):g=b;return g}}]);
app.filter("withReportTypes",[function(){return function(a){var b=[];angular.isArray(a)?a.forEach(function(a){0!==a.reportTypes.length&&b.push(a)}):b=a;return b}}]);app.filter("notEmptyCategories",[function(){return function(a,b){var d=[];angular.isArray(a)?a.forEach(function(a){var b=!1;a.reportTypes.some(function(a){if(a.paramsetsCount&&a.paramsetsCount===a.checkedParamsetsCount)return b=!0});!0===b&&d.push(a)}):d=a;return d}}]);app=angular.module("portalNMC");app.service("securityCheck",["$http",function(a){return{isAuthenficated:function(){return a({url:"../api/securityCheck/isAuthenticated",method:"GET",timeout:5E3}).then(function(a){return a.data.success},function(a){return!1})["catch"](function(a){return!1})}}}]);angular.module("portalNMC").service("subscrCabinetsSvc",["$http","$cookies","$interval","$rootScope",function(a,b,d,g){function l(a){n(a,"fullName")}var k=[],h=null,p={},m=function(a){var b=!1;if(angular.isUndefined(a)||null==a)b=!0;return b},n=function(a,b){if(!angular.isArray(a))return"Input value is no array.";if(m(b))return"Field for sort is undefined or null.";a.sort(function(a,c){return m(a[b])&&m(c[b])?0:m(a[b])?-1:m(c[b])||a[b].toUpperCase()>c[b].toUpperCase()?1:a[b].toUpperCase()<c[b].toUpperCase()?
-1:0})},e=null;g.$on("subscrCabinets:requestReloadCabinetData",function(){e=a.get("../api/subscr/subscrCabinet/contObjectCabinetInfo")});b=function(b){a.get(b).then(function(a){k=angular.copy(a.data)},function(a){console.log(a)})};b("../api/subscr/subscrObjectTreeTemplates");e=a.get("../api/subscr/subscrCabinet/contObjectCabinetInfo");return{createTree:function(b){return a.post("../api/rma/subscrObjectTree/contObjectTreeType1",b)},createCabinets:function(b){return m(b)||!angular.isArray(b)?null:a.put("../api/subscr/subscrCabinet/create",
b)},deleteCabinets:function(b){return m(b)||!angular.isArray(b)?null:a.put("../api/subscr/subscrCabinet/delete",b)},deleteTree:function(b){return a["delete"]("../api/rma/subscrObjectTree/contObjectTreeType1/"+b)},deleteTreeNode:function(b,d){return a["delete"]("../api/rma/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+d)},getCurrentCabinet:function(){return h},getCabinet:function(b){return angular.isUndefined(b)||null==b?"Cabinet id is null or undefined":a.get("../api/subscr/subscrCabinet/contObjectCabinetInfo/"+
b)},getCabinetSettings:function(){return p},getLoadingStatus:function(){return!0},getCabinetsUrl:function(){return"../api/subscr/subscrCabinet"},getPromise:function(){return e},getRmaCabinet:function(b){return angular.isUndefined(b)||null==b?"Cabinet id is null or undefined":a.get("../api/rma/contObjects/"+b)},getRmaCabinetsData:function(){return a.get("../api/rma/contObjects")},getRmaCabinetsUrl:function(){return"../api/rma/contObjects"},getRmaPromise:function(){return null},getSubscrUrl:function(){return"../api/subscr"},
getRmaTreeTemplates:function(){return k},findCabinetById:function(a,b){var c=null;if(!angular.isArray(b))return c;b.some(function(b){if(b.id===a)return c=b,!0});return c},loadFreeCabinetsByTree:function(b){return a.get("../api/rma/subscrObjectTree/contObjectTreeType1/"+b+"/contCabinets/free")},loadCabinetsByTreeNode:function(b,d){return a.get("../api/rma/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+d+"/contCabinets")},loading:!0,loadTree:function(b){return a.get("../api/rma/subscrObjectTree/contObjectTreeType1/"+
b)},loadTrees:function(){return a.get("../api/rma/subscrObjectTree/contObjectTreeType1")},loadTreeTemplateItems:function(b){return a.get("../api/subscr/subscrObjectTreeTemplates/"+b+"/items")},loadTreeTemplates:b,loadSubscrFreeCabinetsByTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/contCabinets/free")},loadSubscrCabinetsByTreeNode:function(b,d){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+d+"/contCabinets")},loadSubscrTree:function(b){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1/"+
b)},loadSubscrTrees:function(){return a.get("../api/subscr/subscrObjectTree/contObjectTreeType1")},promise:e,putCabinetsToTreeNode:function(b,d,e){return a.put("../api/rma/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+d+"/contCabinets/add",e)},releaseCabinetsFromTreeNode:function(b,d,e){return a.put("../api/rma/subscrObjectTree/contObjectTreeType1/"+b+"/node/"+d+"/contCabinets/remove",e)},resetPassword:function(b){return m(b)||!angular.isArray(b)?null:a.put("../api/subscr/subscrCabinet/subscrUser/resetPassword",
b)},rmaPromise:null,sendLDByEmail:function(b){return m(b)||!angular.isArray(b)?null:a.put("../api/subscr/subscrCabinet/subscrUser/sendPassword",b)},setCabinetSettings:function(a){for(var b in a)p[b]=a[b]},setCurrentCabinet:function(a){h=a},sortCabinetsByFullName:l,sortCabinetsByFullNameEx:function(a){if(angular.isUndefined(a)||null==a||!angular.isArray(a))return!1;var b=[],c=[];a.forEach(function(a){m(a.fullName)?c.push(a):b.push(a)});if(0==b.length)return"No Cabinets with fullName";l(b);Array.prototype.push.apply(c,
b);return c},sortCabinetsByContObjectFullName:function(a){if(angular.isUndefined(a)||null==a||!angular.isArray(a))return!1;a.sort(function(a,b){return(m(a.contObjectInfo)||m(a.contObjectInfo.fullName))&&(m(b.contObjectInfo)||m(b.contObjectInfo.fullName))?0:m(a.contObjectInfo)||m(a.contObjectInfo.fullName)?-1:m(b.contObjectInfo)||m(b.contObjectInfo.fullName)||a.contObjectInfo.fullName.toUpperCase()>b.contObjectInfo.fullName.toUpperCase()?1:a.contObjectInfo.fullName.toUpperCase()<b.contObjectInfo.fullName.toUpperCase()?
-1:0})},updateCabinet:function(b){return m(b)||m(b.cabinet)?null:a.put("../api/subscr/subscrCabinet/subscrUser/"+b.cabinet.subscrUser.id,b.cabinet.subscrUser)},updateTree:function(b){return a.put("../api/rma/subscrObjectTree/contObjectTreeType1/"+b.id,b)}}}]);
